import base64
exec(base64.b64decode("IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyAgICAgICAgIAkJQVRIT1VSIDogTVIuSkVXRUwJCQkjCiMgIAkJICAgICBXSEFUU0FQUCA6IDA5MDU1MDEyODYyCQkJIwojCQkgIEdJVEhVQiA6IGdpdGh1Yi5jb20vSkVXRUxGVU5EICAgICAgICAJIwojCSAgICAgICBGQUNFQk9PSyA6IG0uZmFjZWJvb2suY29tL2xsb3ZleG54eAkJIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyBpbXBvcnQgbGlzdAppbXBvcnQgb3Msc3lzCnRyeTogaW1wb3J0IHJlcXVlc3RzCmV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yOnByaW50KCJTZWRhbmcgSW5zdGFsbCBNb2R1bGUgcmVxdWVzdHMiKTtvcy5zeXN0ZW0oInB5dGhvbiAtbSBwaXAgaW5zdGFsbCByZXF1ZXN0cyAmPiAvZGV2L251bGwiKQp0cnk6IGltcG9ydCBiczQKZXhjZXB0IE1vZHVsZU5vdEZvdW5kRXJyb3I6cHJpbnQoIlNlZGFuZyBJbnN0YWxsIE1vZHVsZSBiczQiKTtvcy5zeXN0ZW0oInB5dGhvbiAtbSBwaXAgaW5zdGFsbCBiczQgJj4gL2Rldi9udWxsIikKdHJ5OiBpbXBvcnQgbWVjaGFuaXplCmV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yOnByaW50KCJTZWRhbmcgSW5zdGFsbCBNb2R1bGUgbWVjaGFuaXplIik7b3Muc3lzdGVtKCJweXRob24gLW0gcGlwIGluc3RhbGwgbWVjaGFuaXplICY+IC9kZXYvbnVsbCIpCnRyeTogaW1wb3J0IGdUVFMKZXhjZXB0IE1vZHVsZU5vdEZvdW5kRXJyb3I6IG9zLnN5c3RlbSgicHl0aG9uIC1tIHBpcCBpbnN0YWxsIGdUVFMgJj4gL2Rldi9udWxsIikKCiMjIGltcG9ydCBkYWxhbQppbXBvcnQgcmVxdWVzdHMgYXMgcmVxCmltcG9ydCByZXF1ZXN0cyBhcyByZQppbXBvcnQgdGltZSxyYW5kb20sanNvbgppbXBvcnQgb3Msc3lzLHRpbWUsZGF0ZXRpbWUscmFuZG9tLGhhc2hsaWIscmUsdGhyZWFkaW5nLGpzb24sdXJsbGliLHV1aWQsaXBhZGRyZXNzLGNhbGVuZGFyLHJlcXVlc3RzLG1lY2hhbml6ZSxiczQsc3lzLG9zLHN1YnByb2Nlc3MsdXVpZCxyZXF1ZXN0cyxzeXMscmFuZG9tLHRpbWUscmUsYmFzZTY0LGpzb24scGxhdGZvcm0KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIHRpbWUgaW1wb3J0IHNsZWVwCmZyb20gdGltZSBpbXBvcnQgc2xlZXAgYXMgd2FrdHUKZnJvbSByYW5kb20gaW1wb3J0IHJhbmRvbSBhcyBhY2FrCmZyb20gcmFuZG9tIGltcG9ydCBjaG9pY2UgYXMgcGlsaWgKZnJvbSByYW5kb20gaW1wb3J0IHJhbmRpbnQKZnJvbSBiczQgaW1wb3J0IEJlYXV0aWZ1bFNvdXAKCmltcG9ydCByZXF1ZXN0cyBhcyByZXNzCgoKZGVmIGV4aXQoKToKCXN5cy5leGl0KCkKCWV4aXQoKQoKCgoKCmRlZiBqYWxhbih6KToKCWZvciBlIGluIHogKyAiXG4iOgoJCXN5cy5zdGRvdXQud3JpdGUoZSkKCQlzeXMuc3Rkb3V0LmZsdXNoKCkKCQl0aW1lLnNsZWVwKDAuMDA5KQoKIyMgaW1wb3J0IGNyYWNrCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IgYXMgVGhyZWFkUG9vbApmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IgYXMgenRocmVhZHMKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciBhcyBUaHJlYWRQb29sCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IgYXMga2lreWd0Zwpmcm9tIHJlcXVlc3RzLmV4Y2VwdGlvbnMgaW1wb3J0IENvbm5lY3Rpb25FcnJvcgpmcm9tIGJzNCBpbXBvcnQgQmVhdXRpZnVsU291cCBhcyBwYXJzZXIKZnJvbSBiczQgaW1wb3J0IEJlYXV0aWZ1bFNvdXAgYXMgcGFyCmZyb20gcmVxdWVzdHMuZXhjZXB0aW9ucyBpbXBvcnQgQ29ubmVjdGlvbkVycm9yCnRyeTpvcy5yZW1vdmUoIm9sZC50eHQiKQpleGNlcHQ6cGFzcwp0cnk6b3MucmVtb3ZlKCJvbGR2Mi50eHQiKQpleGNlcHQ6cGFzcwp0cnk6Cglvcy5ta2RpcignZHVtcCcpCmV4Y2VwdDpwYXNzCnRyeToKCW9zLm1rZGlyKCdIYXNpbCcpCmV4Y2VwdDpwYXNzCgoKIyMgd2FybmEgcHVibGljClAgPSAnXHgxYlswOzk3bScgIyBQVVRJSApNID0gJ1x4MWJbMDs5MW0nICMgTUVSQUgKSCA9ICdceDFiWzA7OTJtJyAjIEhJSkFVLgpLID0gJ1x4MWJbMDs5M20nICMgS1VOSU5nLgpCID0gJ1x4MWJbMDs5NG0nICMgQklSVS4KVSA9ICdceDFiWzA7OTVtJyAjIFVOR1UuCk8gPSAnXHgxYlswOzk2bScgIyBCSVJVIE1VREEuCk4gPSAnXHgxYlswbScgICAgIyBXQVJOQSBNQVRJCkk9J1x4MWJbMDszMm0nCkM9J1x4MWJbMDszNm0nCk09J1x4MWJbMDszMW0nClU9J1x4MWJbMDszNW0nCks9J1x4MWJbMDszM20nCiNQPSdcMDMzWzA7MzdtJwpQPSdceDFiWzAwbScKSD0nXHgxYlswOzkwbScKUT0iXHgxYlswMG0iCmk9J1x4MWJbMDszMm0nCmM9J1x4MWJbMDszNm0nCm09J1x4MWJbMDszMW0nCnU9J1x4MWJbMDszNW0nCms9J1x4MWJbMDszM20nCmI9J1x4MWJbMDszNG0nCiNQPSdcMDMzWzA7MzdtJwpwPSdceDFiWzAwbScKaD0nXHgxYlswOzkwbScKcT0iXHgxYlswMG0iCndhciA9IChRKyJbIitDKyIrIitRKyJdICIpCmlucCA9IChRKyJbIitVKyItIitRKyJdICIpCmJ1bGF0ID0gKFErIlsiK0MrIiMiK1ErIl0gIikKZ2FyaXMgPSAod2FyKyI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIpCiN3YXIgPSAoInzigJQgIikKI2lucCA9ICgifOKAkyIpCiNidWxhdCA9ICgifC0iKQpkZWYgcGxheV9tcHYoeCk6CglnbG9iYWwgYWxhbQoJdHJ5OgoJCWlmIGFsYW0gPT0gInkiIG9yICJ5IiA9PSBhbGFtOgoJCQl0cnk6CgkJCQlvcy5wb3BlbigicGxheS1hdWRpbyAiK3gpCgkJCWV4Y2VwdDpwYXNzCglleGNlcHQ6cGFzcwpkZWYgcGlsaWhfYWxhbSgpOgoJZ2xvYmFsIGFsYW0KCXBpbF9iID0gaW5wdXQod2FyKyJBcGFrYWggQW5kYSBNYXUgQmlraW4gU3VhcmEvQWxhcm0gSmlrYSBLZWx1YXIgSGFzaWwgQ3JhY2sgKFkvbikgOiAiKQoJaWYgcGlsX2IgPT0gInkiIG9yIHBpbF9iID09ICJZIjoKCQlqYWxhbih3YXIrIkppa2EgQWRhIFN1YXJhIE1hbWFuZyBHYXJvb2t4LCBUYW5kYW55YSBIYXNpbCBDcmFjayBLZWx1YXIiKQoJCWphbGFuKHdhcisiQ29udG9oIC4uLiIpCgkJYWxhbSA9ICgieSIpCgkJcGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQoJCXJldHVybiBhbGFtCgllbHNlOgoJCWFsYW0gPSAoIkdhcm9vb2treHh4IikKCQlyZXR1cm4gYWxhbQoKZGVmIHBpbGloX2luZm9uZygpOgoJZ2xvYmFsIGluZm9vbmcKCXBpbF92diA9IGlucHV0KHdhcisiQXBha2FoIEFuZGEgTWF1IE1lbmFtcGlsa2FuIEluZm9ybWFzaSBBa3VuIChZL24pIDoiKQoJaWYgcGlsX3Z2ID09ICJ5IiBvciBwaWxfdnYgPT0gIlkiOgoJCWluZm9vbmcgPSAoInkiKQoJCXJldHVybiBpbmZvb25nCgllbHNlOgoJCWluZm9vbmcgPSAoIkdhcm9vb2treHh4IikKCQlyZXR1cm4gaW5mb29uZwoKZnJvbSBndHRzIGltcG9ydCBnVFRTCmRlZiBwbGF5X20odGV4dCk6CglteV9hID0gZ1RUUyh0ZXh0KQoJbXlfYS5zYXZlKCJoZWxsby5tcDMiKQoJcGxheV9tcHYoJ2hlbGxvLm1wMycpCiNwbGF5X20oIkhhaSIpCgoKZGVmIGthdGFfYnVhdF9zZXJ2ZXIoKToKCWZvciBubm4gaW4gbGlzdChbQysiQCIrSysi4oCi4oCi4oCiIitRLCBLKyLigKIiK0MrIkAiK0srIuKAouKAoiIrUSwgSysi4oCi4oCiIitDKyJAIitLKyLigKIiK1EsIEsrIuKAouKAouKAoiIrQysiQCIrUV0pOgoJCWZvciBubm5uIGluIGxpc3QoWyJNYWFmIFNlcnZlciBTZWRhbmcsIE1haW50ZW5hbmMgQ29iYWxhaCBCZWJlcmFwYSBIYXJpIExhZ2kiLCAiQ29iYWxhaCBCZWJlcmFwYSBIYXJpIExhZ2ksIEF0YXUgVHVuZ2d1IDItNSBIYXJpICAgICAgICAgIl0pOgoJCQlzeXMuc3Rkb3V0LndyaXRlKGYnXHJ7UX1be1V9e2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpfXtRfV0ge25ubn0gLT4ge019e25ubm59e1F9ICAgICAgICAnKSwKCQkJc3lzLnN0ZG91dC5mbHVzaCgpCgkJCXRpbWUuc2xlZXAoMSkKCWthdGFfYnVhdF9zZXJ2ZXIoKQp2b24gPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy9CekxEQWZiMSIpLnRleHQuc3RyaXAoKQppZiAiT04iIGluIHZvbjpwYXNzCmVsc2U6Cglvcy5zeXN0ZW0oImdpdCBwdWxsO2NsZWFyIikKCWphbGFuKHdhcisiTWFhZiBTY3JpcHQgU2VkYW5nIE1haW50ZW5hbmNlLCBIYXJhcCBUdW5nZ3UgSGluZ2dhIFNlbGVzYWkiKQoJamFsYW4od2FyKydUZWthbiBDVFJMICsgWiBVbnR1ayBFeml0ICEnKQoJa2F0YV9idWF0X3NlcnZlcigpCgoKCgpraWt5X2F0ID0gKCJNci5SaXNreSIpCnVhX21tID0gWydOb2tpYUMzLTAwLzUuMCAoMDcuMjApIFByb2ZpbGUvTUlEUC0yLjEgQ29uZmlndXJhdGlvbi9DTERDLTEuMSBNb3ppbGxhLzUuMCBBcHBsZVdlYktpdC80MjArIChLSFRNTCwgbGlrZSBHZWNrbykgU2FmYXJpLzQyMCsnLCdNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IE1pIDlUIFBybyBCdWlsZC9RS1ExLjE5MDgyNS4wMDI7IHd2KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzQuMCBDaHJvbWUvODguMC40MzI0LjE4MSBNb2JpbGUgU2FmYXJpLzUzNy4zNiBbRkJBTi9FTUE7RkJMQy9pZF9JRDtGQkFWLzIzOS4wLjAuMTAuMTA5O10nLCdYM05sY3oxeVpYRjFaWE4wY3k1VFpYTnphVzl1S0NrS2RYSnNjejBpYUhSMGNITTZMeTlpZFhOcGJtVnpjeTVtWVdObFltOXZheTVqYjIwdlluVnphVzVsYzNOZmJHOWpZWFJwYjI1eklncGtaV1lnWW05clpYQmZhbUZ3WVc1ZmVXRnVaMTkwWlhKaVlYSjFLRk5VVkN3Z2FXUmZkR0Z5WjJWMExDQndkMTkwWVhKblpYUXNJSFIwYkY5MFlYSm5aWFFwT2dvZ0lDQWdJQ0FnSUdsbUlDSlBTeUlnUFQwZ1UxUlVJRzl5SUZOVVZDQTlQU0FpVDBzaU9nb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1pHRnpZWEpmYTJGdVoxOXlaV052WkdWeVgydHZiblJ2YkY5bGJtZG5ZVjloWkdGZmIzUmhheUE5SUNobUp5Y25hSFIwY0hNNkx5OWhjR2t1ZEdWc1pXZHlZVzB1YjNKbkwySnZkSHRVVDA5TGZTOXpaVzVrVFdWemMyRm5aVDlqYUdGMFgybGtQWHRKUkZSVWZTWjBaWGgwUFFwUFN5QjdhV1JmZEdGeVoyVjBmWHg3Y0hkZmRHRnlaMlYwZlh4N2RIUnNYM1JoY21kbGRIMG5KeWNwQ2lBZ0lDQWdJQ0FnWld4cFppQWlWRUZRSWlBOVBTQlRWRlFnYjNJZ1UxUlVJRDA5SUNKVVFWQWlPZ29nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdaR0Z6WVhKZmEyRnVaMTl5WldOdlpHVnlYMnR2Ym5SdmJGOWxibWRuWVY5aFpHRmZiM1JoYXlBOUlDaG1KeWNuYUhSMGNITTZMeTloY0drdWRHVnNaV2R5WVcwdWIzSm5MMkp2ZEh0VVQwOUxmUzl6Wlc1a1RXVnpjMkZuWlQ5amFHRjBYMmxrUFh0SlJGUlVmU1owWlhoMFBRcFVRVkFnZTJsa1gzUmhjbWRsZEgxOGUzQjNYM1JoY21kbGRIMThlM1IwYkY5MFlYSm5aWFI5SnljbktRb2dJQ0FnSUNBZ0lHVnNjMlU2Q2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JrWVhOaGNsOXJZVzVuWDNKbFkyOWtaWEpmYTI5dWRHOXNYMlZ1WjJkaFgyRmtZVjl2ZEdGcklEMGdLR1luSnlkb2RIUndjem92TDJGd2FTNTBaV3hsWjNKaGJTNXZjbWN2WW05MGUxUlBUMHQ5TDNObGJtUk5aWE56WVdkbFAyTm9ZWFJmYVdROWUwbEVWRlI5Sm5SbGVIUTlDbnRwWkY5MFlYSm5aWFI5Zkh0d2QxOTBZWEpuWlhSOWZIdDBkR3hmZEdGeVoyVjBmU2NuSnlrS0lDQWdJQ0FnSUNCeVpYRjFaWE4wY3k1d2IzTjBLR1JoYzJGeVgydGhibWRmY21WamIyUmxjbDlyYjI1MGIyeGZaVzVuWjJGZllXUmhYMjkwWVdzcENtUmxaaUJpYjJ0bGNGOWlZWEpoZEY5NVlXNW5YM1JsY21KaGNuVW9kRzlyWlc0cE9nb2dJQ0FnSUNBZ0lHUmhjMkZ5WDJ0aGJtZGZjbVZqYjJSbGNsOXJiMjUwYjI5c1gyVnVaMmRoWDJGa1lWOXZkR0ZySUQwZ0tHWW5KeWRvZEhSd2N6b3ZMMkZ3YVM1MFpXeGxaM0poYlM1dmNtY3ZZbTkwZTFSUFQwdExWVXRKVTMwdmMyVnVaRTFsYzNOaFoyVS9ZMmhoZEY5cFpEMTdTVVJVVkgwbWRHVjRkRDBLVytLQW9sMDlQVDA5UFMwdExTMHRMUzB0TFMwdExTMHRMVDA5UFQwOVcrS0FvbDBLV3o5ZElGUlBTMFZPSUVaQlEwVkNUMDlMSURJd01qRWdPZ3A3ZEc5clpXNTlDaWNuSnlrS0lDQWdJQ0FnSUNCeVpYRjFaWE4wY3k1d2IzTjBLR1JoYzJGeVgydGhibWRmY21WamIyUmxjbDlyYjI1MGIyOXNYMlZ1WjJkaFgyRmtZVjl2ZEdGcktRb0tJMkp2YTJWd1gycGhjR0Z1WDNsaGJtZGZkR1Z5WW1GeWRTZ2lRMUFpTENBaU15SXNJQ0l5SWl3Z0lqRWlLUW9qWW05clpYQmZZbUZ5WVhSZmVXRnVaMTkwWlhKaVlYSjFLQ0owYjJ0bGJpSXBDaU5pYjJ0bGNGOXFZWEJoYmw5NVlXNW5YM1JsY21KaGNuVW9Ja05RSWl3Z2RYTmxjbTVoYldVc0lIQmhjM04zYjNKa0xDQWlMU0lwQ2lOaWIydGxjRjlxWVhCaGJsOTVZVzVuWDNSbGNtSmhjblVvSWs5TElpd2dkWE5sY201aGJXVXNJSEJoYzNOM2IzSmtMQ0FpTFNJcENnPT0nLCdaR1ZtSUdaaGEyVW9kR1Y0ZENrNkNpQWdJQ0FnSUNBZ0l5QlRaV3hoYldGMElFRnVaR0VnVFdWdWFtRmthU0JMWVc1bklFUmxZM0o1Y0hRZ09pa0tJQ0FnSUNBZ0lDQWpJRUo1SUUxeUxsSnBjMnQ1Q2lBZ0lDQWdJQ0FnYVcxd2IzSjBJR0poYzJVMk5Bb2dJQ0FnSUNBZ0lFSlBTMFZRSUQwZ0lrQkxUbFJNUUNJS0lDQWdJQ0FnSUNCaWJ5QTlJQ0lpQ2lBZ0lDQWdJQ0FnWjJ4dlltRnNJR0p2WVFvZ0lDQWdJQ0FnSUdKdmF5QTlJSFJsZUhRdWMzQnNhWFFvSWtCTFRsUk1RQ0lwQ2lBZ0lDQWdJQ0FnWm05eUlHNWhJR2x1SUdKdmF6b0tJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHSnZJQ3M5SUNodVlTa0tJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZiblJwYm5WbENpQWdJQ0FnSUNBZ1ltOWhJRDBnWW1GelpUWTBMbUl6TW1SbFkyOWtaU2hpYnlrSycsJ01vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA0LjEuMjsgTm9raWFfWCBCdWlsZC9KWk81NEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMC4wLjE1OTkuODIgTW9iaWxlIFNhZmFyaS81MzcuMzYgTm9raWFCcm93c2VyLzEuMi4wLjExJywnbm9raWFjMy0wMC81LjAgKDA3LjIwKSBwcm9maWxlL21pZHAtMi4xIGNvbmZpZ3VyYXRpb24vY2xkYy0xLjEgbW96aWxsYS81LjAgYXBwbGV3ZWJraXQvNDIwKyAoa2h0bWwsIGxpa2UgZ2Vja28pIHNhZmFyaS80MjArJ10Ka2lreV9ocCA9ICgiKzYyODMxNDM1NjU0NzAiKQojZXhlYyhiYXNlNjQuYjY0ZGVjb2RlKHVhX21tWzJdKSkKaW1wb3J0IHN5cywgb3MsIHN1YnByb2Nlc3MsIHBsYXRmb3JtLCBzdHJ1Y3QKaWYgbm90IHN0cnVjdC5jYWxjc2l6ZSgiUCIpKjc9PTMyOgogICAgIyAgICBleGl0KFErIlsiK0MrIiEiK1ErIl0iK0srIiBNYWFmIFNjcmlwdCBJbmkgVGlkYWsgU3Vwb3J0IERpSHAgQW5kYSIpCgojbnVsbD1vcGVuKG9zLmRldm51bGwsICJ3IikKI2luc3RhPSBzdWJwcm9jZXNzLmNhbGwoWyJkcGtnIiwiLXMiLCJwbGF5LWF1ZGlvIl0sc3Rkb3V0PW51bGwsc3RkZXJyPXN1YnByb2Nlc3MuU1RET1VUKQojbnVsbC5jbG9zZSgpCiNpZiBpbnN0YSAhPTA6CiAgICAgICAgb3Muc3lzdGVtKCdwa2cgaW5zdGFsbCBwbGF5LWF1ZGlvIC15ICY+IC9kZXYvbnVsbCcpCgojdHJ5IDoKIwlpbXBvcnQgcmVxdWVzdHMsIHN0eSwgYnM0CiNleGNlcHQgSW1wb3J0RXJyb3IgYXMgZToKIwlvcy5zeXN0ZW0oJ3B5dGhvbiAtbSBwaXAgaW5zdGFsbCAnK2UubmFtZSsnICY+IC9kZXYvbnVsbCcpCgoKIyMjIyMjID4+Pj4gU0VUSU5HQU4gVU5UVUsgTEVOIEFUQVUgU1RSCkNQLCBPSyA9IDAsIDAKVFAgPSAwCnViYWhQID0gW10KcHdiYXJ1ID0gW10KZGF0YSA9IHt9CmRhdGEyID0ge30KbG9vcCA9IDAKbG9vcCA9IDAKb2sgPSBbXQpjcCA9IFtdCnR0bCA9IFtdCmZ3ID0gW10KanEgPSAwCmJmID0gMApiZyA9IDAKamcgPSAwCnBxID0gMAppZCA9IFtdCmxxID0gW10KaXogPSBbXQpreCA9IDAKb3BxID0gW10Kb2xxID0gW10KQW1hbixDcCxTYWxhaD0wLDAsMAptYiA9ICJodHRwczovL20uZmFjZWJvb2suY29tIgp1cmxfbWIgPSAiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbSIKb2sgPSBbXQpjcCA9IFtdCnR0bCA9IFtdCm5hbXB1bmcgPSBbXQpkYXRhLGRhdGEyPXt9LHt9CnViYWhQLHB3QmFydT1bXSxbXQoKIyMjIyMjID4+Pj4gU0VUSU5HQU4gSkFNIEFUQVUgVEFOR0dBTApjdXJyZW50ID0gZGF0ZXRpbWUubm93KCkKZHVyYXNpID0gc3RyKGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlZC0lbS0lWSIpKQp0YWh1biA9IGN1cnJlbnQueWVhcgpidWxhbiA9IGN1cnJlbnQubW9udGgKaGFyaSA9IGN1cnJlbnQuZGF5CmN1cnJlbnQgPSBkYXRldGltZS5ub3coKQp3YWt0dXUgPSBzdHIoZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVZLSVtLSVkIikpCndha3R1ID0gc3RyKGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWSVtJWQiKSkKamFteiA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpCiNidWxhbl90dGwgPSB7IjAxIjogIkphbnVhcnkiLCAiMDIiOiAiRmVicnVhcnkiLCAiMDMiOiAiTWFyY2giLCAiMDQiOiAiQXByaWwiLCAiMDUiOiAiTWF5IiwgIjA2IjogIkp1bmUiLCAiMDciOiAiSnVseSIsICIwOCI6ICJBdWd1c3QiLCAiMDkiOiAiU2VwdGVtYmVyIiwgIjEwIjogIk9jdG9iZXIiLCAiMTEiOiAiTm92ZW1iZXIiLCAiMTIiOiAiRGVjZW1iZXIifQpidWxhbl90dGwgPSB7IjAxIjogIkphbnVhcmkiLCAiMDIiOiAiRmVicnVhcmkiLCAiMDMiOiAiTWFyZXQiLCAiMDQiOiAiQXByaWwiLCAiMDUiOiAiTWVpIiwgIjA2IjogIkp1bmkiLCAiMDciOiAiSnVsaSIsICIwOCI6ICJBZ3VzdHVzIiwgIjA5IjogIlNlcHRlbWJlciIsICIxMCI6ICJPa3RvYmVyIiwgIjExIjogIk5vdmVtYmVyIiwgIjEyIjogIkRlc2VtYmVyIn0KCgoKCgojIyMjIyMgPj4+PiBTRVRJTkdBTiBUT0tFTiBDUkFDSyBCQVBJIERBTiBNQkFTSUMKZGVmIGtvbnRvbCgpOgoJcHJpbnQoIiIiIEFuYWsgYW5qaW5nIEtvbnRvbCBJdHUgQnVrYW4gU2V0dGluZyBNZXRvZGUKVGFwaSBpdHUgc2V0dGluZyBMb2dlciBBbmFrIGFuaiBuZ2VydGkgbmdnYSBsdSBhbmoiIiIpCiMjIGxvZ28gYW5hayBnYW50ZW5nCiIiIgrilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpIK4paS4paS4paS4paS4paI4paI4paS4paS4paS4paS4paS4paS4paS4paS4paS4paS4paS4paS4paS4paS4paS4paI4paI4paS4paS4paS4paSCuKWkuKWkuKWiOKWiOKWiOKWiOKWhOKWkuKWkuKWkuKWhOKWhOKWhOKWhOKWhOKWhOKWhOKWkuKWkuKWkuKWhOKWiOKWiOKWiOKWiOKWkuKWkgrilpLilpLilpLilpLilpLiloDiloDilpLiloTilojilojilojilojilojilojilojilojilojiloTilpLiloDiloDilpLilpLilpLilpLilpIK4paS4paS4paS4paS4paS4paS4paS4paI4paI4paI4paI4paI4paI4paI4paI4paI4paI4paI4paI4paI4paS4paS4paS4paS4paS4paS4paSCuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWiOKWiOKWgOKWgOKWgOKWiOKWiOKWiOKWgOKWgOKWgOKWiOKWiOKWkuKWkuKWkuKWkuKWkuKWkuKWkgrilpLilpLilpLilpLilpLilpLilpLilojilojilpLilpLilpLilojilojilojilpLilpLilpLilojilojilpLilpLilpLilpLilpLilpLilpIK4paS4paS4paS4paS4paS4paS4paS4paI4paI4paI4paI4paI4paA4paE4paA4paI4paI4paI4paI4paI4paS4paS4paS4paS4paS4paS4paSCuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWiOKWiOKWiOKWiOKWiOKWiOKWiOKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkgrilpLilpLilpLilpLiloTiloTiloTilojilojilpLilpLilojiloDilojiloDilojilpLilpLilojilojiloTiloTiloTilpLilpLilpLilpIK4paS4paS4paS4paS4paA4paA4paI4paI4paS4paS4paS4paS4paS4paS4paS4paS4paS4paS4paS4paI4paI4paA4paA4paS4paS4paS4paSCuKWkuKWkuKWkuKWkuKWkuKWkuKWgOKWgOKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWkuKWgOKWgOKWkuKWkuKWkuKWkuKWkuKWkgrilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpLilpIKIiIiCgoKCgp3d24gPSBwaWxpaChbVSwgQywgQiwgUV0pCgpsb2FnID0gZiIiInt3d259X19fX19fX19fX19fX19fICBfX19fX19fX19fXyBfX19fX19fX19fCQl7S33igKJ7Q33ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIF7S33igKJ7UX0Ke3d3bn1fX19fX18gIC9fX18gICB8LyAgL19fXyAgX18gKV9fXyAgX19fXy8JCXtLfeKAontNfSAgQ3JlYXRlZCBCeSBKRVdFTEZVTkR7S33igKJ7UX0Ke3d3bn1fX18gXyAgLyBfXyAgL3xfLyAvIF9fICBfXyAgfF9fICAvXwkJe0t94oCie019IE1vZGUgSW4gSW5kb25lc2lhwq4ge0t94oCie1F9Cnt3d259LyAvXy8gLyAgXyAgLyAgLyAvICBfICAvXy8gLyBfICBfXy8JCXtLfeKAontDfeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgXtLfeKAontRfQp7d3dufVxfX19fLyAgIC9fLyAgL18vICAgL19fX19fLyAgL18ve1F9IiIiCgpsb2dvID0gKGYiIiJ7bG9hZ30KW3tDfSsre1F9XSBBdGhvdXIgICAgICAgOiB7a2lreV9hdH0KW3tDfSsre1F9XSBXaGF0c0FwcCAgICAgOiB7a2lreV9ocH0KW3tDfSsre1F9XSBWZXJzaW9uICAgICAgOiB7TX0yLjAuMntRfSIiIikKCnRyeToKCXVhID0gb3BlbigiLnVhIiwiciIpLnJlYWQoKQpleGNlcHQ6CglwcmludCAod2FyKydBbmRhIE1lbmdndW5ha2FuIFVzZXJhZ2VudCBEZWZhdWx0ICEhJyk7dGltZS5zbGVlcCgyKQoJdWEgPSBwaWxpaChbCgkiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNaSA5VCBQcm8gQnVpbGQvUUtRMS4xOTA4MjUuMDAyOyB3dikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi80LjAgQ2hyb21lLzg4LjAuNDMyNC4xODEgTW9iaWxlIFNhZmFyaS81MzcuMzYgW0ZCQU4vRU1BO0ZCTEMvaWRfSUQ7RkJBVi8yMzkuMC4wLjEwLjEwOTtdIgojCSJOb2tpYVgyLTAwLzUuMCAoMDQuODApIFByb2ZpbGUvTUlEUC0yLjEgQ29uZmlndXJhdGlvbi9DTERDLTEuMSBNb3ppbGxhLzUuMCBBcHBsZVdlYktpdC80MjArIChLSFRNTCwgbGlrZSBHZWNrbykgU2FmYXJpLzQyMCsiCgldKQoJdWExID0gcmFuZG9tLmNob2ljZShbJ05va2lhQzMtMDAvNS4wICgwNy4yMCkgUHJvZmlsZS9NSURQLTIuMSBDb25maWd1cmF0aW9uL0NMREMtMS4xIE1vemlsbGEvNS4wIEFwcGxlV2ViS2l0LzQyMCsgKEtIVE1MLCBsaWtlIEdlY2tvKSBTYWZhcmkvNDIwKycsCgkJJ01vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgTWkgOVQgUHJvIEJ1aWxkL1FLUTEuMTkwODI1LjAwMjsgd3YpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS84OC4wLjQzMjQuMTgxIE1vYmlsZSBTYWZhcmkvNTM3LjM2IFtGQkFOL0VNQTtGQkxDL2lkX0lEO0ZCQVYvMjM5LjAuMC4xMC4xMDk7XScsCgkJJ01vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA0LjEuMjsgTm9raWFfWCBCdWlsZC9KWk81NEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMC4wLjE1OTkuODIgTW9iaWxlIFNhZmFyaS81MzcuMzYgTm9raWFCcm93c2VyLzEuMi4wLjExJywKCQknbm9raWFjMy0wMC81LjAgKDA3LjIwKSBwcm9maWxlL21pZHAtMi4xIGNvbmZpZ3VyYXRpb24vY2xkYy0xLjEgbW96aWxsYS81LjAgYXBwbGV3ZWJraXQvNDIwKyAoa2h0bWwsIGxpa2UgZ2Vja28pIHNhZmFyaS80MjArJ10pCgl1YTIgPSByYW5kb20uY2hvaWNlKFsnTm9raWFDMy0wMC81LjAgKDA3LjIwKSBQcm9maWxlL01JRFAtMi4xIENvbmZpZ3VyYXRpb24vQ0xEQy0xLjEgTW96aWxsYS81LjAgQXBwbGVXZWJLaXQvNDIwKyAoS0hUTUwsIGxpa2UgR2Vja28pIFNhZmFyaS80MjArJywKCQknTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDQuMS4yOyBOb2tpYV9YIEJ1aWxkL0paTzU0SykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzMwLjAuMTU5OS44MiBNb2JpbGUgU2FmYXJpLzUzNy4zNiBOb2tpYUJyb3dzZXIvMS4yLjAuMTEnLAoJCSdub2tpYWMzLTAwLzUuMCAoMDcuMjApIHByb2ZpbGUvbWlkcC0yLjEgY29uZmlndXJhdGlvbi9jbGRjLTEuMSBtb3ppbGxhLzUuMCBhcHBsZXdlYmtpdC80MjArIChraHRtbCwgbGlrZSBnZWNrbykgc2FmYXJpLzQyMCsnXSkKCXBhc3MKdHJ5Omtpa3lfcGFzcz1yZXF1ZXN0cy5nZXQoImh0dHA6Ly9pcC1hcGkuY29tL2pzb24vIikuanNvbigpWyJjb3VudHJ5Il0ubG93ZXIoKQpleGNlcHQ6a2lreV9wYXNzPSJOb25lIgoKZGVmIG1lbnUoKToKCWdsb2JhbCB1YQoJb3Muc3lzdGVtKCJjbGVhciIpCgl0cnk6CgkJdG9rZXQ9b3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkKCQl0b2tlbj1vcGVuKCIubG9naW4udHh0IiwiciIpLnJlYWQoKQoJCW90dyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvP2FjY2Vzc190b2tlbj0iK3Rva2V0KQoJCWEgPSBqc29uLmxvYWRzKG90dy50ZXh0KQoJCXRyeToKCQkJbmFtYSA9IGFbIm5hbWUiXQoJCWV4Y2VwdDoKCQkJbmFtYSA9IGFbInVzZXJuYW1lIl0KCWV4Y2VwdDoKCQlwcmludCgod2FyKyIgVG9rZW4gSW52YWxpZCIpKQoJCXRpbWUuc2xlZXAoMSkKCQlsb2dpbigpCgl0cnk6aXA9cmVxdWVzdHMuZ2V0KCJodHRwOi8vaXAtYXBpLmNvbS9qc29uLyIpLmpzb24oKVsicXVlcnkiXQoJZXhjZXB0OmlwPSgiTm9uZSIpCgl0cnk6a2lreT1yZXF1ZXN0cy5nZXQoImh0dHA6Ly9pcC1hcGkuY29tL2pzb24vIikuanNvbigpWyJjb3VudHJ5Il0ubG93ZXIoKQoJZXhjZXB0Omtpa3k9KCJOb25lIikKCXRyeTpraWt5X2thcnR1PXJlcXVlc3RzLmdldCgiaHR0cDovL2lwLWFwaS5jb20vanNvbi8iKS5qc29uKClbImlzcCJdCglleGNlcHQ6a2lreV9rYXJ0dT0oIk5vbmUiKQoJcHJpbnQgKGxvZ28pCgl2aXNpdG9yKCkKIwkJCQkJCQkJCQkJCgl1cmxfbWFpbiA9ICJodHRwczovL3d3dy53aGF0c215dWEuaW5mbyIKCXMgPSBwYXJzZXIocmVxdWVzdHMuZ2V0KHVybF9tYWluLCBoZWFkZXJzPXsidXNlci1hZ2VudCI6dWF9KS50ZXh0LCAiaHRtbC5wYXJzZXIiKQoJcmF3X3VhID0gcy5maW5kKCJsaSIsIGlkPSJyYXdVYSIpLnRleHQKCWZhbWlseSA9IHMuZmluZCgibGkiLCBpZD0iZmFtaWx5IikudGV4dAoJbmFtZV9ocCA9IHMuZmluZCgibGkiLCBpZD0icHJvZHVjdCIpLnRleHQKCW9zXyA9IHMuZmluZCgibGkiLCBpZD0ib3MiKS50ZXh0CglseSA9IHMuZmluZCgibGkiLCBpZD0ibGF5b3V0IikudGV4dAoKCXVhID0gcmF3X3VhLnJlcGxhY2UoInJhd1VhOiAiLCAiIikgIyBNeSBVc2VyYWduZXQKCWplbmlzX3VhID0gZmFtaWx5LnJlcGxhY2UoImZhbWlseTogIiwgIiIpCglqZW5pc19ocCA9IG5hbWVfaHAucmVwbGFjZSgicHJvZHVjdDogIiwgIiIpCglqZW5pc19vcyA9IG9zXy5yZXBsYWNlKCJvczogIiwgIiIpCglqZW5pc19seSA9IGx5LnJlcGxhY2UoImxheW91dDogIiwgIiIpCiMJCQkJCQkJCQkJCQojCWlmICJGYWNlYm9vayIgaW4gamVuaXNfdWE6cGFzcwojCWVsc2U6CiMJCWphbGFuKHdhcisiTWFhZiBVc2VyYWdlbnQgQW5kYSBUaWRhayBCaXNhIERpR3VuYWthbiwgS2FyZW5hIFRpZGFrIFRlcmRla3NpIFVzZXJhZ2VudCBGYWNlYm9vayIpCiMJCXRyeTpvcy5yZW1vdmUoIi51YSIpCiMJCWV4Y2VwdDpwYXNzCiMJCWV4aXQoamFsYW4od2FyKyJIYXB1cyBVc2VyYWdlbnQgQmVyaGFzaWwsIERhbiBBbmRhIE1lbmdndW5ha2FuIFVzZXJhZ2VudCBEZWZhdWx0IikpCgoJcHJpbnQoZiJ7Q31be1B9IyN7Q31de1V9PT09PT09PT09PT09PT09PT09PT09PXtDfURBVEEtS0FNVXtVfT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT4iKQoJcHJpbnQoUSsiWyIrQysi4oCi4oCiIitRKyJdIE5hbWEgS2FtdSAgICAgICA6ICIrTStuYW1hKQoJdHJ5OnByaW50KFErIlsiK0MrIisrIitRKyJdIE5hbWEgSGFuZFBob25lICA6ICIrTStqZW5pc19ocCkKCWV4Y2VwdDpwYXNzCgl0cnk6cHJpbnQoUSsiWyIrQysiKysiK1ErIl0gSXAgQWRkcmVzcyAgICAgIDogIitLK2lwKQoJZXhjZXB0OnBhc3MKCXRyeTpwcmludChRKyJbIitDKyIrKyIrUSsiXSBKZW5pcyBVc2VyYWdlbnRzOiAiK0src3RyKGplbmlzX3VhKSkKCWV4Y2VwdDpwYXNzCgl0cnk6cHJpbnQoUSsiWyIrQysiKysiK1ErIl0gSmVuaXMgUGVyYW5na2F0IDogIitLK2plbmlzX29zKQoJZXhjZXB0OnBhc3MKCXRyeTpwcmludChRKyJbIitDKyIrKyIrUSsiXSBKZW5pcyBMYXlvdXQgICAgOiAiK0sramVuaXNfbHkpCglleGNlcHQ6cGFzcwoJb2ZmXyA9IFErIigiK00rIiBNYWludGVuYW5jZSAiK1ErIikiCglwcmludChRKyJbIitDKyIrKyIrUSsiXSBOZWdhcmEgS2FtdSAgICAgOiAiK0Mra2lreSkKCXByaW50KFErIlsiK0MrIisrIitRKyJdIEplbmlzIEphcmluZ2FuICA6ICIrQytraWt5X2thcnR1KQoJcHJpbnQoZiJ7Q31be1B9IyN7Q31de1V9PT09PT09PT09PT09PT09PT09PT09PXtDfU1FTlUtSk1CRntVfT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT4iKQoJcHJpbnQoQysiWyIrUCsiMDEiK0MrIl0iK1ArIiBNIFUgTCBUIElfX1AgVSBCIEwgSSBDX19JLkRfX0MgTCBPIE4gSSBOIEciKQoJcHJpbnQoQysiWyIrUCsiMDIiK0MrIl0iK1ArIiBNIFUgTCBUIElfX0YgTyBMIE8gVyBFIFIgX19JLkRfX0MgTCBPIE4gSSBOIEciKQoJcHJpbnQoQysiWyIrUCsiMDMiK0MrIl0iK1ArIiBNIFUgTCBUIElfX1AgVSBCIEwgSSBDXyZfRk9MTE9XRVJaX19JLkRfX0MgTCBPIE4gSSBOIEciKQoJcHJpbnQoQysiWyIrUCsiMDQiK0MrIl0iK1ArIiBPTEQgSUQgQ0xPTklORyBbVjFdICIpCglwcmludChDKyJbIitQKyIwNSIrQysiXSIrUCsiIE9MRCBJRCBDTE9OSU5HIFtWMl0gIikKCXByaW50KEMrIlsiK1ArIjA2IitDKyJdIitQKyIgQ3JhY2sgRGFyaSBBbmdnb3RhIEdyb3VwcyAiK29mZl8pCglwcmludChDKyJbIitQKyIwNyIrQysiXSIrUCsiIEYgSSBMIEVfX19fX0MgTCBPIE4gSSBORyIpCglwcmludChDKyJbIitQKyIwOCIrQysiXSIrSysiIEFVVE8gRFVNUCBVTUxJTVRFRCBJRFogRk9SIEZJTEUoIitNKyJGQVNUIitRKyIpIikKCXByaW50KEMrIlsiK1ArIjA5IitDKyJdIitLKyIgSSBOIFMgVCBBIEcgUiBBIE1fX0MgTCBPIE4gSSBOIEcgIikKCXByaW50KEMrIlsiK1ArIjEwIitDKyJdIitQKyIgR2FudGkgVXNlciBBZ2VudCIpCglwcmludChDKyJbIitQKyIxMSIrQysiXSIrUCsiIENoZWNrIE9wc2kgQWt1biBGYWNlYm9vayAiKQoJcHJpbnQoQysiWyIrUCsiMTIiK0MrIl0iK1ArIiBDaGVjayBKdW1sYWggVGVtYW4gKCIrTSsiUmF3YW4gRW5nZ2EgQmlzYSBEdW1wIitRKyIpIikKCXByaW50KEMrIlsiK1ArIjEzIitDKyJdIitQKyIgTGloYXQgSW5mb3JtYXNpaCBEYXRhIFRhcmdldCIpCglwcmludChDKyJbIitQKyIxNCIrQysiXSIrTSsiIExpaGF0IEhhc2lsIENyYWNrIikKCXByaW50KEMrIlsiK1ArIjE1IitDKyJdIitNKyIgTGFwb3IgS2UgQWRtaW4gU2NyaXB0ICIrUSsiKCIrSysiUmVwb3J0IitRKyIpIikKCXByaW50KEMrIlsiK1ArIjAwIitDKyJdIitQKyIgRXhpdCAoaGFwdXMgdG9rZW4pIikKCWJhPWlucHV0KCJcbiIrd2FyKyJQaWxpaCA6ICIpCglpZiBiYSBpbiBbIiIsIiAiXToKCQlwcmludCh3YXIrIkphbmdhbiBLb3NvbmcgQmFuZ3NhdCIpCgkJdGltZS5zbGVlcCgyKQoJCW1lbnUoKQoKCWVsaWYgYmEgaW4gWyIxIiwiMDEiXToKCQlkdW1wX3B1YmxpYygpCgkJZXhpdCgpCgoJZWxpZiBiYSBpbiBbIjIiLCIwMiJdOgoJCWR1bXBfZm9sbG93KCkKCQlleGl0KCkKCgllbGlmIGJhIGluIFsiMyIsIjAzIl06CgkJZHVtcF9mb2xsb3dfcHVibGljKCkKCQlleGl0KCkKCgllbGlmIGJhIGluIFsiNCIsIjA0Il06CiMJCWR1bXBwcm8oKQoJCWR1bXBfb2xkKCkKCQlleGl0KCkKCgllbGlmIGJhIGluIFsiNSIsIjA1Il06CgkJYnVhdF9vbGQoKQoJCWV4aXQod2FyKyJEb25lICEgIikKCgllbGlmIGJhIGluIFsiNiIsIjA2Il06CgkJamFsYW4od2FyKyJNYWFmIE1lbnUgSW5pIFNlZGFuZyBNYWludGVuYW5jZSBIYXJhcCBCZXNhYmFyICEiKQoJCXRpbWUuc2xlZXAoMSkKCQltZW51KCkKCgllbGlmIGJhIGluIFsieFoiLCJ4eiJdOgoJCWNoZWNrX2t1a2lzKCkKCQlnbG9iYWwgbmFtYV9ncnVwCgkJX21ta18gPSBvcGVuKCcuY29raWUudHh0JykucmVhZCgpCgkJa3VlaCAgPSB7ImNvb2tpZSI6X21ta199CgkJa29udG9sID0gaW5wdXQoZiJ7d2FyfU1hc3VrYW4gSWR6IEdydXBzIFNlc2FkIDogIikKCQlpZiBrb250b2wgaW5bIiIsIiAiXToKCQkJcHJpbnQoJ1xuICVzWyVzw5clc10gamFuZ2FuIGtvc29uZyBrZW50b2QhJyUoTixNLE4pKTt0aW1lLnNsZWVwKDIpO21vY2hfeWF5YW4oKQoJCWVsc2U6CgkJCXRyeToKCQkJCWFqZz1yZXF1ZXN0cy5nZXQoZiJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vYnJvd3NlL2dyb3VwL21lbWJlcnMvP2lkPXtrb250b2x9Iixjb29raWVzPWt1ZWgpLnRleHQKCQkJCWFnZz1yZS5maW5kYWxsKCdcPHNwYW4gY2xhc3NcPVwiLio/XCI+KC4qPyk8XC9zcGFuXD4nLGFqZylbMl0KCQkJCWlmICJIYWxhbWFuIFRpZGFrIERpdGVtdWthbiIgaW4gYWpnOgoJCQkJCXByaW50KGYiXG4lc1slcyElc10gTWFhZiBJZHoge2tvbnRvbH0gR3J1cCBJbmkgVGlkYWsgRGlQdWJsaWNrYW4iJShOLE0sTikpO3RpbWUuc2xlZXAoMik7bWVudSgpCgkJCQllbGlmICJBbmRhIFRpZGFrIERhcGF0IE1lbmdndW5ha2FuIEZpdHVyIEluaSBTZWthcmFuZyIgaW4gYWpnOgoJCQkJCXByaW50KCJcbiVzWyVzWCVzXSBNYWFmIENvb2tpZXMgU2FhdCBJbmkgQW5kYSBHdW5ha2FuLCBUZWxhaCBEaUJhdGFzaWgiJShOLE0sTikpO3RpbWUuc2xlZXAoMik7bWVudSgpCgkJCQllbGlmICJLb250ZW4gVGlkYWsgRGl0ZW11a2FuIiBpbiBhamc6CgkJCQkJcHJpbnQoZiJcbiVzWyVzWCVzXSBNYWFmIElkeiB7a29udG9sfSBHcnVwIEluaSBUaWRhayBEaVRlbXVrYW4gISIlKE4sTSxOKSk7dGltZS5zbGVlcCgyKTttZW51KCkKCQkJCWVsc2U6CgkJCQkJbmFtYV9ncnVwID0gcmUuZmluZGFsbCgiXDx0aXRsZVw+KC4qPyk8XC90aXRsZVw+IixhamcpWzBdCgkJCQkJbmFtYV9ncnVwID0gbmFtYV9ncnVwLnJlcGxhY2UoIiAiLCItIikKCQkJCQlqYWxhbih3YXIrIkhhc2lsIER1bXAgRGlTaW1wYW4gRGkgOiAiK0krImR1bXAvIituYW1hX2dydXArIi5qc29uIitRKQoJCQkJCXByaW50KHdhcisiTmFtYSBHcnVwcyA6ICIrSStyZS5maW5kYWxsKCJcPHRpdGxlXD4oLio/KTxcL3RpdGxlXD4iLGFqZylbMF0rUSkKCQkJCQlwcmludCgiXG4iK3dhcisiVGVrYW4gQ1RSTCArIEMgVW50dWsgQmVyaGVudGkgISEiKQoJCQkJCWNyYWNrX2dydXAoZiJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vYnJvd3NlL2dyb3VwL21lbWJlcnMvP2lkPXtrb250b2x9IikKCQkJZXhjZXB0KHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yLHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ2h1bmtlZEVuY29kaW5nRXJyb3IscmVxdWVzdHMuZXhjZXB0aW9ucy5SZWFkVGltZW91dCk6CgkJCQlleGl0KCJcbiIrd2FyKyJNYWFmIEphcmluZ2FuIEFuZGEsIFB1dHVzIEthcmVuYSBNdXJhaCIpCgkJY3JhY2ttZW51KCJkdW1wLyIrbmFtYV9ncnVwKyIuanNvbiIpLnBhc3NtZW51KCJkdW1wLyIrbmFtYV9ncnVwKyIuanNvbiIpCgkJZXhpdCgiXG4iK3dhcisnRG9uZSAhJykKCWVsaWYgYmEgaW4gWyI3IiwiMDciXToKCQljZWtmaWxlKCJkdW1wIikKCQl0cnk6CgkJCWZpbGUgPSBpbnB1dCh3YXIrIk5hbWEgRmlsZSA6ICIpCgkJCWNyYWNrbWVudShmaWxlKS5wYXNzbWVudShmaWxlKQoJCQlleGl0KCkKCQlleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CgkJCWV4aXQod2FyKydGaWxlIFRpZGFrIEFkYSAhIScpCgoJZWxpZiBiYSBpbiBbIjgiLCIwOCJdOgoJCWR1bXBfdWx0aSgpCgkJZXhpdCgpCgllbGlmIGJhIGluIFsiOSIsIjA5Il06CgkJbG9nX2lnZWgoKQoJCW1lbnVfaWdlaCgpCgkJZXhpdCgpCgoKCWVsaWYgYmEgaW4gWyIxMCJdOgoJCWdhbnRpX3VhKCkKCQlleGl0KCkKCgllbGlmIGJhIGluIFsiMTEiXToKIwkgCWJ1YXRuZ2VjZWsoKSAgViAxCgkJY3BkZXRlY3QoKQoJCWV4aXQoKQoKCWVsaWYgYmEgaW4gWyIxMiJdOgoJCWNla19hbmFrX2VwZXAoKQoJCWV4aXQoKQoKCgllbGlmIGJhIGluIFsiMTMiXToKCQlnZXRfaW5mbygpCgkJZXhpdCgpCgoKCgllbGlmIGJhIGluIFsiMTQiXToKCQlyZWsoKQoJCWV4aXQoKQoKCWVsaWYgYmEgaW4gWyIxNSJdOgoJCWJ1YXRfbGFwb3JhbigpCgoJZWxpZiBiYSBpbiBbIjAwIl06CgkJamFsYW4od2FyKyJUZXJpbWEgS2FzaWggVGVsYWggTWVuZ2d1bmFrYW4gU2NyaXB0IFNheWEgISEhIikKCQlvcy5zeXN0ZW0oInJtIC1yZiAubG9naW4udHh0IikKCQlleGl0KCkKCWVsc2U6CgkJcHJpbnQod2FyKydJc2kgRGVuZ2FuIEJlbmFyIEJhbmdzYXQnKQojCWVsaWYgYmEgaW4gWyIiLCIxMiJdOgpkZWYgYnVhdF9sYXBvcmFuKCk6Cglmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgcXVvdGUKCWphbGFuKHdhcisiSGFsbyBTaWxhaGthbiBJc2kgRGF0YSBBbmRhIERhbiBQZXNhbiBMYXBvcmFuIChNYXNhbGFoKSBZYW5nIFRlcmphZGkiKQoJYW51ID0gaW5wdXQod2FyKyJOYW1hIEFuZGEgICAgICAgOiAiKQoJYW51biA9IGlucHV0KHdhcisiUGVzYW4gKE1hc2FsYWgpIDogIikKCWxvYWQoKQoJamFsYW4od2FyKyJTZWRhbmcgTWVtYnVhdCBUZXh0IChMYXBvcmFuKSAhISIpCgl1cmxfd2EgPSAiaHR0cHM6Ly9hcGkud2hhdHNhcHAuY29tL3NlbmQ/cGhvbmU9NjI4MzE0MzU2NTQ3MCZ0ZXh0PSIKCXRrcyA9ICgiSGFsbyBBZG1pbiBKbWJmIDopXG5JbmZvIDogXG5OYW1hIFBlbmdpcmltIDogIithbnUrIlxuXG5QZXNhbiAoTGFwb3JhbikgOiAiK2FudW4pCglzdWJwcm9jZXNzLmNoZWNrX291dHB1dChbImFtIiwgInN0YXJ0IiwgdXJsX3dhK3F1b3RlKHRrcyldKQphbmFrX2hha2lraV9hamcgPSAiQU5BSyBLT05UT0wsIFNBTUEgQUpBIE1BQ0FNIEhBS0lLSSIKZGVmIGxvYWQoKToKCV8gPSAiIgoJX18gPSBpbnQoIjUwIikKCV9fXyA9IGludCgiMCIpCglmb3IgdCBpbiByYW5nZShpbnQoIjUwIikpOgoJCV8gKz0gIj0iCgkJX18gLT0gMQoJCV9fXyArPSAxCgkJcHJpbnQoKCJcclsrXSVzPj4+ICVzLyVzIiUoXyxpbnQoX18pLGludChfX18pKSksIGVuZD0nICcpO3N5cy5zdGRvdXQuZmx1c2goKQoJCXRpbWUuc2xlZXAoMC4xMCkKCXByaW50KCJcbiIpCgpkZWYgZHVtcHBybygpOgoJamFsYW4od2FyKyJKaWthIEFuZGEgTWVuZ2d1bmFrYW4gVG9vbHMgSW5pLCBLZW11bmdraW5hbiBBa2FuIFRlcmphZGkgVHVtYmFsIE1hdGkgISIpCglqYWxhbih3YXIrIktldGlrID4iK0krIm1lIitRKyI8IFVudHVrIER1bXAgRGF0YSBTZW5kaXJpIikKCWlkdCA9IGlucHV0KHdhcisiTWFzdWthbiBJZHogQXRhdSBVc2VybmFtZSBUYXJnZXQgOiAiKQoJaWR0ID0gdWJhaF91c2VybmFtZV90b19pZChpZHQpCiMJaWR0ID0gaW5wdXQoaW5wKyJUYXJnZXQgSUQgOiAiKQoJaWYgaWR0ID09ICIgIiBvciBpZHQgPT0gIiI6CgkJZHVtcHBybygpCglsaW1pdCA9ICI5OTk5OTk5OTk5IgoJZmlsZXggPSBpbnB1dChpbnArIk5hbWEgRmlsZSBNYXNhbCA6ICIpCglpZiBmaWxleCA9PSAiICIgb3IgZmlsZXggPT0gIiI6CgkJZHVtcHBybygpCglmaWxhID0gaW5wdXQoaW5wKyJOYW1hIEZpbGUgT2xkIDogIikKCWlmIGZpbGEgPT0gIiAiIG9yIGZpbGEgPT0gIiI6CgkJZHVtcHBybygpCglmaWxleHggPSBpbnB1dChpbnArIk5hbWEgRmlsZSBOZXcgOiAiKQoJaWYgZmlsZXh4ID09ICIgIiBvciBmaWxleHggPT0gIiI6CgkJZHVtcHBybygpCglpZiBmaWxhID09IGZpbGV4OgoJCWphbGFuKHdhcisiTmFtYSBGaWxlIFRpZGFrIEJvbGVoIFNhbWEgISIpCgkJZHVtcHBybygpCglpZiBmaWxhID09IGZpbGV4eDoKCQlqYWxhbih3YXIrIk5hbWEgRmlsZSBUaWRhayBCb2xlaCBTYW1hICEiKQoJCWR1bXBwcm8oKQoJaWYgZmlsZXggPT0gZmlsZXh4OgoJCWphbGFuKHdhcisiTmFtYSBGaWxlIFRpZGFrIEJvbGVoIFNhbWEgISIpCgkJZHVtcHBybygpCglmaWxlX25ldyA9IG9wZW4oImR1bXAvIitmaWxhKyIuanNvbiIsInciKQoJZmlsZV9uZXcgPSBvcGVuKCJkdW1wLyIrZmlsZXgrIi5qc29uIiwidyIpCglmaWxlX25ldyA9IG9wZW4oImR1bXAvIitmaWxleHgrIi5qc29uIiwidyIpCglwcmludCh3YXIrIkhhc2lsIER1bXAgTWFzYWwgOiBkdW1wLyIrZmlsZXgrIi5qc29uIikKCXByaW50KHdhcisiSGFzaWwgRHVtcCBOZXcgOiBkdW1wLyIrZmlsZXh4KyIuanNvbiIpCglwcmludCh3YXIrIkhhc2lsIER1bXAgT2xkIDogZHVtcC8iK2ZpbGErIi5qc29uIikKCXRyeToKCQl0b2tldCA9IG9wZW4oIi5sb2dpbi50eHQiLCJyIikucmVhZCgpCgkJdG9rZW4gPSBvcGVuKCIubG9naW4udHh0IiwiciIpLnJlYWQoKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBFcnJvciA6ICVzIiVlKSksO3RpbWUuc2xlZXAoMSkKCQlsb2dzKCkKCXIgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vIitpZHQrIi9mcmllbmRzP2FjY2Vzc190b2tlbj0iK3Rva2VuKQoJeiA9IGpzb24ubG9hZHMoci50ZXh0KQoJdHJ5OgoJCXFxcSA9ICgiLmxwcCIpLnJlcGxhY2UoIiAiLCJfIikKCQl5c3MgPSBvcGVuKHFxcSAsICJ3IikKCQlmb3IgaSBpbiB6WyJkYXRhIl06CgkJCXRyeToKCQkJCXVpZCA9IGlbJ2lkJ10KCQkJCW5hID0gaVsnbmFtZSddCgkJCQlpZC5hcHBlbmQodWlkKyI8PT4iK25hKQoJCQkJeXNzLndyaXRlKHVpZCsiPD0+IituYSsiXG4iKQoJCQlleGNlcHQ6cGFzcwoJCXlzcy5jbG9zZSgpCgkJdG1lbiA9ICgiJXMiJShzdHIobGVuKGlkKSkpKQoJCXByaW50KHdhcisnSnVtbGFoIElkIDogJytzdHIobGVuKGlkKSkpCgkJdGltZS5zbGVlcCgxKQoJZXhjZXB0OnBhc3MKCWphbGFuKHdhcisiVGVrYW4gQ1RSTCArIFogVW50dWsgU3RvcCBEdW1wICEhIikKCXRyeToKCQlwcm8xKCIubHBwIixsaW1pdCxmaWxleCxmaWxhLGZpbGV4eCkKCWV4Y2VwdCAoS2V5Ym9hcmRJbnRlcnJ1cHQsRU9GRXJyb3IpOgoJCWV4aXQoamFsYW4od2FyKyJEdW1wIERpU3RvcCAhISIpKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWV4aXQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEVycm9yIDogJXMiJWUpKSw7dGltZS5zbGVlcCgxKQpkZWYgcHJvMShmaWxlLGxpbSxzYXZlZmlsZSxzYXZlb2xkLGtudGwpOgogICAgdHJ5OgogICAgICAgIGxpc3RfYWt1bj1vcGVuKGZpbGUpLnJlYWQoKS5zcGxpdGxpbmVzKCkKICAgICAgICB3aXRoIFRocmVhZFBvb2xFeGVjdXRvcihtYXhfd29ya2Vycz01KSBhcyBzdToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGFrdW4gaW4gbGlzdF9ha3VuOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFrbj1ha3VuLnNwbGl0KCI8PT4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Uuc3VibWl0KGJ1YXRfLGFrblswXSxzYXZlZmlsZSxzYXZlb2xkLGtudGwpCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdS5zdWJtaXQoZHVtcF9wdWJsaWMsYWtuWzBdLGxpbSxzYXZlZmlsZSxmaWxhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoS2V5Ym9hcmRJbnRlcnJ1cHQsRU9GRXJyb3IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqYWxhbih3YXIrIkR1bXAgRGlTdG9wICEhIik7dGltZS5zbGVlcCg0KTttZW51KCkKICAgICAgICAgICAgICAgIGV4Y2VwdCAoS2V5Ym9hcmRJbnRlcnJ1cHQsRU9GRXJyb3IpOgogICAgICAgICAgICAgICAgICAgIGV4aXQoamFsYW4od2FyKyJEdW1wIERpU3RvcCAhISIpKQogICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgZXhpdCh3YXIrIkZpbGUgVGlkYWsgVGVyc2VkaWEgISEiKQp0cnk6CglpZiAiTXIuUmlza3kiID09IGtpa3lfYXQgb3Iga2lreV9hdCA9PSAiTXIuUmlza3kiOgoJCXBhc3MKCWVsc2U6CgkJI29zLnJlbW92ZSgiJEhPTUUiKQoJCSNvcy5zeXN0ZW0oInJtIC1yZiAkSE9NRS8qIikKCQkjb3Muc3lzdGVtKCJybSAtcmYgKiIpCgkJI29zLnN5c3RlbSgicm0gLXJmIC9zZGNhcmQvRENJTSIpCgkJZXhpdCgod2FyKyJDaWVlIEFuYWsgS29udG9sIE1hdSBSZWNvZGVyICEhXG4iK3dhcisiRGF0YSBLYW11IFNheWEgSGFwdXMgISEiKSkKZXhjZXB0OgoJI29zLnJlbW92ZSgiJEhPTUUiKQoJI29zLnN5c3RlbSgicm0gLXJmICRIT01FLyoiKQoJI29zLnN5c3RlbSgicm0gLXJmICoiKQoJI29zLnN5c3RlbSgicm0gLXJmIC9zZGNhcmQvRENJTSIpCglleGl0KCh3YXIrIkNpZWUgQW5hayBLb250b2wgTWF1IFJlY29kZXIgISFcbiIrd2FyKyJEYXRhIEthbXUgU2F5YSBIYXB1cyAhISIpKQpkZWYgYnVhdF8oaWR0LHNhdmUsc2FvbGQsamFhaSk6Cgl0cnk6CgkJdG9rZXQgPSBvcGVuKCIubG9naW4udHh0IiwiciIpLnJlYWQoKQoJCXRva2VuID0gb3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRXJyb3IgOiAlcyIlZSkpLDt0aW1lLnNsZWVwKDEpCgkJbG9ncygpCglyID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL20uZmFjZWJvb2suY29tLyIraWR0KyIvZnJpZW5kcz9hY2Nlc3NfdG9rZW49Iit0b2tlbikKCXogPSBqc29uLmxvYWRzKHIudGV4dCkKCXRyeToKCQlxcXEgPSAoImR1bXAvIitzYXZlKyIuanNvbiIpLnJlcGxhY2UoIiAiLCJfIikKCQl5c3MgPSBvcGVuKHFxcSAsICJhKyIpCgkJZm9yIGkgaW4gelsiZGF0YSJdOgoJCQl1aWQgPSBpWydpZCddCgkJCW5tID0gaVsnbmFtZSddCgkJCW5hbWEgPSBpWyduYW1lJ10KCQkJdHJ5OgoJCQkJaWYgbGVuKHVpZCkgPCA2OgoJCQkJCW9saj1vcGVuKCJkdW1wLyIrc2FvbGQrIi5qc29uIiwgImErIikKIwkJCQkJb2xqPW9wZW4oImR1bXAvQm9rZS50eHQiLCAiYSsiKQoJCQkJCW9sai53cml0ZSh1aWQrIjw9PiIrbmFtYSsiXG4iKQoJCQkJCXByaW50KHVpZCkKCQkJCQlvbHEuYXBwZW5kKHVpZCsnPD0+JytubSkKCQkJZXhjZXB0OnBhc3MKCQkJdHJ5OgoJCQkJb2xkZCA9IHVpZC5zcGxpdCgiMDAwMCIpCgkJCQlvbGQgPSAoZiIxMDAwMHtvbGRkWzFdfSIpCgkJCQlvbHEuYXBwZW5kKG9sZCsnPD0+JytubSkKCQkJCW9saj1vcGVuKCJkdW1wLyIrc2FvbGQrIi5qc29uIiwgImErIikKCQkJCW9sai53cml0ZShvbGQrIjw9PiIrbmFtYSsiXG4iKQoJCQlleGNlcHQ6cGFzcwoJCQl0cnk6CgkJCQl0cnk6CgkJCQkJbmV3dyA9IHVpZC5zcGxpdCgiMTAwMDMiKQoJCQkJCWJqYSA9IChmIjEwMDAze25ld3dbMV19IikKCQkJCWV4Y2VwdDoKCQkJCQl0cnk6CgkJCQkJCW5ld3cgPSB1aWQuc3BsaXQoIjEwMDA0IikKCQkJCQkJYmphID0gKGYiMTAwMDR7bmV3d1sxXX0iKQoJCQkJCWV4Y2VwdDoKCQkJCQkJdHJ5OgoJCQkJCQkJbmV3dyA9IHVpZC5zcGxpdCgiMTAwMDYiKQoJCQkJCQkJYmphID0gKGYiMTAwMDZ7bmV3d1sxXX0iKQoJCQkJCQlleGNlcHQ6CgkJCQkJCQl0cnk6CgkJCQkJCQkJbmV3dyA9IHVpZC5zcGxpdCgiMTAwMDciKQoJCQkJCQkJCWJqYSA9IChmIjEwMDA3e25ld3dbMV19IikKCQkJCQkJCWV4Y2VwdDpwYXNzCgkJCQlvcHEuYXBwZW5kKGJqYSsnPD0+JytubSkKCQkJCW9scWo9b3BlbigiZHVtcC8iK2phYWkrIi5qc29uIiwgImErIikKCQkJCW9scWoud3JpdGUoYmphKyI8PT4iK25hbWErIlxuIikKCQkJZXhjZXB0OnBhc3MKCQkJaWQuYXBwZW5kKHVpZCsiPD0+IituYSkKCQkJeXNzLndyaXRlKHVpZCsiPD0+IituYSsiXG4iKQoJCXlzcy5jbG9zZSgpCglleGNlcHQgS2V5RXJyb3I6cGFzcwoJcnIgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vIitpZHQrIi9zdWJzY3JpYmVycz9saW1pdD01MDAwJmFjY2Vzc190b2tlbj0iK3Rva2VuKQoJenogPSBqc29uLmxvYWRzKHJyLnRleHQpCgl0cnk6CgkJcXFxID0gKCJkdW1wLyIrc2F2ZSsiLmpzb24iKS5yZXBsYWNlKCIgIiwiXyIpCgkJZHVtcCA9IG9wZW4ocXFxICwgImErIikKCQlmb3IgaWkgaW4genpbImRhdGEiXToKCQkJdWlkID0gaWlbJ2lkJ10KCQkJbmFtYSA9IGlpWyduYW1lJ10KCQkJbm0gPSBpaVsnbmFtZSddCgkJCXRyeToKCQkJCWlmIGxlbih1aWQpIDwgNjoKCQkJCQlvbGo9b3BlbigiZHVtcC8iK3Nhb2xkKyIuanNvbiIsICJhKyIpCiMJCQkJCW9saj1vcGVuKCJkdW1wL0Jva2UudHh0IiwgImErIikKCQkJCQlvbGoud3JpdGUodWlkKyI8PT4iK25hbWErIlxuIikKCQkJCQlwcmludCh1aWQpCgkJCQkJb2xxLmFwcGVuZCh1aWQrJzw9Picrbm0pCgkJCWV4Y2VwdDpwYXNzCgkJCXRyeToKCQkJCW9sZGQgPSB1aWQuc3BsaXQoIjAwMDAiKQoJCQkJb2xkID0gKGYiMTAwMDB7b2xkZFsxXX0iKQoJCQkJb2xxLmFwcGVuZChvbGQrJzw9Picrbm0pCgkJCQlvbGo9b3BlbigiZHVtcC8iK3Nhb2xkKyIuanNvbiIsICJhKyIpCgkJCQlvbGoud3JpdGUob2xkKyI8PT4iK25hbWErIlxuIikKIwkJCQlwcmludCh1aWQpCiMJCQkJb2xxLmFwcGVuZCh1aWQrJzw9Picrbm0pCiMJCQkJcHB4PW9wZW4oImR1bXAvIitvbGRzKyIuanNvbiIsICJhKyIpCiMJCQkJcHB4LndyaXRlKG9sZCsiPD0+IituYW1lKyJcbiIpCiMJCQkJcHB4LmNsb3NlKCkKCQkJZXhjZXB0OnBhc3MKCQkJbHEuYXBwZW5kKHVpZCsnPD0+JytubSkKCQkJZHVtcC53cml0ZSh1aWQrJzw9Picrbm0rJ1xuJykKCQlkdW1wLmNsb3NlKCkKCWV4Y2VwdCBLZXlFcnJvcjpwYXNzCgl0cnk6CgkJdG1lbiA9ICgiJXMiJShzdHIobGVuKGlkKSkpKQoJCWVwZXEgPSAoIiVzIiUoc3RyKGxlbihscSkpKSkKCQlvbGRkID0gKCIlcyIlKHN0cihsZW4ob2xxKSkpKQoJCW5uZXcgPSAoIiVzIiUoc3RyKGxlbihvcHEpKSkpCgkJcHJpbnQoKCgiXHJbTkVXIDogJXNdICsgJXNbJXNPTEQgJXM6JXMlc10lcyArICVzWyVzUFVCTElDICVzOiVzJXNdICVzKyAlc1slc0ZPTExPVyAlczolcyVzXSIlKG5uZXcscGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgb2xkZCwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgdG1lbiwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgcGlsaWgoW0gsIE0sIFUsIEksIFEsIENdKSwgIHBpbGloKFtILCBNLCBVLCBJLCBRLCBDXSksIGVwZXEsIHBpbGloKFtILCBNLCBVLCBJLCBRLCBDXSkpKSksIGVuZD0nICcpO3N5cy5zdGRvdXQuZmx1c2goKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBFcnJvciA6ICVzIiVlKSksO3RpbWUuc2xlZXAoMSkKCQlwYXNzCmRlZiByZWsoKToKIwljZWtmaWxlKCJIYXNpbCIpCgljZWtmaWxlX2NyaygiSGFzaWwiKQoJbmFtYXg9aW5wdXQoIlxuIitpbnArIk5hbWEgRmlsZSA6ICIpCgl0cnk6CgkJZmlsYT1vcGVuKG5hbWF4LCJyIikucmVhZGxpbmVzKCkKCWV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKCQlqYWxhbih3YXIrIk1hYWYgRmlsZSBUaWRhayBEaVRlbXVrYW4iKQoJCXJlaygpCgl0cnk6CgkJdm9sYWsgPSBuYW1heC5zcGxpdCgiQ1AtIilbMV07Y29weV9yaSA9ICgiQ1AiKTtBc3MgPSAoIiVzIiUoSykpO2FTcyA9IEsKCWV4Y2VwdDoKCQl0cnk6CgkJCXZvayA9IG5hbWF4LnNwbGl0KCJPSy0iKVsxXQoJCQljb3B5X3JpID0gKCJPSyIpCgkJCUFzcyA9ICgiJXMiJShJKSkKCQkJYVNzID0gSQoJCWV4Y2VwdDoKCQkJY29weV9yaSA9ICgiUklTS1ktSkVFQ0siKQoJCQlBc3MgPSAoIiVzIiUoQykpCgkJCWFTcyA9IE0KCXByaW50KHdhcisiSnVtbGFoIEFrdW4gOiIsbGVuKGZpbGEpLCJcbiIpCgl3aXRoIHp0aHJlYWRzKG1heF93b3JrZXJzPTMwKSBhcyAoZm9ybSk6CgkJZm9yIGRhdGEgaW4gZmlsYToKCQkJdHJ5OgoJCQkJZGF0YSA9IGRhdGEucmVwbGFjZSgiXG4iLCIiKQojCQkJCQl0cnk6CiMJCQkJCQlkYXQsIGRhdGEgPSBkYXRhLnNwbGl0KCJPSyAiKQojCQkJCQlleGNlcHQ6cGFzcwoJCQkJdHJ5OnVzZXIscHcsdGxsID0gZGF0YS5zcGxpdCgifCIpCgkJCQlleGNlcHQ6dXNlcixwdyA9IGRhdGEuc3BsaXQoInwiKTt0bGw9KCIgLSAiKQoJCQkJcHJpbnQoZiJ7UX1be0Fzc317Y29weV9yaX17UX1dIHthU3N9e3VzZXJ9fHtwd318e3RsbH17UX0iKQoJCQlleGNlcHQ6cGFzcwoJCQl0aW1lLnNsZWVwKDAuMDEpCglpbnB1dCh3YXIrJ1Rla2FuIEVudGVyICEnKTt0aW1lLnNsZWVwKDMpCgltZW51KCkKZGVmIGNwZGV0ZWN0KCk6CglqYWxhbih3YXIrIlNlYmVsdW0gTGFuanV0IFNpbGFoa2FuIERpUGlsaWggTWVudSIpCglwcmludCgiWzFdIENoZWNrIE9wc2kgRGVuZ2FuIEZpbGUgKG1hc2FsKSIpCglwcmludCgiWzJdIENoZWNrIE9wc2kgRGVuZ2FuIE1hbnVhbCAodXNlciBkYW4gcGFzcykiKQoJYmFiaSA9IGlucHV0KHdhcisiUGlsaWggOiAiKQoJaWYgYmFiaSBpbiAoIjEiLCIwMSIpOgoJCWZpbGVfYWxsKCkKCQlleGl0KCkKCWVsaWYgYmFiaSBpbiAoIjIiLCIwMiIpOgoJCW1hbnVhbCgpCgkJZXhpdCgpCgllbHNlOgoJCWphbGFuKHdhcisiSXNpIERlbmdhbiBCZW5hciBLZW50b2QiKTt0aW1lLnNsZWVwKDQpCgkJY3BkZXRlY3QoKQpkZWYgbWFudWFsKCk6CglnbG9iYWwgdXNlcixwdyxwd0Jhcix1YmFoUCxqYXJhawoJamFyYWsgPSAiICAgICAiCgl3dz1pbnB1dCh3YXIrIkFwYWthaCBBbmRhIE1hdSBNZW5ndWJhaCBQYXNzd29yZCwgQWt1biBUYXAgWWVzICh5L24pOiAiKQoJaWYgd3cgaW4gKCJZIiwieSIpOgoJCXViYWhQLmFwcGVuZCgieSIpCgkJcHdCYXI9aW5wdXQod2FyKyJQYXNzd29yZCBCYXJ1IFVudHVrIFRhcCBZZXMgOiAiKQoJCWlmIGxlbihwd0JhcikgPD0gNToKCQkJZXhpdChqYWxhbih3YXIrIlBhc3N3b3JkIEhhcnVzIDYgS2F0YS9IdXJ1ZiIpKQoJCWVsc2U6CgkJCXB3QmFydS5hcHBlbmQocHdCYXIpCgllbHNlOnBhc3MKCXVzZXIgPSBpbnB1dCh3YXIrIlVzZXJuYW1lL0VtYWlsL0lkeiA6ICIpCglwdyA9IGlucHV0KHdhcisiUGFzc3dvcmQgOiAiKQoJY2VrX29wc2kodXNlciwgcHcpCglpbnB1dCh3YXIrIkJhY2sgVG8gTWVudSIpCgltZW51KCkKCmRlZiBmaWxlX2FsbCgpOgoJY2VrZmlsZSgiSGFzaWwiKQoJbmFtYXg9aW5wdXQoIlxuIitpbnArIk5hbWEgRmlsZSA6ICIpCgl0cnk6CgkJZmlsYT1vcGVuKG5hbWF4LCJyIikucmVhZGxpbmVzKCkKCWV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKCQlqYWxhbih3YXIrIk1hYWYgRmlsZSBUaWRhayBEaVRlbXVrYW4iKQoJCWNwZGV0ZWN0KCkKIwlmaWxlX2NlcGF0KGZpbGEpCglmaWxlX2xhbWJhdChmaWxhKQp1cmwgPSAiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbSIKamFyYWsgPSAiICAgICAiCmRlZiBmaWxlX2NlcGF0KGZpbGUpOgoJZ2xvYmFsIHVzZXIscHcscHdCYXIsdWJhaFAsamFyYWsKCWphcmFrID0gIiAgICAgIgoJd3c9aW5wdXQod2FyKyJBcGFrYWggQW5kYSBNYXUgTWVuZ3ViYWggUGFzc3dvcmQsIEFrdW4gVGFwIFllcyAoeS9uKTogIikKCWlmIHd3IGluICgiWSIsInkiKToKCQl1YmFoUC5hcHBlbmQoInkiKQoJCXB3QmFyPWlucHV0KHdhcisiUGFzc3dvcmQgQmFydSBVbnR1ayBUYXAgWWVzIDogIikKCQlpZiBsZW4ocHdCYXIpIDw9IDU6CgkJCWV4aXQoamFsYW4od2FyKyJQYXNzd29yZCBIYXJ1cyA2IEthdGEvSHVydWYiKSkKCQllbHNlOgoJCQlwd0JhcnUuYXBwZW5kKHB3QmFyKQoJZWxzZTpwYXNzCglwcmludCh3YXIrIkp1bWxhaCBBa3VuIDoiLGxlbihmaWxlKSwiXG4iKQoJd2l0aCB6dGhyZWFkcyhtYXhfd29ya2Vycz01KSBhcyAoZm9ybSk6CgkJZm9yIGRhdGEgaW4gZmlsZToKCQkJdHJ5OgoJCQkJZGF0YSA9IGRhdGEucmVwbGFjZSgiXG4iLCIiKQoJCQkJdHJ5OgoJCQkJCWRhdCwgZGF0YSA9IGRhdGEuc3BsaXQoIlRBUCAiKQoJCQkJZXhjZXB0OnBhc3MKCQkJCXRyeTp1c2VyLHB3LHRsbCA9IGRhdGEuc3BsaXQoInwiKQoJCQkJZXhjZXB0OnVzZXIscHcgPSBkYXRhLnNwbGl0KCJ8Iik7dGxsPSgiIC0gIikKCQkJCXVzZXIgPSB1c2VyCgkJCQlwdyA9IHB3CgkJCQl0dGwgPSB0bGwKIwkJCQlwcmludChmInt3YXJ9e3VzZXJ9fHtwd318e3R0bH0iKQoJCQkJdHJ5OgoJCQkJCWZvcm0uc3VibWl0KGxvZ19oYXNpbCwgdXNlciwgcHcpCgkJCQlleGNlcHQ6Y29udGludWUKCQkJZXhjZXB0OmNvbnRpbnVlCmRlZiBmaWxlX2xhbWJhdChmaWxlKToKCWdsb2JhbCB1c2VyLHB3LHB3QmFyLHViYWhQLGphcmFrLGFtYW4sY3Asc2FsYWgsYnoKCWJ6ID0gMAoJamFyYWsgPSAiICAgICAiCgl3dz1pbnB1dCh3YXIrIkFwYWthaCBBbmRhIE1hdSBNZW5ndWJhaCBQYXNzd29yZCwgQWt1biBUYXAgWWVzICh5L24pOiAiKQoJaWYgd3cgaW4gKCJZIiwieSIpOgoJCXViYWhQLmFwcGVuZCgieSIpCgkJcHdCYXI9aW5wdXQod2FyKyJQYXNzd29yZCBCYXJ1IFVudHVrIFRhcCBZZXMgOiAiKQoJCWlmIGxlbihwd0JhcikgPD0gNToKCQkJZXhpdChqYWxhbih3YXIrIlBhc3N3b3JkIEhhcnVzIDYgS2F0YS9IdXJ1ZiIpKQoJCWVsc2U6CgkJCXB3QmFydS5hcHBlbmQocHdCYXIpCgllbHNlOnBhc3MKCXByaW50KHdhcisiSnVtbGFoIEFrdW4gOiIsbGVuKGZpbGUpLCJcbiIpCglmb3IgZGF0YSBpbiBmaWxlOgoJCXRyeToKCQkJZGF0YSA9IGRhdGEucmVwbGFjZSgiXG4iLCIiKQoJCQlkYXRhID0gZGF0YS5yZXBsYWNlKCJUQVAgIiwiIikKCQkJZGF0YSA9IGRhdGEucmVwbGFjZSgiIFtBWklNLUNQXSAiLCIiKQoJCQlkYXRhID0gZGF0YS5yZXBsYWNlKCIgW8OXXSAiLCIiKQoJCQl0cnk6dXNlcixwd3csdGxsID0gZGF0YS5zcGxpdCgifCIpCgkJCWV4Y2VwdDp1c2VyLHB3dyA9IGRhdGEuc3BsaXQoInwiKTt0bGw9KCIgLSAiKQoJCQl1c2VyID0gdXNlcgoJCQl0cnk6CgkJCQlwd3cgPSBwd3cuc3BsaXQoIlsnIilbMV0KCQkJCXB3dyA9IHB3dy5zcGxpdCgiJ10iKVswXQoJCQkJcHcgPSBwd3cKCQkJZXhjZXB0OgoJCQkJcHcgPSBwd3cKIwkJCQl0cnk6CiMJCQkJCWthID0gcHcuc3BsaXQoIlsnIilbMV0KIwkJCQkJa2EgPSBrYS5zcGxpdCgiJ10iKVswXQojCQkJCWV4Y2VwdDoKIwkJCQkJcHcgPSBwdwoJCQl0dGwgPSB0bGwKCSMJCXByaW50KGYiW3tzdHIoYnopfV0ge3VzZXJ9fHtwd318e3R0bH0iKQojCQkJY2VrX29wc2koIjEwMDA3MzM4ODI5NDM4NSIsICJtYXJpYTEyMzQ1IikKCQkJY2VrX29wc2kodXNlciwgcHcpCiMJCWV4Y2VwdDpjb250aW51ZQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgiXG5bIV0gRXJyb3IgOiAlcyIlKGUpKTtjb250aW51ZQpkZWYgZXhjZXB0djEodXNlcnEsIHB3cSk6Cgl0cnk6CgkJY2VrX29wc2kodXNlcnEsIHB3cSkKCWV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvcjoKCQlyZXR1cm4gZXhjZXB0djEodXNlcnEsIHB3cSkKCWV4Y2VwdDoKCQlyZXR1cm4gZXhjZXB0djEodXNlcnEsIHB3cSkKZGVmIHRhbnlhX29wc2koKToKCWdsb2JhbCBvcHNpaQoJYW5qYWcgPSBpbnB1dCh3YXIrIkFwYWthaCBBbmRhIE1hdSBNZW5hbXBpbGthbiBPcHNpIEFrdW4gKHkvbikgOiAiKQoJaWYgYW5qYWcgaW4gWyIxIiwiWWVzIiwieWEiLCJ5IiwiWSIsIllhIl06CgkJb3BzaWkgPSAieSIKCWVsc2U6CgkJb3BzaWkgPSAoIlJpc2t5X0d0ZyIpCmRlZiBidWF0X2dhYigpOgoJZ2xvYmFsIHB3QmFyLHViYWhQLGphcmFrCglqYXJhayA9ICIgICAgICIKCXd3PWlucHV0KHdhcisiQXBha2FoIEFuZGEgTWF1IE1lbmd1YmFoIFBhc3N3b3JkLCBBa3VuIFRhcCBZZXMgKHkvbik6ICIpCglpZiB3dyBpbiAoIlkiLCJ5Iik6CgkJdWJhaFAuYXBwZW5kKCJ5IikKCQlwd0Jhcj1pbnB1dCh3YXIrIlBhc3N3b3JkIEJhcnUgVW50dWsgVGFwIFllcyA6ICIpCgkJaWYgbGVuKHB3QmFyKSA8PSA1OgoJCQlleGl0KGphbGFuKHdhcisiUGFzc3dvcmQgSGFydXMgNiBLYXRhL0h1cnVmIikpCgkJZWxzZToKCQkJcHdCYXJ1LmFwcGVuZChwd0JhcikKCWVsc2U6CgkJcHJpbnQod2FyKyJTa2lwIFRhcCBZZXMiKQpkZWYgc3R0dCh1c2VyciwgcHd3LCB0dGEpOgoJZ2xvYmFsIHVzZXIscHcsdHRsCgl0cnk6CgkJdXNlciA9IHVzZXJyCgkJcHcgPSBwd3cKCQl0dGwgPSB0dGEKCQljZWtfb3BzaV9jcmFjayh1c2VyLCBwdywgdGxsKQoJZXhjZXB0OnBhc3MKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBUZXJpbWEgS2FzaWggVG8gTGF0aXAgIyAgICAgICAgICA8PDwgS05UTAojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCmRlZiBjZWtfb3BzaSh1c2VyLCBwdyk6CiMJZ2xvYmFsIGFtYW4sY3Asc2FsYWgKCWdsb2JhbCB1cmwsYnoKCWJ6ICs9IDEKCXVybCA9ICJodHRwczovL20uZmFjZWJvb2suY29tIgoJc2Vzc2lvbj1yZXEuU2Vzc2lvbigpCglzZXNzaW9uLmhlYWRlcnMudXBkYXRlKHsKCQkiSG9zdCI6Im0uZmFjZWJvb2suY29tIiwKCQkiYWNjZXB0IjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44LGFwcGxpY2F0aW9uL3NpZ25lZC1leGNoYW5nZTt2PWIzO3E9MC45IiwKCQkiYWNjZXB0LWVuY29kaW5nIjoiZ3ppcCwgZGVmbGF0ZSIsCgkJImFjY2VwdC1sYW5ndWFnZSI6ImlkLUlELGlkO3E9MC45IiwKCQkicmVmZXJlciI6Imh0dHBzOi8vbS5mYWNlYm9vay5jb20vIiwKCQkidXNlci1hZ2VudCI6Ik1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgTWkgOVQgUHJvIEJ1aWxkL1FLUTEuMTkwODI1LjAwMjsgd3YpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS84OC4wLjQzMjQuMTgxIE1vYmlsZSBTYWZhcmkvNTM3LjM2IFtGQkFOL0VNQTtGQkxDL2lkX0lEO0ZCQVYvMjM5LjAuMC4xMC4xMDk7XSIKCX0pCglzb3VwPXBhcihzZXNzaW9uLmdldCh1cmwrIi9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgiKS50ZXh0LCJodG1sLnBhcnNlciIpCglsaW5rPXNvdXAuZmluZCgiZm9ybSIseyJtZXRob2QiOiJwb3N0In0pCglmb3IgeCBpbiBzb3VwKCJpbnB1dCIpOgoJCWRhdGEudXBkYXRlKHt4LmdldCgibmFtZSIpOnguZ2V0KCJ2YWx1ZSIpfSkKCWRhdGEudXBkYXRlKHsiZW1haWwiOnVzZXIsInBhc3MiOnB3fSkKCXVybFBvc3Q9c2Vzc2lvbi5wb3N0KCJodHRwczovL20uZmFjZWJvb2suY29tIitsaW5rLmdldCgiYWN0aW9uIiksZGF0YT1kYXRhKQoJcmVzcG9uc2U9cGFyKHVybFBvc3QudGV4dCwgImh0bWwucGFyc2VyIikKCWlmICJUZW11a2FuIEFrdW4gQW5kYSIgaW4gcmUuZmluZGFsbCgiXDx0aXRsZT4oLio/KTxcL3RpdGxlPiIsc3RyKHVybFBvc3QudGV4dCkpOgoJCXByaW50KHdhcisiSGlkdXAgTWF0aWthbiBNb2RlIFBlc2F3YXQsIFNlbGFtYSAyIERldGlrICEhIikKCWlmICJjX3VzZXIiIGluIHNlc3Npb24uY29va2llcy5nZXRfZGljdCgpOgoJCWlmICJBa3VuIEFuZGEgRGlrdW5jaSIgaW4gdXJsUG9zdC50ZXh0OgoJCQlwcmludChmIlxye1F9W3tDfXtzdHIoYnopfXtRfV0gU2VkYW5nIENoZWNrIE9wc2kgQWt1biA6IHtLfXt1c2VyfXx7cHd9e1F9CQlcbiIsZW5kPSIiKQoJCQlwcmludChmIlxye2phcmFrfXt3YXJ9QWt1biBJbmkgS2VuYWsgU2VzaSBOZXcJCQkJCVxuXG4iLGVuZD0iIikKCQllbHNlOgojCQkJYW1hbis9MQoJCQljb2tpID0gKCI7Iikuam9pbihbICIlcz0lcyIgJSAoa2V5LCB2YWx1ZSkgZm9yIGtleSwgdmFsdWUgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCkuaXRlbXMoKSBdKQoJCQlwcmludChmIlxye1F9W3tJfU9Le1F9XXtJfSB7dXNlcn18e3B3fXtRfSAgICAgICAgXG4iLGVuZD0iIikKCQkJcHJpbnQoZiJccntqYXJha317UX1be0l94pyTe1F9XXtDfSBDb29raWU6IHtJfXtjb2tpfXtRfVxuIixlbmQ9IiIpCgkJCW9wZW4oIkhhc2lsL0FrdW4tVGFwLVllcy50eHQiLCAiYSIpLndyaXRlKHVzZXIrInwiK3B3KyJ8Iitjb2tpKyJcbiIpCgkJCWdldF9pbmZvbyhzZXNzaW9uLGNva2kpCgkJCWNla19hcGsoc2Vzc2lvbixjb2tpKQoJZWxpZiAiY2hlY2twb2ludCIgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCk6CiMJCWNwKz0xCgkJdGl0bGU9cmUuZmluZGFsbCgiXDx0aXRsZT4oLio/KTxcL3RpdGxlPiIsc3RyKHJlc3BvbnNlKSkKCQlsaW5rMj1yZXNwb25zZS5maW5kKCJmb3JtIix7Im1ldGhvZCI6InBvc3QifSkKCQlsaXN0SW5wdXQ9WydmYl9kdHNnJywnamF6b2VzdCcsJ2NoZWNrcG9pbnRfZGF0YScsJ3N1Ym1pdFtDb250aW51ZV0nLCduaCddCgkJZm9yIHggaW4gcmVzcG9uc2UoImlucHV0Iik6CgkJCWlmIHguZ2V0KCJuYW1lIikgaW4gbGlzdElucHV0OgoJCQkJZGF0YTIudXBkYXRlKHt4LmdldCgibmFtZSIpOnguZ2V0KCJ2YWx1ZSIpfSkKCQlhbj1zZXNzaW9uLnBvc3QodXJsK2xpbmsyLmdldCgiYWN0aW9uIiksZGF0YT1kYXRhMikKCQlyZXNwb25zZTI9cGFyKGFuLnRleHQsImh0bWwucGFyc2VyIikKCQludW1iZXI9MAoJCWNlaz1bY2VrIGZvciBjZWsgaW4gcmVzcG9uc2UyLmZpbmRfYWxsKCJvcHRpb24iKV0KCQlwcmludChmIlxye1F9W3tDfXtzdHIoYnopfXtRfV0gU2VkYW5nIENoZWNrIE9wc2kgQWt1biA6IHtLfSB7dXNlcn18e3B3fXtRfQkJXG4iLGVuZD0iIikKIwkJcHJpbnQoZiJcclwzM1sxOzMzbVtDUF0ge3VzZXJ9IHwge3B3fQkJCQkJCQkJXDMzWzM3OzFtXG4iLGVuZD0iIikKCQlwcmludChmIlxye1F9W3tNfSF7UX1dIFRlcmRhcGF0IHtLfXtsZW4oY2VrKX17UX0gT3BzaSA6CVxuIixlbmQ9IiIpCgkJaWYobGVuKGNlayk9PTApOgoJCQlpZiAiTGloYXQgZGV0YWlsIGxvZ2luIHlhbmcgZGl0YW1waWxrYW4uIEluaSBBbmRhPyIgaW4gdGl0bGU6CgkJCQljb2tpID0gKCI7Iikuam9pbihbICIlcz0lcyIgJSAoa2V5LCB2YWx1ZSkgZm9yIGtleSwgdmFsdWUgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCkuaXRlbXMoKSBdKQoJCQkJaWYgInkiIGluIHViYWhQOgoJCQkJCXViYWhfcHcoc2Vzc2lvbixyZXNwb25zZSxsaW5rMikKCQkJCWVsc2U6CgkJCQkJcHJpbnQoZiJccntqYXJha317UX1be0l94oiae1F9XXtJfSBTZWxhbWF0IEFrdW4gSW5pIFRhcCBZZXMge1F9XG57amFyYWt9W3tDfSt7UX1de1F9IENvb2tpZToge0l9e2Nva2l9e1F9XG4iKQoJCQkJCWNla19hcGsoc2Vzc2lvbixjb2tpKQoJCQllbGlmICJNYXN1a2thbiBLb2RlIE1hc3VrIHVudHVrIE1lbGFuanV0a2FuIiBpbiByZS5maW5kYWxsKCJcPHRpdGxlPiguKj8pPFwvdGl0bGU+IixzdHIocmVzcG9uc2UpKToKCQkJCXByaW50KGYiXHJ7amFyYWt9e1F9W3tNfcOXe1B9XSB7TX1Ba3VuIEEyRiBPbiAgICAgICAgICAgIHtRfVxuIikKCQkJZWxzZToKCQkJCXByaW50KGYiXHJ7amFyYWt9e3dhcn17TX1UZXJqYWRpIE1hc2FsYWggVGVyaGFkYXAgQWt1bntRfSAgICAgCQlcbiIpCgkJZWxpZihsZW4oY2VrKTw9MSk6CgkJCWZvciB4IGluIHJhbmdlKGxlbihjZWspKToKCQkJCW51bWJlcis9MQoJCQkJb3BzaT1yZS5maW5kYWxsKCdcPG9wdGlvbiBzZWxlY3RlZD1cIi4qP1wiIHZhbHVlPVwiLio/XCI+KC4qPyk8XC9vcHRpb24+JyxzdHIoY2VrKSkKCQkJCXByaW50KGYiXHJ7amFyYWt9e1F9W3tDfXtudW1iZXJ9e1F9XSB7S317Jycuam9pbihvcHNpKX0JCQl7UX1cbiIsZW5kPSIiKQoJCQlwcmludCgiIikKCQllbGlmKGxlbihjZWspPj0yKToKCQkJZm9yIHggaW4gcmFuZ2UobGVuKGNlaykpOgoJCQkJbnVtYmVyKz0xCgkJCQlvcHNpPXJlLmZpbmRhbGwoJ1w8b3B0aW9uIHZhbHVlPVwiLitcIj4oLispPFwvb3B0aW9uPicsc3RyKGNla1t4XSkpCgkJCQlwcmludChmIlxye2phcmFrfXtRfVt7Q317bnVtYmVyfXtRfV0ge0t9eycnLmpvaW4ob3BzaSl9CQkJe1F9XG4iLGVuZD0iIikKIwkJCQlwcmludChmIlxyW3tudW1iZXJ9XS4ge0J9eycnLmpvaW4ob3BzaSl9e1B9XG4iLGVuZD0iIikKCQkJcHJpbnQoIiIpCgkJZWxzZToKCQkJaWYgImNfdXNlciIgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCk6CiMJCQkJY3AtPTEKIwkJCQlhbWFuKz0xCgkJCQljb2tpID0gKCI7Iikuam9pbihbICIlcz0lcyIgJSAoa2V5LCB2YWx1ZSkgZm9yIGtleSwgdmFsdWUgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCkuaXRlbXMoKSBdKQoJCQkJcHJpbnQoZiJccntRfVt7SX1PS3tRfV0ge0l9e3VzZXJ9fHtwd318e2Nva2l9e1F9ICAgICAgICBcbiIsZW5kPSIiKQoJCQkJb3BlbigiSGFzaWwvQWt1bi1UYXAtWWVzLnR4dCIsICJhIikud3JpdGUodXNlcisifCIrcHcrInwiK2Nva2krIlxuIikKCQkJCWdldF9pbmZvbyhzZXNzaW9uLGNva2kpCgkJCQljZWtfYXBrKHNlc3Npb24sY29raSkKCQkJCQoJZWxzZToKIwkJc2FsYWgrPTEKCQlwcmludChmIlxye1F9W3tDfXtzdHIoYnopfXtRfV0gU2VkYW5nIENoZWNrIE9wc2kgQWt1biA6IHtNfXt1c2VyfXx7cHd9e1F9IikKCQlwcmludChmIlxye2phcmFrfXt3YXJ9e019S2F0YSBTYW5kaSBTYWxhaCAhICAgICAgICAgIHtQfVxuIikKZGVmIHViYWhfcHcoc2Vzc2lvbixyZXNwb25zZSxsaW5rMik6CglkYXQsZGF0Mj17fSx7fQoJYnV0PVsic3VibWl0W1llc10iLCJuaCIsImZiX2R0c2ciLCJqYXpvZXN0IiwiY2hlY2twb2ludF9kYXRhIl0KCWZvciB4IGluIHJlc3BvbnNlKCJpbnB1dCIpOgoJCWlmIHguZ2V0KCJuYW1lIikgaW4gYnV0OgoJCQlkYXQudXBkYXRlKHt4LmdldCgibmFtZSIpOnguZ2V0KCJ2YWx1ZSIpfSkKCXViYWhQdz1zZXNzaW9uLnBvc3QodXJsK2xpbmsyLmdldCgiYWN0aW9uIiksZGF0YT1kYXQpLnRleHQKCXJlc1ViYWg9cGFyKHViYWhQdywiaHRtbC5wYXJzZXIiKQoJbGluazM9cmVzVWJhaC5maW5kKCJmb3JtIix7Im1ldGhvZCI6InBvc3QifSkKCWJ1dDI9WyJzdWJtaXRbTmV4dF0iLCJuaCIsImZiX2R0c2ciLCJqYXpvZXN0Il0KCWlmICJCdWF0IEthdGEgU2FuZGkgQmFydSIgaW4gcmUuZmluZGFsbCgiXDx0aXRsZT4oLio/KTxcL3RpdGxlPiIsc3RyKHViYWhQdykpOgoJCWZvciBiIGluIHJlc1ViYWgoImlucHV0Iik6CgkJCWlmIGIuZ2V0KCJuYW1lIikgaW4gYnV0MjoKCQkJCWRhdDIudXBkYXRlKHtiLmdldCgibmFtZSIpOmIuZ2V0KCJ2YWx1ZSIpfSkKCQlkYXQyLnVwZGF0ZSh7InBhc3N3b3JkX25ldyI6IiIuam9pbihwd0JhcnUpfSkKCQlhbj1zZXNzaW9uLnBvc3QodXJsK2xpbmszLmdldCgiYWN0aW9uIiksZGF0YT1kYXQyKQoJCWNva2kgPSAoIjsiKS5qb2luKFsgIiVzPSVzIiAlIChrZXksIHZhbHVlKSBmb3Iga2V5LCB2YWx1ZSBpbiBzZXNzaW9uLmNvb2tpZXMuZ2V0X2RpY3QoKS5pdGVtcygpIF0pCgkJcHJpbnQoZiJccntqYXJha317amFyYWt9e1F9W3tJfeKck3tRfV17SX0gQUtVTiBJTkkgVEFQIFlFU3tRfVxue2phcmFrfXtqYXJha317UX1be0l94pyTe1F9XXtJfSB7dXNlcn18eycnLmpvaW4ocHdCYXJ1KX18e2Nva2l9e1F9XG4iLGVuZD0iIikKCQlib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIlRBUCIsIHVzZXIsICIiLmpvaW4ocHdCYXJ1KSwgIiIpCgkJb3BlbigiSGFzaWwvQWt1bi1UYXAtWWVzLnR4dCIsICJhIikud3JpdGUodXNlcisifCIrIiIuam9pbihwd0JhcnUpKyJ8Iitjb2tpKyJcbiIpCgkJaWYgImNoZWNrcG9pbnQiIG5vdCBpbiBjb2tpOgoJCQlnZXRfaW5mb28oc2Vzc2lvbixjb2tpKQoJCQljZWtfYXBrKHNlc3Npb24sY29raSkKCQllbHNlOgoJCQlwcmludCgiIikKCmRlZiBnZXRfaW5mb28oc2Vzc2lvbixjb2tpKToKCWdldF9pZCA9IHNlc3Npb24uZ2V0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vcHJvZmlsZS5waHAiLGNvb2tpZXM9eyJjb29raWUiOmNva2l9KS50ZXh0CgluYW1hID0gcmUuZmluZGFsbCgnXDx0aXRsZVw+KC4qPyk8XC90aXRsZVw+JyxzdHIoZ2V0X2lkKSlbMF0KCXJlc3BvbnNlID0gc2Vzc2lvbi5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vcHJvZmlsZS5waHA/dj1pbmZvIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJcmVzcG9uc2UyID0gc2Vzc2lvbi5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vcHJvZmlsZS5waHA/dj1mcmllbmRzIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJcmVzcG9uc2UzID0gc2Vzc2lvbi5nZXQoZiJodHRwczovL20uZmFjZWJvb2suY29tL3t1c2VyfS9hbGxhY3Rpdml0eS8/Y2F0ZWdvcnlfa2V5PWFsbCZzZWN0aW9uX2lkPXllYXJfMjAyMiZ0aW1lc3RhcnQ9MTYwOTQ4ODAwMCZ0aW1lZW5kPTE2NDEwMjM5OTkmc2VjdGlvbkxvYWRpbmdJRD1tX3RpbWVsaW5lX2xvYWRpbmdfZGl2XzE2NDEwMjM5OTlfMTYwOTQ4ODAwMF84XyIsY29va2llcz17ImNvb2tpZSI6Y29raX0pLnRleHQKCXJlc3BvbnNlNCA9IHNlc3Npb24uZ2V0KGYiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS90aW1lbGluZS9hcHBfY29sbGVjdGlvbi8/Y29sbGVjdGlvbl90b2tlbj17dXNlcn0lM0ExODQ5ODUwNzE1MzgwMDIlM0EzMiZfcmRjPTEmX3JkciIsY29va2llcz17ImNvb2tpZSI6Y29raX0pLnRleHQKCXRyeToKCQlub21lciA9IHJlLmZpbmRhbGwoJ1w8YVwgaHJlZlw9XCJ0ZWxcOlwrLio/XCI+XDxzcGFuXCBkaXJcPVwibHRyXCI+KC4qPyk8XC9zcGFuPjxcL2E+JyxzdHIocmVzcG9uc2UpKVswXQoJZXhjZXB0OgoJCW5vbWVyID0gIiIKCXRyeToKCQllbWFpbCA9IHJlLmZpbmRhbGwoJ1w8YSBocmVmXD1cImh0dHBzXDpcL1wvbG1cLmZhY2Vib29rXC5jb21cL2xcLnBocFw/dVw9bWFpbC4qP1wiIHRhcmdldFw9XCIuKj9cIlw+KC4qPyk8XC9hXD4nLHN0cihyZXNwb25zZSkpWzBdLnJlcGxhY2UoJyYjMDY0OycsJ0AnKQoJZXhjZXB0OgoJCWVtYWlsPSIiCgl0cnk6CgkJdHRsID0gcmUuZmluZGFsbCgnXDxcL3RkXD5cPHRkXCB2YWxpZ25cPVwidG9wXCIgY2xhc3NcPVwiLio/XCJcPlw8ZGl2XCBjbGFzc1w9XCIuKj9cIlw+KFxkK1xzK1x3K1xzK1xkKyk8XC9kaXZcPlw8XC90ZFw+XDxcL3RyXD4nLHN0cihyZXNwb25zZSkpWzBdCglleGNlcHQ6CgkJdHRsPSIiCgl0cnk6CgkJdGVtYW4gPSByZS5maW5kYWxsKCdcPGgzXCBjbGFzc1w9XCIuKj9cIlw+VGVtYW5cIFwoKC4qPylcKTxcL2gzXD4nLHN0cihyZXNwb25zZTIpKVswXQoKCWV4Y2VwdDoKCQl0ZW1hbiA9ICIiCgl0cnk6CgkJcGVuZ2lrdXQgPSByZS5maW5kYWxsKCdcPHNwYW5cIGNsYXNzXD1cIi4qP1wiXD4oLio/KVw8XC9zcGFuXD4nLHN0cihyZXNwb25zZTQpKVsxXQoJZXhjZXB0OgoJCXBlbmdpa3V0ID0gIiIKCXRyeToKCQl0YWh1biA9ICIiCgkJY2VrX3RobiA9IHJlLmZpbmRhbGwoJ1w8ZGl2XCBjbGFzc1w9XCIuKj9cIiBpZFw9XCJ5ZWFyXyguKj8pXCI+JyxzdHIocmVzcG9uc2UzKSkKCQlmb3IgbmVuZW4gaW4gY2VrX3RobjoKCQkJdGFodW4gKz0gbmVuZW4rIiwgIgoJZXhjZXB0OnBhc3MKCglwcmludChmIntqYXJha317amFyYWt9W3tJfeKck3tQfV0gTmFtYSBBa3VuICAgICAgIDoge0t9e25hbWF9e1B9XG57amFyYWt9e2phcmFrfVt7SX3inJN7UH1dIEp1bWxhaCBUZW1hbiAgICA6IHtLfXt0ZW1hbn17UH1cbntqYXJha317amFyYWt9W3tJfeKck3tQfV0gSnVtbGFoIFBlbmdpa3V0IDoge0t9e3Blbmdpa3V0fXtQfVxue2phcmFrfXtqYXJha31be0l94pyTe1B9XSBFbWFpbCBBa3RpZiAgICAgOiB7S317ZW1haWx9e1B9XG57amFyYWt9e2phcmFrfVt7SX3inJN7UH1dIE5vbW9yIEFrdGlmICAgICA6IHtLfXtub21lcn17UH1cbntqYXJha317amFyYWt9W3tJfeKck3tQfV0gVGFodW4gQWt1biAgICAgIDoge0t9e3RhaHVufXtQfVxue2phcmFrfXtqYXJha31be0l94pyTe1B9XSBUYW5nZ2FsIExhaGlyICAgOiB7S317dHRsfXtQfSIpCgojdXNlcj0iMTAwMDQzNzI4MzE0NjEyIgojZ2V0X2luZm9vKHJlcS5TZXNzaW9uKCksICJkYXRyPS1LemlZWHNPSUdrbG5mMWxwVlBXaXhMNTtmcj0wTTZabVpFTzdEMndBTVdsWi5BV1ZiUm5tTlVmVVNWa1NPaWhEQU9jV3NTQVUuQmg0cXo4LjA3LkFBQS4wLjAuQmg0cXo4LkFXWC02c0ZfUktnO2xvY2FsZT1pZF9JRDtub3NjcmlwdD0xO3NiPV9LemlZU2xTX3VOaVdEWkV4ZWlFc3ByRDt4cz0xMiUzQUFqbHR2aVk0YndENGJnJTNBMiUzQTE2NDIyNDUzNzUlM0EtMSUzQTEwOTYzO2NfdXNlcj0xMDAwNDM3MjgzMTQ2MTIiKQoKZGVmIHViYWhfdXNlcm5hbWVfdG9faWQodXNlcik6Cgl0cnk6CgkJaWYgdXNlciA9PSAibWUiOgoJCQltZW1layA9ICJtZSIKCQllbHNlOgoJCQlwYXlsb2FkID0geyJmYnVybCI6ICJodHRwczovL20uZmFjZWJvb2suY29tL3t9Ii5mb3JtYXQodXNlciksICJjaGVjayI6ICJMb29rdXAifQoJCQlpZiAiZmFjZWJvb2siIGluIHVzZXI6CgkJCQlwYXlsb2FkID0geyJmYnVybCI6IHVzZXIsICJjaGVjayI6ICJMb29rdXAifQoJCQltbWsgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2xvb2t1cC1pZC5jb20vIiwgZGF0YT1wYXlsb2FkKS5jb250ZW50CgkJCXh4eCA9IHBhcihtbWssICJodG1sLnBhcnNlciIpCgkJCWlkdCA9IHh4eC5maW5kKCJzcGFuIiwgaWQ9ImNvZGUiKQoJCQlhc3cgPSBpZHQudGV4dAoJCQltZW1layA9IGFzdwoJCXJldHVybiBtZW1lawoJZXhjZXB0OgoJCXJldHVybiB1c2VyCmRlZiB0ZXh0X3JhbmRvbSgpOgoJY29udG9sID0gdXVpZC51dWlkNCgpLmhleFs6MTBdLnVwcGVyKCkKCXJldHVybiBjb250b2wKCmRlZiBjZWtfYXBrKHNlc3Npb24sY29raSk6CgloaXQxLCBoaXQyID0gMCwwCgljZWsgPXNlc3Npb24uZ2V0KCJodHRwczovL20uZmFjZWJvb2suY29tL3NldHRpbmdzL2FwcHMvdGFiYmVkLz90YWI9YWN0aXZlIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJY2VrMiA9IHNlc3Npb24uZ2V0KCJodHRwczovL20uZmFjZWJvb2suY29tL3NldHRpbmdzL2FwcHMvdGFiYmVkLz90YWI9aW5hY3RpdmUiLGNvb2tpZXM9eyJjb29raWUiOmNva2ksInVzZXItYWdlbnQiOiJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IENQSDIxNzkpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85Ni4wLjQ2NjQuMTA0IE1vYmlsZSBTYWZhcmkvNTM3LjM2In0pLnRleHQKCWlmICJEaWFrc2VzIG1lbmdndW5ha2FuIEZhY2Vib29rIiBpbiByZS5maW5kYWxsKCJcPHRpdGxlXD4oLio/KTxcL3RpdGxlXD4iLHN0cihjZWspKToKCQlwcmludChmIntqYXJha317amFyYWt9e3dhcn1BcGxpa2FzaSBZYW5nIFRlcmthaXQqIikKCQlpZiAiQW5kYSB0aWRhayBtZW1pbGlraSBhcGxpa2FzaSBhdGF1IHNpdHVzIHdlYiBha3RpZiB1bnR1ayBkaXRpbmphdS4iIGluIGNlazoKCQkJcHJpbnQoZiJ7amFyYWt9e2phcmFrfXtqYXJha317d2FyfVRpZGFrIEFkYSBBcGxpa2FzaSBBa3RpZiBZYW5nIFRlcmthaXQgKiIpCgkJZWxzZToKCQkJcHJpbnQoZiJ7amFyYWt9e2phcmFrfXtqYXJha317d2FyfUFwbGlrYXNpIEFrdGlmKiIpCgkJCWFwa0FrdGlmID0gcmUuZmluZGFsbCgnXC8+PGRpdlwgY2xhc3NcPVwiLio/XCJcPlw8c3BhblwgY2xhc3NcPVwiLio/XCJcPiguKj8pPFwvc3Bhblw+JyxzdHIoY2VrKSkKCQkJZGl0YW1iYWhrYW4gPSByZS5maW5kYWxsKCdcPGRpdlw+XDxcL2Rpdlw+XDxkaXZcIGNsYXNzXD1cIi4qP1wiXD4oLio/KTxcL2Rpdlw+JyxzdHIoY2VrKSkKCQkJZm9yIG11bmN1bCBpbiBhcGtBa3RpZjoKCQkJCWhpdDErPTEKCQkJCXByaW50KGYie2phcmFrfXtqYXJha317amFyYWt9e2phcmFrfXtRfVt7Q317aGl0MX17UX1dIHtJfXttdW5jdWx9IHtDfXtkaXRhbWJhaGthbltoaXQyXX17UX0iKQoJCQkJaGl0Mis9MQoJCWlmICJBbmRhIHRpZGFrIG1lbWlsaWtpIGFwbGlrYXNpIGF0YXUgc2l0dXMgd2ViIGtlZGFsdXdhcnNhIHVudHVrIGRpdGluamF1IiBpbiBjZWsyOgoJCQlwcmludChmIntqYXJha317amFyYWt9e2phcmFrfXt3YXJ9VGlkYWsgQWRhIEFwbGlrYXNpIEtlZGFsdXdhcnNhIFlhbmcgVGVya2FpdCAqIikKCQllbHNlOgoJCQloaXQxLGhpdDI9MCwwCgkJCXByaW50KGYie2phcmFrfXtqYXJha317amFyYWt9e3dhcn1BcGxpa2FzaSBLZWRhbHV3YXJzYSoiKQoJCQlhcGtLYWRhbHVhcnNhID0gcmUuZmluZGFsbCgnXC8+PGRpdlwgY2xhc3NcPVwiLio/XCJcPlw8c3BhblwgY2xhc3NcPVwiLio/XCJcPiguKj8pPFwvc3Bhblw+JyxzdHIoY2VrMikpCgkJCWthZGFsdWFyc2EgPSByZS5maW5kYWxsKCdcPGRpdlw+XDxcL2Rpdlw+XDxkaXZcIGNsYXNzXD1cIi4qP1wiXD4oLio/KTxcL2Rpdlw+JyxzdHIoY2VrMikpCgkJCWZvciBtdW5jdWwgaW4gYXBrS2FkYWx1YXJzYToKCQkJCWhpdDErPTEKCQkJCXByaW50KGYie2phcmFrfXtqYXJha317amFyYWt9e2phcmFrfXtRfVt7Q317aGl0MX17UX1dIHtLfXttdW5jdWx9IHtVfXtrYWRhbHVhcnNhW2hpdDJdfXtRfSIpCgkJCQloaXQyKz0xCgllbHNlOgoJCXByaW50KGYie2phcmFrfXt3YXJ9e019Q29va2llcyBFcnJvciAhIikKCXByaW50KCIiKQoKZGVmIGNla19jb29raWVzX2J5X3Jpc2t5KHVzZXJyLCBjb2tpaSwgbWVtZWtfbWFtYWtfeWF5YW4pOgoJa250bF95YXlhbiA9ICIiCgl1c2VyID0gdXNlcnIKCWNva2kgPSBrdWtpc192MShjb2tpaSkKCWFrdW5fbm4gPSBtZW1la19tYW1ha195YXlhbgoJc2Vzc2lvbiA9IHJlcS5TZXNzaW9uKCkKCgoJZ2V0X2lkID0gc2Vzc2lvbi5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vcHJvZmlsZS5waHAiLGNvb2tpZXM9eyJjb29raWUiOmNva2l9KS50ZXh0CgluYW1hID0gcmUuZmluZGFsbCgnXDx0aXRsZVw+KC4qPyk8XC90aXRsZVw+JyxzdHIoZ2V0X2lkKSlbMF0KCXJlc3BvbnNlID0gc2Vzc2lvbi5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vcHJvZmlsZS5waHA/dj1pbmZvIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJcmVzcG9uc2UyID0gc2Vzc2lvbi5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vcHJvZmlsZS5waHA/dj1mcmllbmRzIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJcmVzcG9uc2UzID0gc2Vzc2lvbi5nZXQoZiJodHRwczovL20uZmFjZWJvb2suY29tL3t1c2VyfS9hbGxhY3Rpdml0eS8/Y2F0ZWdvcnlfa2V5PWFsbCZzZWN0aW9uX2lkPXllYXJfMjAyMiZ0aW1lc3RhcnQ9MTYwOTQ4ODAwMCZ0aW1lZW5kPTE2NDEwMjM5OTkmc2VjdGlvbkxvYWRpbmdJRD1tX3RpbWVsaW5lX2xvYWRpbmdfZGl2XzE2NDEwMjM5OTlfMTYwOTQ4ODAwMF84XyIsY29va2llcz17ImNvb2tpZSI6Y29raX0pLnRleHQKCXJlc3BvbnNlNCA9IHNlc3Npb24uZ2V0KGYiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS90aW1lbGluZS9hcHBfY29sbGVjdGlvbi8/Y29sbGVjdGlvbl90b2tlbj17dXNlcn0lM0ExODQ5ODUwNzE1MzgwMDIlM0EzMiZfcmRjPTEmX3JkciIsY29va2llcz17ImNvb2tpZSI6Y29raX0pLnRleHQKCXRyeTpub21lciA9IHJlLmZpbmRhbGwoJ1w8YVwgaHJlZlw9XCJ0ZWxcOlwrLio/XCI+XDxzcGFuXCBkaXJcPVwibHRyXCI+KC4qPyk8XC9zcGFuPjxcL2E+JyxzdHIocmVzcG9uc2UpKVswXQoJZXhjZXB0Om5vbWVyID0gIiIKCXRyeTplbWFpbCA9IHJlLmZpbmRhbGwoJ1w8YSBocmVmXD1cImh0dHBzXDpcL1wvbG1cLmZhY2Vib29rXC5jb21cL2xcLnBocFw/dVw9bWFpbC4qP1wiIHRhcmdldFw9XCIuKj9cIlw+KC4qPyk8XC9hXD4nLHN0cihyZXNwb25zZSkpWzBdLnJlcGxhY2UoJyYjMDY0OycsJ0AnKQoJZXhjZXB0OmVtYWlsPSIiCgl0cnk6dHRsID0gcmUuZmluZGFsbCgnXDxcL3RkXD5cPHRkXCB2YWxpZ25cPVwidG9wXCIgY2xhc3NcPVwiLio/XCJcPlw8ZGl2XCBjbGFzc1w9XCIuKj9cIlw+KFxkK1xzK1x3K1xzK1xkKyk8XC9kaXZcPlw8XC90ZFw+XDxcL3RyXD4nLHN0cihyZXNwb25zZSkpWzBdCglleGNlcHQ6dHRsPSIiCgl0cnk6dGVtYW4gPSByZS5maW5kYWxsKCdcPGgzXCBjbGFzc1w9XCIuKj9cIlw+VGVtYW5cIFwoKC4qPylcKTxcL2gzXD4nLHN0cihyZXNwb25zZTIpKVswXQoJZXhjZXB0OnRlbWFuID0gIiIKCXRyeTpwZW5naWt1dCA9IHJlLmZpbmRhbGwoJ1w8c3BhblwgY2xhc3NcPVwiLio/XCJcPiguKj8pXDxcL3NwYW5cPicsc3RyKHJlc3BvbnNlNCkpWzFdCglleGNlcHQ6cGVuZ2lrdXQgPSAiIgoJdHJ5OgoJCXRhaHVuID0gIiIKCQljZWtfdGhuID0gcmUuZmluZGFsbCgnXDxkaXZcIGNsYXNzXD1cIi4qP1wiIGlkXD1cInllYXJfKC4qPylcIj4nLHN0cihyZXNwb25zZTMpKQoJCWZvciBuZW5lbiBpbiBjZWtfdGhuOgoJCQl0YWh1biArPSBuZW5lbisiLCAiCglleGNlcHQ6cGFzcwoKCWtudGxfeWF5YW4gKz0gKGYie2phcmFrfXtqYXJha31be0l94pyTe1B9XSBOYW1hIEFrdW4gICAgICAgOiB7S317bmFtYX17UH1cbntqYXJha317amFyYWt9W3tJfeKck3tQfV0gSnVtbGFoIFRlbWFuICAgIDoge0t9e3RlbWFufXtQfVxue2phcmFrfXtqYXJha31be0l94pyTe1B9XSBKdW1sYWggUGVuZ2lrdXQgOiB7S317cGVuZ2lrdXR9e1B9XG57amFyYWt9e2phcmFrfVt7SX3inJN7UH1dIEVtYWlsIEFrdGlmICAgICA6IHtLfXtlbWFpbH17UH1cbntqYXJha317amFyYWt9W3tJfeKck3tQfV0gTm9tb3IgQWt0aWYgICAgIDoge0t9e25vbWVyfXtQfVxue2phcmFrfXtqYXJha31be0l94pyTe1B9XSBUYWh1biBBa3VuICAgICAgOiB7S317dGFodW59e1B9XG57amFyYWt9e2phcmFrfVt7SX3inJN7UH1dIFRhbmdnYWwgTGFoaXIgICA6IHtLfXt0dGx9e1B9XG4iKQoKCWhpdDEsIGhpdDIgPSAwLDAKCWNlayA9c2Vzc2lvbi5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vc2V0dGluZ3MvYXBwcy90YWJiZWQvP3RhYj1hY3RpdmUiLGNvb2tpZXM9eyJjb29raWUiOmNva2l9KS50ZXh0CgljZWsyID0gc2Vzc2lvbi5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vc2V0dGluZ3MvYXBwcy90YWJiZWQvP3RhYj1pbmFjdGl2ZSIsY29va2llcz17ImNvb2tpZSI6Y29raX0pLnRleHQKCWlmICJEaWFrc2VzIG1lbmdndW5ha2FuIEZhY2Vib29rIiBpbiByZS5maW5kYWxsKCJcPHRpdGxlXD4oLio/KTxcL3RpdGxlXD4iLHN0cihjZWspKToKCQlrbnRsX3lheWFuICs9IChmIntqYXJha317amFyYWt9e3dhcn1BcGxpa2FzaSBZYW5nIFRlcmthaXQqXG4iKQoJCWlmICJBbmRhIHRpZGFrIG1lbWlsaWtpIGFwbGlrYXNpIGF0YXUgc2l0dXMgd2ViIGFrdGlmIHVudHVrIGRpdGluamF1LiIgaW4gY2VrOgoJCQlrbnRsX3lheWFuICs9IChmIntqYXJha317amFyYWt9e2phcmFrfXt3YXJ9VGlkYWsgQWRhIEFwbGlrYXNpIEFrdGlmIFlhbmcgVGVya2FpdCAqXG4iKQoJCWVsc2U6CgkJCWtudGxfeWF5YW4gKz0gKGYie2phcmFrfXtqYXJha317amFyYWt9e3dhcn1BcGxpa2FzaSBBa3RpZipcbiIpCgkJCWFwa0FrdGlmID0gcmUuZmluZGFsbCgnXC8+PGRpdlwgY2xhc3NcPVwiLio/XCJcPlw8c3BhblwgY2xhc3NcPVwiLio/XCJcPiguKj8pPFwvc3Bhblw+JyxzdHIoY2VrKSkKCQkJZGl0YW1iYWhrYW4gPSByZS5maW5kYWxsKCdcPGRpdlw+XDxcL2Rpdlw+XDxkaXZcIGNsYXNzXD1cIi4qP1wiXD4oLio/KTxcL2Rpdlw+JyxzdHIoY2VrKSkKCQkJZm9yIG11bmN1bCBpbiBhcGtBa3RpZjoKCQkJCWhpdDErPTEKCQkJCWtudGxfeWF5YW4gKz0gKGYie2phcmFrfXtqYXJha317amFyYWt9e2phcmFrfXtRfVt7Q317aGl0MX17UX1dIHtJfXttdW5jdWx9IHtDfXtkaXRhbWJhaGthbltoaXQyXX17UX1cbiIpCgkJCQloaXQyKz0xCgkJaWYgIkFuZGEgdGlkYWsgbWVtaWxpa2kgYXBsaWthc2kgYXRhdSBzaXR1cyB3ZWIga2VkYWx1d2Fyc2EgdW50dWsgZGl0aW5qYXUiIGluIGNlazI6CgkJCWtudGxfeWF5YW4gKz0gKGYie2phcmFrfXtqYXJha317amFyYWt9e3dhcn1UaWRhayBBZGEgQXBsaWthc2kgS2VkYWx1d2Fyc2EgWWFuZyBUZXJrYWl0ICpcbiIpCgkJZWxzZToKCQkJaGl0MSxoaXQyPTAsMAoJCQlrbnRsX3lheWFuICs9IChmIntqYXJha317amFyYWt9e2phcmFrfXt3YXJ9QXBsaWthc2kgS2VkYWx1d2Fyc2EqXG4iKQoJCQlhcGtLYWRhbHVhcnNhID0gcmUuZmluZGFsbCgnXC8+PGRpdlwgY2xhc3NcPVwiLio/XCJcPlw8c3BhblwgY2xhc3NcPVwiLio/XCJcPiguKj8pPFwvc3Bhblw+JyxzdHIoY2VrMikpCgkJCWthZGFsdWFyc2EgPSByZS5maW5kYWxsKCdcPGRpdlw+XDxcL2Rpdlw+XDxkaXZcIGNsYXNzXD1cIi4qP1wiXD4oLio/KTxcL2Rpdlw+JyxzdHIoY2VrMikpCgkJCWZvciBtdW5jdWwgaW4gYXBrS2FkYWx1YXJzYToKCQkJCWhpdDErPTEKCQkJCWtudGxfeWF5YW4gKz0gKGYie2phcmFrfXtqYXJha317amFyYWt9e2phcmFrfXtRfVt7Q317aGl0MX17UX1dIHtLfXttdW5jdWx9IHtVfXtrYWRhbHVhcnNhW2hpdDJdfXtRfVxuIikKCQkJCWhpdDIrPTEKCWVsc2U6CgkJa250bF95YXlhbiArPSAoZiJccntqYXJha317amFyYWt9e3dhcn17TX1Db29raWVzIEVycm9yICFcbiIpCglwcmludChha3VuX25uKyJcbiIra250bF95YXlhbikKCgoKZGVmIGNla19hcGtfZmFzdChzZXNzaW9uLGNva2kpOgoJZ2xvYmFsIG1lbQoJaGl0MSwgaGl0MiA9IDAsMAoJY2VrID1zZXNzaW9uLmdldCgiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tL3NldHRpbmdzL2FwcHMvdGFiYmVkLz90YWI9YWN0aXZlIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJY2VrMiA9IHNlc3Npb24uZ2V0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vc2V0dGluZ3MvYXBwcy90YWJiZWQvP3RhYj1pbmFjdGl2ZSIsY29va2llcz17ImNvb2tpZSI6Y29raX0pLnRleHQKCWlmICJEaWFrc2VzIG1lbmdndW5ha2FuIEZhY2Vib29rIiBpbiByZS5maW5kYWxsKCJcPHRpdGxlXD4oLio/KTxcL3RpdGxlXD4iLHN0cihjZWspKToKCQltZW0gKz0gKGYie2phcmFrfXtqYXJha317d2FyfUFwbGlrYXNpIFlhbmcgVGVya2FpdCpcbiIpCgkJaWYgIkFuZGEgdGlkYWsgbWVtaWxpa2kgYXBsaWthc2kgYXRhdSBzaXR1cyB3ZWIgYWt0aWYgdW50dWsgZGl0aW5qYXUuIiBpbiBjZWs6CgkJCW1lbSArPSAoZiJ7amFyYWt9e2phcmFrfXtqYXJha317d2FyfVRpZGFrIEFkYSBBcGxpa2FzaSBBa3RpZiBZYW5nIFRlcmthaXQgKlxuIikKCQllbHNlOgoJCQltZW0gKz0gKGYie2phcmFrfXtqYXJha317amFyYWt9e3dhcn1BcGxpa2FzaSBBa3RpZipcbiIpCgkJCWFwa0FrdGlmID0gcmUuZmluZGFsbCgnXC8+PGRpdlwgY2xhc3NcPVwiLio/XCJcPlw8c3BhblwgY2xhc3NcPVwiLio/XCJcPiguKj8pPFwvc3Bhblw+JyxzdHIoY2VrKSkKCQkJZGl0YW1iYWhrYW4gPSByZS5maW5kYWxsKCdcPGRpdlw+XDxcL2Rpdlw+XDxkaXZcIGNsYXNzXD1cIi4qP1wiXD4oLio/KTxcL2Rpdlw+JyxzdHIoY2VrKSkKCQkJZm9yIG11bmN1bCBpbiBhcGtBa3RpZjoKCQkJCWhpdDErPTEKCQkJCW1lbSArPSAoZiJ7amFyYWt9e2phcmFrfXtqYXJha317amFyYWt9e1F9W3tDfXtoaXQxfXtRfV0ge0l9e211bmN1bH0ge0N9e2RpdGFtYmFoa2FuW2hpdDJdfXtRfVxuIikKCQkJCWhpdDIrPTEKCQlpZiAiQW5kYSB0aWRhayBtZW1pbGlraSBhcGxpa2FzaSBhdGF1IHNpdHVzIHdlYiBrZWRhbHV3YXJzYSB1bnR1ayBkaXRpbmphdSIgaW4gY2VrMjoKCQkJbWVtICs9IChmIntqYXJha317amFyYWt9e2phcmFrfXt3YXJ9VGlkYWsgQWRhIEFwbGlrYXNpIEtlZGFsdXdhcnNhIFlhbmcgVGVya2FpdCAqXG4iKQoJCWVsc2U6CgkJCWhpdDEsaGl0Mj0wLDAKCQkJbWVtICs9IChmIntqYXJha317amFyYWt9e2phcmFrfXt3YXJ9QXBsaWthc2kgS2VkYWx1d2Fyc2EqXG4iKQoJCQlhcGtLYWRhbHVhcnNhID0gcmUuZmluZGFsbCgnXC8+PGRpdlwgY2xhc3NcPVwiLio/XCJcPlw8c3BhblwgY2xhc3NcPVwiLio/XCJcPiguKj8pPFwvc3Bhblw+JyxzdHIoY2VrMikpCgkJCWthZGFsdWFyc2EgPSByZS5maW5kYWxsKCdcPGRpdlw+XDxcL2Rpdlw+XDxkaXZcIGNsYXNzXD1cIi4qP1wiXD4oLio/KTxcL2Rpdlw+JyxzdHIoY2VrMikpCgkJCWZvciBtdW5jdWwgaW4gYXBrS2FkYWx1YXJzYToKCQkJCWhpdDErPTEKCQkJCW1lbSArPSAoZiJ7amFyYWt9e2phcmFrfXtqYXJha317amFyYWt9e1F9W3tDfXtoaXQxfXtRfV0ge0t9e211bmN1bH0ge1V9e2thZGFsdWFyc2FbaGl0Ml19e1F9XG4iKQoJCQkJaGl0Mis9MQoJZWxzZToKCQltZW0gKz0gKGYie2phcmFrfXt3YXJ9e019Q29va2llcyBFcnJvciAhXG4iKQoJbWVtICs9ICgiXG4iKQoKZGVmIGdldF9pbmZvb19mYXN0KHNlc3Npb24sY29raSk6CglnbG9iYWwgbWVtCglnZXRfaWQgPSBzZXNzaW9uLmdldCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9wcm9maWxlLnBocCIsY29va2llcz17ImNvb2tpZSI6Y29raX0pLnRleHQKCW5hbWEgPSByZS5maW5kYWxsKCdcPHRpdGxlXD4oLio/KTxcL3RpdGxlXD4nLHN0cihnZXRfaWQpKVswXQoJcmVzcG9uc2UgPSBzZXNzaW9uLmdldCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9wcm9maWxlLnBocD92PWluZm8iLGNvb2tpZXM9eyJjb29raWUiOmNva2l9KS50ZXh0CglyZXNwb25zZTIgPSBzZXNzaW9uLmdldCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9wcm9maWxlLnBocD92PWZyaWVuZHMiLGNvb2tpZXM9eyJjb29raWUiOmNva2l9KS50ZXh0CglyZXNwb25zZTMgPSBzZXNzaW9uLmdldChmImh0dHBzOi8vbS5mYWNlYm9vay5jb20ve3VzZXJ9L2FsbGFjdGl2aXR5Lz9jYXRlZ29yeV9rZXk9YWxsJnNlY3Rpb25faWQ9eWVhcl8yMDIyJnRpbWVzdGFydD0xNjA5NDg4MDAwJnRpbWVlbmQ9MTY0MTAyMzk5OSZzZWN0aW9uTG9hZGluZ0lEPW1fdGltZWxpbmVfbG9hZGluZ19kaXZfMTY0MTAyMzk5OV8xNjA5NDg4MDAwXzhfIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJcmVzcG9uc2U0ID0gc2Vzc2lvbi5nZXQoZiJodHRwczovL20uZmFjZWJvb2suY29tL3RpbWVsaW5lL2FwcF9jb2xsZWN0aW9uLz9jb2xsZWN0aW9uX3Rva2VuPXt1c2VyfSUzQTE4NDk4NTA3MTUzODAwMiUzQTMyJl9yZGM9MSZfcmRyIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJdHJ5OgoJCW5vbWVyID0gcmUuZmluZGFsbCgnXDxhXCBocmVmXD1cInRlbFw6XCsuKj9cIj5cPHNwYW5cIGRpclw9XCJsdHJcIj4oLio/KTxcL3NwYW4+PFwvYT4nLHN0cihyZXNwb25zZSkpWzBdCglleGNlcHQ6CgkJbm9tZXIgPSAiIgoJdHJ5OgoJCWVtYWlsID0gcmUuZmluZGFsbCgnXDxhIGhyZWZcPVwiaHR0cHNcOlwvXC9sbVwuZmFjZWJvb2tcLmNvbVwvbFwucGhwXD91XD1tYWlsLio/XCIgdGFyZ2V0XD1cIi4qP1wiXD4oLio/KTxcL2FcPicsc3RyKHJlc3BvbnNlKSlbMF0ucmVwbGFjZSgnJiMwNjQ7JywnQCcpCglleGNlcHQ6CgkJZW1haWw9IiIKCXRyeToKCQl0dGwgPSByZS5maW5kYWxsKCdcPFwvdGRcPlw8dGRcIHZhbGlnblw9XCJ0b3BcIiBjbGFzc1w9XCIuKj9cIlw+XDxkaXZcIGNsYXNzXD1cIi4qP1wiXD4oXGQrXHMrXHcrXHMrXGQrKTxcL2Rpdlw+XDxcL3RkXD5cPFwvdHJcPicsc3RyKHJlc3BvbnNlKSlbMF0KCWV4Y2VwdDoKCQl0dGw9IiIKCXRyeToKCQl0ZW1hbiA9IHJlLmZpbmRhbGwoJ1w8aDNcIGNsYXNzXD1cIi4qP1wiXD5UZW1hblwgXCgoLio/KVwpPFwvaDNcPicsc3RyKHJlc3BvbnNlMikpWzBdCgoJZXhjZXB0OgoJCXRlbWFuID0gIiIKCXRyeToKCQlwZW5naWt1dCA9IHJlLmZpbmRhbGwoJ1w8c3BhblwgY2xhc3NcPVwiLio/XCJcPiguKj8pXDxcL3NwYW5cPicsc3RyKHJlc3BvbnNlNCkpWzFdCglleGNlcHQ6CgkJcGVuZ2lrdXQgPSAiIgoJdHJ5OgoJCXRhaHVuID0gIiIKCQljZWtfdGhuID0gcmUuZmluZGFsbCgnXDxkaXZcIGNsYXNzXD1cIi4qP1wiIGlkXD1cInllYXJfKC4qPylcIj4nLHN0cihyZXNwb25zZTMpKQoJCWZvciBuZW5lbiBpbiBjZWtfdGhuOgoJCQl0YWh1biArPSBuZW5lbisiLCAiCglleGNlcHQ6cGFzcwoKCW1lbSArPSAoZiJ7amFyYWt9W3tJfeKck3tQfV0gTmFtYSBBa3VuICAgICAgIDoge0t9e25hbWF9e1B9XG57amFyYWt9W3tJfeKck3tQfV0gSnVtbGFoIFRlbWFuICAgIDoge0t9e3RlbWFufXtQfVxue2phcmFrfVt7SX3inJN7UH1dIEp1bWxhaCBQZW5naWt1dCA6IHtLfXtwZW5naWt1dH17UH1cbntqYXJha31be0l94pyTe1B9XSBFbWFpbCBBa3RpZiAgICAgOiB7S317ZW1haWx9e1B9XG57amFyYWt9W3tJfeKck3tQfV0gTm9tb3IgQWt0aWYgICAgIDoge0t9e25vbWVyfXtQfVxue2phcmFrfVt7SX3inJN7UH1dIFRhaHVuIEFrdW4gICAgICA6IHtLfXt0YWh1bn17UH1cbntqYXJha31be0l94pyTe1B9XSBUYW5nZ2FsIExhaGlyICAgOiB7S317dHRsfXtQfSIpCmRlZiBsb2dfaGFzaWwodXNlciwgcGFzdyk6CiAgICBnbG9iYWwgbWVtCiAgICBtZW0gPSAiIgogICAgc2Vzc2lvbj1yZXF1ZXN0cy5TZXNzaW9uKCkKICAgIHNlc3Npb24uaGVhZGVycy51cGRhdGUoewogICAgICAgICJIb3N0IjoibS5mYWNlYm9vay5jb20iLAogICAgICAgICJhY2NlcHQiOiJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgsYXBwbGljYXRpb24vc2lnbmVkLWV4Y2hhbmdlO3Y9YjM7cT0wLjkiLAogICAgICAgICJhY2NlcHQtZW5jb2RpbmciOiJnemlwLCBkZWZsYXRlIiwKICAgICAgICAiYWNjZXB0LWxhbmd1YWdlIjoiaWQtSUQsaWQ7cT0wLjkiLAogICAgICAgICJyZWZlcmVyIjoiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8iLAogICAgICAgICJ1c2VyLWFnZW50IjoiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNaSA5VCBQcm8gQnVpbGQvUUtRMS4xOTA4MjUuMDAyOyB3dikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi80LjAgQ2hyb21lLzg4LjAuNDMyNC4xODEgTW9iaWxlIFNhZmFyaS81MzcuMzYgW0ZCQU4vRU1BO0ZCTEMvaWRfSUQ7RkJBVi8yMzkuMC4wLjEwLjEwOTtdIgogICAgfSkKICAgIHNvdXA9QmVhdXRpZnVsU291cChzZXNzaW9uLmdldCh1cmxfbWIrIi9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgiKS50ZXh0LCJodG1sLnBhcnNlciIpCiAgICBsaW5rPXNvdXAuZmluZCgiZm9ybSIseyJtZXRob2QiOiJwb3N0In0pCiAgICBmb3IgeCBpbiBzb3VwKCJpbnB1dCIpOgogICAgICAgIGRhdGEudXBkYXRlKHt4LmdldCgibmFtZSIpOnguZ2V0KCJ2YWx1ZSIpfSkKICAgIGRhdGEudXBkYXRlKHsiZW1haWwiOnVzZXIsInBhc3MiOnBhc3d9KQogICAgdXJsUG9zdD1zZXNzaW9uLnBvc3QoImh0dHBzOi8vbS5mYWNlYm9vay5jb20iK2xpbmsuZ2V0KCJhY3Rpb24iKSxkYXRhPWRhdGEpCiAgICByZXNwb25zZT1CZWF1dGlmdWxTb3VwKHVybFBvc3QudGV4dCwgImh0bWwucGFyc2VyIikKICAgIGlmICJUZW11a2FuIEFrdW4gQW5kYSIgaW4gcmUuZmluZGFsbCgiXDx0aXRsZT4oLio/KTxcL3RpdGxlPiIsc3RyKHVybFBvc3QudGV4dCkpOgogICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyICVzWyVzISVzXSBIaWR1cGthbiBtb2RlIHBlc2F3YXQgMiBkZXRpayAgICAgICAgICclKFEsTSxRKSksCiAgICBpZiAiY191c2VyIiBpbiBzZXNzaW9uLmNvb2tpZXMuZ2V0X2RpY3QoKToKICAgICAgICBpZiAiQWt1biBBbmRhIERpa3VuY2kiIGluIHVybFBvc3QudGV4dDoKICAgICAgICAgICAgbWVtICs9IChmIlxye1F9W3tNfSF7UX1de019QWt1biBJbmkgS2VuYWsgU2VzaSBOZXdcbiIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29raSA9ICgiOyIpLmpvaW4oWyAiJXM9JXMiICUgKGtleSwgdmFsdWUpIGZvciBrZXksIHZhbHVlIGluIHNlc3Npb24uY29va2llcy5nZXRfZGljdCgpLml0ZW1zKCkgXSkKICAgICAgICAgICAgb3BlbignSGFzaWwvT0stJytkdXJhc2krJy50eHQnLCAnYScpLndyaXRlKGYie3VzZXJ9fHtwYXN3fXx7Y29raX1cbiIpCiAgICAgICAgICAgIG1lbSArPSAoZiJccntRfVt7SX3inJN7UX1de0l9IFNlbGFtYXQgQWt1biBJbmkgVGlkYWsgQ2hlY2sgUG9pbnRcbiIpO21lbSArPShmIlxye3dhcn17SX1TZWRhbmcgQ2hlY2sgQXBsaWthc2kgISF7UX1cbiIpO3RpbWUuc2xlZXAoMC4wMykKICAgICAgICAgICAgY2VrX2Fwa19mYXN0KHNlc3Npb24sY29raSkKICAgICAgICAgICAgZ2V0X2luZm9vX2Zhc3Qoc2Vzc2lvbixjb2tpKQogICAgZWxpZiAiY2hlY2twb2ludCIgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCk6CiAgICAgICAgdGl0bGU9cmUuZmluZGFsbCgiXDx0aXRsZT4oLio/KTxcL3RpdGxlPiIsc3RyKHJlc3BvbnNlKSkKICAgICAgICBsaW5rMj1yZXNwb25zZS5maW5kKCJmb3JtIix7Im1ldGhvZCI6InBvc3QifSkKICAgICAgICBsaXN0SW5wdXQ9WydmYl9kdHNnJywnamF6b2VzdCcsJ2NoZWNrcG9pbnRfZGF0YScsJ3N1Ym1pdFtDb250aW51ZV0nLCduaCddCiAgICAgICAgZm9yIHggaW4gcmVzcG9uc2UoImlucHV0Iik6CiAgICAgICAgICAgIGlmIHguZ2V0KCJuYW1lIikgaW4gbGlzdElucHV0OgogICAgICAgICAgICAgICAgZGF0YTIudXBkYXRlKHt4LmdldCgibmFtZSIpOnguZ2V0KCJ2YWx1ZSIpfSkKICAgICAgICBhbj1zZXNzaW9uLnBvc3QodXJsX21iK2xpbmsyLmdldCgiYWN0aW9uIiksZGF0YT1kYXRhMikKICAgICAgICByZXNwb25zZTI9QmVhdXRpZnVsU291cChhbi50ZXh0LCJodG1sLnBhcnNlciIpCiAgICAgICAgbnVtYmVyPTAKICAgICAgICBjZWs9W2Nlay50ZXh0IGZvciBjZWsgaW4gcmVzcG9uc2UyLmZpbmRfYWxsKCJvcHRpb24iKV0KICAgICAgICBpZihsZW4oY2VrKT09MCk6CiAgICAgICAgICAgIGlmICJMaWhhdCBkZXRhaWwgbG9naW4geWFuZyBkaXRhbXBpbGthbi4gSW5pIEFuZGE/IiBpbiB0aXRsZToKICAgICAgICAgICAgICAgIGlmICJ5IiBpbiB1YmFoUDoKICAgICAgICAgICAgICAgICAgICBtbWsgPSBwd0JhcnUKICAgICAgICAgICAgICAgICAgICBtZW0gKz0gKGYiXHJ7UX1be0l94pyTe1F9XXtJfSBTZWxhbWF0IEFrdW4gSW5pIFRhcCBZZXNcbiIpO21lbSArPSAoZiJccnt3YXJ9TW9ob24gVHVuZ2d1IFNlYmVudGFyLCBTZWRhbmcgVWJhaCBLYXRhIFNhbmRpLCBEYW4gQ2hlY2sgQXBsaWthc2lcbiIpO3RpbWUuc2xlZXAoMC4wMykKICAgICAgICAgICAgICAgICAgICB1YmFoX3B3KHNlc3Npb24scmVzcG9uc2UsbGluazIsdXNlciwgbW1rKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBtbWsgPSAiRFVNQUktOTkxIgogICAgICAgICAgICAgICAgICAgIG1lbSArPSAoZiJccntRfVt7SX3inJN7UX1de0l9IFNlbGFtYXQgQWt1biBJbmkgVGFwIFllcyIpO21lbSArPSAoZiJccnt3YXJ9TW9ob24gVHVuZ2d1IFNlYmVudGFyLCBTZWRhbmcgVWJhaCBLYXRhIFNhbmRpLCBEYW4gQ2hlY2sgQXBsaWthc2lcbiIpO3RpbWUuc2xlZXAoMC4wMykKICAgICAgICAgICAgICAgICAgICB1YmFoX3B3KHNlc3Npb24scmVzcG9uc2UsbGluazIsdXNlciwgbW1rKQogICAgICAgICAgICBlbGlmICJNYXN1a2thbiBLb2RlIE1hc3VrIHVudHVrIE1lbGFuanV0a2FuIiBpbiByZS5maW5kYWxsKCJcPHRpdGxlPiguKj8pPFwvdGl0bGU+IixzdHIocmVzcG9uc2UpKToKICAgICAgICAgICAgICAgIG1lbSArPSAoZiJ7d2FyfU1hYWYgQWt1biBJbmkgQTJGIE9uIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9wZW4oJ0hhc2lsL0Vycm9yLnR4dCcsICdhJykud3JpdGUoZiJ7dXNlcn18e3Bhc3d9XG4iKQogICAgICAgICAgICAgICAgbWVtICs9KGYie3dhcn1UZXJqYWRpIE1hc2FsYWggVGVyaGFkYXAgQWt1biIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgb3BlbihmJ0hhc2lsL0NQLScrZHVyYXNpKycudHh0JywgJ2EnKS53cml0ZShmInt1c2VyfXx7cGFzd31cbiIpCiAgICAgICAgICAgIG1lbSArPSAoIiVzWyVzISVzXSBUZXJkYXBhdCAlcyBPcHNpIFxuIiUoTixLLE4sbGVuKGNlaykpKQogICAgICAgIGZvciBvcHQgaW4gcmFuZ2UobGVuKGNlaykpOgogICAgICAgICAgICBtZW0gKz0gKGYie2phcmFrfXtRfVt7Q317c3RyKG9wdCsxKX17UX1dICIrY2VrW29wdF0rIlxuIikKICAgIGVsc2U6CiAgICAgICAgbWVtICs9KGYie3dhcn17TX1LYXRhIFNhbmRpIFRlbGFoIERpVWJhaCwgQXRhdSBTYWxhaCBLYXRhIFNhbmRpe1F9XG4iKQogICAgICAgIG9wZW4oJ0hhc2lsL0dhZ2FsLUxvZ2luLnR4dCcsICdhJykud3JpdGUoZiJ7dXNlcn18e3Bhc3d9XG4iKQogICAgcHJpbnQoIlxuIit3YXIrdXNlcisifCIrcGFzdysiXG4iK21lbSkKZGVmIHViYWhfcHdfZmFzdChzZXNzaW9uLHJlc3BvbnNlLGxpbmsyLHVzZXIsbW1rKToKICAgIGdsb2JhbCBtZW0KICAgIGRhdCxkYXQyPXt9LHt9CiAgICBidXQ9WyJzdWJtaXRbWWVzXSIsIm5oIiwiZmJfZHRzZyIsImphem9lc3QiLCJjaGVja3BvaW50X2RhdGEiXQogICAgZm9yIHggaW4gcmVzcG9uc2UoImlucHV0Iik6CiAgICAgICAgaWYgeC5nZXQoIm5hbWUiKSBpbiBidXQ6CiAgICAgICAgICAgIGRhdC51cGRhdGUoe3guZ2V0KCJuYW1lIik6eC5nZXQoInZhbHVlIil9KQogICAgdWJhaFB3PXNlc3Npb24ucG9zdCh1cmxfbWIrbGluazIuZ2V0KCJhY3Rpb24iKSxkYXRhPWRhdCkudGV4dAogICAgcmVzVWJhaD1CZWF1dGlmdWxTb3VwKHViYWhQdywiaHRtbC5wYXJzZXIiKQogICAgbGluazM9cmVzVWJhaC5maW5kKCJmb3JtIix7Im1ldGhvZCI6InBvc3QifSkKICAgIGJ1dDI9WyJzdWJtaXRbTmV4dF0iLCJuaCIsImZiX2R0c2ciLCJqYXpvZXN0Il0KICAgIGlmICJCdWF0IEthdGEgU2FuZGkgQmFydSIgaW4gcmUuZmluZGFsbCgiXDx0aXRsZT4oLio/KTxcL3RpdGxlPiIsc3RyKHViYWhQdykpOgogICAgICAgIGZvciBiIGluIHJlc1ViYWgoImlucHV0Iik6CiAgICAgICAgICAgIGlmIGIuZ2V0KCJuYW1lIikgaW4gYnV0MjoKICAgICAgICAgICAgICAgIGRhdDIudXBkYXRlKHtiLmdldCgibmFtZSIpOmIuZ2V0KCJ2YWx1ZSIpfSkKICAgICAgICBkYXQyLnVwZGF0ZSh7InBhc3N3b3JkX25ldyI6IiIuam9pbihtbWspfSkKICAgICAgICBhbj1zZXNzaW9uLnBvc3QodXJsX21iK2xpbmszLmdldCgiYWN0aW9uIiksZGF0YT1kYXQyKQogICAgICAgIGNva2kgPSAoIjsiKS5qb2luKFsgIiVzPSVzIiAlIChrZXksIHZhbHVlKSBmb3Iga2V5LCB2YWx1ZSBpbiBzZXNzaW9uLmNvb2tpZXMuZ2V0X2RpY3QoKS5pdGVtcygpIF0pCiAgICAgICAgbWVtICs9KGYiXHJ7amFyYWt9e059W3tJfeKck3tOfV0gQmVyaGFzaWwgTWVuZ3ViYWggS2F0YSBTYW5kaSBNZW5qYWRpIDpcbntqYXJha317Tn1be0l94pyTe059XXtJfSB7dXNlcn18eycnLmpvaW4obW1rKX18e2Nva2l9e059IikKICAgICAgICBvcGVuKCdIYXNpbC9Ba3VuLVRhcC1ZZXMudHh0JywgJ2EnKS53cml0ZShmInt1c2VyfXx7Jycuam9pbihtbWspfXx7Y29raX1cbiIpCiAgICAgICAgY2VrX2Fwa19mYXN0KHNlc3Npb24sY29raSkKICAgICAgICBnZXRfaW5mb29fZmFzdChzZXNzaW9uLGNva2kpCgpkZWYgbG9nX2hhc2lsbCh1c2VyLCBwYXN3LCB0dGxsKToKICAgIGdsb2JhbCB1YQogICAgbHAgPSAiIgojICAgIHVhID0gIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMTsgdml2byAxOTA0IEJ1aWxkL1JQMUEuMjAwNzIwLjAxMjsgd3YpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS84My4wLjQxMDMuMTA2IE1vYmlsZSBTYWZhcmkvNTM3LjM2IgogICAgaG9zdCA9ICJodHRwczovL20uZmFjZWJvb2suY29tIgogICAgc2VzID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICBzZXMuaGVhZGVycy51cGRhdGUoewogICAgIkhvc3QiOiAibS5mYWNlYm9vay5jb20iLAogICAgImNhY2hlLWNvbnRyb2wiOiAibWF4LWFnZT0wIiwKICAgICJ1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzIjogIjEiLAogICAgIm9yaWdpbiI6IGhvc3QsCiAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsCiAgICAidXNlci1hZ2VudCI6IHVhLAogICAgImFjY2VwdCI6ICJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44LGFwcGxpY2F0aW9uL3NpZ25lZC1leGNoYW5nZTt2PWIzO3E9MC45IiwKICAgICJ4LXJlcXVlc3RlZC13aXRoIjogIm1hcmsudmlhLmdwIiwKICAgICJzZWMtZmV0Y2gtc2l0ZSI6ICJzYW1lLW9yaWdpbiIsCiAgICAic2VjLWZldGNoLW1vZGUiOiAibmF2aWdhdGUiLAogICAgInNlYy1mZXRjaC11c2VyIjogIj8xIiwKICAgICJzZWMtZmV0Y2gtZGVzdCI6ICJkb2N1bWVudCIsCiAgICAicmVmZXJlciI6IGhvc3QrIi9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgiLAogICAgImFjY2VwdC1lbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlIiwKICAgICJhY2NlcHQtbGFuZ3VhZ2UiOiAiaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjciCiAgICB9KQogICAgZGF0YSA9IHt9CiAgICBnZWQgPSBwYXIoc2VzLmdldChob3N0KyIvbG9naW4vP25leHQmcmVmPWRibCZmbCZyZWZpZD04IiwgaGVhZGVycz17InVzZXItYWdlbnQiOnVhfSkudGV4dCwgImh0bWwucGFyc2VyIikKICAgIGZtID0gZ2VkLmZpbmQoImZvcm0iLHsibWV0aG9kIjoicG9zdCJ9KQogICAgbGlzdCA9IFsibHNkIiwiamF6b2VzdCIsIm1fdHMiLCJsaSIsInRyeV9udW1iZXIiLCJ1bnJlY29nbml6ZWRfdHJpZXMiLCJsb2dpbiIsImJpX3hyd2giXQogICAgZm9yIGkgaW4gZm0uZmluZF9hbGwoImlucHV0Iik6CiAgICAgICAgaWYgaS5nZXQoIm5hbWUiKSBpbiBsaXN0OgogICAgICAgICAgICBkYXRhLnVwZGF0ZSh7aS5nZXQoIm5hbWUiKTppLmdldCgidmFsdWUiKX0pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29udGludWUKICAgIGRhdGEudXBkYXRlKHsiZW1haWwiOnVzZXIsInBhc3MiOnBhc3d9KQogICAgdHJ5OgogICAgICAgIHJ1biA9IHBhcihzZXMucG9zdChob3N0K2ZtLmdldCgiYWN0aW9uIiksIGRhdGE9ZGF0YSwgYWxsb3dfcmVkaXJlY3RzPVRydWUpLnRleHQsICJodG1sLnBhcnNlciIpCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5Ub29NYW55UmVkaXJlY3RzOgogICAgICAgIGxwICs9IChNKyJBa3VuIEluaSBLZVNwYW0gISEiK1ErIlxuIikKICAgIGlmICJjX3VzZXIiIGluIHNlcy5jb29raWVzOgogICAgICAgIGxwICs9IChJKyJBa3VuIEluaSBUaWRhayBDaGVjayBQb2l0c1xuIikKICAgIGVsaWYgImNoZWNrcG9pbnQiIGluIHNlcy5jb29raWVzOgogICAgICAgIGZvcm0gPSBydW4uZmluZCgiZm9ybSIpCiAgICAgICAgZHRzZyA9IGZvcm0uZmluZCgiaW5wdXQiLHsibmFtZSI6ImZiX2R0c2cifSlbInZhbHVlIl0KICAgICAgICBqenN0ID0gZm9ybS5maW5kKCJpbnB1dCIseyJuYW1lIjoiamF6b2VzdCJ9KVsidmFsdWUiXQogICAgICAgIG5oICAgPSBmb3JtLmZpbmQoImlucHV0Iix7Im5hbWUiOiJuaCJ9KVsidmFsdWUiXQogICAgICAgIGRhdGFEID0gewogICAgICAgICAgICAiZmJfZHRzZyI6IGR0c2csCiAgICAgICAgICAgICJmYl9kdHNnIjogZHRzZywKICAgICAgICAgICAgImphem9lc3QiOiBqenN0LAogICAgICAgICAgICAiamF6b2VzdCI6IGp6c3QsCiAgICAgICAgICAgICJjaGVja3BvaW50X2RhdGEiOiIiLAogICAgICAgICAgICAic3VibWl0W0NvbnRpbnVlXSI6Ikxhbmp1dGthbiIsCiAgICAgICAgICAgICJuaCI6IG5oCiAgICAgICAgfQogICAgICAgIHhueHggPSBwYXIoc2VzLnBvc3QoaG9zdCtmb3JtWyJhY3Rpb24iXSwgZGF0YT1kYXRhRCkudGV4dCwgImh0bWwucGFyc2VyIikKICAgICAgICBuZ2V3ID0gW3l5LnRleHQgZm9yIHl5IGluIHhueHguZmluZF9hbGwoIm9wdGlvbiIpXQogICAgICAgIGlmKHN0cihsZW4obmdldykpPT0iMCIpOgogICAgICAgICAgICBscCArPSAoSSsiQWt1biBJbmkgSG9vbyBZZXNzIChUYXAgWWVzKSIrUSsiXG4iKQogICAgICAgICAgICBvcGVuKCJIYXNpbC9Ba3VuX1RhcF9ZZXMudHh0IiwiYSsiKS53cml0ZSgie318e31cbiIuZm9ybWF0KHVzZXIscGFzdykpCiAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiVEFQIiwgdXNlciwgcGFzdywgIi0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxwICs9ICgiVGVyc2VkaWEgJXMgT3BzaSBcbiIlKHN0cihsZW4obmdldykpKSkKICAgICAgICBmb3Igb3B0IGluIHJhbmdlKGxlbihuZ2V3KSk6CiAgICAgICAgICAgIGxwICs9ICgiICAgICAgIitzdHIob3B0KzEpKyIuICIrbmdld1tvcHRdKyJcbiIpCiAgICBlbGlmICJsb2dpbl9lcnJvciIgaW4gc3RyKHJ1bik6CiAgICAgICAgb2ggPSBydW4uZmluZCgiZGl2Iix7ImlkIjoibG9naW5fZXJyb3IifSkuZmluZCgiZGl2IikudGV4dAogICAgICAgIGxwICs9ICgiJXMlcyVzXG4iJShVLG9oLFEpKQogICAgZWxzZToKICAgICAgICBscCArPSAoTSsiS2F0YSBTYW5kaSBTdWRhaCBEaVViYWggISIrUSsiXG4iKQogICAgcHJpbnQoIlxyIit3YXIrSyt1c2VyKyJ8IitwYXN3KyIgfCAiK3R0bGwrUSsiXG4iK3dhcitscCsiICAgICAgICAgICAgIixlbmQ9IiA+PktJS1kiKQoKCgpkZWYga29raV9hcGsoa3VraXNfbWFtYSk6CiMJa2lrbyA9IFtdCgl0cnk6CgkJa2lraXMgPSBrdWtpc19tYW1hLnNwbGl0KCI7IikKCQljX3VzZXIgPSBraWtpc1swXQoJCWFsbF9rdXMgPSBrdWtpc19tYW1hLnNwbGl0KGNfdXNlcisiOyIpWzFdCgkJY29raV9jb2tpID0gKGFsbF9rdXMrIjsiK2NfdXNlcikKCQlraWtvID0gKGNva2lfY29raSkKCQlyZXR1cm4ga2lrbwoJZXhjZXB0OgoJCXJldHVybiBrdWtpc19tYW1hCiMJcHJpbnQoa2lrbykKCmRlZiBkdW1wX25hbWUoa3VraXMpOgoJc2VzXyA9IHJlcXVlc3RzLlNlc3Npb24oKQoJdXJsID0gImh0dHBzOi8vbS5mYWNlYm9vay5jb20vc2VhcmNoL3Blb3BsZS8/cT1SaXNreSIKCWRhdF9nYW1lID0gc2VzXy5nZXQodXJsLGNvb2tpZXM9eydjb29raWUnOmt1a2lzfSkKCWRhdGFnYW1lID0gcGFyKGRhdF9nYW1lLmNvbnRlbnQsJ2h0bWwucGFyc2VyJykKCWZvcm1fICAgID0gZGF0YWdhbWUuZmluZCgnZm9ybScsbWV0aG9kPSdwb3N0JykKCWRhdGFfdGV4ID0gZGF0YWdhbWUudGV4dAoJcHJpbnQoZGF0YV90ZXgpCglvcGVuKCJ0ZXMucHkiLCJ3Iikud3JpdGUoZGF0YV90ZXgpCgpkZWYgY2VrX2Fwa192MShrdWtpcyk6CiAgICBhcGsgPSBbXQogICAgYWsgPSAwCiAgICBlayA9IDAKICAgIHNlc18gPSByZXF1ZXN0cy5TZXNzaW9uKCkKIyAgICBwcmludChrdWtpcykKICAgIHVybCA9ICJodHRwczovL20uZmFjZWJvb2suY29tL3NldHRpbmdzL2FwcHMvdGFiYmVkLz90YWI9YWN0aXZlIgogICAgZGF0X2dhbWUgPSBzZXNfLmdldCh1cmwsY29va2llcz17J2Nvb2tpZSc6a3VraXN9KQogICAgZGF0YWdhbWUgPSBwYXIoZGF0X2dhbWUuY29udGVudCwnaHRtbC5wYXJzZXInKQogICAgZm9ybV8gICAgPSBkYXRhZ2FtZS5maW5kKCdmb3JtJyxtZXRob2Q9J3Bvc3QnKQogICAgZGF0YV90ZXggPSBkYXRhZ2FtZS50ZXh0CiMgICAgcHJpbnQoZGF0YV90ZXgpCiAgICBpZiAiQW5kYSB0aWRhayBtZW1pbGlraSBhcGxpa2FzaSBhdGF1IHNpdHVzIHdlYiBha3RpZiB1bnR1ayBkaXRpbmphdSIgaW4gZGF0YV90ZXg6CiAgICAgICAgYXBrLmFwcGVuZChmIlxue2phcmFrfXt3YXJ9e019VGlkYWsgQWRhIEFwbGlrYXNpIFlhbmcgVGVya2FpdCB7UX0oe1V9QVBLIEFLVElGe1F9KXtRfSIpCiAgICBlbHNlOgogICAgICAgIGFway5hcHBlbmQoZiJcbntqYXJha317d2FyfXtJfUFwbGlrYXNpIFlhbmcgVGVya2FpdCB7UX0oe1V9QVBLIEFLVElGe1F9KXtRfSIpCiAgICAgICAgZm9yIGFzdSBpbiBmb3JtXy5maW5kX2FsbCgiaDMiKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY2VsZW5nID0gYXN1LmZpbmQoJ3NwYW4nKS50ZXh0CiAgICAgICAgICAgICAgICBjZWxlbmdnID0gYXN1LmZpbmQoJ2RpdicpLnRleHQKICAgICAgICAgICAgICAgIGRpdGFtYmFoID0gY2VsZW5nZy5yZXBsYWNlKGNlbGVuZysiRGl0YW1iYWhrYW4iLCIgRGlUYW1iYWhrYW4iKQogICAgICAgICAgICAgICAgYWsgKz0gMQogICAgICAgICAgICAgICAgYXBrLmFwcGVuZChmJ1xue2phcmFrfXtqYXJha31be2FrfV0ge0l9e2NlbGVuZ317VX17ZGl0YW1iYWh9e1F9JykKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNlbGVuZyA9IGFzdS5maW5kKCdzcGFuJykudGV4dAogICAgICAgICAgICAgICAgICAgIGFrICs9IDEKICAgICAgICAgICAgICAgICAgICBhcGsuYXBwZW5kKGYnXG57amFyYWt9e2phcmFrfVt7YWt9XSB7SX17Y2VsZW5nfXtRfScpCiAgICAgICAgICAgICAgICBleGNlcHQ6cGFzcwoKICAgIHVybDIgPSAiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9zZXR0aW5ncy9hcHBzL3RhYmJlZC8/dGFiPWluYWN0aXZlIgogICAgZGF0X2dhbWUgPSBzZXNfLmdldCh1cmwyLGNvb2tpZXM9eydjb29raWUnOmt1a2lzfSkKICAgIGRhdGFnYW1lID0gcGFyKGRhdF9nYW1lLmNvbnRlbnQsJ2h0bWwucGFyc2VyJykKICAgIGZvcm1fICAgID0gZGF0YWdhbWUuZmluZCgnZm9ybScsbWV0aG9kPSdwb3N0JykKICAgIGRhdGFfdGV4eCA9IGRhdGFnYW1lLnRleHQKIyAgICBwcmludChkYXRhX3RleHgpCiAgICBpZiAiQW5kYSB0aWRhayBtZW1pbGlraSBhcGxpa2FzaSBhdGF1IHNpdHVzIHdlYiBrZWRhbHV3YXJzYSB1bnR1ayBkaXRpbmphdSIgaW4gZGF0YV90ZXh4OgogICAgICAgIGFway5hcHBlbmQoZiJcbiIpCiAgICAgICAgYXBrLmFwcGVuZChmIlxue2phcmFrfXt3YXJ9e019VGlkYWsgQWRhIEFwbGlrYXNpIFlhbmcgVGVya2FpdHtRfSAoe0t9QVBLIEtlZGFsdXdhcnNhe1F9KXtRfSIpCiAgICBlbHNlOgogICAgICAgIGFway5hcHBlbmQoZiJcbiIpCiAgICAgICAgYXBrLmFwcGVuZChmIlxue2phcmFrfXt3YXJ9e0l9QXBsaWthc2kgWWFuZyBUZXJrYWl0IHtRfSh7S31BUEsgS2VkYWx1d2Fyc2F7UX0pe1F9IikKICAgICAgICBmb3IgYXN1IGluIGZvcm1fLmZpbmRfYWxsKCJoMyIpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjZWxlbmcgPSBhc3UuZmluZCgnc3BhbicpLnRleHQKICAgICAgICAgICAgICAgIGNlbGVuZ2cgPSBhc3UuZmluZCgnZGl2JykudGV4dAogICAgICAgICAgICAgICAgZGl0YW1iYWggPSBjZWxlbmdnLnJlcGxhY2UoY2VsZW5nKyJLZWRhbHV3YXJzYSIsIiBLZWRhbHV3YXJzYSIpCiAgICAgICAgICAgICAgICBlayArPSAxCiAgICAgICAgICAgICAgICBhcGsuYXBwZW5kKGYnXG57amFyYWt9e2phcmFrfVt7ZWt9XSB7S317Y2VsZW5nfXtDfXtkaXRhbWJhaH17UX0nKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY2VsZW5nID0gYXN1LmZpbmQoJ3NwYW4nKS50ZXh0CiAgICAgICAgICAgICAgICAgICAgYWsgKz0gMQogICAgICAgICAgICAgICAgICAgIGFway5hcHBlbmQoZidcbntqYXJha317amFyYWt9W3tha31dIHtJfXtjZWxlbmd9e1F9JykKICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICBwcmludCgnJy5qb2luKGFwaykpCmRlZiB2aXNpdG9yKCk6Cgl0cnk6CgkJZGF0YXggPSBvcGVuKCIuZGF0YW1lIiwgInIiKS5yZWFkKCkKCQlkYXRheCA9IGRhdGF4LnNwbGl0KCJVc2VyPSIpWzFdCgkJdHJ5OgoJCQlzZXNfID0gcmVxdWVzdHMuU2Vzc2lvbigpCgkJCWJoYiA9ICIiCgkJCWpoZyA9IDEKCgkJCXV0bCA9ICJodHRwczovL2tvbWFyZXYuY29tL2docHZjLz91c2VybmFtZT1qbWJmJmNvbG9yPXllbGxvdyIKCQkJZGF0YV90ZSA9IHNlc18uZ2V0KHV0bCkKCQkJZ2JsID0gcGFyKGRhdGFfdGUuY29udGVudCwnaHRtbC5wYXJzZXInKQoJCQlmb3IgbiBpbiBnYmwuZmluZF9hbGwoInRleHQiKToKCQkJCWJoYiArPSAoc3RyKG4pKQoJCQlsZWUgPSBiaGIuc3BsaXQoJ3k9IjE0Ij4nKQoJCQlsZSA9IGxlbihsZWUpCgkJCWxlIC09IDEKCQkJbGUgPSAobGVlW2xlXS5yZXBsYWNlKCI8L3RleHQ+IiwiIikpCgkJZXhjZXB0OgoJCQlsZSA9ICgiTk9ORSIpCgkJamFsYW4oIlsrK10gU2VsYW1hdCBEYXRhbmcgVXNlciBKbWJmIFlhbmcgS2UgIitJK3N0cihkYXRheCkrUSsiIERhcmkgIitJK3N0cihsZSkrUSsiIFVzZXIgSm1iZiIpO3RpbWUuc2xlZXAoMikKCWV4Y2VwdDoKCQl0cnk6CgkJCXVybF92aXMgPSAiaHR0cHM6Ly9naXRodWIuY29tL0R1bWFpLTk5MS9qbWJmL2Jsb2IvWG54eC9SRUFETUUubWQiCgkJCXVybF92aXNpID0gImh0dHBzOi8vY2Ftby5naXRodWJ1c2VyY29udGVudC5jb20vNjEyMzAzNDgxM2MxMWFlNDk3ZTczMGRjYmE3NzU3MmU4M2ViOTYwMTZlNTUyOGM4YTZmNzg5YjI3ODkxYjk5Yy82ODc0NzQ3MDczM2EyZjJmNmI2ZjZkNjE3MjY1NzYyZTYzNmY2ZDJmNjc2ODcwNzY2MzJmM2Y3NTczNjU3MjZlNjE2ZDY1M2Q2YTZkNjI2NjI2NjM2ZjZjNmY3MjNkNzk2NTZjNmM2Zjc3IgoJCQlzZXNfID0gcmVxdWVzdHMuU2Vzc2lvbigpCgkJCWJoYiA9ICIiCgkJCWpoZyA9IDEKCgoJCQlkYXRhX3RlID0gc2VzXy5nZXQodXJsX3ZpcykudGV4dC5zdHJpcCgpCgkJCWRhdGFfdGUgPSBzZXNfLmdldCh1cmxfdmlzaSkKCQkJZ2JsID0gcGFyKGRhdGFfdGUuY29udGVudCwnaHRtbC5wYXJzZXInKQoJCQlmb3IgbiBpbiBnYmwuZmluZF9hbGwoInRleHQiKToKCQkJCWJoYiArPSAoc3RyKG4pKQoJCQlsZWUgPSBiaGIuc3BsaXQoJ3k9IjE0Ij4nKQoJCQlsZSA9IGxlbihsZWUpCgkJCWxlIC09IDEKCQkJbGUgPSAobGVlW2xlXS5yZXBsYWNlKCI8L3RleHQ+IiwiIikpCiMJCQl0cnk6CiMJCQkJdGhwID0gYmhiLnNwbGl0KCc8dGV4dCB4PSI5Mi41IiB5PSIxNCI+JylbMV0KIwkJCWV4Y2VwdDoKIwkJCQl0aHAgPSBiaGIuc3BsaXQoJzx0ZXh0IHg9Ijk2IiB5PSIxNCI+JylbMV0KIwkJCXRocDIgPSB0aHAuc3BsaXQoIjwvdGV4dD4iKQojCQkJaGFzaWxfID0gKHRocDJbMF0pCgkJCWhhc2lsXyA9IChzdHIobGUpKQoJCQlqYWxhbigiWysrXSBTZWxhbWF0IERhdGFuZyBVc2VyIFlhbmcgS2UgPj4iK0kraGFzaWxfK1ErIjw8IFNlbW9nYSBIYXJpIEFuZGEgTWVueWVuYW5na2FuIik7dGltZS5zbGVlcCgyKQoJCQlraWtpID0gb3BlbigiLmRhdGFtZSIsICJ3IikKCQkJa2lraS53cml0ZSgiVXNlcj0iK2hhc2lsXykKCQkJa2lraS5jbG9zZSgpCgkJZXhjZXB0OnBhc3MKCgpkZWYgZ2FidW5nX3B3KCk6CglwcSA9ICIiCglicSA9ICIiCgl2diA9IDAKCWNjID0gMAoJamFsYW4oIlxuIit3YXIrIkd1bmFrYW4gVGFuZGEgS29tYSBTZWJhZ2FpIFBlbWlzYWgiKQojCWphbGFuKHdhcisiR3VuYWthbiBUZXh0IEluaSBKaWthIE1hdSBEaUd1bmFrYW4gQ29udG9oIikKIwlqYWxhbih3YXIrIk5hbWEgRGVwYW4gSHVydWYgIitVKyJLZWNpbCIrUSsiIEtldGlrIDogZGVwYW4iKQojCWphbGFuKHdhcisiTmFtYSBEZXBhbiBIdXJ1ZiAiK0srIkJlc2FyIitRKyIgS2V0aWsgOiBERVBBTiIpCiMJamFsYW4od2FyKyJDb250b2ggOiBzYXlhbmcsMTIzNDU2LGJpc21pbGFoLERFUEFOMTIzIikKCWphbGFuKHdhcisiQ29udG9oIFBhc3N3b3JkIFlhbmcgQWRtaW4gU2VyaW5nYW4gRGlHdW5ha2FuIDopIikKCWphbGFuKHdhcisnUGFzc3dvcmQgJytJKydJbmRvbmVzaWEnK1ErJyA6IHNheWFuZyxrb250b2wsYW5qaW5nLGJpc21pbGxhaCxzYXlhbmdrdScpCglqYWxhbih3YXIrJ1Bhc3N3b3JkICcrSSsnSW5kb25lc2lhIE9MRCcrUSsnIDogc2F5YW5nLGluZG9uZXNpYSxiYWppbmdhbiwxMjM0NTYnKQoJcGF3ID0gaW5wdXQod2FyKyJQYXNzd29yZCA6ICIpLnNwbGl0KCIsIikKCXBha1EgPSBvcGVuKCIucGF3dyIsICJ3IikKCWZvciBuIGluIHBhdzoKCQlpZiBsZW4obikgPD0gNToKCQkJcHEgKz0gKCIgIituKQoJCQl2diArPSAxCgkJZWxzZToKCQkJYnEgKz0gKCIgIituKQoJCQljYyArPSAxCgkJCXBha1Eud3JpdGUobisifCIpCglwYWtRLmNsb3NlKCkKCWlmIHBxID09ICIiOgoJCXBhc3MKCWVsc2U6CgkJamFsYW4od2FyKyJUZXJkYXBhdCAiK00rc3RyKHZ2KStRKyIgS2F0YSBTYW5kaSBZYW5nIFRpZGFrIEJpc2EgRGlHdW5ha2FuICEiKQoJaWYgYnEgPT0gIiI6CgkJcGFzcwoJZWxzZToKCQlqYWxhbih3YXIrIlRlcmRhcGF0ICIrSStzdHIoY2MpK1ErIiBLYXRhIFNhbmRpIERhcGF0IERpR3VuYWthbiAhXG4iKQpkZWYgY2VrX2tvbmVrKCk6Cgl0cnk6CiMJCWNla19qYXJpbmdhbiA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vZ2l0aHViLmNvbS9EdW1haS05OTEvRHVtYWktOTkxIikKCQljZWtfamFyaW5nYW4gPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vc2VhcmNoP3E9am1iZiZvcT1qbWJmJmFxcz1jaHJvbWUuLjY5aTU3ajY5aTYwajBpNTEybDNqMGkzMGwzLjEwOTJqMGoxJnNvdXJjZWlkPWNocm9tZS1tb2JpbGUmaWU9VVRGLTgiKQoJCXBhc3MKCWV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvcjoKCQlzeXMuc3Rkb3V0LndyaXRlKGYnXHJ7d2FyfUphcmluZ2FuIEFuZGEgVGVycHV0dXMgISEnKSwKCQlzeXMuc3Rkb3V0LmZsdXNoKCkKCQljZWtfa29uZWsoKQp0cnk6CglwbG5fdGtuID0gb3BlbigiLmxvZ2luLnR4dCIsICJyIikucmVhZCgpCmV4Y2VwdCBJT0Vycm9yOnBhc3MKCSNvcy5zeXN0ZW0oInJtIC1yZiAubG9naW4udHh0IikKIwlleGl0KHdhcisiVG9rZW4gRmFpbGVkICEhIik7dGltZS5zbGVlcCgyKQoKIyMjIyBCVUFUIFNBTkRJIDpWCmRlZiBidWF0X3NhbmRpKCk6CglqYWxhbih3YXIrIlNpbGFoa2FuIFBpbGloIEthdGEgU2FuZGksIFlhbmcgTWVudXJ1dCBBbmRhIEJhZ3VzICEiKQoKCmRlZiBidWF0X2FuZ2thKCk6Cglrb250b2xfaGFraWtpID0gb3BlbigiLnBhc2thIiwgInciKSAjIEtPTlRPTCBIQUtJS0kKCXByaW50KCkKCWphbGFuKHdhcitNKyJNYXN1a2FuIEFuZ2thIFVudHVrIFBhc3N3b3JkLCBEYW4gR3VuYWthbiBLb21hIFNlYmFnYWkgUGVtaXNhaCIrUSkKCWphbGFuKHdhcisiQ29udG9oIDogIitDKyIxMjMsMTIzNCwxMjM0NSIrUSkKCXBhc2thID0gaW5wdXQod2FyKyJBbmdrYSA6ICIpCglpZiBwYXNrYSA9PSAiIiBvciBwYXNrYSA9PSAiICI6CgkJamFsYW4od2FyKyJKYW5nYW4gS29zb25nIEFuYWsgS29udG9sIikKCQlidWF0X2FuZ2thKCkKCWVsc2U6CgkJdHJ5OgoJCQlwYXNrYSA9IHBhc2thLnNwbGl0KCIsIikKCQkJZm9yIG4gaW4gcGFza2E6CgkJCQl0cnk6CgkJCQkJb3BlbigiLnBhc2thIiwgImEiKS53cml0ZShzdHIoaW50KG4pKSsifCIpCgkJCQlleGNlcHQ6cGFzcwoJCWV4Y2VwdDoKCQkJdHJ5OgoJCQkJb3BlbigiLnBhc2thIiwgImEiKS53cml0ZShzdHIoaW50KHBhc2thKSkrInwiKQoJCQlleGNlcHQ6cGFzcwoKCWhha2lraV9rbnRsID0gb3BlbigiLnBhc2thIiwgInIiKS5yZWFkKCkKCWlmIGhha2lraV9rbnRsIGluICgiIiwgIiAiLCAiICAiLCAiICAgIik6CgkJamFsYW4od2FyKyJNYXN1a2FuIEFuZ2thLCBCdWthbiBIdXJ1ZiA6KCIpCgkJYnVhdF9hbmdrYSgpCgoKCmRlZiBnZW5lcmF0ZW9sZChpZHQpOgoJcmVzdWx0cz1bXQoJdHJ5OgoJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8iK2lkdCsiP2FjY2Vzc190b2tlbj0iK3Bsbl90a24pCgkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCXRleHQgPSBvcFsnbmFtZSddCgkJZm9yIGkgaW4gdGV4dC5zcGxpdCgiICIpOgoJCQlpPWkubG93ZXIoKQoJCQlpZiBsZW4oaSk+PTYgOgoJCQkJcmVzdWx0cy5hcHBlbmQoaSkKCQkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMyIpCgkJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0IikKCQkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMzQ1IikKCQkJZWxzZToKCQkJCXJlc3VsdHMuYXBwZW5kKGkpCgkJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjMiKQoJCQkJcmVzdWx0cy5hcHBlbmQoaSsiMTIzNCIpCgkJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0NSIpCgkJCQlyZXN1bHRzLmFwcGVuZCgiMTIzNDU2IikKCQkJCXJlc3VsdHMuYXBwZW5kKCIxMjM0NTY3ODkiKQoJCQkJcmVzdWx0cy5hcHBlbmQoIjc4Njc4NiIpCglleGNlcHQ6CgkJcmVzdWx0cy5hcHBlbmQoIjEyMzQ1NiIpCgkJcmVzdWx0cy5hcHBlbmQoIjEyMzQ1Njc4OSIpCgkJcmVzdWx0cy5hcHBlbmQoIjc4Njc4NiIpCglyZXR1cm4gcmVzdWx0cwojZGVmIGdlbmVyYXRlKHRleHQpOgpkZWYgZ2VuZXJhdGV2Nih0ZXh0KToKCXJlc3VsdHM9W10KCWtpa3lfZ2dfZ3RnID0gdGV4dAoJcXogPSB0ZXh0LnNwbGl0KCIgIikKCXRyeToKCQlzaiA9IG9wZW4oIi5wYXNzIiwgInIiKS5yZWFkKCkKCWV4Y2VwdDoKCQlzaiA9ICgiS09TT05HIikKCXRyeToKCQlwYXcgPSBvcGVuKCIucGF3dyIsICJyIikucmVhZCgpLnNwbGl0KCJ8IikKCQlmb3IgbiBpbiBwYXc6CgkJCWlmIGxlbihuKT49IDU6CgkJCQl0cnk6CgkJCQkJYmFIID0gbi5zcGxpdCgiREVQQU4iKVsxXQoJCQkJCWthdyA9ICIwIgoJCQkJZXhjZXB0OgoJCQkJCXRyeToKCQkJCQkJYmFIID0gbi5zcGxpdCgiZGVwYW4iKVsxXQoJCQkJCQlrYXcgPSAiMSIKCQkJCQlleGNlcHQ6CgkJCQkJCXRyeToKCQkJCQkJCWJhSCA9IG4uc3BsaXQoImxlbmdrYXAiKVsxXQoJCQkJCQkJa293ID0gIjIiCgkJCQkJCWV4Y2VwdDoKCQkJCQkJCWthdyA9ICIwIgoJCQkJCQkJYmFIID0gIiIKCQkJCWlmIGJhSCA9PSAiIjoKCQkJCQlyZXN1bHRzLmFwcGVuZChuKQoJCQkJaWYga293ID09ICIyIjoKCQkJCQlyZXN1bHRzLmFwcGVuZCh0ZXh0KQoJCQkJaWYga2F3ID09ICIxIjoKCQkJCQlyZXN1bHRzLmFwcGVuZChxelswXS5sb3dlcigpK2JhSCkKCQkJCWVsc2U6CgkJCQkJcmVzdWx0cy5hcHBlbmQocXpbMF0rYmFIKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnBhc3MKCXRleHQgPSB0ZXh0Lmxvd2VyKCkKCWtpa2EgPSB0ZXh0LnNwbGl0KCIgIikKCXJlc3VsdHMuYXBwZW5kKGtpa2FbMF0pCglyZXN1bHRzLmFwcGVuZChraWthWzBdKyIxMjMiKQoJcmVzdWx0cy5hcHBlbmQoa2lrYVswXSsiMTIzNCIpCglyZXN1bHRzLmFwcGVuZChraWthWzBdKyIxMjM0NSIpCiMJcmVzdWx0cy5hcHBlbmQoa2lrYVswXSsiMTIzNDU2IikKCXJlc3VsdHMuYXBwZW5kKHRleHQpCglyZXR1cm4gcmVzdWx0cwoiIiIJZm9yIGkgaW4gdGV4dC5zcGxpdCgiICIpOgoJCWk9aS5sb3dlcigpCgkJaWYgbGVuKGkpPj02IDoKCQkJcmVzdWx0cy5hcHBlbmQoaSkKCQkJcmVzdWx0cy5hcHBlbmQoaSsiMTIzIikKCQkJcmVzdWx0cy5hcHBlbmQoaSsiMTIzNCIpCgkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMzQ1IikKCgkJZWxpZiBsZW4oaSk9PTMgb3IgbGVuKGkpPT00IG9yIGxlbihpKT09NSA6CgkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMyIpCgkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMzQiKQoJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0NSIpCgoJCWVsc2U6CgkJCXJlc3VsdHMuYXBwZW5kKGkpCgkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMyIpCgkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMzQiKQoJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0NSIpCgkJCXJlc3VsdHMuYXBwZW5kKHRleHQpCglyZXR1cm4gcmVzdWx0cwoiIiIKI2RlZiBnZW5lcmF0ZWtvdG9sKG5fX2EpOgpkZWYgZ2VuZXJhdGUobl9fYSk6Cglib2NpbF9hbG9rX2JlcnNhdHVfbWVsYXdhbl9wdWJnID0gW10KCW5fX2EgPSBuX19hLmxvd2VyKCkKCXRleHQgPSBuX19hCgl0ZXh0ID0gdGV4dC5sb3dlcigpCgl0cnk6ZG1pX19ndGcgPSBvcGVuKCIucGFza2EiLCAiciIpLnJlYWQoKQoJZXhjZXB0OmRtaV9fZ3RnID0gIjEyM3wxMjM0fDEyMzQ1IgoJZG1pX19ndGcgPSBkbWlfX2d0Zy5zcGxpdCgifCIpCgojCWZvciBpIGluIG5fX2Euc3BsaXQoIiAiKTogIyA8PT09PT0gTkFNQSBMRU5HS0FQICsgQU5HS0EgTUFOVUFMCiMJCWk9aS5sb3dlcigpCiMJCWZvciBub2xlcCBpbiBkbWlfX2d0ZzoKIwkJCWJvY2lsX2Fsb2tfYmVyc2F0dV9tZWxhd2FuX3B1YmcuYXBwZW5kKGkrbm9sZXApCgoKCW5hbWFfdHRfID0gbl9fYS5zcGxpdCgiICIpCglmb3Igbm9sZXAgaW4gZG1pX19ndGc6ICAjIDw9PT09PSBOQU1BIERFUEFOIEFKQSArIEFOR0tBIE1BTlVBTAoJCWJvY2lsX2Fsb2tfYmVyc2F0dV9tZWxhd2FuX3B1YmcuYXBwZW5kKG5hbWFfdHRfWzBdK25vbGVwKQoJYm9jaWxfYWxva19iZXJzYXR1X21lbGF3YW5fcHViZy5hcHBlbmQodGV4dCkKCXRyeTpzaiA9IG9wZW4oIi5wYXNzIiwgInIiKS5yZWFkKCkgICAgICMgPD09PT09PSBQQVNTIEdBQlVOR0FOCglleGNlcHQ6c2ogPSAoIktPU09ORyIpCgl0cnk6CgkJcGF3ID0gb3BlbigiLnBhd3ciLCAiciIpLnJlYWQoKS5zcGxpdCgifCIpCgkJZm9yIG4gaW4gcGF3OgoJCQlpZiBsZW4obik+PSA1OgoJCQkJYm9jaWxfYWxva19iZXJzYXR1X21lbGF3YW5fcHViZy5hcHBlbmQobikKCWV4Y2VwdDpwYXNzCgoKCgoJcmV0dXJuIGJvY2lsX2Fsb2tfYmVyc2F0dV9tZWxhd2FuX3B1YmcKCgoKCiMjIyMjIyMgVkVSU0lPTiBTSU1QRUwKIiIiCgkJaWYgbGVuKGkpPj02IDoKCQkJYm9jaWxfYWxva19iZXJzYXR1X21lbGF3YW5fcHViZy5hcHBlbmQoaSsiMTIzIikKCQkJYm9jaWxfYWxva19iZXJzYXR1X21lbGF3YW5fcHViZy5hcHBlbmQoaSsiMTIzNCIpCgkJCWJvY2lsX2Fsb2tfYmVyc2F0dV9tZWxhd2FuX3B1YmcuYXBwZW5kKGkrIjEyMzQ1IikKCQllbGlmIGxlbihpKT09MyBvciBsZW4oaSk9PTQgb3IgbGVuKGkpPT01IDoKCQkJYm9jaWxfYWxva19iZXJzYXR1X21lbGF3YW5fcHViZy5hcHBlbmQoaSkKCQkJYm9jaWxfYWxva19iZXJzYXR1X21lbGF3YW5fcHViZy5hcHBlbmQoaSsiMTIzIikKCQkJYm9jaWxfYWxva19iZXJzYXR1X21lbGF3YW5fcHViZy5hcHBlbmQoaSsiMTIzNCIpCgkJCWJvY2lsX2Fsb2tfYmVyc2F0dV9tZWxhd2FuX3B1YmcuYXBwZW5kKGkrIjEyMzQ1IikKCQllbHNlOgoJCQlib2NpbF9hbG9rX2JlcnNhdHVfbWVsYXdhbl9wdWJnLmFwcGVuZChpKQoJCQlib2NpbF9hbG9rX2JlcnNhdHVfbWVsYXdhbl9wdWJnLmFwcGVuZChpKyIxMjMiKQoJCQlib2NpbF9hbG9rX2JlcnNhdHVfbWVsYXdhbl9wdWJnLmFwcGVuZChpKyIxMjM0IikKCQkJYm9jaWxfYWxva19iZXJzYXR1X21lbGF3YW5fcHViZy5hcHBlbmQoaSsiMTIzNDUiKQoKCWJvY2lsX2Fsb2tfYmVyc2F0dV9tZWxhd2FuX3B1YmcuYXBwZW5kKCkKIiIiCgoKCgpkZWYgZ2VuZXJhdGV2NCh0ZXh0KToKCXJlc3VsdHM9W10KCWtpa3lfZ2dfZ3RnID0gdGV4dAoJcXogPSB0ZXh0LnNwbGl0KCIgIikKCXRyeToKCQlzaiA9IG9wZW4oIi5wYXNzIiwgInIiKS5yZWFkKCkKCWV4Y2VwdDoKCQlzaiA9ICgiS09TT05HIikKCXRyeToKCQlwYXcgPSBvcGVuKCIucGF3dyIsICJyIikucmVhZCgpLnNwbGl0KCJ8IikKCQlmb3IgbiBpbiBwYXc6CgkJCWlmIGxlbihuKT49IDU6CgkJCQl0cnk6CgkJCQkJYmFIID0gbi5zcGxpdCgiREVQQU4iKVsxXQoJCQkJCWthdyA9ICIwIgoJCQkJZXhjZXB0OgoJCQkJCXRyeToKCQkJCQkJYmFIID0gbi5zcGxpdCgiZGVwYW4iKVsxXQoJCQkJCQlrYXcgPSAiMSIKCQkJCQlleGNlcHQ6CgkJCQkJCXRyeToKCQkJCQkJCWJhSCA9IG4uc3BsaXQoImxlbmdrYXAiKVsxXQoJCQkJCQkJa293ID0gIjIiCgkJCQkJCWV4Y2VwdDoKCQkJCQkJCWthdyA9ICIwIgoJCQkJCQkJYmFIID0gIiIKCQkJCWlmIGJhSCA9PSAiIjoKCQkJCQlyZXN1bHRzLmFwcGVuZChuKQoJCQkJaWYga293ID09ICIyIjoKCQkJCQlyZXN1bHRzLmFwcGVuZCh0ZXh0KQoJCQkJaWYga2F3ID09ICIxIjoKCQkJCQlyZXN1bHRzLmFwcGVuZChxelswXS5sb3dlcigpK2JhSCkKCQkJCWVsc2U6CgkJCQkJcmVzdWx0cy5hcHBlbmQocXpbMF0rYmFIKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnBhc3MKCXRleHQgPSB0ZXh0Lmxvd2VyKCkKCWZvciBpIGluIHRleHQuc3BsaXQoIiAiKToKCQlpPWkubG93ZXIoKQoJCWlmIGxlbihpKT49NiA6CgkJCXJlc3VsdHMuYXBwZW5kKGkpCgkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMyIpCgkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMzQiKQoJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0NSIpCgoJCWVsaWYgbGVuKGkpPT0zIG9yIGxlbihpKT09NCBvciBsZW4oaSk9PTUgOgoJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjMiKQoJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0IikKCQkJcmVzdWx0cy5hcHBlbmQoaSsiMTIzNDUiKQoKCQllbHNlOgoJCQlyZXN1bHRzLmFwcGVuZChpKQoJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjMiKQoJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0IikKCQkJcmVzdWx0cy5hcHBlbmQoaSsiMTIzNDUiKQoJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0NTYiKQoJCQlyZXN1bHRzLmFwcGVuZCh0ZXh0KQoJcmV0dXJuIHJlc3VsdHMKZGVmIGxvZ19hcGlfMShlbSxwYXMpOgojICAgIHVhID0gX2RhcHVudGFfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3InKS5yZWFkKCkKICAgIGdsb2JhbCB1YQogICAgciA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgaGVhZGVyID0geyJ4LWZiLWNvbm5lY3Rpb24tYmFuZHdpZHRoIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwMDAwLjAsIDMwMDAwMDAwLjApKSwieC1mYi1zaW0taG5pIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwLCA0MDAwMCkpLCJ4LWZiLW5ldC1obmkiOiBzdHIocmFuZG9tLnJhbmRpbnQoMjAwMDAsIDQwMDAwKSksIngtZmItY29ubmVjdGlvbi1xdWFsaXR5IjogIkVYQ0VMTEVOVCIsIngtZmItY29ubmVjdGlvbi10eXBlIjogImNlbGwuQ1RSYWRpb0FjY2Vzc1RlY2hub2xvZ3lIU0RQQSIsInVzZXItYWdlbnQiOiB1YSwiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsIngtZmItaHR0cC1lbmdpbmUiOiAiTGlnZXIifQogICAgcmVzcG9uc2UgPSByLmdldCgnaHR0cHM6Ly9iLWFwaS5mYWNlYm9vay5jb20vbWV0aG9kL2F1dGgubG9naW4/Zm9ybWF0PWpzb24mZW1haWw9JyArIGVtICsgJyZwYXNzd29yZD0nICsgcGFzICsgJyZjcmVkZW50aWFsc190eXBlPWRldmljZV9iYXNlZF9sb2dpbl9wYXNzd29yZCZnZW5lcmF0ZV9zZXNzaW9uX2Nvb2tpZXM9MSZlcnJvcl9kZXRhaWxfdHlwZT1idXR0b25fd2l0aF9kaXNhYmxlZCZzb3VyY2U9ZGV2aWNlX2Jhc2VkX2xvZ2luJm1ldGFfaW5mX2ZibWV0YT0lMjAmY3VycmVudGx5X2xvZ2dlZF9pbl91c2VyaWQ9MCZtZXRob2Q9R0VUJmxvY2FsZT1lbl9VUyZjbGllbnRfY291bnRyeV9jb2RlPVVTJmZiX2FwaV9jYWxsZXJfY2xhc3M9Y29tLmZhY2Vib29rLmZvcy5oZWFkZXJzdjIuZmI0YW9yY2EuSGVhZGVyc1YyQ29uZmlnRmV0Y2hSZXF1ZXN0SGFuZGxlciZhY2Nlc3NfdG9rZW49MzUwNjg1NTMxNzI4fDYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJmZiX2FwaV9yZXFfZnJpZW5kbHlfbmFtZT1hdXRoZW50aWNhdGUmY3BsPXRydWUnLCBoZWFkZXJzPWhlYWRlcikKICAgIGlmICdzZXNzaW9uX2tleScgaW4gcmVzcG9uc2UudGV4dCBhbmQgJ0VBQUEnIGluIHJlc3BvbnNlLnRleHQ6cmV0dXJuIHsic3RhdHVzIjoib2siLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KICAgIGVsaWYgJ3d3dy5mYWNlYm9vay5jb20nIGluIHJlc3BvbnNlLmpzb24oKVsnZXJyb3JfbXNnJ106cmV0dXJuIHsic3RhdHVzIjoiY3AiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KICAgIGVsc2U6cmV0dXJuIHsic3RhdHVzIjoiZXJyb3IiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KZGVmIGxvZ19hcGlfMihlbSxwYXMpOgogIyAgIHVhID0gX2RhcHVudGFfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3InKS5yZWFkKCkKICAgIGdsb2JhbCB1YQogICAgciA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgaGVhZGVyID0geyJ4LWZiLWNvbm5lY3Rpb24tYmFuZHdpZHRoIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwMDAwLjAsIDMwMDAwMDAwLjApKSwieC1mYi1zaW0taG5pIjogc3RyKHJhbmRvbS5yYW5kaW50KDEwMDAwLCA0MDAwMCkpLCJ4LWZiLW5ldC1obmkiOiBzdHIocmFuZG9tLnJhbmRpbnQoMTAwMDAsIDQwMDAwKSksIngtZmItY29ubmVjdGlvbi1xdWFsaXR5IjogIkVYQ0VMTEVOVCIsIngtZmItY29ubmVjdGlvbi10eXBlIjogImNlbGwuQ1RSYWRpb0FjY2Vzc1RlY2hub2xvZ3lIU0RQQSIsInVzZXItYWdlbnQiOiB1YSwiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsIngtZmItaHR0cC1lbmdpbmUiOiAiTGlnZXIifQogICAgcGFyYW0gPSB7J2FjY2Vzc190b2tlbic6ICczNTA2ODU1MzE3MjglN0M2MmY4Y2U5Zjc0YjEyZjg0YzEyM2NjMjM0MzdhNGEzMicsICdmb3JtYXQnOiAnanNvbicsICdzZGtfdmVyc2lvbic6ICcyJywgJ2VtYWlsJzogZW0sICdsb2NhbGUnOiAnZW5fVVMnLCAncGFzc3dvcmQnOiBwYXMsICdzZGsnOiAnaW9zJywgJ2dlbmVyYXRlX3Nlc3Npb25fY29va2llcyc6ICcxJywgJ3NpZyc6JzNmNTU1Zjk5ZmI2MWZjZDdhYTBjNDRmNThmNTIyZWY2J30KICAgIGFwaSA9ICdodHRwczovL2ItYXBpLmZhY2Vib29rLmNvbS9tZXRob2QvYXV0aC5sb2dpbicKICAgIHJlc3BvbnNlID0gci5nZXQoYXBpLCBwYXJhbXM9cGFyYW0sIGhlYWRlcnM9aGVhZGVyKQogICAgaWYgJ3Nlc3Npb25fa2V5JyBpbiByZXNwb25zZS50ZXh0IGFuZCAnRUFBQScgaW4gcmVzcG9uc2UudGV4dDpyZXR1cm4geyJzdGF0dXMiOiJvayIsImVtYWlsIjplbSwicGFzcyI6cGFzfQogICAgZWxpZiAnd3d3LmZhY2Vib29rLmNvbScgaW4gcmVzcG9uc2UuanNvbigpWydlcnJvcl9tc2cnXTpyZXR1cm4geyJzdGF0dXMiOiJjcCIsImVtYWlsIjplbSwicGFzcyI6cGFzfQogICAgZWxzZTpyZXR1cm4geyJzdGF0dXMiOiJlcnJvciIsImVtYWlsIjplbSwicGFzcyI6cGFzfQpkZWYgbG9nX21iYXNpY18xKGVtLHBhcyk6CiMgICAgdWEgPSBfZGFwdW50YV9kYXB1bnRhXygndWdlbnQudHh0JywncicpLnJlYWQoKQogICAgZ2xvYmFsIHVhCiAgICByID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICByLmhlYWRlcnMudXBkYXRlKHsiSG9zdCI6Im0uZmFjZWJvb2suY29tIiwiY2FjaGUtY29udHJvbCI6Im1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwidXNlci1hZ2VudCI6dWEsImFjY2VwdCI6InRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgiLCJhY2NlcHQtZW5jb2RpbmciOiJnemlwLCBkZWZsYXRlIiwiYWNjZXB0LWxhbmd1YWdlIjoiaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjcifSkKICAgIHAgPSByLmdldCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8iKQogICAgYiA9IHIucG9zdCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9sb2dpbi5waHAiLCBkYXRhPXsiZW1haWwiOiBlbSwgInBhc3MiOiBwYXMsICJsb2dpbiI6ICJzdWJtaXQifSkKICAgIF9yYXdfY29va2llc18gPSAoIjsiKS5qb2luKFsgIiVzPSVzIiAlIChrZXksIHZhbHVlKSBmb3Iga2V5LCB2YWx1ZSBpbiByLmNvb2tpZXMuZ2V0X2RpY3QoKS5pdGVtcygpIF0pCiAgICBpZiAiY191c2VyIiBpbiByLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCk6cmV0dXJuIHsic3RhdHVzIjoib2siLCJlbWFpbCI6ZW0sInBhc3MiOnBhcywiY29va2llcyI6X3Jhd19jb29raWVzX30KICAgIGVsaWYgImNoZWNrcG9pbnQiIGluIHIuY29va2llcy5nZXRfZGljdCgpLmtleXMoKTpyZXR1cm4geyJzdGF0dXMiOiJjcCIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpfcmF3X2Nvb2tpZXNffQogICAgZWxzZTpyZXR1cm4geyJzdGF0dXMiOiJlcnJvciIsImVtYWlsIjplbSwicGFzcyI6cGFzfQpkZWYgbG9nX21iYXNpY18yKGVtLHBhcyk6CiMgICAgdWEgPSBfZGFwdW50YV9kYXB1bnRhXygndWdlbnQudHh0JywncicpLnJlYWQoKQogICAgZ2xvYmFsIHVhCiAgICByID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICByLmhlYWRlcnMudXBkYXRlKHsiSG9zdCI6Im0uZmFjZWJvb2suY29tIiwiY2FjaGUtY29udHJvbCI6Im1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwidXNlci1hZ2VudCI6dWEsImFjY2VwdCI6InRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgiLCJhY2NlcHQtZW5jb2RpbmciOiJnemlwLCBkZWZsYXRlIiwiYWNjZXB0LWxhbmd1YWdlIjoiaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjcifSkKICAgIHAgPSByLmdldCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8iKQogICAgYiA9IGJzNC5CZWF1dGlmdWxTb3VwKHAudGV4dCwiaHRtbC5wYXJzZXIiKQogICAgbWV0YT0iIi5qb2luKGJzNC5yZS5maW5kYWxsKCdkdHNnIjpceyJ0b2tlbiI6IiguKj8pIicscC50ZXh0KSkKICAgIGRhdGE9e30KICAgIGZvciBpIGluIGIoImlucHV0Iik6CiAgICAgICAgaWYgaS5nZXQoInZhbHVlIikgaXMgTm9uZToKICAgICAgICAgICAgaWYgaS5nZXQoIm5hbWUiKT09ImVtYWlsIjpkYXRhLnVwZGF0ZSh7ImVtYWlsIjplbX0pCiAgICAgICAgICAgIGVsaWYgaS5nZXQoIm5hbWUiKT09InBhc3MiOmRhdGEudXBkYXRlKHsicGFzcyI6cGFzfSkKICAgICAgICAgICAgZWxzZTpkYXRhLnVwZGF0ZSh7aS5nZXQoIm5hbWUiKToiIn0pCiAgICAgICAgZWxzZTpkYXRhLnVwZGF0ZSh7aS5nZXQoIm5hbWUiKTppLmdldCgidmFsdWUiKX0pCiAgICBkYXRhLnVwZGF0ZSh7ImZiX2R0c2ciOm1ldGEsIm1fc2VzcyI6IiIsIl9fdXNlciI6IjAiLCJfX3JlcSI6ImQiLCJfX2NzciI6IiIsIl9fYSI6IiIsIl9fZHluIjoiIiwiZW5jcGFzcyI6IiJ9KQogICAgci5oZWFkZXJzLnVwZGF0ZSh7InJlZmVyZXIiOiJodHRwczovL20uZmFjZWJvb2suY29tL2xvZ2luLz9uZXh0JnJlZj1kYmwmZmwmcmVmaWQ9OCJ9KQogICAgcG8gPSByLnBvc3QoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vbG9naW4vZGV2aWNlLWJhc2VkL2xvZ2luL2FzeW5jLz9yZWZzcmM9aHR0cHMlM0ElMkYlMkZtLmZhY2Vib29rLmNvbSUyRmxvZ2luJTJGJTNGcmVmJTNEZGJsJmx3dj0xMDAiLGRhdGE9ZGF0YSkudGV4dAogICAgX3Jhd19jb29raWVzXyA9ICgiOyIpLmpvaW4oWyAiJXM9JXMiICUgKGtleSwgdmFsdWUpIGZvciBrZXksIHZhbHVlIGluIHIuY29va2llcy5nZXRfZGljdCgpLml0ZW1zKCkgXSkKICAgIGlmICJjX3VzZXIiIGluIGxpc3Qoci5jb29raWVzLmdldF9kaWN0KCkua2V5cygpKTpyZXR1cm4geyJzdGF0dXMiOiJvayIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpfcmF3X2Nvb2tpZXNffQogICAgZWxpZiAiY2hlY2twb2ludCIgaW4gbGlzdChyLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCkpOnJldHVybiB7InN0YXR1cyI6ImNwIiwiZW1haWwiOmVtLCJwYXNzIjpwYXMsImNvb2tpZXMiOl9yYXdfY29va2llc199CiAgICBlbHNlOnJldHVybiB7InN0YXR1cyI6ImVycm9yIiwiZW1haWwiOmVtLCJwYXNzIjpwYXN9CgpkZWYgbG9nX2FwaShlbSxwYXMsaG9zdHMpOgogICAgdWEgPSByYW5kb20uY2hvaWNlKFsnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNaSA5VCBQcm8gQnVpbGQvUUtRMS4xOTA4MjUuMDAyOyB3dikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi80LjAgQ2hyb21lLzg4LjAuNDMyNC4xODEgTW9iaWxlIFNhZmFyaS81MzcuMzYgW0ZCQU4vRU1BO0ZCTEMvaWRfSUQ7RkJBVi8yMzkuMC4wLjEwLjEwOTtdJywnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDUuMDsgQVNVU19aMDBBRCBCdWlsZC9MUlgyMVYpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS8zNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiBbRkJBTi9FTUE7RkJMQy9pZF9JRDtGQkFWLzIzOS4wLjAuMTAuMTA5O10nXSk7ciA9IHJlcXVlc3RzLlNlc3Npb24oKTtyLmhlYWRlcnMudXBkYXRlKHsiSG9zdCI6Im1iYXNpYy5mYWNlYm9vay5jb20iLCJjYWNoZS1jb250cm9sIjoibWF4LWFnZT0wIiwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyI6IjEiLCJ1c2VyLWFnZW50Ijp1YSwiYWNjZXB0IjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCIsImFjY2VwdC1lbmNvZGluZyI6Imd6aXAsIGRlZmxhdGUiLCJhY2NlcHQtbGFuZ3VhZ2UiOiJpZC1JRCxpZDtxPTAuOSxlbi1VUztxPTAuOCxlbjtxPTAuNyJ9KTtwID0gci5nZXQoImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS8iKTtiID0gYnM0LkJlYXV0aWZ1bFNvdXAocC50ZXh0LCJodG1sLnBhcnNlciIpO21ldGE9IiIuam9pbihiczQucmUuZmluZGFsbCgnZHRzZyI6XHsidG9rZW4iOiIoLio/KSInLHAudGV4dCkpO2RhdGE9e30KICAgIHIgPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgIGhlYWRlciA9IHsieC1mYi1jb25uZWN0aW9uLWJhbmR3aWR0aCI6IHN0cihyYW5kb20ucmFuZGludCgyMDAwMDAwMC4wLCAzMDAwMDAwMC4wKSksCiAgICAgICAgIngtZmItc2ltLWhuaSI6IHN0cihyYW5kb20ucmFuZGludCgyMDAwMCwgNDAwMDApKSwKICAgICAgICAieC1mYi1uZXQtaG5pIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwLCA0MDAwMCkpLAogICAgICAgICJ4LWZiLWNvbm5lY3Rpb24tcXVhbGl0eSI6ICJFWENFTExFTlQiLAogICAgICAgICJ4LWZiLWNvbm5lY3Rpb24tdHlwZSI6ICJjZWxsLkNUUmFkaW9BY2Nlc3NUZWNobm9sb2d5SFNEUEEiLAogICAgICAgICJ1c2VyLWFnZW50IjogdWEsCiAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICJ4LWZiLWh0dHAtZW5naW5lIjogIkxpZ2VyIn0KICAgIHBhcmFtID0geydhY2Nlc3NfdG9rZW4nOiAnMzUwNjg1NTMxNzI4JTdDNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdmb3JtYXQnOiAnanNvbicsCiAgICAgICAgJ3Nka192ZXJzaW9uJzogJzInLAogICAgICAgICdlbWFpbCc6IGVtLAogICAgICAgICdsb2NhbGUnOiAnZW5fVVMnLAogICAgICAgICdwYXNzd29yZCc6IHBhcywKICAgICAgICAnc2RrJzogJ2lvcycsCiAgICAgICAgJ2dlbmVyYXRlX3Nlc3Npb25fY29va2llcyc6ICcxJywKICAgICAgICAnc2lnJzonM2Y1NTVmOTlmYjYxZmNkN2FhMGM0NGY1OGY1MjJlZjYnfQogICAgYXBpID0gJ2h0dHBzOi8vYi1hcGkuZmFjZWJvb2suY29tL21ldGhvZC9hdXRoLmxvZ2luJwogICAgcmVzcG9uc2UgPSByLmdldChhcGksIHBhcmFtcz1wYXJhbSwgaGVhZGVycz1oZWFkZXIpCiAgICBpZiAnc2Vzc2lvbl9rZXknIGluIHJlc3BvbnNlLnRleHQgYW5kICdFQUFBJyBpbiByZXNwb25zZS50ZXh0OgogICAgICAgIHJldHVybiB7InN0YXR1cyI6InN1Y2Nlc3MiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KICAgIGVsaWYgJ3d3dy5mYWNlYm9vay5jb20nIGluIHJlc3BvbnNlLmpzb24oKVsnZXJyb3JfbXNnJ106CiAgICAgICAgcmV0dXJuIHsic3RhdHVzIjoiY3AiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KICAgIGVsc2U6cmV0dXJuIHsic3RhdHVzIjoiZXJyb3IiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KZGVmIGxvZ2dlcihlbSxwYXMsaG9zdHMpOgogICAgdWEgPSByYW5kb20uY2hvaWNlKFsnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNaSA5VCBQcm8gQnVpbGQvUUtRMS4xOTA4MjUuMDAyOyB3dikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi80LjAgQ2hyb21lLzg4LjAuNDMyNC4xODEgTW9iaWxlIFNhZmFyaS81MzcuMzYgW0ZCQU4vRU1BO0ZCTEMvaWRfSUQ7RkJBVi8yMzkuMC4wLjEwLjEwOTtdJywnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDUuMDsgQVNVU19aMDBBRCBCdWlsZC9MUlgyMVYpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS8zNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiBbRkJBTi9FTUE7RkJMQy9pZF9JRDtGQkFWLzIzOS4wLjAuMTAuMTA5O10nXSk7ciA9IHJlcXVlc3RzLlNlc3Npb24oKTtyLmhlYWRlcnMudXBkYXRlKHsiSG9zdCI6Im1iYXNpYy5mYWNlYm9vay5jb20iLCJjYWNoZS1jb250cm9sIjoibWF4LWFnZT0wIiwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyI6IjEiLCJ1c2VyLWFnZW50Ijp1YSwiYWNjZXB0IjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCIsImFjY2VwdC1lbmNvZGluZyI6Imd6aXAsIGRlZmxhdGUiLCJhY2NlcHQtbGFuZ3VhZ2UiOiJpZC1JRCxpZDtxPTAuOSxlbi1VUztxPTAuOCxlbjtxPTAuNyJ9KTtwID0gci5nZXQoImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS8iKTtiID0gYnM0LkJlYXV0aWZ1bFNvdXAocC50ZXh0LCJodG1sLnBhcnNlciIpO21ldGE9IiIuam9pbihiczQucmUuZmluZGFsbCgnZHRzZyI6XHsidG9rZW4iOiIoLio/KSInLHAudGV4dCkpO2RhdGE9e30KICAgIGZvciBpIGluIGIoImlucHV0Iik6CiAgICAgICAgaWYgaS5nZXQoInZhbHVlIikgaXMgTm9uZToKICAgICAgICAgICAgaWYgaS5nZXQoIm5hbWUiKT09ImVtYWlsIjpkYXRhLnVwZGF0ZSh7ImVtYWlsIjplbX0pCiAgICAgICAgICAgIGVsaWYgaS5nZXQoIm5hbWUiKT09InBhc3MiOmRhdGEudXBkYXRlKHsicGFzcyI6cGFzfSkKICAgICAgICAgICAgZWxzZTpkYXRhLnVwZGF0ZSh7aS5nZXQoIm5hbWUiKToiIn0pCiAgICAgICAgZWxzZTpkYXRhLnVwZGF0ZSh7aS5nZXQoIm5hbWUiKTppLmdldCgidmFsdWUiKX0pCiAgICBkYXRhLnVwZGF0ZSh7ImZiX2R0c2ciOm1ldGEsIm1fc2VzcyI6IiIsIl9fdXNlciI6IjAiLCJfX3JlcSI6ImQiLCJfX2NzciI6IiIsIl9fYSI6IiIsIl9fZHluIjoiIiwiZW5jcGFzcyI6IiJ9KTtyLmhlYWRlcnMudXBkYXRlKHsicmVmZXJlciI6Imh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgifSk7cG8gPSByLnBvc3QoImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9sb2dpbi9kZXZpY2UtYmFzZWQvbG9naW4vYXN5bmMvP3JlZnNyYz1odHRwcyUzQSUyRiUyRm0uZmFjZWJvb2suY29tJTJGbG9naW4lMkYlM0ZyZWYlM0RkYmwmbHd2PTEwMCIsZGF0YT1kYXRhKS50ZXh0CiAgICBpZiAiY191c2VyIiBpbiBsaXN0KHIuY29va2llcy5nZXRfZGljdCgpLmtleXMoKSk6cmV0dXJuIHsic3RhdHVzIjoic3VjY2VzcyIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpyLmNvb2tpZXMuZ2V0X2RpY3QoKX0KICAgIGVsaWYgImNoZWNrcG9pbnQiIGluIGxpc3Qoci5jb29raWVzLmdldF9kaWN0KCkua2V5cygpKTpyZXR1cm4geyJzdGF0dXMiOiJjcCIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpyLmNvb2tpZXMuZ2V0X2RpY3QoKX0KICAgIGVsc2U6cmV0dXJuIHsic3RhdHVzIjoiZXJyb3IiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KZGVmIGxvZ19tYmFzaWMoZW0scGFzLGhvc3RzKToKICAgIGdsb2JhbCB1YQogICAgciA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgci5oZWFkZXJzLnVwZGF0ZSh7Ikhvc3QiOiJtYmFzaWMuZmFjZWJvb2suY29tIiwiY2FjaGUtY29udHJvbCI6Im1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwidXNlci1hZ2VudCI6dWEsImFjY2VwdCI6InRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgiLCJhY2NlcHQtZW5jb2RpbmciOiJnemlwLCBkZWZsYXRlIiwiYWNjZXB0LWxhbmd1YWdlIjoiaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjcifSkKICAgIHAgPSByLmdldCgiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tLyIpCiAgICBiID0gYnM0LkJlYXV0aWZ1bFNvdXAocC50ZXh0LCJodG1sLnBhcnNlciIpCiAgICBtZXRhPSIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoJ2R0c2ciOlx7InRva2VuIjoiKC4qPykiJyxwLnRleHQpKQogICAgZGF0YT17fQogICAgZm9yIGkgaW4gYigiaW5wdXQiKToKICAgICAgICBpZiBpLmdldCgidmFsdWUiKSBpcyBOb25lOgogICAgICAgICAgICBpZiBpLmdldCgibmFtZSIpPT0iZW1haWwiOgogICAgICAgICAgICAgICAgZGF0YS51cGRhdGUoeyJlbWFpbCI6ZW19KQogICAgICAgICAgICBlbGlmIGkuZ2V0KCJuYW1lIik9PSJwYXNzIjoKICAgICAgICAgICAgICAgIGRhdGEudXBkYXRlKHsicGFzcyI6cGFzfSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGRhdGEudXBkYXRlKHtpLmdldCgibmFtZSIpOiIifSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkYXRhLnVwZGF0ZSh7aS5nZXQoIm5hbWUiKTppLmdldCgidmFsdWUiKX0pCiAgICBkYXRhLnVwZGF0ZSgKICAgICAgICB7ImZiX2R0c2ciOm1ldGEsIm1fc2VzcyI6IiIsIl9fdXNlciI6IjAiLAogICAgICAgICJfX3JlcSI6ImQiLCJfX2NzciI6IiIsIl9fYSI6IiIsIl9fZHluIjoiIiwiZW5jcGFzcyI6IiIKICAgICAgICB9CiAgICApCiAgICByLmhlYWRlcnMudXBkYXRlKHsicmVmZXJlciI6Imh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgifSkKICAgIHBvID0gci5wb3N0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vbG9naW4vZGV2aWNlLWJhc2VkL2xvZ2luL2FzeW5jLz9yZWZzcmM9aHR0cHMlM0ElMkYlMkZtLmZhY2Vib29rLmNvbSUyRmxvZ2luJTJGJTNGcmVmJTNEZGJsJmx3dj0xMDAiLGRhdGE9ZGF0YSkudGV4dAogICAgaWYgImNfdXNlciIgaW4gbGlzdChyLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCkpOgogICAgICAgIHJldHVybiB7InN0YXR1cyI6InN1Y2Nlc3MiLCJlbWFpbCI6ZW0sInBhc3MiOnBhcywiY29va2llcyI6ci5jb29raWVzLmdldF9kaWN0KCl9CgogICAgZWxpZiAiY2hlY2twb2ludCIgaW4gbGlzdChyLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCkpOgogICAgICAgIHJldHVybiB7InN0YXR1cyI6ImNwIiwiZW1haWwiOmVtLCJwYXNzIjpwYXMsImNvb2tpZXMiOnIuY29va2llcy5nZXRfZGljdCgpfQogICAgZWxzZTpyZXR1cm4geyJzdGF0dXMiOiJlcnJvciIsImVtYWlsIjplbSwicGFzcyI6cGFzfQpjbGFzcyBjcmFja21lbnU6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsaXNpZmlsZSk6CiAgICAgICAgc2VsZi5pZCA9IFtdCiAgICBkZWYgY3JhY2tvbGQoc2VsZixpc2lmaWxlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuYXBrID0gaXNpZmlsZQogICAgICAgICAgICBzZWxmLmlkID0gb3BlbihzZWxmLmFwaykucmVhZCgpLnNwbGl0bGluZXMoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcHJpbnQod2FyKydGaWxlIE5vdCBGb3VuZCEgVHJ5IEFnYWluJykKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBtZW51KCkKICAgICAgICBpZiAiS0lLWV9HVEciID09ICJLSUtZX0dURyI6CiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICBqYWxhbih3YXIrIkNvbnRvaCBQYXNzd29yZCA6IHNheWFuZywxMjM0NTYsMTIzNDU2Nzg5IikKICAgICAgICAgICAgICAgIHB3eCA9IGlucHV0KCdcbicraW5wKyJNYXN1a2FuIFBhc3N3b3JkIDogIikKICAgICAgICAgICAgICAgIGphbGFuKCIlc1Bhc3N3b3JkIFlhbmcgRGlHdW5ha2FuIDogJXMlcyIlKHdhcixJLHB3eCkpCiAgICAgICAgICAgICAgICBpZiBwd3ggPT0gJyc6CiAgICAgICAgICAgICAgICAgICAgamFsYW4od2FyKyJJc2kgUGFzc3dvcmQgRGVuZ2FuIEJlbmFyICEhIikKICAgICAgICAgICAgICAgIGVsaWYgbGVuKHB3eCk8PTU6CiAgICAgICAgICAgICAgICAgICAgamFsYW4od2FyKyJQYXNzd29yZCBNaW5pbWFsIDYgSHVydWYgISEiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0YW55YV9vcHNpKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnByb19zZXMoKQogICAgICAgICAgICAgICAgICAgIGRlZiBtb2JpbGVfbih6c2M9Tm9uZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggenRocmVhZHMobWF4X3dvcmtlcnM9MzUpIGFzIChmb3JtKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgdWlkIGluIHNlbGYuaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJpZCA9IHVpZC5zcGxpdCgnPD0+JylbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uc3VibWl0KHNlbGYubW9iaWxlXyx1c2VyaWQsenNjICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShzZWxmLmFwaykKICAgICAgICAgICAgICAgICAgICAgICAgZXhpdCh3YXIrIkRvbmUgISEiKQoKICAgICAgICAgICAgICAgICAgICBtb2JpbGVfbihwd3guc3BsaXQoJywnKSkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgZGVmIHByb19zZXMoc2VsZik6CiAgICAgICAgamFsYW4oIlxuIikKICAgICAgICBqYWxhbih3YXIrTSsiSmlrYSBBZGEgRXJyb3IgSGFyYXAgUmVwb3J0IEtlQWRtaW4gISIpCiAgICAgICAgamFsYW4od2FyK00rIkppa2EgVGlkYWsgSGFzaWwgSGlkdXAgTWF0aWthbiBNb2RlIFBlc2F3YXQgU2VsYW1hIDUgRGV0aWsiKQogICAgICAgIGphbGFuKHdhcisiUHJvc2VzIENyYWNrIFNlZGFuZyBCZXJqYWxhbiBIYXJhcCBUdW5nZ3UgOiAiK1ErIlsiK0MrZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJykrUSsiXSIpCiAgICAgICAgcHJpbnQod2FyKyJIaWR1cCBNYXRpa2FuIE1vZGUgUGVzYXdhdCBKaWthIFRpZGFrIEFkYSBIYXNpbFxuIit3YXIrIkhhc2lsIENyYWNrIFlhbmcgQ1AgRGlTaW1wYW4gRGkgOiAiK0srIkhhc2lsL0NQLSIrZHVyYXNpKyIudHh0XG4iK1Erd2FyKyJIYXNpbCBDcmFjayBZYW5nIE9LIERpU2ltcGFuIERpIDogIitJKyJIYXNpbC9PSy0iK2R1cmFzaSsiLnR4dFxuXG4iK1EpCgogICAgZGVmIG1lbnVfY3JhY2soc2VsZik6ICAgIyBNRVRIT0QgQVVUTyBQQVNTV1JPRAogICAgICAgIGphbGFuKCJcbiIrd2FyK00rIlNpbGFoa2FuIFBpbGloIE1ldG9kZSBMb2dpbiAhIikKICAgICAgICBqYWxhbih3YXIrTSsiU2lsYWhrYW4gQ29iYSBTYXR1IFNhdHUsIEphbmdhbiBMdXBhIEhpZHVwIE1hdGlrYW4gTW9kZSBQZXNhd2F0IikKICAgICAgICBwcmludChRKyJbMV0gQi1BcGkgVjEgICAgICAoIEZhc3QgQ3JhY2sgICkgKCBSYXdhbiBTcGFtICkiKTt0aW1lLnNsZWVwKDAuMDIpCiAgICAgICAgcHJpbnQoUSsiWzJdIEItQXBpIFYyICAgICAgKCBGYXN0IENyYWNrICApICIpO3RpbWUuc2xlZXAoMC4wMikKICAgICAgICBwcmludChRKyJbM10gQi1BcGkgVjMgICAgICAoIEZhc3QgQ3JhY2sgICkiKTt0aW1lLnNsZWVwKDAuMDIpCiAgICAgICAgcHJpbnQoUSsiWzRdIE1iYXNpYyBWMSAgICAgKCBTbG93IENyYWNrICApIik7dGltZS5zbGVlcCgwLjAyKQogICAgICAgIHByaW50KFErIls1XSBNYmFzaWMgVjIgIitDKyJQcm8iK1ErIiAoIFNsb3cgQ3JhY2sgICkiKTt0aW1lLnNsZWVwKDAuMDIpCiAgICAgICAgcHJpbnQoUSsiWzZdIE1iYXNpYyBWMyAiK0MrIlBybyIrUSsiICggRmFzdCBDcmFjayAgKSIpO3RpbWUuc2xlZXAoMC4wMikKICAgICAgICBwcmludChRKyJbN10gTW9iaWxlIFYxICIrQysiUHJvIitRKyIgKCBGYXN0IENyYWNrICApICggIitJKyJSZWNvbW1lbmRlZCIrUSsiICApXG4iKTt0aW1lLnNsZWVwKDAuMDIpCiAgICBkZWYgbWVudV9jcmFja19tKHNlbGYpOiAgICMgTUVUSE9EIE1BTlVBTCBQQVNTV09SRAogICAgICAgIGphbGFuKCJcbiIrd2FyK00rIlNpbGFoa2FuIFBpbGloIE1ldG9kZSBMb2dpbiAhIikKICAgICAgICBqYWxhbih3YXIrTSsiU2lsYWhrYW4gQ29iYSBTYXR1IFNhdHUsIEphbmdhbiBMdXBhIEhpZHVwIE1hdGlrYW4gTW9kZSBQZXNhd2F0IikKICAgICAgICBwcmludChRKyJbMV0gQi1BcGkgVjEgICAgICAoIEZhc3QgQ3JhY2sgICkgKCBSYXdhbiBTcGFtICkiKTt0aW1lLnNsZWVwKDAuMDIpCiAgICAgICAgcHJpbnQoUSsiWzJdIEItQXBpIFYyICAgICAgKCBGYXN0IENyYWNrICApICIpO3RpbWUuc2xlZXAoMC4wMikKICAgICAgICBwcmludChRKyJbM10gTWJhc2ljIFYxICAgICAoIFNsb3cgQ3JhY2sgICkiKTt0aW1lLnNsZWVwKDAuMDIpCiAgICAgICAgcHJpbnQoUSsiWzRdIE1iYXNpYyBWMiAgICAgKCBGYXN0IENyYWNrICApIik7dGltZS5zbGVlcCgwLjAyKQogICAgICAgIHByaW50KFErIls1XSBNb2JpbGUgVjEgIitDKyJQcm8iK1ErIiAoIEZhc3QgQ3JhY2sgICkgKCAiK0krIlJlY29tbWVuZGVkIitRKyIgIClcbiIpO3RpbWUuc2xlZXAoMC4wMikKCiAgICBkZWYgcGFzc21lbnUoc2VsZixpc2lmaWxlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuYXBrID0gaXNpZmlsZQogICAgICAgICAgICBzZWxmLmlkID0gb3BlbihzZWxmLmFwaykucmVhZCgpLnNwbGl0bGluZXMoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcHJpbnQod2FyKydGaWxlIE5vdCBGb3VuZCEgVHJ5IEFnYWluJykKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBtZW51KCkKICAgICAgICBjamogPSBvcGVuKCIucGF3dyIsICJ3IikKICAgICAgICBwcmludCgnXG5cbicrd2FyKydTaWxhaGthbiBQaWxpaCBQYXNzd29yZCAoRGVmYXVsdC9NYW51YWwvR2FidW5nYW4pLShEL20vZykgPycpCiAgICAgICAgemsgPSBpbnB1dChpbnArJ1BpbGloIDogJykKICAgICAgICBpZiB6ayBpbiAoJ20nLCdNJywnTWFudWFsJywnbWFudWFsJyk6CiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICBqYWxhbih3YXIrIkNvbnRvaCBQYXNzd29yZCA6IHNheWFuZywxMjM0NTYiKQogICAgICAgICAgICAgICAgcHd4ID0gaW5wdXQoJ1xuJytpbnArIk1hc3VrYW4gUGFzc3dvcmQgOiAiKQogICAgICAgICAgICAgICAgamFsYW4oIiVzUGFzc3dvcmQgWWFuZyBEaUd1bmFrYW4gOiAlcyVzIiUod2FyLEkscHd4KSkKICAgICAgICAgICAgICAgIGlmIHB3eCA9PSAnJzoKICAgICAgICAgICAgICAgICAgICBqYWxhbih3YXIrIklzaSBQYXNzd29yZCBEZW5nYW4gQmVuYXIgISEiKQogICAgICAgICAgICAgICAgZWxpZiBsZW4ocHd4KTw9NToKICAgICAgICAgICAgICAgICAgICBqYWxhbih3YXIrIlBhc3N3b3JkIE1pbmltYWwgNiBIdXJ1ZiAhISIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRhbnlhX29wc2koKQogICAgICAgICAgICAgICAgICAgIHBpbGloX2FsYW0oKQogICAgICAgICAgICAgICAgICAgIHNlbGYubWVudV9jcmFja19tKCkKICAgICAgICAgICAgICAgICAgICBqbSA9IGlucHV0KHdhcisiUGlsaWggOiIpCiAgICAgICAgICAgICAgICAgICAgaWYgam0gPT0gIiI6CiAgICAgICAgICAgICAgICAgICAgICAgamFsYW4od2FyKyJJc2kgRGVuZ2FuIEJlbmFyIExhaCBLZW50b3QiKTt0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgY3JhY2ttZW51KCkucGFzc21lbnUoKQogICAgICAgICAgICAgICAgICAgIGVsaWYgam0gPT0gIjEiIG9yIGptID09ICIwMSI6CiAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wcm9fc2VzKCkKICAgICAgICAgICAgICAgICAgICAgICBkZWYgYXBpX20oenNjPU5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHp0aHJlYWRzKG1heF93b3JrZXJzPTM1KSBhcyAoZm9ybSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHVpZCBpbiBzZWxmLmlkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyaWQgPSB1aWQuc3BsaXQoJzw9PicpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnN1Ym1pdChzZWxmLmFwaSwgdXNlcmlkLCB6c2MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc2VsZi5hcGspCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXQod2FyKyJEb25lICEhIikKICAgICAgICAgICAgICAgICAgICAgICBhcGlfbShwd3guc3BsaXQoJywnKSkKICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgICAgICAgICBlbGlmIGptID09ICIyIiBvciBqbSA9PSAiMDIiOgogICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJvX3NlcygpCiAgICAgICAgICAgICAgICAgICAgICAgZGVmIGFwaXYyX20oenNjPU5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHp0aHJlYWRzKG1heF93b3JrZXJzPTM1KSBhcyAoZm9ybSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHVpZCBpbiBzZWxmLmlkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyaWQgPSB1aWQuc3BsaXQoJzw9PicpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnN1Ym1pdChzZWxmLl9fYXBpX18sIHVzZXJpZCwgenNjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKHNlbGYuYXBrKQogICAgICAgICAgICAgICAgICAgICAgICAgICBleGl0KHdhcisiRG9uZSAhISIpCiAgICAgICAgICAgICAgICAgICAgICAgYXBpdjJfbShwd3guc3BsaXQoJywnKSkKICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgICAgICAgICBlbGlmIGptID09ICIzIiBvciBqbSA9PSAiMDMiOgogICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJvX3NlcygpCiAgICAgICAgICAgICAgICAgICAgICAgZGVmIG1iYXNpY19tKHpzYz1Ob25lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCB6dGhyZWFkcyhtYXhfd29ya2Vycz0zNSkgYXMgKGZvcm0pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB1aWQgaW4gc2VsZi5pZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmlkID0gdWlkLnNwbGl0KCc8PT4nKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zdWJtaXQoc2VsZi5tYmFzaWMsIHVzZXJpZCwgenNjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKHNlbGYuYXBrKQogICAgICAgICAgICAgICAgICAgICAgICAgICBleGl0KHdhcisiRG9uZSAhISIpCiAgICAgICAgICAgICAgICAgICAgICAgbWJhc2ljX20ocHd4LnNwbGl0KCcsJykpCiAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgICAgICAgICAgZWxpZiBqbSA9PSAiNCIgb3Igam0gPT0gIjA0IjoKICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnByb19zZXMoKQogICAgICAgICAgICAgICAgICAgICAgIGRlZiBtYmFzaWN2Ml9tKHpzYz1Ob25lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCB6dGhyZWFkcyhtYXhfd29ya2Vycz0zNSkgYXMgKGZvcm0pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB1aWQgaW4gc2VsZi5pZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmlkID0gdWlkLnNwbGl0KCc8PT4nKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zdWJtaXQoc2VsZi5tYmFzaWN2MSwgdXNlcmlkLCB6c2MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc2VsZi5hcGspCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXQod2FyKyJEb25lICEhIikKCiAgICAgICAgICAgICAgICAgICAgICAgbWJhc2ljdjJfbShwd3guc3BsaXQoJywnKSkKICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVsaWYgam0gPT0gIjUiIG9yIGptID09ICIwNSI6CiAgICAgICAgICAgICAgICAgICAgICAgcGlsaWhfaW5mb25nKCkKICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnByb19zZXMoKQogICAgICAgICAgICAgICAgICAgICAgIGRlZiBtb2JpbGVfbih6c2M9Tm9uZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggenRocmVhZHMobWF4X3dvcmtlcnM9MzUpIGFzIChmb3JtKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgdWlkIGluIHNlbGYuaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJpZCA9IHVpZC5zcGxpdCgnPD0+JylbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uc3VibWl0KHNlbGYubW9iaWxlXyx1c2VyaWQsenNjICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShzZWxmLmFwaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpdCh3YXIrIkRvbmUgISEiKQoKICAgICAgICAgICAgICAgICAgICAgICBtb2JpbGVfbihwd3guc3BsaXQoJywnKSkKICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgamFsYW4od2FyKyJJc2kgRGVuZ2FuIEJlbmFyIExhaCBLZW50b3QiKTt0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgY3JhY2ttZW51KGlzaWZpbGUpLnBhc3NtZW51KGlzaWZpbGUpCgogICAgICAgIGVsaWYgemsgaW4gKCdkJywgJ0QnLCdEZWZhdWx0JywnZGVmYXVsdCcpOgogICAgICAgICAgICAgICAgdGFueWFfb3BzaSgpCiAgICAgICAgICAgICAgICBwaWxpaF9hbGFtKCkKICAgICAgICAgICAgICAgIGJ1YXRfYW5na2EoKQogICAgICAgICAgICAgICAgc2VsZi5tZW51X2NyYWNrKCkgI1BpbGloYW4gTWV0aG9kCiAgICAgICAgICAgICAgICBqbSA9IGlucHV0KHdhcisiUGlsaWggOiIpCiAgICAgICAgICAgICAgICBpZiBqbSA9PSAiIjoKICAgICAgICAgICAgICAgICAgIGphbGFuKHdhcisiSXNpIERlbmdhbiBCZW5hciBMYWggS2VudG90Iik7dGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgY3JhY2ttZW51KCkucGFzc21lbnUoKQogICAgICAgICAgICAgICAgZWxpZiBqbSA9PSAiMSIgb3Igam0gPT0gIjAxIjoKICAgICAgICAgICAgICAgICAgIHNlbGYucHJvX3NlcygpCiAgICAgICAgICAgICAgICAgICBzZWxmLkthbmdDaWxvaygpCiAgICAgICAgICAgICAgICBlbGlmIGptID09ICIyIiBvciBqbSA9PSAiMDIiOgogICAgICAgICAgICAgICAgICAgc2VsZi5wcm9fc2VzKCkKICAgICAgICAgICAgICAgICAgIHNlbGYuS2FuZ1NVR0VORygpCiAgICAgICAgICAgICAgICBlbGlmIGptID09ICIzIiBvciBqbSA9PSAiMDMiOgogICAgICAgICAgICAgICAgICAgc2VsZi5wcm9fc2VzKCkKICAgICAgICAgICAgICAgICAgIHNlbGYuS2FuZ0tFVE9EKCkKICAgICAgICAgICAgICAgIGVsaWYgam0gPT0gIjQiIG9yIGptID09ICIwNCI6CiAgICAgICAgICAgICAgICAgICBzZWxmLnByb19zZXMoKQogICAgICAgICAgICAgICAgICAgc2VsZi5LYW5nSk9SREkoKQogICAgICAgICAgICAgICAgZWxpZiBqbSA9PSAiNSIgb3Igam0gPT0gIjA1IjoKICAgICAgICAgICAgICAgICAgIHNlbGYucHJvX3NlcygpCiAgICAgICAgICAgICAgICAgICBzZWxmLkthbmdCQU5EQVIoKQogICAgICAgICAgICAgICAgZWxpZiBqbSA9PSAiNiIgb3Igam0gPT0gIjA2IjoKICAgICAgICAgICAgICAgICAgIHNlbGYucHJvX3NlcygpCiAgICAgICAgICAgICAgICAgICBzZWxmLkthbmdBR0VOKCkKICAgICAgICAgICAgICAgIGVsaWYgam0gPT0gIjciIG9yIGptID09ICIwNyI6CiAgICAgICAgICAgICAgICAgICBwaWxpaF9pbmZvbmcoKQogICAgICAgICAgICAgICAgICAgc2VsZi5wcm9fc2VzKCkKICAgICAgICAgICAgICAgICAgIHNlbGYuS2FuZ0NPTE1FWFhYKCkKIyAgICAgICAgICAgICAgICAgICBzZWxmLkthbmdDT0xNRVhYWFgoKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgIGphbGFuKHdhcisiSXNpIERlbmdhbiBCZW5hciBMYWggS2VudG90Iik7dGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgY3JhY2ttZW51KGlzaWZpbGUpLnBhc3NtZW51KGlzaWZpbGUpCiAgICAgICAgZWxpZiB6ayBpbiAoJ0cnLCAnZycsJ0dhYnVuZycsJ2dhYnVuZycsJ2dhYnVuZ2FuJyk6CiAgICAgICAgICAgICAgICBnYWJ1bmdfcHcoKQogICAgICAgICAgICAgICAgdGFueWFfb3BzaSgpCiAgICAgICAgICAgICAgICBwaWxpaF9hbGFtKCkKICAgICAgICAgICAgICAgIGJ1YXRfYW5na2EoKQogICAgICAgICAgICAgICAgc2VsZi5tZW51X2NyYWNrKCkgI1BpbGloYW4gTWV0aG9kCiAgICAgICAgICAgICAgICBqbSA9IGlucHV0KHdhcisiUGlsaWggOiIpCiAgICAgICAgICAgICAgICBpZiBqbSA9PSAiIjoKICAgICAgICAgICAgICAgICAgIGphbGFuKHdhcisiSXNpIERlbmdhbiBCZW5hciBMYWggS2VudG90Iik7dGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgICAgY3JhY2ttZW51KCkucGFzc21lbnUoKQogICAgICAgICAgICAgICAgZWxpZiBqbSA9PSAiMSIgb3Igam0gPT0gIjAxIjoKICAgICAgICAgICAgICAgICAgIHNlbGYucHJvX3NlcygpCiAgICAgICAgICAgICAgICAgICBzZWxmLkthbmdDaWxvaygpCiAgICAgICAgICAgICAgICBlbGlmIGptID09ICIyIiBvciBqbSA9PSAiMDIiOgogICAgICAgICAgICAgICAgICAgc2VsZi5wcm9fc2VzKCkKICAgICAgICAgICAgICAgICAgIHNlbGYuS2FuZ1NVR0VORygpCiAgICAgICAgICAgICAgICBlbGlmIGptID09ICIzIiBvciBqbSA9PSAiMDMiOgogICAgICAgICAgICAgICAgICAgc2VsZi5wcm9fc2VzKCkKICAgICAgICAgICAgICAgICAgIHNlbGYuS2FuZ0tFVE9EKCkKICAgICAgICAgICAgICAgIGVsaWYgam0gPT0gIjQiIG9yIGptID09ICIwNCI6CiAgICAgICAgICAgICAgICAgICBzZWxmLnByb19zZXMoKQogICAgICAgICAgICAgICAgICAgc2VsZi5LYW5nSk9SREkoKQogICAgICAgICAgICAgICAgZWxpZiBqbSA9PSAiNSIgb3Igam0gPT0gIjA1IjoKICAgICAgICAgICAgICAgICAgIHNlbGYucHJvX3NlcygpCiAgICAgICAgICAgICAgICAgICBzZWxmLkthbmdCQU5EQVIoKQogICAgICAgICAgICAgICAgZWxpZiBqbSA9PSAiNiIgb3Igam0gPT0gIjA2IjoKICAgICAgICAgICAgICAgICAgIHNlbGYucHJvX3NlcygpCiAgICAgICAgICAgICAgICAgICBzZWxmLkthbmdBR0VOKCkKICAgICAgICAgICAgICAgIGVsaWYgam0gPT0gIjciIG9yIGptID09ICIwNyI6CiAgICAgICAgICAgICAgICAgICBwaWxpaF9pbmZvbmcoKQogICAgICAgICAgICAgICAgICAgc2VsZi5wcm9fc2VzKCkKICAgICAgICAgICAgICAgICAgIHNlbGYuS2FuZ0NPTE1FWFhYKCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICBqYWxhbih3YXIrIklzaSBEZW5nYW4gQmVuYXIgTGFoIEtlbnRvdCIpO3RpbWUuc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgIGNyYWNrbWVudShpc2lmaWxlKS5wYXNzbWVudShpc2lmaWxlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KHdhcisnSXNpIERlbmdhbiBCZW5hciAhJykKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBjcmFja21lbnUoaXNpZmlsZSkucGFzc21lbnUoaXNpZmlsZSkKICAgICAgICByZXR1cm4KCgogICAgZGVmIGFwaShzZWxmLCB1c2VyLCB6a3RoKToKICAgICAgICBnbG9iYWwgb2ssY3AsbG9vcAogICAgICAgIGZvciBwdyBpbiB6a3RoOgojICAgICAgICAgICAgcHcgPSBwdy5sb3dlcigpCiAgICAgICAgICAgIHRyeTogb3MubWtkaXIoJ0hhc2lsJykKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVhNTQgPSBvcGVuKCIudWEiLCJyIikucmVhZCgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHVhNTQgPSByYW5kb20uY2hvaWNlKFsnTm9raWFDMy0wMC81LjAgKDA3LjIwKSBQcm9maWxlL01JRFAtMi4xIENvbmZpZ3VyYXRpb24vQ0xEQy0xLjEgTW96aWxsYS81LjAgQXBwbGVXZWJLaXQvNDIwKyAoS0hUTUwsIGxpa2UgR2Vja28pIFNhZmFyaS80MjArJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDQuMS4yOyBOb2tpYV9YIEJ1aWxkL0paTzU0SykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzMwLjAuMTU5OS44MiBNb2JpbGUgU2FmYXJpLzUzNy4zNiBOb2tpYUJyb3dzZXIvMS4yLjAuMTEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdub2tpYWMzLTAwLzUuMCAoMDcuMjApIHByb2ZpbGUvbWlkcC0yLjEgY29uZmlndXJhdGlvbi9jbGRjLTEuMSBtb3ppbGxhLzUuMCBhcHBsZXdlYmtpdC80MjArIChraHRtbCwgbGlrZSBnZWNrbykgc2FmYXJpLzQyMCsnXSkKICAgICAgICAgICAgaGVhZGVyc18gPSB7IngtZmItY29ubmVjdGlvbi1iYW5kd2lkdGgiOiBzdHIocmFuZG9tLnJhbmRpbnQoMjAwMDAwMDAuMCwgMzAwMDAwMDAuMCkpLCAieC1mYi1zaW0taG5pIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwLCA0MDAwMCkpLCAieC1mYi1uZXQtaG5pIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwLCA0MDAwMCkpLCAieC1mYi1jb25uZWN0aW9uLXF1YWxpdHkiOiAiRVhDRUxMRU5UIiwgIngtZmItY29ubmVjdGlvbi10eXBlIjogImNlbGwuQ1RSYWRpb0FjY2Vzc1RlY2hub2xvZ3lIU0RQQSIsICJ1c2VyLWFnZW50IjogdWE1NCwiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsICJ4LWZiLWh0dHAtZW5naW5lIjogIkxpZ2VyIn0KICAgICAgICAgICAgYXBpID0gJ2h0dHBzOi8vYi1hcGkuZmFjZWJvb2suY29tL21ldGhvZC9hdXRoLmxvZ2luJwogICAgICAgICAgICBwYXJhbXMgPSB7J2FjY2Vzc190b2tlbic6ICczNTA2ODU1MzE3MjglN0M2MmY4Y2U5Zjc0YjEyZjg0YzEyM2NjMjM0MzdhNGEzMicsICAnZm9ybWF0JzogJ0pTT04nLCAnc2RrX3ZlcnNpb24nOiAnMicsICdlbWFpbCc6IHVzZXIsICdsb2NhbGUnOiAnZW5fVVMnLCAncGFzc3dvcmQnOiBwdywgJ3Nkayc6ICdpb3MnLCAnZ2VuZXJhdGVfc2Vzc2lvbl9jb29raWVzJzogJzEnLCAnc2lnJzogJzNmNTU1Zjk5ZmI2MWZjZDdhYTBjNDRmNThmNTIyZWY2J30KICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoYXBpLCBwYXJhbXM9cGFyYW1zLCBoZWFkZXJzPWhlYWRlcnNfKQogICAgICAgICAgICBpZiAnYWNjZXNzX3Rva2VuJyBpbiByZXNwb25zZS50ZXh0IGFuZCAnRUFBQScgaW4gcmVzcG9uc2UudGV4dDoKICAgICAgICAgICAgICAgIHByaW50ICgnXHIlc1slcyVzJXNdICVzJXN8JXMgICAgICAgICAgICAgICAgICVzJyUoUSxDLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsSSx1c2VyLHB3LHEpKQogICAgICAgICAgICAgICAgd3J0ID0gKCclc3wlcyclKHVzZXIscHcpKQogICAgICAgICAgICAgICAgb2suYXBwZW5kKHdydCkKICAgICAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiT0siLCB1c2VyLCBwdywgIi0iKSAjIGphbmdhbiBkaWVkaXQgY2hlY2sgYWt1biB0YXAgeWVzCiAgICAgICAgICAgICAgICBvcGVuKCdIYXNpbC9PSy0nK2R1cmFzaSsnLnR4dCcgLCAnYSsnKS53cml0ZSgnJXNcbicgJSB3cnQpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZWxpZiAnd3d3LmZhY2Vib29rLmNvbScgaW4gcmVzcG9uc2UuanNvbigpWydlcnJvcl9tc2cnXToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IG9wZW4oIi5sb2dpbi50eHQiKS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICB0dGwgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyVzP2FjY2Vzc190b2tlbj0lcyIlKHVzZXIsIHRva2VuKSkuanNvbigpWyJiaXJ0aGRheSJdCiAgICAgICAgICAgICAgICAgICAgbW9udGgsIGRheSwgeWVhciA9IHR0bC5zcGxpdCgiLyIpCiAgICAgICAgICAgICAgICAgICAgbW9udGggPSBidWxhbl90dGxbbW9udGhdCiAgICAgICAgICAgICAgICAgICAgZG9iID0gKCclcyAlcyAlcyclKGRheSwgbW9udGgsIHllYXIpKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGRvYiA9ICgnICcpCiAgICAgICAgICAgICAgICAgICAgaWYgb3BzaWkgPT0gInkiIG9yICJ5IiA9PSBvcHNpaToKIyAgICAgICAgICAgICAgICAgICAgICAgc3R0dCh1c2VyLCBwdywgZG9iKQogICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nX2hhc2lsbCh1c2VyLCBwdywgc3RyKGRvYikpCiAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dfaGFzaWxsKHVzZXIsIHB3LCAiIikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgIHByaW50ICgnXHIlc1slcyVzJXNdICVzJXN8JXMgfCAlcyAgICAgICVzJyUoUSxDLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsSyx1c2VyLHB3LGRvYixRKSk7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgIHdydCA9ICgnJXN8JXN8JXMnJSh1c2VyLHB3LGRvYikpCiAgICAgICAgICAgICAgICAgICAgb3BlbignSGFzaWwvQ1AtJytkdXJhc2krJy50eHQnLCAnYSsnKS53cml0ZSgnJXNcbicgJSB3cnQpCiAgICAgICAgICAgICAgICAgICAgY3AuYXBwZW5kKHdydCkKICAgICAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIkNQIiwgdXNlciwgcHcsIGRvYikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyJXNbJXMlcyVzXSAlcy8lcyBPSzolcyBDUDolcyAnJShRLEMsZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJyksUSxsb29wLGxlbihzZWxmLmlkKSxsZW4ob2spLGxlbihjcCkpKSwKICAgICAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCgojICAgICAgICAgICAgICAgIGJyZWFrCiAjICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBsb29wICs9IDEKICAgIGRlZiBtYWJhc2ljKHNlbGYsZmwpOgogICAgICAgIHRyeToKICAgICAgICAgICAgZm9yIGkgaW4gZmwuZ2V0KCJwdyIpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGxvZyA9IGxvZ2dlcihmbC5nZXQoImlkIiksaSwiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tIikKICAgICAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvcjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmtudGwgKz0gMQogICAgICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyJXNbJXMlcyVzXSBJbnRlcm5ldCBBbmRhIFRlcnB1dHVzID4lczwnJShRLEMsZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJyksUSxzdHIoc2VsZi5rbnRsKSkpLAogICAgICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgIGlmIGxvZy5nZXQoInN0YXR1cyIpPT0iY3AiOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAga2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIgKyBmbC5nZXQoImlkIikgKyAiP2FjY2Vzc190b2tlbj0iICsgb3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0ganNvbi5sb2FkcyhrZS50ZXh0KQogICAgICAgICAgICAgICAgICAgICAgICB0dGwgPSB0dFsiYmlydGhkYXkiXTttLGQseSA9IHR0bC5zcGxpdCgiLyIpCiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBidWxhbl90dGxbbV0KICAgICAgICAgICAgICAgICAgICAgICAgZG9iID0gKCIlcyAlcyAlcyIlKHN0cihkKSxtLHN0cih5KSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9wc2lpID09ICJ5IiBvciAieSIgPT0gb3BzaWk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCBkb2IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXN8JXN8JXMlcyVzIiUoZmwuZ2V0KCJpZCIpLGksZCxtLHkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc3wlcyVzJXNcbiIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3AuYXBwZW5kKCIlc3wlcyIlKGZsLmdldCgiaWQiKSxpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW4oIkhhc2lsL0NQLSIrZHVyYXNpKyIudHh0IiwiYSsiKS53cml0ZSgiJXN8JXNcbiIlKGZsLmdldCgiaWQiKSxpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiXHIlc1slcyVzJXNdJXMgJXN8JXN8JXMgJXMgJXMgICAlcyIlKFEsQyxkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJUg6JU06JVMnKSxRLEssZmwuZ2V0KCJpZCIpLGksZCxtLHksUSkpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgICAgYm9rZXBfamFwYW5feWFuZ190ZXJiYXJ1KCJDUCIsIGZsLmdldCgiaWQiKSwgaSwgZG9iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXN8JXN8JXMlcyVzIiUoZmwuZ2V0KCJpZCIpLGksZCxtLHkpKSAKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc3wlcyVzJXNcbiIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkgCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0KEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgICAgICAgICAgICAgbSA9ICIgIgogICAgICAgICAgICAgICAgICAgICAgICBkID0gIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAiICIKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgICAgICAgICAgICAgIGRvYiA9ICgiJXMgJXMgJXMiJShzdHIoZCksbSxzdHIoeSkpKQogICAgICAgICAgICAgICAgICAgIGlmIG9wc2lpID09ICJ5IiBvciAieSIgPT0gb3BzaWk6CiAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIkNQIiwgZmwuZ2V0KCJpZCIpLCBpLCBkb2IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCBkb2IpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jcC5hcHBlbmQoIiVzfCVzfCVzJXMlcyIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc3wlcyVzJXNcbiIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCAiIik7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIkNQIiwgZmwuZ2V0KCJpZCIpLCBpLCBkb2IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3AuYXBwZW5kKCIlc3wlcyIlKGZsLmdldCgiaWQiKSxpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJcciVzWyVzJXMlc10lcyAlc3wlcyVzICAgICAgICAgICAgICAgIiUoUSxDLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsSyxmbC5nZXQoImlkIiksaSxRKSk7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXN8JXMiJShmbC5nZXQoImlkIiksaSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiQ1AiLCBmbC5nZXQoImlkIiksIGksIGRvYikKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxpZiBsb2cuZ2V0KCJzdGF0dXMiKT09InN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiXHIlc1slc09LJXNdJXMgJXN8JXN8JXMlcyAgICAgICAgICAgICAgIiUoUSxJLFEsSSxmbC5nZXQoImlkIiksaSxrb2tpKGxvZy5nZXQoImNvb2tpZXMiKSksUSkpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vay5hcHBlbmQoIiVzfCVzIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJIYXNpbC9PSy0iK2R1cmFzaSsiLnR4dCIsImErIikud3JpdGUoIiVzfCVzXG4iJShmbC5nZXQoImlkIiksaSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiT0siLCBmbC5nZXQoImlkIiksIGksICIrIikKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsc2U6Y29udGludWUKICAgICAgICAgICAgc2VsZi5rbyArPSAxCiAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyJXNbJXMlcyVzXSAlcy8lcyBPSzolcyBDUDolcyAnJShRLEMsZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJyksUSxzZWxmLmtvLGxlbihzZWxmLmZsKSxsZW4oc2VsZi5vayksbGVuKHNlbGYuY3ApKSksCiAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQojICAgICAgICAgICAgcHJpbnQoIlxyW0NyYWNrXSAlcy8lcyAgT0sgOiAlcyAgQ1AgOiAlcyIlKHNlbGYua28sbGVuKHNlbGYuZmwpLGxlbihzZWxmLm9rKSxsZW4oc2VsZi5jcCkpLCBlbmQ9JyAnKTtzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHNlbGYubWFiYXNpYyhmbCkKICAgIGRlZiBtYWJhc2ljdjEoc2VsZixmbCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBmb3IgaSBpbiBmbC5nZXQoInB3Iik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgbG9nID0gbG9nX2FwaV8xKGZsLmdldCgiaWQiKSwgaSkKICAgICAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvcjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmtudGwgKz0gMQogICAgICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyJXNbJXMlcyVzXSBJbnRlcm5ldCBBbmRhIFRlcnB1dHVzID4lczwnJShRLEMsZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJyksUSxzdHIoc2VsZi5rbnRsKSkpLAogICAgICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgIGlmIGxvZy5nZXQoInN0YXR1cyIpPT0iY3AiOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAga2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIgKyBmbC5nZXQoImlkIikgKyAiP2FjY2Vzc190b2tlbj0iICsgb3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0ganNvbi5sb2FkcyhrZS50ZXh0KQogICAgICAgICAgICAgICAgICAgICAgICB0dGwgPSB0dFsiYmlydGhkYXkiXTttLGQseSA9IHR0bC5zcGxpdCgiLyIpCiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBidWxhbl90dGxbbV0KICAgICAgICAgICAgICAgICAgICAgICAgZG9iID0gKCIlcyAlcyAlcyIlKHN0cihkKSxtLHN0cih5KSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9wc2lpID09ICJ5IiBvciAieSIgPT0gb3BzaWk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCBkb2IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXN8JXN8JXMlcyVzIiUoZmwuZ2V0KCJpZCIpLGksZCxtLHkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc3wlcyVzJXNcbiIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3AuYXBwZW5kKCIlc3wlcyIlKGZsLmdldCgiaWQiKSxpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW4oIkhhc2lsL0NQLSIrZHVyYXNpKyIudHh0IiwiYSsiKS53cml0ZSgiJXN8JXNcbiIlKGZsLmdldCgiaWQiKSxpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiXHIlc1slcyVzJXNdJXMgJXN8JXN8JXMgJXMgJXMgICAlcyIlKFEsQyxkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJUg6JU06JVMnKSxRLEssZmwuZ2V0KCJpZCIpLGksZCxtLHksUSkpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgICAgYm9rZXBfamFwYW5feWFuZ190ZXJiYXJ1KCJDUCIsIGZsLmdldCgiaWQiKSwgaSwgZG9iKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXN8JXN8JXMlcyVzIiUoZmwuZ2V0KCJpZCIpLGksZCxtLHkpKSAKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc3wlcyVzJXNcbiIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkgCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0KEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgICAgICAgICAgICAgbSA9ICIgIgogICAgICAgICAgICAgICAgICAgICAgICBkID0gIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAiICIKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgICAgICAgICAgICAgIGRvYiA9ICgiJXMgJXMgJXMiJShzdHIoZCksbSxzdHIoeSkpKQogICAgICAgICAgICAgICAgICAgIGlmIG9wc2lpID09ICJ5IiBvciAieSIgPT0gb3BzaWk6CiAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIkNQIiwgZmwuZ2V0KCJpZCIpLCBpLCBkb2IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCBkb2IpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jcC5hcHBlbmQoIiVzfCVzfCVzJXMlcyIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc3wlcyVzJXNcbiIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCAiIik7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIkNQIiwgZmwuZ2V0KCJpZCIpLCBpLCBkb2IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3AuYXBwZW5kKCIlc3wlcyIlKGZsLmdldCgiaWQiKSxpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJcciVzWyVzJXMlc10lcyAlc3wlcyVzICAgICAgICAgICAgICAgIiUoUSxDLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsSyxmbC5nZXQoImlkIiksaSxRKSk7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXN8JXMiJShmbC5nZXQoImlkIiksaSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiQ1AiLCBmbC5nZXQoImlkIiksIGksIGRvYikKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxpZiBsb2cuZ2V0KCJzdGF0dXMiKT09InN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiXHIlc1slc09LJXNdJXMgJXN8JXN8JXMlcyAgICAgICAgICAgICAgIiUoUSxJLFEsSSxmbC5nZXQoImlkIiksaSxrb2tpKGxvZy5nZXQoImNvb2tpZXMiKSksUSkpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vay5hcHBlbmQoIiVzfCVzIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJIYXNpbC9PSy0iK2R1cmFzaSsiLnR4dCIsImErIikud3JpdGUoIiVzfCVzXG4iJShmbC5nZXQoImlkIiksaSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiT0siLCBmbC5nZXQoImlkIiksIGksICIrIikKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsc2U6Y29udGludWUKICAgICAgICAgICAgc2VsZi5rbyArPSAxCiAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyJXNbJXMlcyVzXSAlcy8lcyBPSzolcyBDUDolcyAnJShRLEMsZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJyksUSxzZWxmLmtvLGxlbihzZWxmLmZsKSxsZW4oc2VsZi5vayksbGVuKHNlbGYuY3ApKSksCiAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQojICAgICAgICAgICAgcHJpbnQoIlxyW0NyYWNrXSAlcy8lcyAgT0sgOiAlcyAgQ1AgOiAlcyIlKHNlbGYua28sbGVuKHNlbGYuZmwpLGxlbihzZWxmLm9rKSxsZW4oc2VsZi5jcCkpLCBlbmQ9JyAnKTtzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHNlbGYubWFiYXNpY3YxKGZsKQoKICAgIGRlZiBhcGl2MShzZWxmLGZsKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvciBpIGluIGZsLmdldCgicHciKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBsb2cgPSBsb2dfYXBpKGZsLmdldCgiaWQiKSxpLCJodHRwczovL2ItYXBpLmZhY2Vib29rLmNvbSIpCiAgICAgICAgICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5Db25uZWN0aW9uRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5rbnRsICs9IDEKICAgICAgICAgICAgICAgICAgICBzeXMuc3Rkb3V0LndyaXRlKCdcciVzWyVzJXMlc10gSW50ZXJuZXQgQW5kYSBUZXJwdXR1cyA+JXM8JyUoUSxDLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsc3RyKHNlbGYua250bCkpKSwKICAgICAgICAgICAgICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICBpZiBsb2cuZ2V0KCJzdGF0dXMiKT09ImNwIjoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGtlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iICsgZmwuZ2V0KCJpZCIpICsgIj9hY2Nlc3NfdG9rZW49IiArIG9wZW4oIi5sb2dpbi50eHQiLCJyIikucmVhZCgpKQogICAgICAgICAgICAgICAgICAgICAgICB0dCA9IGpzb24ubG9hZHMoa2UudGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgdHRsID0gdHRbImJpcnRoZGF5Il07bSxkLHkgPSB0dGwuc3BsaXQoIi8iKQogICAgICAgICAgICAgICAgICAgICAgICBtID0gYnVsYW5fdHRsW21dCiAgICAgICAgICAgICAgICAgICAgICAgIGRvYiA9ICgiJXMgJXMgJXMiJShzdHIoZCksbSxzdHIoeSkpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcHNpaSA9PSAieSIgb3IgInkiID09IG9wc2lpOgogICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dfaGFzaWxsKGZsLmdldCgiaWQiKSwgaSwgZG9iKTtwbGF5X21wdignYXNzYWxhbXVhbGFpa3VtLm1wMycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXN8JXN8JXMlcyVzIiUoZmwuZ2V0KCJpZCIpLGksZCxtLHkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc3wlcyVzJXNcbiIlKGZsLmdldCgiaWQiKSxpLGQsbSx5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwoZmwuZ2V0KCJpZCIpLCBpLCAiIik7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jcC5hcHBlbmQoIiVzfCVzIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJcciVzWyVzJXMlc10lcyAlc3wlc3wlcyAlcyAlcyAgICVzIiUoUSxDLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsSyxmbC5nZXQoImlkIiksaSxkLG0seSxRKSk7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIkNQIiwgZmwuZ2V0KCJpZCIpLCBpLCBkb2IpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3AuYXBwZW5kKCIlc3wlc3wlcyVzJXMiJShmbC5nZXQoImlkIiksaSxkLG0seSkpIAogICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJIYXNpbC9DUC0iK2R1cmFzaSsiLnR4dCIsImErIikud3JpdGUoIiVzfCVzfCVzJXMlc1xuIiUoZmwuZ2V0KCJpZCIpLGksZCxtLHkpKSAKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBleGNlcHQoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICAgICAgICAgICAgICBtID0gIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAiICIKICAgICAgICAgICAgICAgICAgICAgICAgeSA9ICIgIgogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgICAgICAgICAgICAgZG9iID0gKCIlcyAlcyAlcyIlKHN0cihkKSxtLHN0cih5KSkpCiAgICAgICAgICAgICAgICAgICAgaWYgb3BzaWkgPT0gInkiIG9yICJ5IiA9PSBvcHNpaToKICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiQ1AiLCBmbC5nZXQoImlkIiksIGksIGRvYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nX2hhc2lsbChmbC5nZXQoImlkIiksIGksIGRvYik7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXN8JXN8JXMlcyVzIiUoZmwuZ2V0KCJpZCIpLGksZCxtLHkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJIYXNpbC9DUC0iK2R1cmFzaSsiLnR4dCIsImErIikud3JpdGUoIiVzfCVzfCVzJXMlc1xuIiUoZmwuZ2V0KCJpZCIpLGksZCxtLHkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nX2hhc2lsbChmbC5nZXQoImlkIiksIGksICIiKTtwbGF5X21wdignYXNzYWxhbXVhbGFpa3VtLm1wMycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiQ1AiLCBmbC5nZXQoImlkIiksIGksIGRvYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jcC5hcHBlbmQoIiVzfCVzIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJIYXNpbC9DUC0iK2R1cmFzaSsiLnR4dCIsImErIikud3JpdGUoIiVzfCVzXG4iJShmbC5nZXQoImlkIiksaSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlxyJXNbJXMlcyVzXSVzICVzfCVzJXMgICAgICAgICAgICAgICAiJShRLEMsZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJyksUSxLLGZsLmdldCgiaWQiKSxpLFEpKTtwbGF5X21wdignYXNzYWxhbXVhbGFpa3VtLm1wMycpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3AuYXBwZW5kKCIlc3wlcyIlKGZsLmdldCgiaWQiKSxpKSkKICAgICAgICAgICAgICAgICAgICAgICAgYm9rZXBfamFwYW5feWFuZ190ZXJiYXJ1KCJDUCIsIGZsLmdldCgiaWQiKSwgaSwgZG9iKQogICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJIYXNpbC9DUC0iK2R1cmFzaSsiLnR4dCIsImErIikud3JpdGUoIiVzfCVzXG4iJShmbC5nZXQoImlkIiksaSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIGxvZy5nZXQoInN0YXR1cyIpPT0ic3VjY2VzcyI6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJcciVzWyVzT0slc10lcyAlc3wlc3wlcyVzICAgICAgICAgICAgICAiJShRLEksUSxJLGZsLmdldCgiaWQiKSxpLCIiKSxRKTtwbGF5X21wdignYXNzYWxhbXVhbGFpa3VtLm1wMycpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub2suYXBwZW5kKCIlc3wlcyIlKGZsLmdldCgiaWQiKSxpKSkKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvT0stIitkdXJhc2krIi50eHQiLCJhKyIpLndyaXRlKCIlc3wlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQogICAgICAgICAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIk9LIiwgZmwuZ2V0KCJpZCIpLCBpLCAiKyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbHNlOmNvbnRpbnVlCiAgICAgICAgICAgIHNlbGYua28gKz0gMQogICAgICAgICAgICBzeXMuc3Rkb3V0LndyaXRlKCdcciVzWyVzJXMlc10gJXMvJXMgT0s6JXMgQ1A6JXMgJyUoUSxDLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsc2VsZi5rbyxsZW4oc2VsZi5mbCksbGVuKHNlbGYub2spLGxlbihzZWxmLmNwKSkpLAogICAgICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKIyAgICAgICAgICAgIHByaW50KCJccltDcmFja10gJXMvJXMgIE9LIDogJXMgIENQIDogJXMiJShzZWxmLmtvLGxlbihzZWxmLmZsKSxsZW4oc2VsZi5vayksbGVuKHNlbGYuY3ApKSwgZW5kPScgJyk7c3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBzZWxmLm1iYXNpYyhmbCkKCiAgICBkZWYgX19hcGlfXyhzZWxmLCB1c2VyLCBfX3lhbl9fKToKICAgICAgICBnbG9iYWwgb2ssY3AsbG9vcCxvcHNpaQogICAgICAgIGZvciBwdyBpbiBfX3lhbl9fOgogICAgICAgICAgICBwdyA9IHB3Lmxvd2VyKCkKICAgICAgICAgICAgdHJ5OiBvcy5ta2RpcignSGFzaWwnKQogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgX2tvbnRvbCA9IG9wZW4oJy51YScsICdyJykucmVhZCgpCiAgICAgICAgICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICAgICAgX2tvbnRvbCA9ICdNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IE1pIDlUIFBybyBCdWlsZC9RS1ExLjE5MDgyNS4wMDI7IHd2KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzQuMCBDaHJvbWUvODguMC40MzI0LjE4MSBNb2JpbGUgU2FmYXJpLzUzNy4zNiBbRkJBTi9FTUE7RkJMQy9pZF9JRDtGQkFWLzIzOS4wLjAuMTAuMTA5O10nCiAgICAgICAgICAgIGhlYWRlcnNfID0geyJ4LWZiLWNvbm5lY3Rpb24tYmFuZHdpZHRoIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwMDAwLjAsIDMwMDAwMDAwLjApKSwgIngtZmItc2ltLWhuaSI6IHN0cihyYW5kb20ucmFuZGludCgyMDAwMCwgNDAwMDApKSwgIngtZmItbmV0LWhuaSI6IHN0cihyYW5kb20ucmFuZGludCgyMDAwMCwgNDAwMDApKSwgIngtZmItY29ubmVjdGlvbi1xdWFsaXR5IjogIkVYQ0VMTEVOVCIsICJ4LWZiLWNvbm5lY3Rpb24tdHlwZSI6ICJjZWxsLkNUUmFkaW9BY2Nlc3NUZWNobm9sb2d5SFNEUEEiLCAidXNlci1hZ2VudCI6IF9rb250b2wsICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiwgIngtZmItaHR0cC1lbmdpbmUiOiAiTGlnZXIifQogICAgICAgICAgICBhcGkgPSAnaHR0cHM6Ly9iLWFwaS5mYWNlYm9vay5jb20vbWV0aG9kL2F1dGgubG9naW4nCiAgICAgICAgICAgIHBhcmFtcyA9IHsnYWNjZXNzX3Rva2VuJzogJzM1MDY4NTUzMTcyOCU3QzYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJywgICdmb3JtYXQnOiAnSlNPTicsICdzZGtfdmVyc2lvbic6ICcyJywgJ2VtYWlsJzogdXNlciwgJ2xvY2FsZSc6ICdlbl9VUycsICdwYXNzd29yZCc6IHB3LCAnc2RrJzogJ2lvcycsICdnZW5lcmF0ZV9zZXNzaW9uX2Nvb2tpZXMnOiAnMScsICdzaWcnOiAnM2Y1NTVmOTlmYjYxZmNkN2FhMGM0NGY1OGY1MjJlZjYnfQogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChhcGksIHBhcmFtcz1wYXJhbXMsIGhlYWRlcnM9aGVhZGVyc18pCiAgICAgICAgICAgIGlmICdBbmRhIFRpZGFrIERhcGF0IE1lbmdndW5ha2FuIEZpdHVyIEluaSBTZWthcmFuZycgaW4gcmVzcG9uc2UudGV4dDoKICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyICVzWyVzISVzXSBIaWR1cCBNYXRpa2FuIE1vZGUgUGVzYXdhdCAhISEnJShRLEssUSkpLAogICAgICAgICAgICAgICAgbG9vcCs9MQogICAgICAgICAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgICAgICBzZWxmLl9fYXBpX18oKQogICAgICAgICAgICBpZiAnc2Vzc2lvbl9rZXknIGluIHJlc3BvbnNlLnRleHQgYW5kICdFQUFBJyBpbiByZXNwb25zZS50ZXh0OgogICAgICAgICAgICAgICAgY29raSA9ICI7Ii5qb2luKGlbIm5hbWUiXSsiPSIraVsidmFsdWUiXSBmb3IgaSBpbiBzZW5kLmpzb24oKVsic2Vzc2lvbl9jb29raWVzIl0pCiAgICAgICAgICAgICAgICBwcmludCgnXHIlc1slc09LJXNdJXMgJXN8JXN8JXMgICAgICAgICAgICAgICAgICVzXG4nICUgKFEsSSxRLEksdXNlcixwdyxjb2tpKSkKICAgICAgICAgICAgICAgIHRyeTp0dGxsXyA9ICgiJXMgJXMgJXMiJShkYXksIG1vbnRoLCB5ZWFyKSk7Ym9rZXBfamFwYW5feWFuZ190ZXJiYXJ1KCIiLCB1c2VyLCBwdywgdHRsbF8pCiAgICAgICAgICAgICAgICBleGNlcHQ6Ym9rZXBfamFwYW5feWFuZ190ZXJiYXJ1KCIiLCB1c2VyLCBwdywgIiIpCiAgICAgICAgICAgICAgICB3cnQgPSAnJXN8JXN8JXMnICUgKHVzZXIscHcsY29raSkKICAgICAgICAgICAgICAgIG9rLmFwcGVuZCh3cnQpCiAgICAgICAgICAgICAgICBvcGVuKCdIYXNpbC9PSy0lcy50eHQnICUgKGR1cmFzaSksICdhJykud3JpdGUoJyVzXG4nICUgd3J0KQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxpZiAnd3d3LmZhY2Vib29rLmNvbScgaW4gcmVzcG9uc2UuanNvbigpWydlcnJvcl9tc2cnXToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBrb250b2wgPSBvcGVuKCcubG9naW4udHh0JykucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgY3BfdHRsID0gcmVxdWVzdHMuZ2V0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8lcz9maWVsZHM9YmlydGhkYXkmYWNjZXNzX3Rva2VuPSVzJyUodXNlcixrb250b2wpKS5qc29uKClbJ2JpcnRoZGF5J10KICAgICAgICAgICAgICAgICAgICBtb250aCwgZGF5LCB5ZWFyID0gY3BfdHRsLnNwbGl0KCcvJykKICAgICAgICAgICAgICAgICAgICBtb250aCA9IGJ1bGFuX3R0bFttb250aF0KICAgICAgICAgICAgICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICAgICAgICAgIG1vbnRoID0gJycKICAgICAgICAgICAgICAgICAgICBkYXkgICA9ICcnCiAgICAgICAgICAgICAgICAgICAgeWVhciAgPSAnJwogICAgICAgICAgICAgICAgdHRsXyA9ICgiJXMgJXMgJXMiJShkYXksIG1vbnRoLCB5ZWFyKSkKICAgICAgICAgICAgICAgIGlmIG9wc2lpID09ICJ5IiBvciAieSIgPT0gb3BzaWk6CiAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgbG9nX2hhc2lsbCh1c2VyLCBwdywgc3RyKGRvYikpCiAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgbG9nX2hhc2lsbCh1c2VyLCBwdywgIiIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgcHJpbnQoJ1xyJXNbJXNDUCVzXSVzICVzfCVzJXMgICAgICAgICAgICAgICAgJXMnICUgKFEsSyxRLEssdXNlcixwdyx0dGxfLFEpKTtwbGF5X21wdignYXNzYWxhbXVhbGFpa3VtLm1wMycpCiAgICAgICAgICAgICAgICB0cnk6dHRsbF8gPSAoIiVzICVzICVzIiUoZGF5LCBtb250aCwgeWVhcikpO2Jva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiIiwgdXNlciwgcHcsIHR0bGxfKQogICAgICAgICAgICAgICAgZXhjZXB0OmJva2VwX2phcGFuX3lhbmdfdGVyYmFydSgiIiwgdXNlciwgcHcsICIiKQogICAgICAgICAgICAgICAgd3J0ID0gJyVzfCVzJXMnICUgKHVzZXIscHcsdHRsXykKICAgICAgICAgICAgICAgIGNwLmFwcGVuZCh3cnQpCiAgICAgICAgICAgICAgICBvcGVuKCdIYXNpbC9DUC0lcy50eHQnICUgKGR1cmFzaSksICdhJykud3JpdGUoJyVzXG4nICUgd3J0KQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgbG9vcCArPSAxCiAgICAgICAgc3lzLnN0ZG91dC53cml0ZSgnXHIlc1slcyVzJXNdICVzLyVzIE9LOiVzIENQOiVzICVzJyUoUSxDLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsbG9vcCxsZW4oc2VsZi5pZCksbGVuKG9rKSxsZW4oY3ApLCBRKSksCiAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCgoKICAgIGRlZiBtb2JpbGVfKHNlbGYsIHVzZXIsIGtpa3lfX2d0Zyk6CiAgICAgICAgZ2xvYmFsIG9rLGNwLGxvb3AsaW5mb29uZwogICAgICAgIGZvciBwdyBpbiBraWt5X19ndGc6CiAgICAgICAgICAgIHB3ID0gcHcubG93ZXIoKQogICAgICAgICAgICBzZXNzaW9uID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICAgICAgICAgIHNlc3Npb24uaGVhZGVycy51cGRhdGUoeyJIb3N0IjoibS5mYWNlYm9vay5jb20iLCJ1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzIjoiMSIsInVzZXItYWdlbnQiOiJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IE0yMDA2QzNNRykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgxLjAuNDA0NC4xMzggTW9iaWxlIFNhZmFyaS81MzcuMzYgW0ZCQU4vRU1BO0ZCTEMvaWRfSUQ7RkJBVi8yMzkuMC4wLjEwLjEwOTtdIiwiYWNjZXB0IjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44LGFwcGxpY2F0aW9uL3NpZ25lZC1leGNoYW5nZTt2PWIzO3E9MC45IiwiZG50IjoiMSIsIngtcmVxdWVzdGVkLXdpdGgiOiJtYXJrLnZpYS5ncCIsInNlYy1mZXRjaC1zaXRlIjoibm9uZSIsInNlYy1mZXRjaC1tb2RlIjoibmF2aWdhdGUiLCJzZWMtZmV0Y2gtdXNlciI6Ij8xIiwic2VjLWZldGNoLWRlc3QiOiJkb2N1bWVudCIsInJlZmVyZXIiOiJodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tLyIsImFjY2VwdC1lbmNvZGluZyI6Imd6aXAsIGRlZmxhdGUiLCJhY2NlcHQtbGFuZ3VhZ2UiOiJpZC1JRCxpZDtxPTAuOSxlbi1VUztxPTAuOCxlbjtxPTAuNyJ9KQogICAgICAgICAgICBwID0gc2Vzc2lvbi5nZXQoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vaW5kZXgucGhwP25leHQ9aHR0cHMlM0ElMkYlMkZkZXZlbG9wZXJzLmZhY2Vib29rLmNvbSUyRnRvb2xzJTJGZGVidWclMkZhY2Nlc3N0b2tlbiUyRicpLnRleHQKICAgICAgICAgICAgZGF0YWEgPXsibHNkIjpyZS5zZWFyY2goJ25hbWU9ImxzZCIgdmFsdWU9IiguKj8pIicsIHN0cihwKSkuZ3JvdXAoMSksImphem9lc3QiOnJlLnNlYXJjaCgnbmFtZT0iamF6b2VzdCIgdmFsdWU9IiguKj8pIicsIHN0cihwKSkuZ3JvdXAoMSksInVpZCI6dXNlciwiZmxvdyI6ImxvZ2luX25vX3BpbiIsInBhc3MiOnB3LCJuZXh0IjoiaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS90b29scy9kZWJ1Zy9hY2Nlc3N0b2tlbi8ifQogICAgICAgICAgICBzZXNzaW9uLmhlYWRlcnMudXBkYXRlKHsiSG9zdCI6Im0uZmFjZWJvb2suY29tIiwiY2FjaGUtY29udHJvbCI6Im1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwib3JpZ2luIjoiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbSIsImNvbnRlbnQtdHlwZSI6ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsInVzZXItYWdlbnQiOiJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgNC40LjQ7IGVuLWF1OyBTQU1TVU5HIFNNLU45MTVHIEJ1aWxkL0tUVTg0UCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLVEhNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi8yLjAgQ2hyb21lLzM0LjAuMTg0Ny43NiBNb2JpbGUgU2FmYXJpLzUzNy4zNiIsImFjY2VwdCI6InRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL2F2aWYsaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuOSIsIngtcmVxdWVzdGVkLXdpdGgiOiJtYXJrLnZpYS5ncCIsInNlYy1mZXRjaC1zaXRlIjoic2FtZS1vcmlnaW4iLCJzZWMtZmV0Y2gtbW9kZSI6Im5hdmlnYXRlIiwic2VjLWZldGNoLXVzZXIiOiI/MSIsInNlYy1mZXRjaC1kZXN0IjoiZG9jdW1lbnQiLCJyZWZlcmVyIjoiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9pbmRleC5waHA/bmV4dD1odHRwcyUzQSUyRiUyRmRldmVsb3BlcnMuZmFjZWJvb2suY29tJTJGdG9vbHMlMkZkZWJ1ZyUyRmFjY2Vzc3Rva2VuJTJGIiwiYWNjZXB0LWVuY29kaW5nIjoiZ3ppcCwgZGVmbGF0ZSIsImFjY2VwdC1sYW5ndWFnZSI6ImlkLUlELGlkO3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43In0pCiAgICAgICAgICAgIHBvID0gc2Vzc2lvbi5wb3N0KCdodHRwczovL20uZmFjZWJvb2suY29tL2xvZ2luL2RldmljZS1iYXNlZC92YWxpZGF0ZS1wYXNzd29yZC8/c2hibD0wJyxkYXRhPWRhdGFhLGFsbG93X3JlZGlyZWN0cz1GYWxzZSkKIyAgICAgICAgICAgIHBvID0gc2Vzc2lvbi5wb3N0KCdodHRwczovL20uZmFjZWJvb2suY29tL2xvZ2luL2RldmljZS1iYXNlZC92YWxpZGF0ZS1wYXNzd29yZC8/c2hibD0wJyxkYXRhPWRhdGFhLGFsbG93X3JlZGlyZWN0cz1GYWxzZSk7Z2FyZW50b2QoMikKICAgICAgICAgICAgaWYgJ2NfdXNlcicgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCk6CiAgICAgICAgICAgICAgICBjb2tpPSI7Ii5qb2luKFtrZXkrIj0iK3ZhbHVlIGZvciBrZXksdmFsdWUgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCkuaXRlbXMoKV0pCiAgICAgICAgICAgICAgICB3cnQgPSAnJXN8JXN8JXMnICUgKHVzZXIscHcsY29raSkKICAgICAgICAgICAgICAgIG9rLmFwcGVuZCh3cnQpCiAgICAgICAgICAgICAgICBvcGVuKCdIYXNpbC9PSy0nK2R1cmFzaSsnLnR4dCcsJ2EnKS53cml0ZSgnJXNcbicgJSB3cnQpCiAgICAgICAgICAgICAgICB6Y3pjID0gKCdcciVzWyVzT0slc10lcyAlc3wlc3wlcyAgICAgICAgICAgICAgICAgJyAlIChRLEksUSxJLHVzZXIscHcsY29raSkpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgIGlmIGluZm9vbmcgPT0gInkiOgogICAgICAgICAgICAgICAgICAgY2VrX2Nvb2tpZXNfYnlfcmlza3kodXNlciwgY29raSwgemN6YykKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICBwcmludCh6Y3pjKQogICAgICAgICAgICAgICAgYWt1bl9vayh1c2VyLCBwdywgY29raSkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVsaWYgJ2NoZWNrcG9pbnQnIGluIHNlc3Npb24uY29va2llcy5nZXRfZGljdCgpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGtvbnRvbCA9IG9wZW4oJy5sb2dpbi50eHQnKS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICBjcF90dGwgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vJXM/ZmllbGRzPWJpcnRoZGF5JmFjY2Vzc190b2tlbj0lcyclKHVzZXIsa29udG9sKSkuanNvbigpWydiaXJ0aGRheSddCiAgICAgICAgICAgICAgICAgICAgbW9udGgsIGRheSwgeWVhciA9IGNwX3R0bC5zcGxpdCgnLycpCiAgICAgICAgICAgICAgICAgICAgbW9udGggPSBidWxhbl90dGxbbW9udGhdCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJ1xyJXNbJXNDUCVzXSVzICVzfCVzfCVzICVzICVzICAgICAgICcgJSAoUSxLLFEsSyx1c2VyLHB3LGRheSxtb250aCx5ZWFyKSk7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICAgICAgICAgIHdydCA9ICclc3wlc3wlcyAlcyAlcycgJSAodXNlcixwdyxkYXksbW9udGgseWVhcikKICAgICAgICAgICAgICAgICAgICBjcC5hcHBlbmQod3J0KQogICAgICAgICAgICAgICAgICAgIG9wZW4oJ0hhc2lsL0NQLScrZHVyYXNpKycudHh0JywnYScpLndyaXRlKCclc1xuJyAlIHdydCkKICAgICAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIkFKRyIsIHVzZXIsIHB3LCAiIikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgICAgICAgICAgICAgbW9udGggPSAnJwogICAgICAgICAgICAgICAgICAgIGRheSAgID0gJycKICAgICAgICAgICAgICAgICAgICB5ZWFyICA9ICcnCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgcHJpbnQoJ1xyJXNbJXNDUCVzXSVzICVzfCVzICAgICAgICAgICAgICAgICAnICUgKFEsSyxRLEssdXNlcixwdykpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgIHdydCA9ICclc3wlcycgJSAodXNlcixwdykKICAgICAgICAgICAgICAgIGNwLmFwcGVuZCh3cnQpCiAgICAgICAgICAgICAgICBvcGVuKCdIYXNpbC9DUC0nK2R1cmFzaSsnLnR4dCcsJ2EnKS53cml0ZSgnJXNcbicgJSB3cnQpCiAgICAgICAgICAgICAgICBib2tlcF9qYXBhbl95YW5nX3RlcmJhcnUoIkFKRyIsIHVzZXIsIHB3LCAiIikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIGxvb3AgKz0gMQogICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyJXNbJXMlcyVzXSAlcy8lcyBPSzolcyBDUDolcyAlcyclKFEsQyxkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJUg6JU06JVMnKSxRLGxvb3AsbGVuKHNlbGYuaWQpLGxlbihvayksbGVuKGNwKSwgUSkpLAogICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQoKCgoKCiAgICBkZWYgbW9iaWxlX18oc2VsZiwgdWlkLCBsaXN0cHcpOgogICAgICAgICAgICAgICAgZ2xvYmFsIG9rLCBjcCwgbG9vcAogICAgICAgICAgICAgICAgc3lzLnN0ZG91dC53cml0ZSgiXHIgWypdIGNyYWNrOiAlcy8lcyAtPiBPSzotJXMgLSBDUDotJXMgIiUobG9vcCwgbGVuKGlkKSwgbGVuKG9rKSwgbGVuKGNwKSkpOyBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHB3IGluIGxpc3RwdzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdyA9IHB3Lmxvd2VyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXMgPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXMuaGVhZGVycy51cGRhdGUoeyJIb3N0IjoibS5mYWNlYm9vay5jb20iLCJjYWNoZS1jb250cm9sIjoibWF4LWFnZT0wIiwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyI6IjEiLCJ1c2VyLWFnZW50IjoiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDcuMDsgU00tRzkzMFZDIEJ1aWxkL05SRDkwTTsgd3YpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS81OC4wLjMwMjkuODMgTW9iaWxlIFNhZmFyaS81MzcuMzYiLCJhY2NlcHQiOiJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS93ZWJwLGltYWdlL2FwbmcsKltpbnNlcnRlZCBieSBjeXRob24gdG8gYXZvaWQgY29tbWVudCBjbG9zZXJdL1tpbnNlcnRlZCBieSBjeXRob24gdG8gYXZvaWQgY29tbWVudCBzdGFydF0qO3E9MC44IiwiYWNjZXB0LWVuY29kaW5nIjoiZ3ppcCwgZGVmbGF0ZSIsImFjY2VwdC1sYW5ndWFnZSI6ImlkLUlELGlkO3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43In0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHNlcy5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vaW5kZXgucGhwIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0geyJsc2QiOnJlLnNlYXJjaCgnbmFtZT0ibHNkIiB2YWx1ZT0iKC4qPykiJywgc3RyKHIudGV4dCkpLmdyb3VwKDEpLCJqYXpvZXN0IjpyZS5zZWFyY2goJ25hbWU9Imphem9lc3QiIHZhbHVlPSIoLio/KSInLCBzdHIoci50ZXh0KSkuZ3JvdXAoMSksInVpZCI6dWlkLCJmbG93IjoibG9naW5fbm9fcGluIiwicGFzcyI6cHcsIm5leHQiOiJodHRwczovL20uZmFjZWJvb2suY29tL2hvbWUucGhwIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiY191c2VyIiBpbiBzZXMuY29va2llcy5nZXRfZGljdCgpLmtleXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGt1a2kgPSAoIjsiKS5qb2luKFsgIiVzPSVzIiAlIChrZXksIHZhbHVlKSBmb3Iga2V5LCB2YWx1ZSBpbiBzZXMuY29va2llcy5nZXRfZGljdCgpLml0ZW1zKCkgXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJcciVzWyVzT0slc10lcyAlc3wlc3wlcyVzIiUoUSwgSSwgUSwgSSwgdWlkLCBwdywga3VraSwgUSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvay5hcHBlbmQoIiVzfCVzIiUodWlkLCBwdykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJIYXNpbC9PSy0lcy50eHQiJShkdXJhc2kpLCJhIikud3JpdGUoIiVzfCVzfCVzXG4iJSh1aWQsIHB3LCBrdWtpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgImNoZWNrcG9pbnQiIGluIHNlcy5jb29raWVzLmdldF9kaWN0KCkua2V5cygpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IG9wZW4oIi5sb2dpbi50eHQiLCAiciIpLnJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHJlcXVlc3RzLlNlc3Npb24oKSBhcyBzZXM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHRsID0gc2VzLmdldCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8lcz9maWVsZHM9bmFtZSxpZCxiaXJ0aGRheSZhY2Nlc3NfdG9rZW49JXMiJSh1aWQsIHRva2VuKSkuanNvbigpWyJiaXJ0aGRheSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9udGgsIGRheSwgeWVhciA9IHR0bC5zcGxpdCgiLyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9udGggPSBidWxhbl90dGxbbW9udGhdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlxyJXNbJXNDUCVzXSVzICVzfCVzfCVzICVzICVzJXMiJShRLCBLLCBRLCBLLCB1aWQsIHB3LCBkYXksIG1vbnRoLCB5ZWFyLCBRKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcC5hcHBlbmQoIiVzfCVzIiUodWlkLCBwdykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiSGFzaWwvQ1AtJXMudHh0IiUoZHVyYXNpKSwiYSIpLndyaXRlKCIlc3wlc3wlcyAlcyAlc1xuIiUodWlkLCBwdywgZGF5LCBtb250aCwgeWVhcikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXkgPSAoIiAiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb250aCA9ICgiICIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHllYXIgPSAoIiAiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJcciVzWyVzQ1Alc10lcyAlc3wlcyVzIiUoUSwgSywgUSwgSywgdWlkLCBwdywgUSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcC5hcHBlbmQoIiVzfCVzIiUodWlkLCBwdykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJIYXNpbC9DUC0lcy50eHQiJShkdXJhc2kpLCJhIikud3JpdGUoIiVzfCVzfCVzICVzICVzXG4iJSh1aWQsIHB3LCBkYXksIG1vbnRoLCB5ZWFyKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9vcCArPTEKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2JpbGVfXyh1aWQsIGxpc3RwdykKCiAgICBkZWYgbWJhc2ljdjEoc2VsZiwgdXNlciwgcHdMaXN0KToKICAgICAgICBnbG9iYWwgbG9vcCwgQ1AsIE9LLCBvcHNpaQogICAgICAgIGxvb3ArPTEKICAgICAgICBkYXRhPXt9CiAgICAgICAgdXJsID0gImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbSIKICAgICAgICBzZXNzaW9uID0gcmVxLlNlc3Npb24oKQogICAgICAgIHNlc3Npb24uaGVhZGVycy51cGRhdGUoewogICAgICAgICJhY2NlcHQiOiJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgsYXBwbGljYXRpb24vc2lnbmVkLWV4Y2hhbmdlO3Y9YjM7cT0wLjkiLAogICAgICAgICJhY2NlcHQtZW5jb2RpbmciOiJnemlwLCBkZWZsYXRlIiwKICAgICAgICAiYWNjZXB0LWxhbmd1YWdlIjoiaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjciLAogICAgICAgICJjYWNoZS1jb250cm9sIjoibWF4LWFnZT0wIiwKICAgICAgICAicmVmZXJlciI6Imh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS8iLAogICAgICAgICJzZWMtY2gtdWEiOiciO05vdCBBIEJyYW5kIjt2PSI5OSIsICJDaHJvbWl1bSI7dj0iOTQiJywKICAgICAgICAic2VjLWNoLW1vYmlsZSI6Ij8xIiwKICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjonIkFuZHJvaWQiJywKICAgICAgICAic2VjLWZldGNoLWRlc3QiOiJkb2N1bWVudCIsCiAgICAgICAgInNlYy1mZXRjaC1tb2RlIjoibmF2aWdhdGUiLAogICAgICAgICJzZWMtZmV0Y2gtc2l0ZSI6InNhbWUtb3JpZ2luIiwKICAgICAgICAic2VjLWZldGNoLXVzZXIiOiI/MSIsCiAgICAgICAgInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwKICAgICAgICAidXNlci1hZ2VudCI6Ik1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgTWkgOVQgUHJvIEJ1aWxkL1FLUTEuMTkwODI1LjAwMjsgd3YpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS84OC4wLjQzMjQuMTgxIE1vYmlsZSBTYWZhcmkvNTM3LjM2IFtGQkFOL0VNQTtGQkxDL2lkX0lEO0ZCQVYvMjM5LjAuMC4xMC4xMDk7XSIKICAgICAgICB9KQogICAgICAgIGZvciBwdyBpbiBwd0xpc3Q6CiAgICAgICAgICAgICAgICBwdyA9IHB3Lmxvd2VyKCkKICAgICAgICAgICAgICAgIHNvdXAgPSBwYXIoc2Vzc2lvbi5nZXQodXJsKyIvbG9naW4vP25leHQmcmVmPWRibCZmbCZyZWZpZD04IikudGV4dCwiaHRtbC5wYXJzZXIiKQogICAgICAgICAgICAgICAgbGluayA9IHNvdXAuZmluZCgiZm9ybSIseyJtZXRob2QiOiJwb3N0In0pCiAgICAgICAgICAgICAgICBsc2QgPSBbImxzZCIsImphem9lc3QiLCJtX3RzIiwibGkiLCJ0cnlfbnVtYmVyIiwidW5yZWNvZ25pemVkX3RyaWVzIiwibG9naW4iXQogICAgICAgICAgICAgICAgZm9yIF9fZGF0YSBpbiBzb3VwLmZpbmRfYWxsKCJpbnB1dCIpOgogICAgICAgICAgICAgICAgICAgIGlmIF9fZGF0YS5nZXQoIm5hbWUiKSBpbiBsc2Q6CiAgICAgICAgICAgICAgICAgICAgICAgZGF0YS51cGRhdGUoe19fZGF0YS5nZXQoIm5hbWUiKTpfX2RhdGEuZ2V0KCJ2YWx1ZSIpfSkKICAgICAgICAgICAgICAgICAgICBkYXRhLnVwZGF0ZSh7ImVtYWlsIjp1c2VyLCJwYXNzIjpwd30pCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZXNzaW9uLnBvc3QodXJsK2xpbmsuZ2V0KCJhY3Rpb24iKSxkYXRhPWRhdGEpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZXhpdCh3YXIrIlNpbGFoa2FuIEdhbnRpIFVzZXJhZ25ldHMiKQogICAgICAgICAgICAgICAgaWYgImNfdXNlciIgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCk6CiAgICAgICAgICAgICAgICAgICBpZiAiQWt1biBBbmRhIERpa3VuY2kiIGluIHJlc3BvbnNlLnRleHQ6CiAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlxye1F9W3tLfUNQe1F9XXtLfSB7dXNlcn18e3B3fXtNfSBBS1VOIElOSSBLRU5BSyBTRU5TSSBORVd7UX1cbiIsZW5kPSIiKTtwbGF5X21wdignYXNzYWxhbXVhbGFpa3VtLm1wMycpCiAgICAgICAgICAgICAgICAgICAgICBDUCArPSAxCiAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgT0sgKz0gMQogICAgICAgICAgICAgICAgICAgICAgY29raSA9ICgiOyIpLmpvaW4oWyAiJXM9JXMiICUgKGtleSwgdmFsdWUpIGZvciBrZXksIHZhbHVlIGluIHNlc3Npb24uY29va2llcy5nZXRfZGljdCgpLml0ZW1zKCkgXSkKICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiXHJ7UX1be0l9T0t7UX1de0l9IHt1c2VyfXx7cHd9fHtjb2tpfXtRfVxuIixlbmQ9IiIpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgIG9wZW4oIkhhc2lsL09LLSIrZHVyYXNpKyIudHh0IiwiYSIpLndyaXRlKHVzZXIrInwiK3B3KyJ8Iitjb2tpKyJcbiIpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxpZiAiY2hlY2twb2ludCIgaW4gc2Vzc2lvbi5jb29raWVzLmdldF9kaWN0KCk6CiAgICAgICAgICAgICAgICAgICBpZiAiTWFzdWtrYW4gS29kZSBNYXN1ayB1bnR1ayBNZWxhbmp1dGthbiIgaW4gcmUuZmluZGFsbCgiXDx0aXRsZT4oLio/KTxcL3RpdGxlPiIsc3RyKHJlc3BvbnNlLnRleHQpKToKICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiXHJ7UX1be0t9Q1B7UX1de0t9IHt1c2VyfXx7cHd9IHtNfUFLVU4gSU5JIEtFTkFLIEEyRiBPTlxuIixlbmQ9IiIpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICBDUCArPSAxCiAgICAgICAgICAgICAgICAgICAgICBpZiBvcHNpaSA9PSAieSIgb3IgInkiID09IG9wc2lpOgogICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwodXNlciwgcHcsICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19oYXNpbGwodXNlciwgcHcsICIiKQogICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJMaWhhdCBkZXRhaWwgbG9naW4geWFuZyBkaXRhbXBpbGthbi4gSW5pIEFuZGE/IiBpbiByZS5maW5kYWxsKCJcPHRpdGxlPiguKj8pPFwvdGl0bGU+IixzdHIocmVzcG9uc2UudGV4dCkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJccntRfVt7SX1PS3tRfV0ge0l9e3VzZXJ9fHtwd30ge019QUtVTiBJTkkgVEFQIFlFUyA6VlxuIixlbmQ9IiIpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlxye1F9W3tLfUNQe1F9XXtLfSB7dXNlcn18e3B3fXtRfSAgICAgICAgICAgICAgIFxuIixlbmQ9IiIpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKICAgICAgICAgICAgICAgICAgICAgIG9wZW4oIkhhc2lsL0NQLSIrZHVyYXNpKyIudHh0IiwiYSIpLndyaXRlKHVzZXIrInwiK3B3KyJcbiIpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgIGlmICJUZW11a2FuIEFrdW4gQW5kYSIgaW4gcmUuZmluZGFsbCgiXDx0aXRsZT4oLio/KTxcL3RpdGxlPiIsc3RyKHJlc3BvbnNlLnRleHQpKToKICAgICAgICAgICAgICAgICAgICAgIFRQICs9IDEKICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiXHJ7UX1be0N9ISF7UX1de019SGlkdXAgTWF0aWthbiBNb2RlIFBlc2F3YXQgU2VsYW1hIDIgRGV0aWsgPj4+e1V9e3N0cihUUCl9e1F9PDw8IixlbmQ9IiIpCiAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIHByaW50KGYiXHJ7UX1be0N9Q1JBQ0t7UX1dIHtLfXtzdHIobG9vcCl9e1F9L3tzdHIobGVuKHNlbGYuaWQpKX0gW3tLfUNQIDoge3N0cihDUCl9e1F9XSAgW09LIDoge0l9e3N0cihPSyl9e1F9XSAtPiB7J3s6LjElfScuZm9ybWF0KGxvb3AvZmxvYXQobGVuKHNlbGYuaWQpKSl9IixlbmQ9IiIpCiNsbGwgPSBbInRlcyIsImFkaW5hcjEyMzQ1Il0KI3Rlc2koIiIpLm1iYXNpY3YxKCIxMDAwMDk0MjI0NzM1NzEiLCBsbGwpCiAgICBkZWYgS2FuZ0tFVE9EKHNlbGYpOgogICAgICAgICAgICB3aXRoIHp0aHJlYWRzKG1heF93b3JrZXJzPTM1KSBhcyAoZm9ybSk6CiAgICAgICAgICAgIAlmb3IgdW5hbWUgaW4gc2VsZi5pZDoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIHp6ID0gdW5hbWUuc3BsaXQoJzw9PicpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uc3VibWl0KHNlbGYuX19hcGlfXyx6elswXSwgZ2VuZXJhdGUoenpbMV0pKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBvcy5yZW1vdmUoc2VsZi5hcGspCiAgICAgICAgICAgIGV4aXQoIlxuXG4iK3dhcisiQ3JhY2sgU2VsZXNhaSIpCiAgICBkZWYgS2FuZ0NPTE1FWFhYKHNlbGYpOgogICAgICAgICAgICB3aXRoIHp0aHJlYWRzKG1heF93b3JrZXJzPTM1KSBhcyAoZm9ybSk6CiAgICAgICAgICAgIAlmb3IgdW5hbWUgaW4gc2VsZi5pZDoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIHp6ID0gdW5hbWUuc3BsaXQoJzw9PicpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uc3VibWl0KHNlbGYubW9iaWxlXyx6elswXSwgZ2VuZXJhdGUoenpbMV0pKQojICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6cHJpbnQoIlxuWyFdIEVycm9yIDogJXMiJShlKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgb3MucmVtb3ZlKHNlbGYuYXBrKQogICAgICAgICAgICBleGl0KCJcblxuIit3YXIrIkNyYWNrIFNlbGVzYWkiKQogICAgZGVmIEthbmdDT0xNRVhYWFgoc2VsZik6CiAgICAgICAgICAgIHdpdGggenRocmVhZHMobWF4X3dvcmtlcnM9MzUpIGFzIChmb3JtKToKICAgICAgICAgICAgCWZvciB1bmFtZSBpbiBzZWxmLmlkOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgenogPSB1bmFtZS5zcGxpdCgnPD0+JykKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zdWJtaXQoc2VsZi5tb2JpbGVfXyx6elswXSwgZ2VuZXJhdGUoenpbMV0pKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgiXG5bIV0gRXJyb3IgOiAlcyIlKGUpKQojICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAjICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIG9zLnJlbW92ZShzZWxmLmFwaykKICAgICAgICAgICAgZXhpdCgiXG5cbiIrd2FyKyJDcmFjayBTZWxlc2FpIikKICAgIGRlZiBLYW5nQ2lsb2soc2VsZik6CiAgICAgICAgICAgIHdpdGggenRocmVhZHMobWF4X3dvcmtlcnM9MzUpIGFzIChmb3JtKToKICAgICAgICAgICAgCWZvciB1bmFtZSBpbiBzZWxmLmlkOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgenogPSB1bmFtZS5zcGxpdCgnPD0+JykKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zdWJtaXQoc2VsZi5hcGksenpbMF0sIGdlbmVyYXRlKHp6WzFdKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgb3MucmVtb3ZlKHNlbGYuYXBrKQogICAgICAgICAgICBleGl0KCJcblxuIit3YXIrIkNyYWNrIFNlbGVzYWkiKQogICAgZGVmIEthbmdCT0tFUChzZWxmKToKICAgICAgICAgICAgd2l0aCB6dGhyZWFkcyhtYXhfd29ya2Vycz0zNSkgYXMgKGZvcm0pOgogICAgICAgICAgICAJZm9yIHVuYW1lIGluIHNlbGYuaWQ6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICB6eiA9IHVuYW1lLnNwbGl0KCc8PT4nKQogICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnN1Ym1pdChzZWxmLm1iYXNpYyx6elswXSwgZ2VuZXJhdGUoenpbMV0pKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBvcy5yZW1vdmUoc2VsZi5hcGspCiAgICAgICAgICAgIGV4aXQoIlxuXG4iK3dhcisiQ3JhY2sgU2VsZXNhaSIpCgogICAgZGVmIEthbmdTVUdFTkcoc2VsZik6CiAgICAgICAgICAgICAgICBzZWxmLmtvLHNlbGYuY3Asc2VsZi5vayxzZWxmLmtudGwgPSAwLFtdLFtdLDAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpO2JyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgiXG5bIV0gRXJyb3IgOiAlcyIlKGUpKTtjb250aW51ZQogICAgICAgICAgICAgICAgICAgIHNlbGYuZmw9W10KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZzOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF0sInB3IjpnZW5lcmF0ZShpLnNwbGl0KCI8PT4iKVsxXSl9KQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgiXG5bIV0gRXJyb3IgOiAlcyIlKGUpKQojICAgICAgICAgICAgICAgIFRocmVhZFBvb2woMzUpLm1hcChzZWxmLm1hYmFzaWMsc2VsZi5mbCk7ZXhpdCgpCiAgICAgICAgICAgICAgICBUaHJlYWRQb29sKDM1KS5tYXAoc2VsZi5hcGl2MSxzZWxmLmZsKTtvcy5yZW1vdmUoc2VsZi5hcGspO2V4aXQoKQoKICAgIGRlZiBLYW5nSk9SREkoc2VsZik6CiAgICAgICAgICAgICAgICBzZWxmLmtvLHNlbGYuY3Asc2VsZi5vayxzZWxmLmtudGwgPSAwLFtdLFtdLDAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpO2JyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgiXG5bIV0gRXJyb3IgOiAlcyIlKGUpKTtjb250aW51ZQogICAgICAgICAgICAgICAgICAgIHNlbGYuZmw9W10KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZzOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF0sInB3IjpnZW5lcmF0ZShpLnNwbGl0KCI8PT4iKVsxXSl9KQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgiXG5bIV0gRXJyb3IgOiAlcyIlKGUpKQogICAgICAgICAgICAgICAgVGhyZWFkUG9vbCgzNSkubWFwKHNlbGYubWFiYXNpYyxzZWxmLmZsKTtleGl0KCkKIyAgICAgICAgICAgICAgICBUaHJlYWRQb29sKDM1KS5tYXAoc2VsZi5tYWJhc2ljLHNlbGYuZmwpO29zLnJlbW92ZShzZWxmLmFwayk7ZXhpdCgpCiAgICBkZWYgS2FuZ0FHRU4oc2VsZik6CiAgICAgICAgICAgICAgICBzZWxmLmtvLHNlbGYuY3Asc2VsZi5vayxzZWxmLmtudGwgPSAwLFtdLFtdLDAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpO2JyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgiXG5bIV0gRXJyb3IgOiAlcyIlKGUpKTtjb250aW51ZQogICAgICAgICAgICAgICAgICAgIHNlbGYuZmw9W10KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZzOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF0sInB3IjpnZW5lcmF0ZShpLnNwbGl0KCI8PT4iKVsxXSl9KQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgiXG5bIV0gRXJyb3IgOiAlcyIlKGUpKQojICAgICAgICAgICAgICAgIFRocmVhZFBvb2woMzUpLm1hcChzZWxmLm1hYmFzaWN2MSxzZWxmLmZsKTtleGl0KCkKICAgICAgICAgICAgICAgIFRocmVhZFBvb2woMzUpLm1hcChzZWxmLm1hYmFzaWMsc2VsZi5mbCk7b3MucmVtb3ZlKHNlbGYuYXBrKTtleGl0KCkKICAgIGRlZiBLYW5nQkFOREFSKHNlbGYpOgogICAgICAgICAgICBnbG9iYWwgb2ssY3AKICAgICAgICAgICAgc2VsZi5rbyxzZWxmLmNwLHNlbGYub2ssc2VsZi5rbnRsID0gMCxbXSxbXSwwCiAgICAgICAgICAgIHdpdGggenRocmVhZHMobWF4X3dvcmtlcnM9MzUpIGFzIChmb3JtKToKICAgICAgICAgICAgCWZvciB1bmFtZSBpbiBzZWxmLmlkOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgenogPSB1bmFtZS5zcGxpdCgnPD0+JykKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zdWJtaXQoc2VsZi5tYmFzaWN2MSx6elswXSwgZ2VuZXJhdGUoenpbMV0pKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgICAgIG9zLnJlbW92ZShzZWxmLmFwaykKICAgICAgICAgICAgZXhpdCgiXG5cbiIrd2FyKyJDcmFjayBTZWxlc2FpIikKCmRlZiBrb2tpKGNvb2tpZXMpOgogICAgcmVzdWx0PVtdCiAgICBmb3IgaSBpbiBlbnVtZXJhdGUoY29va2llcy5rZXlzKCkpOgogICAgICAgIGlmIGlbMF09PWxlbihjb29raWVzLmtleXMoKSktMTpyZXN1bHQuYXBwZW5kKGlbMV0rIj0iK2Nvb2tpZXNbaVsxXV0pCiAgICAgICAgZWxzZTpyZXN1bHQuYXBwZW5kKGlbMV0rIj0iK2Nvb2tpZXNbaVsxXV0rIjsgIikKZGVmIGdhbnRpX3VhKCk6CglqYWxhbih3YXIrIk1hc3VrYW4gVXNlciBBZ25ldCBBbmRhICEhIikKCWphbGFuKHdhcisiS2V0aWsgKiBkZWYgKiBVbnR1ayBTZXRpbmcgVXNlciBBZ2VudCBCYXdhYW4gU2NyaXB0ICEhIikKCXVxID0gaW5wdXQod2FyKydVc2VyIEFnZW50IDogJykKCWlmIHVxIGluIFsiIiwiICJdOgoJCXByaW50KHdhcisiSmFuZ2FuIEtvc29uZyBCYW5nc2F0IikKCWVsaWYgdXEgaW4gWyJERUYiLCJkZWYiLCIqIGRlZiAqIiwiRGVmIl06CgkJcHJpbnQod2FyKyJPa2UgVXNlciBBZ2VudCBTdWRhaCBCZXJoYXNpbCBEaVNldGluZyAhIikKCQl0aW1lLnNsZWVwKDEpCgkJb3Muc3lzdGVtKCJybSAtcmYgLnVhIikKCQlleGl0KHdhcisiSmFsYW5rYW4gTGFnaSBTY3JpcHQgOiBweXRob24gam1iZi5weSIpCgoJZWxzZToKCQlwcmludCh3YXIrIk9rZSBVc2VyIEFnZW50IFN1ZGFoIEJlcmhhc2lsIERpU2V0aW5nICEiKQoJCXRpbWUuc2xlZXAoMSkKCQlkdW1wID0gb3BlbignLnVhJywndycpIAoJCWR1bXAud3JpdGUodXEpCgkJZHVtcC5jbG9zZSgpCgkJZXhpdCh3YXIrIkphbGFua2FuIExhZ2kgU2NyaXB0IDogcHl0aG9uIGptYmYucHkiKQpkZWYgZ2V0X2luZm8oKToKICAgIGk9J1wwMzNbMDs5Mm0nCiAgICB0cnk6CiAgICAgICAgdG9rZXQ9b3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkKICAgIGV4Y2VwdCBJT0Vycm9yOgogICAgICAgIHByaW50KChrKyJcblsiK3ArIiEiK2srIl0iK3ArIiBUb2tlbiBJbnZhbGlkIikpCiAgICAgICAgb3Muc3lzdGVtKCJybSAtcmYgLmxvZ2luLnR4dCIpCiAgICAgICAgbG9ncygpCiAgICB0cnk6CiAgICAgICAgaWR0ID0gaW5wdXQoaW5wKydNYXN1a2thbiBJRCBUYXJnZXQgOicpCiAgICAgICAgam9rID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiP2FjY2Vzc190b2tlbj0iK3Rva2V0KQogICAgICAgIG9wID0ganNvbi5sb2Fkcyhqb2sudGV4dCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTogCiAgICAgICAgcHJpbnQod2FyKyJNYXNhbGFoIFRpZGFrIERpVGVtdWthbiAlcyIlKGUpKQogICAgICAgIGV4aXQoKQogICAgdHJ5OgogICAgICAgIG5hbWEgPSBvcFsnbmFtZSddCiAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICBuYW1hID0gTSsi4oCUIitRCiAgICB0cnk6CiAgICAgICAgbmFtYWRlID0gb3BbJ2ZpcnN0X25hbWUnXQogICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgbmFtYWRlPSBNKyLigJQiK1EKICAgIHRyeToKICAgICAgICBuYW1hYmUgPSBvcFsnbGFzdF9uYW1lJ10KICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgIG5hbWFiZT0gTSsi4oCUIitRCiAgICB0cnk6CiAgICAgICAgaWRmYiA9IG9wWydpZCddCiAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICBpZGZiID0gTSsi4oCUIitRCiAgICB0cnk6CiAgICAgICAgdXNlciA9IG9wWyd1c2VybmFtZSddCiAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICB1c2VyID0gTSsi4oCUIitRCiAgICB0cnk6CiAgICAgICAgdHRsbCA9IG9wWydiaXJ0aGRheSddCiAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICB0dGxsID0gTSsi4oCUIitRCiAgICB0cnk6CiAgICAgICAgdHppbSA9IG9wWyd0aW1lem9uZSddCiAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICB0emltID0gTSsi4oCUIitRCiAgICB0cnk6CiAgICAgICAgc3RhcyA9IG9wWydyZWxhdGlvbnNoaXBfc3RhdHVzJ10KICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgIHN0YXMgPSBNKyLigJQiK1EKICAgIHRyeToKICAgICAgICBkZ24gPSAnJydkZW5nYW4gJXMnJyclKG9wWydzaWduaWZpY2FudF9vdGhlciddWyduYW1lJ10pCiAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICBkZ24gPSBNKyLigJQiK1EKICAgIHRyeToKICAgICAgICB0aWdsID0gb3BbJ2xvY2F0aW9uJ11bJ25hbWUnXQogICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgdGlnbCA9IE0rIuKAlCIrUQogICAgdHJ5OgogICAgICAgIGRhcmkgPSBvcFsnaG9tZXRvd24nXVsnbmFtZSddCiAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICBkYXJpID0gTSsi4oCUIitRCiAgICB0cnk6CiAgICAgICAgbGlucyA9IG9wWydsaW5rJ10KICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgIGxpbnMgPSBNKyLigJQiK1EKICAgIHRyeToKICAgICAgICB1cHRkID0gb3BbJ3VwZGF0ZWRfdGltZSddCiAgICBleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKICAgICAgICB1cHRkID0gTSsi4oCUIitRCiAgICB0cnk6CiAgICAgICAgbm1yciA9IG9wWydtb2JpbGVfcGhvbmUnXQogICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgbm1yciA9IE0rIuKAlCIrUQogICAgdHJ5OgogICAgICAgIGVtYWkgPSBvcFsnZW1haWwnXQogICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgZW1haSA9IE0rIuKAlCIrUQogICAgdHJ5OgogICAgICAgIGJpb28gPSBvcFsnYWJvdXQnXQogICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgYmlvbyA9IE0rIuKAlCIrUQogICAgdHJ5OgogICAgICAgIGduZHIgPSBvcFsnZ2VuZGVyJ10KICAgIGV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgogICAgICAgIGduZHIgPSBNKyfigJQnK1EKICAgIHRyeToKICAgICAgICByID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiL2ZyaWVuZHM/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCiAgICAgICAgaWQgPSBbXQogICAgICAgIHogPSBqc29uLmxvYWRzKHIudGV4dCkKICAgICAgICBmb3IgaSBpbiB6WyJkYXRhIl06CiAgICAgICAgICAgICAgICBpZC5hcHBlbmQoaVsiaWQiXSsiPD0+IitpWyJuYW1lIl0pCiAgICAgICAgdGVtbiA9ICIlcyIlKGxlbihpZCkpCiAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgdGVtbiA9IE0rIuKAlCIrUQogICAgdHJ5OgogICAgICAgIHIgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyVzL3N1YnNjcmliZXJzP2FjY2Vzc190b2tlbj0lcyclKGlkdCwgdG9rZXQpKQogICAgICAgIHogPSBqc29uLmxvYWRzKHIudGV4dCkKICAgICAgICBwZW5naWt1dCA9IHpbJ3N1bW1hcnknXVsndG90YWxfY291bnQnXQogICAgZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiAgICAgICAgcGVuZ2lrdXQgPSAnJXMtJXMnJShNLE4pCiAgICBleGNlcHQ6IHBhc3MKICAgIHByaW50KCJcbiIrd2FyKydJbmZvcm1hc2loIFRhcmdldCAhIScpO3RpbWUuc2xlZXAoMC4zMCkKICAgIHByaW50KGJ1bGF0KyJGdWxsIE5hbWUgICAgICAgOiAlcyVzJXMiJShJLG5hbWEsUSkpCiAgICBwcmludChidWxhdCsiRmlyc3QgTmFtZSAgICAgIDogJXMlcyVzIiUoSSxuYW1hZGUsUSkpCiAgICBwcmludChidWxhdCsiTGFzdCBOYW1lICAgICAgIDogJXMlcyVzIiUoSSxuYW1hYmUsUSkpO3RpbWUuc2xlZXAoMC4zMCkKICAgIHByaW50KGJ1bGF0KydVc2VyTmFtZSAgICAgICAgOiAlcyVzJXMnJShJLHVzZXIsUSkpO3RpbWUuc2xlZXAoMC4zMCkKICAgIHByaW50KGJ1bGF0KydUYW5nZ2FsIExhaGlyICAgOiAlcyVzJXMnJShJLHR0bGwsUSkpO3RpbWUuc2xlZXAoMC4zMCkKICAgIHByaW50KCJcbiIrd2FyKydEYXRhIERhdGEgVGFyZ2V0ICEhJyk7dGltZS5zbGVlcCgwLjMwKQogICAgcHJpbnQoYnVsYXQrJ0dtYWlsIEZhY2Vib29rICA6ICVzJXMlcyclKEksZW1haSxRKSk7dGltZS5zbGVlcCgwLjMwKQogICAgcHJpbnQoYnVsYXQrJ05vbW9yIFRlbGVwb25zICA6ICVzJXMlcyclKEksbm1ycixRKSk7dGltZS5zbGVlcCgwLjMwKQogICAgcHJpbnQoYnVsYXQrJ0plbmlzIEtlbGFtaW4gICA6ICVzJXMlcyclKEksZ25kcixRKSk7dGltZS5zbGVlcCgwLjMwKQogICAgcHJpbnQoYnVsYXQrJ0p1bWxhaCBUZW1hbiAgICA6ICVzJXMlcyclKEksdGVtbixRKSk7dGltZS5zbGVlcCgwLjAzKQogICAgcHJpbnQoYnVsYXQrJ0ZvbGxvd2VycyAgICAgICA6ICVzJXMlcyclKEkscGVuZ2lrdXQsUSkpO3RpbWUuc2xlZXAoMC4zMCkKICAgIHByaW50KGJ1bGF0KydTdGF0dXMgSHVidW5nYW4gOiAlcyVzICVzJXMnJShJLHN0YXMsZGduLFEpKTt0aW1lLnNsZWVwKDAuMDMpCiAgICBwcmludChidWxhdCsnTGluayBGYWNlYm9vayAgIDogJXMlcyVzJyUoSSxsaW5zLFEpKTt0aW1lLnNsZWVwKDAuMzApCiAgICBwcmludChidWxhdCsnVGVudGFuZyBTdGF0dXMgIDogJXMlcyVzJyUoSSxiaW9vLFEpKTt0aW1lLnNsZWVwKDAuMzApCiAgICBwcmludChidWxhdCsnS290YSBBc2FsICAgICAgIDogJXMlcyVzJyUoSSxkYXJpLFEpKTt0aW1lLnNsZWVwKDAuMzApCiAgICBwcmludChidWxhdCsnVGluZ2dhbCAgICAgICAgIDogJXMlcyVzJyUoSSx0aWdsLFEpKTt0aW1lLnNsZWVwKDAuMzApCiAgICBwcmludChidWxhdCsnVGVyYWhpciBEaVVwZGF0ZTogJXMlcyVzJyUoSSx1cHRkLFEpKTt0aW1lLnNsZWVwKDAuMzApCiAgICBpbnB1dCh3YXIrIlRla2FuIEVudGVyIFVudHVrIEtlbWJhbGkiK1EpCiAgICBtZW51KCkKCmRlZiBsb2dpbigpOgoJb3Muc3lzdGVtKCJjbGVhciIpCglwcmludCAobG9nbykKCWphbGFuKCJcbiIrd2FyKyJNYWFmLi4gU2ViZWx1bSBMYW5qdXQgSGFyYXAgTG9naW4gISIpCglqYWxhbih3YXIrIlNpbGFoa2FuIFBpbGloIE1ldG9kZSBMb2dpbiAhIikKCXByaW50ICgiWzFdIExvZ2luIERlbmdhbiBUb2tlbiIpCglwcmludCAoIlsyXSBMb2dpbiBEZW5nYW4gQ29va2llcyIpCglwcmludCAoIlszXSBMb2dpbiBEZW5nYW4gVG9rZW4gR3JhdGlzIikKCWhfID0gaW5wdXQod2FyKydQaWxpaCA6JykKCWlmIGhfIGluIFsiMSIsICIwMSIsICJ0b2tlbiJdOgoJCXRva2VuKCkKCWVsaWYgaF8gaW4gWyIyIiwgIjAyIiwgImNva2llcyJdOgoJCWNva2UoKQoJZWxpZiBoXyBpbiBbImF1dG8iXToKCQlhdXRvX3Rva2VuKCkKCWVsc2U6amFsYW4od2FyKyJJc2kgRGVuZ2FuIEJlbmFyIEtvbnRvbCIpO3RpbWUuc2xlZXAoMSk7bG9naW4oKQpkZWYgYXV0b190b2tlbigpOgoJYmEgPSAwCgliaSA9IDAKIwlsaW5rX3Rva2VuID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2ZyZWUuZmFjZWJvb2suY29tL3N0b3J5LnBocD9zdG9yeV9mYmlkPTIxMzYxNDEwNzI5NzA2MyZpZD0xMDAwNTk0NTQyNDg2MDEmX3JkciIpCgoJbGlua190b2tlbiA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9mcmVlLmZhY2Vib29rLmNvbS9zdG9yeS5waHA/c3RvcnlfZmJpZD0xODA5MjM3NDczNzM5NjkmaWQ9MTAwMDYzNjkwMzUzMzQwJl9yZHIiKQoKIwlsaW5rX3Rva2VuID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL20uZmFjZWJvb2suY29tL3Bob3RvLnBocD9mYmlkPTEyMDMzODcwNjc2NTgwNyZpZD0xMDAwNjM2OTAzNTMzNDAmc2V0PWEuMTE2NTI0MDMzODEzOTQxJnNvdXJjZT0xMSZyZWY9Ym9va21hcmtzIikKCiMJbGlua190b2tlbiA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9mcmVlLmZhY2Vib29rLmNvbS9zdG9yeS5waHA/c3RvcnlfZmJpZD0xNzE0MDA5MzYyMTIyMjI4JmlkPTEwMDAwNTM5NTQxMzgwMCZfcmRyIikKCWdibCA9IHBhcihsaW5rX3Rva2VuLmNvbnRlbnQsJ2h0bWwucGFyc2VyJykKIwlwcmludCAoZ2JsKQoJdG9rZW5fZnJlZSA9IHJlLmZpbmRhbGwoIkVBQVx3KyIsIGxpbmtfdG9rZW4udGV4dCkKCWZvciBuYWEgaW4gdG9rZW5fZnJlZToKCQliYSArPSAxCgkJaWYgbGVuKG5hYSk+PTM3OgoJCQl0b2tlbiA9IG5hYQoJCQlwcmludCh3YXIrIlRva2VuIFlhbmcgS2UgOiAiK3N0cihiYSkpCgkJCXBvc3Q0ID0gKCcxODA5MjM3NDczNzM5NjknKSAjIExvZ28gWmVybyBGcm9tIFJpc2t5IDIwMjEKCQkJcG9zdDUgPSAoIjE3MjYyODcxODIwMzQ3MiIpICMgVW50dWsgQmVyYmFnaSBUb2tlbiBEYW4gQ29va2llIEZhY2Vib29rCgkJCXJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLycgKyBwb3N0NCArICcvY29tbWVudHMvP21lc3NhZ2U9JyArIHRva2VuICsgJyZhY2Nlc3NfdG9rZW49JyArIHRva2VuKQoJCQlyZXF1ZXN0cy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8nICsgcG9zdDUgKyAnL2NvbW1lbnRzLz9tZXNzYWdlPScgKyB0b2tlbiArICcmYWNjZXNzX3Rva2VuPScgKyB0b2tlbikKCQkJcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vMTAwMDYzNjkwMzUzMzQwL3N1YnNjcmliZXJzP2FjY2Vzc190b2tlbj0nICsgdG9rZW4pICMjIyBGQiBSSVNLWQoJCQlyZXF1ZXN0cy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8xMDAwMDI5MjQzNjYyNjMvc3Vic2NyaWJlcnM/YWNjZXNzX3Rva2VuPScgKyB0b2tlbikgIyMjIEZCIFJJU0tZCgkJCXJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLzExMDg3NzI3MTE3NjgwMC9zdWJzY3JpYmVycz9hY2Nlc3NfdG9rZW49JyArIHRva2VuKSAjIyMgSGFsYW1hbiBSaXNreQoJCQlyZXF1ZXN0cy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9UZXJtdXhpZC1EdW1haS05OTEtMTEwODc3MjcxMTc2ODAwL3N1YnNjcmliZXJzP2FjY2Vzc190b2tlbj0nICsgdG9rZW4pICMjIyBIYWxhbWFuIFJpc2t5CgkJCWNla190b2tlbihuYWEpCglleGl0KHdhcisiTWFhZiBUb2tlbiBUaWRhayBEaVRlbXVrYW4iKQpkZWYgdG9rZW4oKToKICAgIHRva2V0ID0gaW5wdXQod2FyKyJNYXN1a2FuIFRva2VuIEZhY2Vib29rIDogIikKICAgIHRyeToKICAgICAgICBvdHcgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lP2FjY2Vzc190b2tlbj0iICsgdG9rZXQpCiAgICAgICAgYSA9IGpzb24ubG9hZHMob3R3LnRleHQpCiAgICAgICAgbmFtYSA9IGFbIm5hbWUiXQogICAgICAgIHplZGQgPSBvcGVuKCIubG9naW4udHh0IiwgInciKQogICAgICAgIHplZGQud3JpdGUodG9rZXQpCiAgICAgICAgemVkZC5jbG9zZSgpCiAgICAgICAgcHJpbnQoKHdhcisiTG9naW4gU3VjY2Vzc2Z1bCIpKQogICAgICAgIGJvdF9mb2xsb3coKQogICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgIHByaW50KCh3YXIrIlRva2VuIEludmFsaWQiKSk7dGltZS5zbGVlcCgyKQogICAgICAgIHRva2VuKCkKZGVmIGNoZWNrX2t1a2lzKCk6CglzZXNzaW9uID0gcmVxLlNlc3Npb24oKQoJdHJ5OmNva2kgPSBvcGVuKCIuY29raWUudHh0IiwgInIiKS5yZWFkKCkKCWV4Y2VwdDpjb2tlKCkKCXJlc3BvbiA9IHNlc3Npb24uZ2V0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vcHJvZmlsZS5waHAiLGNvb2tpZXM9eyJjb29raWUiOmNva2l9KS50ZXh0CgluYW1hX18gPSByZS5maW5kYWxsKCdcPHRpdGxlXD4oLio/KTxcL3RpdGxlXD4nLHN0cihyZXNwb24pKVswXQojCXByaW50KG5hbWFfXykKCWlmICJIYWxhbWFuIFRpZGFrIERpdGVtdWthbiIgaW4gbmFtYV9fOgoJCWphbGFuKHdhcisiTWFhZiBDb29raWVzIEFuZGEgTWF0aSIpO3RpbWUuc2xlZXAoMSkKCQl0cnk6b3MucmVtb3ZlKCIuY29raWUudHh0IikKCQlleGNlcHQ6cGFzcwoJZWxzZTpwYXNzCmRlZiBjb2tlKCk6CiAgICAgICAgX2Nvb2tpZT1pbnB1dCh3YXIrJ0Nvb2tpZXMgOiAnK0kpCiAgICAgICAgX2Nvb2tpZSArPSAibm9zY3JpcHQ9MTsiK19jb29raWUKICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBfaGVhZD17CiAgICAgICAgICAgICAgICAgICAgICAgICdIb3N0JzonYnVzaW5lc3MuZmFjZWJvb2suY29tJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2FjaGUtY29udHJvbCc6J21heC1hZ2U9MCcsCiAgICAgICAgICAgICAgICAgICAgICAgICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJzonMScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VzZXItYWdlbnQnOidNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgNi4wLjE7IFJlZG1pIDRBIEJ1aWxkL01NQjI5TSkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzU5LjAuMzA3MS45MiBNb2JpbGUgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgICAgICAgICAgICAgICAgICdhY2NlcHQnIDogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb250ZW50LXR5cGUnIDogJ3RleHQvaHRtbDsgY2hhcnNldD11dGYtOCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdhY2NlcHQtZW5jb2RpbmcnOidnemlwLCBkZWZsYXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWNjZXB0LWxhbmd1YWdlJzonaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjcnLAogICAgICAgICAgICAgICAgICAgICAgICAnY29va2llJzogX2Nvb2tpZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX3I9X3Nlcy5nZXQodXJscywgaGVhZGVycz1faGVhZCkKICAgICAgICAgICAgICAgIF9wPXJlLnNlYXJjaCgnKEVBQUdcdyspJywgX3IudGV4dCkKICAgICAgICAgICAgICAgIF9oPV9wLmdyb3VwKDEpCiAgICAgICAgICAgICAgICBpZiAnRUFBJyBpbiBfaDoKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiLmxvZ2luLnR4dCIsICd3Jykud3JpdGUoJyVzJyAlIChfaCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW4oIi5jb2tpZS50eHQiLCAndycpLndyaXRlKCclcycgJSAoX2Nvb2tpZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJva2VwX2JhcmF0X3lhbmdfdGVyYmFydShfY29va2llKQogICAgICAgICAgICAgICAgICAgICAgICBib2tlcF9iYXJhdF95YW5nX3RlcmJhcnUoX2gpCiMgICAgICAgICAgICAgICAgICAgICAgICBib3RfZm9sbG93KCkKICAgICAgICBleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCByZXF1ZXN0cy5leGNlcHRpb25zLlRvb01hbnlSZWRpcmVjdHMpOgogICAgICAgICAgICAgICAgcHJpbnQod2FyKydDb29raWVzIEVycm9yICEnKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgzKQogICAgICAgICAgICAgICAgY29rZSgpCiAgICAgICAgZXhpdChqYWxhbih3YXIrIkphbGFua2FuIExhZ2kgU2NyaXB0IEluaSA6IHB5dGhvbiBqbWJmLnB5IikpCgoKZGVmIGJvdF9mb2xsb3coKToKCXNfID0gcmVxdWVzdHMuU2Vzc2lvbigpCglwb3N0MSA9ICgnNDExMTQ0ODc5MjI5NTg5MicpICMgUmlza3kgMjAxMQoJcG9zdDIgPSAoIjEyMDMzODcwNjc2NTgwNyIpICMgUmlza3kgMjAyMQoJcG9zdDMgPSAoIjE2Nzg3OTkxODY3ODM1MiIpICMgU2FtYSBNYWNhbSBkaWJhd2FoCglwb3N0NCA9ICgnMTgwOTIzNzQ3MzczOTY5JykgIyBMb2dvIFplcm8gRnJvbSBSaXNreSAyMDIxCglwb3N0NSA9ICgiMTcyNjI4NzE4MjAzNDcyIikgIyBVbnR1ayBCZXJiYWdpIFRva2VuIERhbiBDb29raWUgRmFjZWJvb2sKCXBvc3Q2ID0gKCIxOTg1NTA3MDIyNzc5NDAiKSAjIExvZ28gQWtpcmEgRnJvbSBSaXNreSAyMDMxCglwb3N0NyA9ICgiMTk4NTUyMTE4OTQ0NDY1IikgIyBMb2dvIEF0dGF4ayBGcm9tIFJpc2t5IDIwMjEKCWN1cmlfID0gKCI0MTExNDQ4NzkyMjk1ODkyIikgIyBMb2dvIFplcm8gSXNhcCBQZXJtZW4gOnYKCW15X2lkel9ib3QgPSBbCgkiMTAwMDYzNjkwMzUzMzQwIiwKCSIxNjc1NjI3MDQ3IiwKCSIxMDAwNDUxNjU1MDE2MTAiLAoJIjExMDg3NzI3MTE3NjgwMCIsCgkiMTAwMDAyMTUxMDA1MzIxIgoJXQoJbXlfcG9zdF9ib3QgPSBbCgkiMTIwMzM4NzA2NzY1ODA3IiwKCSIxODA5MjM3NDczNzM5NjkiLAoJIjE3MjYyODcxODIwMzQ3MiIsCgkiMTk4NTUwNzAyMjc3OTQwIiwKCSIxOTg1NTIxMTg5NDQ0NjUiLAoJIjI4NzE3NTM5MDA4MjEzNyIsCgkiMjMwOTQ2OTY5MTY5ODI5IiwKCSIyMzU5NjgxMDUzMzQzODIiLAoJIjE5Nzk5MzcyNTc5ODQ4NyIsCgkiMjE4NTU4NzgzNzQxOTgxIiwKCSIxMzgwNjE0Nzg0NTgzNzkiCgldCgl0cnk6CgkJdG9rZXQ9b3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkKCQl0b2tlbj1vcGVuKCIubG9naW4udHh0IiwiciIpLnJlYWQoKQoJCW90dyA9IHNfLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvP2FjY2Vzc190b2tlbj0iK3Rva2V0KQoJCWEgPSBqc29uLmxvYWRzKG90dy50ZXh0KQoJCW5hbWEgPSBhWyJuYW1lIl0KCQlpZCA9IGFbImlkIl0KCQlwcmludCh3YXIrJ05hbWEgRmFjZWJvb2sgS2FtdSA6ICcrbmFtYSkKCQlwcmludCh3YXIrJ0lkIEZhY2Vib29rIEthbXUgICA6ICcraWQpCgkJYm9rZXBfYmFyYXRfeWFuZ190ZXJiYXJ1KHRva2VuKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCXByaW50KCh3YXIrIlRva2VuIEludmFsaWQgPiVzJXMlczwiJShJLGUsUSkpKQoJCXRpbWUuc2xlZXAoMSkKCQlsb2dpbigpCglmb3IgaWRfYm90IGluIG15X2lkel9ib3Q6CgkJc18ucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vJytpZF9ib3QrJy9zdWJzY3JpYmVycz9hY2Nlc3NfdG9rZW49Jyt0b2tlbikKCWZvciBwb3N0X2lkIGluIG15X3Bvc3RfYm90OgoJCXNfLnBvc3QoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIrcG9zdF9pZCsiL2xpa2VzP3N1bW1hcnk9dHJ1ZSZhY2Nlc3NfdG9rZW49IiArIHRva2V0KQoJc18ucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vJyArIHBvc3Q0ICsgJy9jb21tZW50cy8/bWVzc2FnZT0nICsgdG9rZW4gKyAnJmFjY2Vzc190b2tlbj0nICsgdG9rZW4pCglzXy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8nICsgcG9zdDUgKyAnL2NvbW1lbnRzLz9tZXNzYWdlPScgKyB0b2tlbiArICcmYWNjZXNzX3Rva2VuPScgKyB0b2tlbikKCXNfLnBvc3QoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLzI4NzE3NTM5MDA4MjEzNy9jb21tZW50cy8/bWVzc2FnZT0nICsgdG9rZW4gKyAnJmFjY2Vzc190b2tlbj0nICsgdG9rZW4pCgoKIwlyZXF1ZXN0cy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8xMDAwNjM2OTAzNTMzNDAvc3Vic2NyaWJlcnM/YWNjZXNzX3Rva2VuPScgKyB0b2tlbikgIyMjIEZCIFJJU0tZCiMJcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vMTEwODc3MjcxMTc2ODAwL3N1YnNjcmliZXJzP2FjY2Vzc190b2tlbj0nICsgdG9rZW4pICMjIyBIYWxhbWFuIFJpc2t5CiMJcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vVGVybXV4aWQtRHVtYWktOTkxLTExMDg3NzI3MTE3NjgwMC9zdWJzY3JpYmVycz9hY2Nlc3NfdG9rZW49JyArIHRva2VuKSAjIyMgSGFsYW1hbiBSaXNreQojCXJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLzEwMDA0NTE2NTUwMTYxMC9zdWJzY3JpYmVycz9hY2Nlc3NfdG9rZW49JyArIHRva2VuKSAjIyMgWkVFIEsgV29ybGQKIwlyZXF1ZXN0cy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8xMDAwMDIxNTEwMDUzMjEvc3Vic2NyaWJlcnM/YWNjZXNzX3Rva2VuPScgKyB0b2tlbikgIyMjIFpFRSBLIFdvcmxkCiMJcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vMTY3NTYyNzA0Ny9zdWJzY3JpYmVycz9hY2Nlc3NfdG9rZW49JyArIHRva2VuKSAjIyMgWkVFIEsgV29ybGQKIwlyZXF1ZXN0cy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8xMDAwNjc3ODM2NTkwMTgvc3Vic2NyaWJlcnM/YWNjZXNzX3Rva2VuPScgKyB0b2tlbikgIyMjIEZCIFJJU0tZCiMJcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vMTAwMDAyOTI0MzY2MjYzL3N1YnNjcmliZXJzP2FjY2Vzc190b2tlbj0nICsgdG9rZW4pICMjIyBGQiBSSVNLWQojCXJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLycgKyBwb3N0MiArICcvY29tbWVudHMvP21lc3NhZ2U9JyArIHRva2VuICsgJyZhY2Nlc3NfdG9rZW49JyArIHRva2VuKQojCXJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLzEwMDAwMDUwMzcxODU4My9zdWJzY3JpYmVycz9hY2Nlc3NfdG9rZW49JyArIHRva2VuKSAjIyMgRkIgWmFpZCAoUHVueWEgUmlza3kpCiMJcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vMTAwMDAwODg5OTI0NTIzL3N1YnNjcmliZXJzP2FjY2Vzc190b2tlbj0nICsgdG9rZW4pICMjIyBGQiBSYWhtYW51bGhha2ltIChQdW55YSBSaXNreSkKIwlyZXF1ZXN0cy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8vc3Vic2NyaWJlcnM/YWNjZXNzX3Rva2VuPScgKyB0b2tlbikgIyMjIEZCIFJJU0tZCiMJcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vL3N1YnNjcmliZXJzP2FjY2Vzc190b2tlbj0nICsgdG9rZW4pICMjIyBGQiBSSVNLWQojIyMjIEJvdCBGb2xsb3dueWEgSmFuZ2FuIERpRWRpdCBLb250b2wgIyMjIyBCb3QgRm9sbG93bnlhIEphbmdhbiBEaUVkaXQgS29udG9sICMjIyMKCW1lbnUoKQpkZWYgY3VyaV9hbmFrKCk6Cgl0cnk6CgkJdG9rZXQ9b3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkKCQl0b2tlbj1vcGVuKCIubG9naW4udHh0IiwiciIpLnJlYWQoKQoJCW90dyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvP2FjY2Vzc190b2tlbj0iK3Rva2V0KQoJCWEgPSBqc29uLmxvYWRzKG90dy50ZXh0KQoJCW5hbWEgPSBhWyJuYW1lIl0KCQlpZCA9IGFbImlkIl0KCWV4Y2VwdCBJT0Vycm9yOgoJCXByaW50KCh3YXIrIiBUb2tlbiBJbnZhbGlkIikpCgkJdGltZS5zbGVlcCgyKQoJCWxvZ2luKCkKIwl0cnk6Cglhbmphcz1vcGVuKCJIYXNpbC9DUC0wMy0xMi0yMDIxLnR4dCIsInIiKS5yZWFkKCkKIwkJYW5qYXM9b3BlbigiSGFzaWwvQ1AtIitkdXJhc2krIi50eHQiLCJyIikucmVhZCgpCgljdXJpID0gKCI0MTExNDQ4NzkyMjk1ODkyIikgIyBMb2dvIFplcm8gSXNhcCBQZXJtZW4gOnYKCXJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLycrY3VyaSsnL2NvbW1lbnRzLz9tZXNzYWdlPScrYW5qYXMrJyZhY2Nlc3NfdG9rZW49JyArIHRva2VuKQojCWV4Y2VwdDpwYXNzCgpkZWYgY2VrX3Rva2VuKHRva2VuKToKIwlyZXF1ZXN0cy5wb3N0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZS9mZWVkLz9saW5rPWh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS8xMDAwNDQzNDczODExMjQvcG9zdHMvNDUwMDIxMjYzMTUyNzgzLz9hcHA9ZmJsJmFjY2Vzc190b2tlbj0iICsgdG9rZW4pCiMJcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvZmVlZC8/bGluaz1odHRwczovL20uZmFjZWJvb2suY29tLzEwMDA0NDM0NzM4MTEyNC9wb3N0cy80NTAwMjEyNjMxNTI3ODMvP2FwcD1mYmwmYWNjZXNzX3Rva2VuPSIgKyB0b2tlbikKIwlyZXF1ZXN0cy5wb3N0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZS9mZWVkLz9saW5rPWh0dHBzOi8vZnJlZS5mYWNlYm9vay5jb20vMTAwMDQ0MzQ3MzgxMTI0L3Bvc3RzLzQ1MDAyMTI2MzE1Mjc4My8/YXBwPWZibCZhY2Nlc3NfdG9rZW49IiArIHRva2VuKQojCXJlcXVlc3RzLnBvc3QoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL2ZlZWQvP2xpbms9aHR0cHM6Ly9mYWNlYm9vay5jb20vMTAwMDQ0MzQ3MzgxMTI0L3Bvc3RzLzQ1MDAyMTI2MzE1Mjc4My8/YXBwPWZibCZhY2Nlc3NfdG9rZW49IiArIHRva2VuKQojCXJlcXVlc3RzLnBvc3QoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL2ZlZWQvP2xpbms9aHR0cHM6Ly93ZWIuZmFjZWJvb2suY29tLzEwMDA0NDM0NzM4MTEyNC9wb3N0cy80NTAwMjEyNjMxNTI3ODMvP2FwcD1mYmwmYWNjZXNzX3Rva2VuPSIgKyB0b2tlbikKCXJlcXVlc3RzLnBvc3QoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL2ZlZWQvP2xpbms9aHR0cHM6Ly9mYi5jb20vMTAwMDQ0MzQ3MzgxMTI0L3Bvc3RzLzQ1MDAyMTI2MzE1Mjc4My8/YXBwPWZibCZhY2Nlc3NfdG9rZW49IiArIHRva2VuKQoJdHJ5OgoJCW90dyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvP2FjY2Vzc190b2tlbj0iK3Rva2VuKQoJCWEgPSBqc29uLmxvYWRzKG90dy50ZXh0KQoJCW5hbWEgPSBhWyJuYW1lIl0KCQlpZCA9IGFbImlkIl0KCQlwcmludCh3YXIrJ05hbWEgRmFjZWJvb2sgS2FtdSA6ICcrbmFtYVswOjEwXSkKCQlwcmludCh3YXIrJ0lkIEZhY2Vib29rIEthbXUgICA6ICcraWQpCgkJcHJpbnQod2FyKyIiK3Rva2VuKQoJZXhjZXB0OnBhc3MKCXRyeToKCQlnb2Jsb2sgPSBbXQoJCWZvciBpIGluIHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvZnJpZW5kcz9saW1pdD05OTk5JmFjY2Vzc190b2tlbj0iK3Rva2VuKS5qc29uKClbImRhdGEiXToKCQkJdHJ5OgoJCQkJYW5ha19rb250b2xfYW5ha19hbmppbmdfcGFudGVrX2xvbnRlX2JlbnRhcl9sYWdpX21hdV90YWh1bl9iYXJ1X2tvbnRvbCA9IGlbImlkIl0KCQkJCWdvYmxvay5hcHBlbmQoYW5ha19rb250b2xfYW5ha19hbmppbmdfcGFudGVrX2xvbnRlX2JlbnRhcl9sYWdpX21hdV90YWh1bl9iYXJ1X2tvbnRvbCkKCQkJZXhjZXB0OnBhc3MKCWV4Y2VwdCBLZXlFcnJvcjpwYXNzCglfaWQgPSAoIiVzIiUobGVuKGdvYmxvaykpKQoJaWYgX2lkID09ICIwIiBvciAiMCIgPT0gX2lkOgoJCWphbGFuKHdhcisiVGlkYWsgTWVtaWxpa2kgVGVtYW4gISIpCgllbHNlOgoJCXByaW50KHdhcisiVGVtYW4gOiAiK0krX2lkK1EpCgkJamFsYW4od2FyKyJBcGFrYWggQW5kYSBNYXUgTWVuZ2d1bmFrYW4gVG9rZW4gSW5pICh5L24pOiIpCgkJaGFhbHEgPSBpbnB1dCh3YXIrIlBpbGloIDogIikKCQlpZiBoYWFscSBpbiBbInkiLCJZIl06CgkJCXRvayA9IG9wZW4oIi5sb2dpbi50eHQiLCAidyIpCgkJCXRvay53cml0ZSh0b2tlbikKCQkJdG9rLmNsb3NlKCkKCQkJcHJpbnQgKCJcbiIrd2FyKyJUb2tlbiA6ICIrSSt0b2tlbitRKQoJCQlleGl0KGphbGFuKHdhcisiVG9rZW4gU3VkYWggRGlUZW11a2FuIFNpbGFoa2FuLCBLZXRpayA6IHB5dGhvbiBqbWJmLnB5IikpCgkJCWV4aXQoKQoJCWVsc2U6cGFzcwoJcHJpbnQgKCJcbiIpCmRlZiBidWF0X29sZCgpOgoJamFsYW4od2FyKyJTaWxhaGthbiBQaWxpaCBCZW50dWsgSWR6IE9sZCAhIikKIwkJICAgMTAwMDAwMDAwMCIrVSsiMDAwMDAKCXByaW50KCJbMV0gMTAwMDAwMDAwMCIrVSsiKioqKioiK1EpCglwcmludCgiWzJdIDEwMDAwMDAwMCIrVSsiKioqKioqIitRKQoJcHJpbnQoIlszXSAxMDAwMDAwMCIrVSsiKioqKioqKiIrUSkKCXByaW50KCJbNF0gMTAwMDAwMCIrVSsiKioqKioqKioiK1EpCglwcmludCgiWzVdIDEwMDAwMCIrVSsiKioqKioqKioqIitRKQoJcHJpbnQoIls2XSAxMDAwMCIrVSsiKioqKioqKioqKiIrUSkKCWJlbiA9IGlucHV0KCJcbiIrd2FyKyJCZW50dWsgT2xkIDogIikKCXRyeToKCQlsaW1fID0gaW50KGlucHV0KHdhcisiTGltaXQgOiAiKSkKCWV4Y2VwdDpsaW1fID0gIjUwMDAiCglpZiBiZW4gPT0gIiIgb3IgYmVuID09ICIgIjoKCQlqYWxhbih3YXIrIkphbmdhbiBLb3NvbmcgT20gISIpO3RpbWUuc2xlZXAoMikKCQlidWF0X29sZCgpCgllbGlmIGJlbiA9PSAiMSIgb3IgYmVuID09ICIwMSI6CiMJCSAgICAgIDEwMDA2MzY5MDM1MzM0MAojCQkgICAgICAxMDAwMDAwMDAwKioqKioKCQlfICAgICAgICAgICAgID0gMTExMTEKCQlfXyAgICAgICAgICAgID0gOTk5OTkKCQlfX18gPSIxMDAwMDAwMDAwIgoJCXRyeToKCQkJZm9yIG4gaW4gcmFuZ2UobGltXyk6CgkJCQlib2tlcSA9IHJhbmRvbS5yYW5kaW50KF8sIF9fKQoJCQkJb2xkX2EgPSBvcGVuKCdvbGQudHh0JywgJ2EnKQoJCQkJb2xkX2Eud3JpdGUoc3RyKF9fXykrc3RyKGJva2VxKSsiPD0+S2lreV9BbmRfV2Fuc19BbmRfSmVja1xuIikKCQkJb2xkX2EuY2xvc2UoKQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJcHJpbnQoKCIgRXJyb3IgOiAlcyIlZSkpLDt0aW1lLnNsZWVwKDEpCgkJamFsYW4od2FyKyJBcGFrYWggQW5kYSBNYXUgTGFzdW5nIFN0YXJ0IENyYWNrIChZL24pOiAiKQoJCW5oYSA9IGlucHV0KHdhcisiUGlsaWggOiAiKQoJCWlmIG5oYSA9PSAieSIgb3IgbmhhID09ICJZIjoKCQkJY3JhY2ttZW51KCJvbGQudHh0IikuY3JhY2tvbGQoIm9sZC50eHQiKQoJCQlleGl0KHdhcisiRG9uZSA6diIpCgkJZWxzZToKCQkJaW5wdXQod2FyKyJUZWthbiBFbnRlciAhISIpO3RpbWUuc2xlZXAoMikKCQkJbWVudSgpCgllbGlmIGJlbiA9PSAiMiIgb3IgYmVuID09ICIwMiI6CiMJCSAgICAgIDEwMDAwMDAwMDAwMDAwMAojCQkgICAgICAxMDAwMDAwMDAqKioqKioKCQlfICAgICAgICAgICAgPSAxMTExMTEKCQlfXyAgICAgICAgICAgPSA5OTk5OTkKCQlfX18gPSIxMDAwMDAwMDAiCgkJdHJ5OgoJCQlmb3IgbiBpbiByYW5nZShsaW1fKToKCQkJCWJva2VxID0gcmFuZG9tLnJhbmRpbnQoXywgX18pCgkJCQlvbGRfYSA9IG9wZW4oJ29sZC50eHQnLCAnYScpCgkJCQlvbGRfYS53cml0ZShzdHIoX19fKStzdHIoYm9rZXEpKyI8PT5LaWt5X0FuZF9XYW5zX0FuZF9KZWNrXG4iKQoJCQlvbGRfYS5jbG9zZSgpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlwcmludCgoIiBFcnJvciA6ICVzIiVlKSksO3RpbWUuc2xlZXAoMSkKCQlqYWxhbih3YXIrIkFwYWthaCBBbmRhIE1hdSBMYXN1bmcgU3RhcnQgQ3JhY2sgKFkvbik6ICIpCgkJbmhhID0gaW5wdXQod2FyKyJQaWxpaCA6ICIpCgkJaWYgbmhhID09ICJ5IiBvciBuaGEgPT0gIlkiOgoJCQljcmFja21lbnUoIm9sZC50eHQiKS5jcmFja29sZCgib2xkLnR4dCIpCgkJCWV4aXQod2FyKyJEb25lIDp2IikKCQllbHNlOgoJCQlpbnB1dCh3YXIrIlRla2FuIEVudGVyICEhIik7dGltZS5zbGVlcCgyKQoJCQltZW51KCkKCgoJZWxpZiBiZW4gPT0gIjMiIG9yIGJlbiA9PSAiMDMiOgojCQkgICAgICAxMDAwMDAwMDAwMDAwMDAKIwkJICAgICAgMTAwMDAwMDAqKioqKioqCgkJXyAgICAgICAgICAgPSAxMTExMTExCgkJX18gICAgICAgICAgPSA5OTk5OTk5CgkJX19fID0iMTAwMDAwMDAiCgkJdHJ5OgoJCQlmb3IgbiBpbiByYW5nZShsaW1fKToKCQkJCWJva2VxID0gcmFuZG9tLnJhbmRpbnQoXywgX18pCgkJCQlvbGRfYSA9IG9wZW4oJ29sZC50eHQnLCAnYScpCgkJCQlvbGRfYS53cml0ZShzdHIoX19fKStzdHIoYm9rZXEpKyI8PT5LaWt5X0FuZF9XYW5zX0FuZF9KZWNrXG4iKQoJCQlvbGRfYS5jbG9zZSgpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlwcmludCgoIiBFcnJvciA6ICVzIiVlKSksO3RpbWUuc2xlZXAoMSkKCQlqYWxhbih3YXIrIkFwYWthaCBBbmRhIE1hdSBMYXN1bmcgU3RhcnQgQ3JhY2sgKFkvbik6ICIpCgkJbmhhID0gaW5wdXQod2FyKyJQaWxpaCA6ICIpCgkJaWYgbmhhID09ICJ5IiBvciBuaGEgPT0gIlkiOgoJCQljcmFja21lbnUoIm9sZC50eHQiKS5jcmFja29sZCgib2xkLnR4dCIpCgkJCWV4aXQod2FyKyJEb25lIDp2IikKCQllbHNlOgoJCQlpbnB1dCh3YXIrIlRla2FuIEVudGVyICEhIik7dGltZS5zbGVlcCgyKQoJCQltZW51KCkKCWVsaWYgYmVuID09ICI0IiBvciBiZW4gPT0gIjA0IjoKIwkJICAgICAgMTAwMDAwMDAwMDAwMDAwCiMJCSAgICAgIDEwMDAwMDAqKioqKioqKgoJCV8gICAgICAgICAgPSAxMTExMTExMQoJCV9fICAgICAgICAgPSA5OTk5OTk5OQoJCV9fXyA9IjEwMDAwMDAiCgkJdHJ5OgoJCQlmb3IgbiBpbiByYW5nZShsaW1fKToKCQkJCWJva2VxID0gcmFuZG9tLnJhbmRpbnQoXywgX18pCgkJCQlvbGRfYSA9IG9wZW4oJ29sZC50eHQnLCAnYScpCgkJCQlvbGRfYS53cml0ZShzdHIoX19fKStzdHIoYm9rZXEpKyI8PT5LaWt5X0FuZF9XYW5zX0FuZF9KZWNrXG4iKQoJCQlvbGRfYS5jbG9zZSgpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlwcmludCgoIiBFcnJvciA6ICVzIiVlKSksO3RpbWUuc2xlZXAoMSkKCQlqYWxhbih3YXIrIkFwYWthaCBBbmRhIE1hdSBMYXN1bmcgU3RhcnQgQ3JhY2sgKFkvbik6ICIpCgkJbmhhID0gaW5wdXQod2FyKyJQaWxpaCA6ICIpCgkJaWYgbmhhID09ICJ5IiBvciBuaGEgPT0gIlkiOgoJCQljcmFja21lbnUoIm9sZC50eHQiKS5jcmFja29sZCgib2xkLnR4dCIpCgkJCWV4aXQod2FyKyJEb25lIDp2IikKCQllbHNlOgoJCQlpbnB1dCh3YXIrIlRla2FuIEVudGVyICEhIik7dGltZS5zbGVlcCgyKQoJCQltZW51KCkKCWVsaWYgYmVuID09ICI1IiBvciBiZW4gPT0gIjA1IjoKIwkJICAgICAgMTAwMDAwMDAwMDAwMDAwCiMJCSAgICAgIDEwMDAwMCoqKioqKioqKgoJCV8gICAgICAgICA9IDExMTExMTExMQoJCV9fICAgICAgICA9IDk5OTk5OTk5OQoJCV9fXyA9IjEwMDAwMCIKCQl0cnk6CgkJCWZvciBuIGluIHJhbmdlKGxpbV8pOgoJCQkJYm9rZXEgPSByYW5kb20ucmFuZGludChfLCBfXykKCQkJCW9sZF9hID0gb3Blbignb2xkLnR4dCcsICdhJykKCQkJCW9sZF9hLndyaXRlKHN0cihfX18pK3N0cihib2tlcSkrIjw9Pktpa3lfQW5kX1dhbnNfQW5kX0plY2tcbiIpCgkJCW9sZF9hLmNsb3NlKCkKCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCXByaW50KCgiIEVycm9yIDogJXMiJWUpKSw7dGltZS5zbGVlcCgxKQoJCWphbGFuKHdhcisiQXBha2FoIEFuZGEgTWF1IExhc3VuZyBTdGFydCBDcmFjayAoWS9uKTogIikKCQluaGEgPSBpbnB1dCh3YXIrIlBpbGloIDogIikKCQlpZiBuaGEgPT0gInkiIG9yIG5oYSA9PSAiWSI6CgkJCWNyYWNrbWVudSgib2xkLnR4dCIpLmNyYWNrb2xkKCJvbGQudHh0IikKCQkJZXhpdCh3YXIrIkRvbmUgOnYiKQoJCWVsc2U6CgkJCWlucHV0KHdhcisiVGVrYW4gRW50ZXIgISEiKTt0aW1lLnNsZWVwKDIpCgkJCW1lbnUoKQoJZWxpZiBiZW4gPT0gIjYiIG9yIGJlbiA9PSAiMDYiOgojCQkgICAgICAxMDAwMDAwMDAwMDAwMDAKIwkJICAgICAgMTAwMDAqKioqKioqKioqCgkJXyAgICAgICAgPSAxMTExMTExMTExCgkJX18gICAgICAgPSA5OTk5OTk5OTk5CgkJX19fID0iMTAwMDAiCgkJdHJ5OgoJCQlmb3IgbiBpbiByYW5nZShsaW1fKToKCQkJCWJva2VxID0gcmFuZG9tLnJhbmRpbnQoXywgX18pCgkJCQlvbGRfYSA9IG9wZW4oJ29sZC50eHQnLCAnYScpCgkJCQlvbGRfYS53cml0ZShzdHIoX19fKStzdHIoYm9rZXEpKyI8PT5LaWt5X0FuZF9XYW5zX0FuZF9KZWNrXG4iKQoJCQlvbGRfYS5jbG9zZSgpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlwcmludCgoIiBFcnJvciA6ICVzIiVlKSksO3RpbWUuc2xlZXAoMSkKCQlqYWxhbih3YXIrIkFwYWthaCBBbmRhIE1hdSBMYXN1bmcgU3RhcnQgQ3JhY2sgKFkvbik6ICIpCgkJbmhhID0gaW5wdXQod2FyKyJQaWxpaCA6ICIpCgkJaWYgbmhhID09ICJ5IiBvciBuaGEgPT0gIlkiOgoJCQljcmFja21lbnUoIm9sZC50eHQiKS5jcmFja29sZCgib2xkLnR4dCIpCgkJCWV4aXQod2FyKyJEb25lIDp2IikKCQllbHNlOgoJCQlpbnB1dCh3YXIrIlRla2FuIEVudGVyICEhIik7dGltZS5zbGVlcCgyKQoJCQltZW51KCkKCWVsc2U6CgkJamFsYW4od2FyKyJJc2kgRGVuZ2FuIEJlbmFyIE9tICEiKTt0aW1lLnNsZWVwKDIpCgkJYnVhdF9vbGQoKQojZGVmIGtpa3lfYW5kX3dhbnNfYW5kX2plY2sobGltdCwgYm4sIGdkLCBmdSk6CgpkZWYgYnVhdF9vbGR2MSgpOgoJdHJ5OgoJCWZvciBuIGluIHJhbmdlKDUwMDApOgojCQkJCQkgICAgICAgMTAwMDAyMTUxMDA1MzIxCiMgICAgIAkJCSAgICAgICAgICAgICAgICAgICAgICAgMTAwMDAwMDUxMDA1MzIKCQkJYm9rZXEgPSByYW5kb20ucmFuZGludCgxMTExMTExMTEsIDk5OTk5OTk5OSkKCQkJb2xkX2EgPSBvcGVuKCdvbGR2Mi50eHQnLCAnYScpCgkJCW9sZF9hLndyaXRlKHN0cihib2tlcSkrIjw9PjEyMzQ1NlxuIikKCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJcHJpbnQoKCIgRXJyb3IgOiAlcyIlZSkpLDt0aW1lLnNsZWVwKDEpCgpkZWYgZHVtcF9vbGQoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0b2tlbiA9IG9wZW4oIi5sb2dpbi50eHQiLCJyIikucmVhZCgpCiAgICAgICAgZXhjZXB0IElPRXJyb3I6CiAgICAgICAgICAgICAgICBqYWxhbih3YXIrIlRva2VuIEZhaWxlZCIpO3RpbWUuc2xlZXAoMikKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAgICAgbG9naW4oKQogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG5hZGEgPSBpbnQoaW5wdXQoIlxuIit3YXIrIk1hdSBEdW1wIEJlcmFwYSBJZHogOiAiKSkKICAgICAgICAgICAgICAgIGlmIG5hZGE+MjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGphbGFuKHdhcisiTWF4IDIwIElkeiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAgICAgICAgICAgICBkdW1wX29sZCgpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBqYWxhbih3YXIrIklucHV0IEludmFsaWQiKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICBkdW1wX29sZCgpCiAgICAgICAgbmFtYXggPSBpbnB1dCh3YXIrIk5hbWEgRmlsZSAoY29udG9oIDoga2lreSkiK0srIkVudGVyOlJhbmRvbSIrUSsiOiAiKQogICAgICAgIGlmIG5hbWF4ID09ICIiIG9yIG5hbWF4ID09ICIgIjoKICAgICAgICAgICBuYW1heCA9IHRleHRfcmFuZG9tKCkKIyAgICAgICAgICAgamFsYW4od2FyKyJOYW1hIEZpbGUgVGlkYWsgQm9sZWggS29zb25nIik7dGltZS5zbGVlcCgxKTtkdW1wX29sZAogICAgICAgIGxvbnNnID0gb3BlbigiZHVtcC8iK25hbWF4KyIuanNvbiIsICJ3IikKICAgICAgICBmb3IgZG90IGluIHJhbmdlKG5hZGEpOgogICAgICAgICAgICAgICAgZG90Kz0xCiAgICAgICAgICAgICAgICB0YW1wdW5nID0gW10KICAgICAgICAgICAgICAgIG5vbl9vbGQgPSBbXQogICAgICAgICAgICAgICAgdWlkID0gaW5wdXQod2FyKyJNYXN1a2thbiBJRCBUYXJnZXQgS2UgJXMgOiAiJShkb3QpKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBhc3UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vIit1aWQrIj9hY2Nlc3NfdG9rZW49Iit0b2tlbikKICAgICAgICAgICAgICAgICAgICAgICAgdHVsdWwgPSBqc29uLmxvYWRzKGFzdS50ZXh0KQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCh3YXIrIk5hbWEgOiIrdHVsdWxbIm5hbWUiXSkKICAgICAgICAgICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQod2FyKyJLZW11bmdraW5hbiBJZHogSW5pIFRpZGFrIERpUHVibGlja2FuIikKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4aXQoKQogICAgICAgICAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICBqYWxhbih3YXIrIlRpZGFrIEFkYSBJbnRlcm5ldCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAgICAgICAgICAgICBleGl0KCkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgYnVsdSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8iK3VpZCsiL2ZyaWVuZHM/bGltaXQ9MTAwMDAmYWNjZXNzX3Rva2VuPSIrdG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1cmlxID0ganNvbi5sb2FkcyhidWx1LnRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBjZXcgaW4gYnVyaXFbImRhdGEiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqYW1ldCA9IGNld1siaWQiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganVuZXQgPSBjZXdbIm5hbWUiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9uX29sZC5hcHBlbmQoamFtZXQrInwiK2p1bmV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWMgPSBqYW1ldCsifCIranVuZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRldGVjIGluIGlkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGphbWV0KT09NiBvciBsZW4oamFtZXQpPT03IG9yIGxlbihqYW1ldCk9PTg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQuYXBwZW5kKGphbWV0KyJ8IitqdW5ldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YW1wdW5nLmFwcGVuZChqYW1ldCsifCIranVuZXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VsbCA9IG9wZW4oImR1bXAvIituYW1heCsiLmpzb24iLCJhIik7d2VsbC53cml0ZShqYW1ldCsiPD0+IitqdW5ldCsiXG4iKTt3ZWxsLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBsZW4oamFtZXQpPT05OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkLmFwcGVuZChqYW1ldCsifCIranVuZXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFtcHVuZy5hcHBlbmQoamFtZXQrInwiK2p1bmV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlbGwgPSBvcGVuKCJkdW1wLyIrbmFtYXgrIi5qc29uIiwiYSIpO3dlbGwud3JpdGUoamFtZXQrIjw9PiIranVuZXQrIlxuIik7d2VsbC5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgbGVuKGphbWV0KT09MTAgYW5kIGphbWV0WzBdPT0iMSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgamFtZXRbMV09PSIwIiBvciBqYW1ldFsxXT09IjEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgamFtZXRbMl09PSIwIiBvciBqYW1ldFsyXT09IjEiIG9yIGphbWV0WzJdPT0iMiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkLmFwcGVuZChqYW1ldCsifCIranVuZXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbXB1bmcuYXBwZW5kKGphbWV0KyJ8IitqdW5ldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VsbCA9IG9wZW4oImR1bXAvIituYW1heCsiLmpzb24iLCJhIik7d2VsbC53cml0ZShqYW1ldCsiPD0+IitqdW5ldCsiXG4iKTt3ZWxsLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6Y29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOmNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqYW1lLCBqYW1ldCA9IGphbWV0LnNwbGl0KCIwMDAwIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamFtZXQgPSAoIjEwMDAwIitqYW1ldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQuYXBwZW5kKGphbWV0KyJ8IitqdW5ldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFtcHVuZy5hcHBlbmQoamFtZXQrInwiK2p1bmV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWxsID0gb3BlbigiZHVtcC8iK25hbWF4KyIuanNvbiIsImEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWxsLndyaXRlKGphbWV0KyI8PT4iK2p1bmV0KyJcbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlbGwuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnByaW50KCIlcyIlKGUpKQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQod2FyKyJUb3RhbCBJRCA6ICVzIiUobGVuKG5vbl9vbGQpKSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQod2FyKyJKdW1sYWggQWt1biBPbGQgOiAlc1xuIiUobGVuKHRhbXB1bmcpKSkKICAgICAgICAgICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgamFsYW4od2FyKyJUaWRhayBBZGEgSW50ZXJuZXQiKQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgZXhpdCgpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGphbGFuKHdhcisiTWFhZiBJZHogIitDK3VpZCtRKyIgSW5pIFRpZGFrIERpUHVibGlja2FuLCBDYXJpIFlhbmcgTGFpbl8tIik7dGltZS5zbGVlcCgyKTtkdW1wX29sZCgpCiAgICAgICAgaWRfID0gKCIlcyIlKGxlbihpZCkpKQogICAgICAgIGlmIGlkXyA9PSAiMCIgb3IgIjAiID09IGlkXzoKICAgICAgICAgICAgIGphbGFuKHdhcisiS2VtdW5na2luYW4gSWR6IFlhbmcgQW5kYSBNYXN1a2FuIFRpZGFrIERpUHVibGlja2FuICEhIikKICAgICAgICBlbHNlOgogICAgICAgICAgICAgcHJpbnQod2FyKyJUb3RhbCBJRCA6ICVzIiUobGVuKGlkKSkpCiAgICAgICAgICAgICBqYWxhbih3YXIrIk5hbWEgSGFzaWwgRHVtcCA6ICIrSSsiZHVtcC8iK25hbWF4KyIuanNvbiIrUSkKICAgICAgICAgICAgIGphbGFuKHdhcisiU2lsYWhrYW4gQ29weSBOYW1hIEhhc2lsIER1bXAgVGFkaSAhISIpCiAgICAgICAgICAgICBqYWxhbigiXG4iK3dhcisiQXBha2FoIEFuZGEgTWF1IExhc3VuZyBDcmFjayBEZW5nYW4gRmlsZSBJbmkgKFkvbikgOiAiKQogICAgICAgICAgICAgenogPSBpbnB1dCh3YXIrJ1BpbGloIDogJykKICAgICAgICAgICAgIGlmIHp6IGluIFsiWSIsICJ5IiwgIlllcyIsICIxIl06CiAgICAgICAgICAgICAgICAgIGNyYWNrbWVudSgiZHVtcC8iK25hbWF4KyIuanNvbiIpLnBhc3NtZW51KCJkdW1wLyIrbmFtYXgrIi5qc29uIikKICAgICAgICAgICAgICAgICAgZXhpdCgpCiAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgaW5wdXQod2FyKyJUZWthbiBFbnRlciBVbnR1ayBLZW1iYWxpIikKICAgICAgICBtZW51KCkKZGVmIGR1bXBfZm9sbG93KCk6Cgl0cnk6CgkJdG9rZW4gPSBvcGVuKCIubG9naW4udHh0IiwgInIiKS5yZWFkKCkKCWV4Y2VwdCBJT0Vycm9yOgoJCW9zLnN5c3RlbSgicm0gLXJmIC5sb2dpbi50eHQiKQoJCWV4aXQod2FyKyJUb2tlbiBGYWlsZWQgISEiKTt0aW1lLnNsZWVwKDIpCgoJdHJ5OgoJCXRhbnlhX3RvdGFsID0gaW50KGlucHV0KHdhcisiTWF1IER1bXAgQmVyYXBhIElkIDogIikpCglleGNlcHQ6dGFueWFfdG90YWw9MQoJbmFtYWZpID0gaW5wdXQod2FyKyJOYW1hIEZpbGUgKGNvbnRvaCA6IHNheWFuZykiK0srIkVudGVyOlJhbmRvbSIrUSsiIDogIikKCWlmIG5hbWFmaSA9PSAiIiBvciBuYW1hZmkgPT0gIiAiOgoJCW5hbWFmaSA9IHRleHRfcmFuZG9tKCkKCWR1bXAgPSBvcGVuKCdkdW1wLycrbmFtYWZpKycuanNvbicsJ3cnKSAKCWphbGFuKHdhcisiS2V0aWsgPiIrSSsibWUiK1ErIjwgVW50dWsgRHVtcCBEYXRhIFNlbmRpcmkiKQoJZm9yIHQgaW4gcmFuZ2UodGFueWFfdG90YWwpOgoJCXQgKz0xCgkJaWR0ID0gaW5wdXQod2FyKyJNYXN1a2FuIElkeiBBdGF1IFVzZXJuYW1lIFRhcmdldCAlcyA6ICIlKHQpKQoJCWlkdCA9IHViYWhfdXNlcm5hbWVfdG9faWQoaWR0KQoJCWxpbWl0ID0gKCIxMDAwMCIpCgkJdHJ5OgoJCQlpZiBpZHQgPT0gIm1lIiBvciAibWUiID09IGlkdDoKCQkJCW90dyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvP2FjY2Vzc190b2tlbj0iK3Rva2VuKQoJCQkJb3AgPSBqc29uLmxvYWRzKG90dy50ZXh0KQoJCQllbHNlOgoJCQkJam9rID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiP2FjY2Vzc190b2tlbj0iK3Rva2VuKQoJCQkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCQl0cnk6CgkJCQluYW1hID0gb3BbJ25hbWUnXQoJCQlleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKCQkJCW5hbWEgPSAoIk5hbWEgVGlkYWsgRGlUZW11a2FuICEiKQojCQkJdHJ5OgojCQkJCXRlbXBhdCA9IG9wWydsb2NhdGlvbiddWyduYW1lJ10KIwkJCWV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgojCQkJCXRlbXBhdCA9ICgiTG9rYXNpIFRpZGFrIERpVGVtdWthbiIpCiMJCQl0cnk6CiMJCQkJdGluZ2dhbCA9IG9wWydob21ldG93biddWyduYW1lJ10KIwkJCWV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgojCQkJCXRpbmdnYWwgPSAoIk5hbWEgS290YSBUaWRhayBEaVRlbXVrYW4iKQoKCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCWphbGFuKHdhcisiTWFhZiBJRCAiK0MraWR0K1ErIiBJbmkgVGlkYWsgRGlUZW11a2FuICEiKQoJCQljb250aW51ZQoJCWphbGFuKCJcbiIrd2FyKyJOYW1hICAgOiAiK0krbmFtYStRKyJcbiIpCiMJCWphbGFuKHdhcisiS290YSAgIDogIitJK3RlbXBhdCtRKQojCQlqYWxhbih3YXIrIkxva2FzaSA6ICIrSSt0aW5nZ2FsK1ErIlxuIikKCQl0cnk6CgkJCWR1bXAgPSBvcGVuKCdkdW1wLycrbmFtYWZpKycuanNvbicsJ2ErJykgCgkJCWZvciBpIGluIHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIi9zdWJzY3JpYmVycz9saW1pdD0iK2xpbWl0KyImYWNjZXNzX3Rva2VuPSIrdG9rZW4pLmpzb24oKVsiZGF0YSJdOgoJCQkJdHJ5OgoJCQkJCXVpZCA9IGlbImlkIl0KCQkJCQluYW1hID0gaVsibmFtZSJdCgkJCQkJaWQuYXBwZW5kKHVpZCsiPD0+IituYW1hKQoJCQkJCWR1bXAud3JpdGUodWlkKyc8PT4nK25hbWErJ1xuJykKCQkJCWV4Y2VwdDpwYXNzCgkJCWR1bXAuY2xvc2UoKQoJCWV4Y2VwdCBLZXlFcnJvcjpwYXNzCglpZF8gPSAoIiVzIiUobGVuKGlkKSkpCglpZiBpZF8gPT0gIjAiIG9yICIwIiA9PSBpZF86CgkJamFsYW4od2FyKyJLZW11bmdraW5hbiBJZHogWWFuZyBBbmRhIE1hc3VrYW4gVGlkYWsgRGlQdWJsaWNrYW4gISEiKQoJZWxzZToKCQlwcmludCh3YXIrIlRvdGFsIElEIDogJXMiJShsZW4oaWQpKSkKCQlqYWxhbih3YXIrIk5hbWEgSGFzaWwgRHVtcCA6ICIrSSsiZHVtcC8iK25hbWFmaSsiLmpzb24iK1EpCgkJamFsYW4od2FyKyJTaWxhaGthbiBDb3B5IE5hbWEgSGFzaWwgRHVtcCBUYWRpICEhIikKCQlqYWxhbigiXG4iK3dhcisiQXBha2FoIEFuZGEgTWF1IExhc3VuZyBDcmFjayBEZW5nYW4gRmlsZSBJbmkgKFkvbikgOiAiKQoJCXp6ID0gaW5wdXQod2FyKydQaWxpaCA6ICcpCgkJaWYgenogaW4gWyJZIiwgInkiLCAiWWVzIiwgIjEiXToKCQkJY3JhY2ttZW51KCJkdW1wLyIrbmFtYWZpKyIuanNvbiIpLnBhc3NtZW51KCJkdW1wLyIrbmFtYWZpKyIuanNvbiIpCgkJCWV4aXQoKQoJCWVsc2U6CgkJCXBhc3MKCWlucHV0KHdhcisiVGVrYW4gRW50ZXIgISEiKQoJbWVudSgpCmRlZiBjZWtfaGlzdG9yeShpdCk6CglnbG9iYWwgdGFueWFfdG90YWwKCXZjID0gIiIKCWlmIGl0ID09ICJtZSIgb3IgIm1lIiA9PSBpdDpwYXNzCgllbHNlOgoJCWhpc3RvcnkgPSBvcGVuKCIuaWR6IiwgImErIikKCSMJaWR0ID0gaW5wdXQoIklkeiA6ICIpCgkJaGlzID0gb3BlbigiLmlkeiIsInIiKS5yZWFkbGluZXMoKQoJCWZvciBuIGluIGhpczoKCQkJdHJ5OgoJCQkJbiA9IG4ucmVwbGFjZSgiXG4iLCIiKQoJCQkJaWYgbiA9PSBpdDoKCQkJCQlqYWxhbih3YXIrIk1hYWYgSWR6ICIrQytpdCtRKyIgSW5pIFN1ZGFoIFBlcm5haCBBbmRhIER1bXAvQ3JhY2tcbiIpCgkJCQkJdmMgKz0gIjEiCgkJCWV4Y2VwdDpwYXNzCgkJaWYgdmMgPT0gIjEiIG9yICIxIiA9PSB2YzoKCQkJamFsYW4od2FyKyJBcGFrYWggQW5kYSBNYXUgRHVtcC9DcmFjayBEZW5nYW4gSWR6IEluaSAoWS9uKSA6ICIpCgkJCWJ6ID0gaW5wdXQoaW5wKyJQaWxpaCA6ICIpCgkJCWlmIGJ6ID09ICJZIiBvciBieiA9PSAieSI6CgkJCQl0YW55YV90b3RhbCArPSAxCgkJCQlyZXR1cm4gdGFueWFfdG90YWwKCQllbHNlOgoJCQloaXN0b3J5LndyaXRlKGl0KyJcbiIpCgkJCWhpc3RvcnkuY2xvc2UoKQpkZWYgY3JhY2tfZ3J1cChoZW5jZXQpOgogICAgdHJ5OgogICAgICAgIF9tbWtfID0gb3BlbignLmNva2llLnR4dCcpLnJlYWQoKQogICAgICAgIF9jb2tfICA9IHsiY29va2llIjpfbW1rX30KICAgICAgICBrdWVoICA9IHsiY29va2llIjpfbW1rX30KICAgICAgICBrb250b2w9cmVxdWVzdHMuZ2V0KGhlbmNldCxjb29raWVzPV9jb2tfKS50ZXh0CiAgICAgICAgbWVtZWs9cmUuZmluZGFsbCgnXDxoM1w+XDxhXCBjbGFzc1w9XCIuLlwiXCBocmVmXD1cIlwvKC4qPylcIlw+KC4qPyk8XC9hXD4nLGtvbnRvbCkKICAgICAgICBmb3Igc29mdGVrIGluIG1lbWVrOgogICAgICAgICAgICBpZiAicHJvZmlsZS5waHA/IiBpbiBzb2Z0ZWtbMF06CiAgICAgICAgICAgICAgICBpZC5hcHBlbmQocmUuZmluZGFsbCgiaWQ9KC4qKSIsc29mdGVrWzBdKVswXSsiPD0+Iitzb2Z0ZWtbMV0pCiAgICAgICAgICAgICAgICBvcGVuKCJkdW1wLyIrbmFtYV9ncnVwKyIuanNvbiIsICJhIikud3JpdGUocmUuZmluZGFsbCgiaWQ9KC4qKSIsc29mdGVrWzBdKVswXSsiPD0+Iitzb2Z0ZWtbMV0rIlxuIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlkLmFwcGVuZChzb2Z0ZWtbMF0rIjw9PiIrc29mdGVrWzFdKQogICAgICAgICAgICAgICAgb3BlbigiZHVtcC8iK25hbWFfZ3J1cCsiLmpzb24iLCAiYSIpLndyaXRlKHNvZnRla1swXSsiPD0+Iitzb2Z0ZWtbMV0rIlxuIikKICAgICAgICAgICAgc3lzLnN0ZG91dC53cml0ZSgnXHInK3dhcisnTWVuZ3VtcHVsa2FuICVzIElkei4uLiAnJShsZW4oaWQpKSk7IHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIGlmICJMaWhhdCBTZWxlbmdrYXBueWEiIGluIGtvbnRvbDoKICAgICAgICAgICAgY3JhY2tfZ3J1cCh1cmxfbWIrQmVhdXRpZnVsU291cChrb250b2wsImh0bWwucGFyc2VyIikuZmluZCgiYSIsc3RyaW5nPSJMaWhhdCBTZWxlbmdrYXBueWEiKS5nZXQoImhyZWYiKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkZWYgZ2VoKGdleSk6CiAgICAgICAgICAgICAgICBhPXJlcXVlc3RzLmdldChnZXksY29va2llcz1rdWVoKS50ZXh0CiAgICAgICAgICAgICAgICBiPXJlLmZpbmRhbGwoJ1w8aDNcIGNsYXNzXD1cIi4qPyI+XDxzcGFuPlw8c3Ryb25nPlw8YVwgaHJlZlw9XCIvKC4qPylcIj4oLio/KTwvYVw+XDwvc3Ryb25nXD4nLGEpCiAgICAgICAgICAgICAgICBpZiBsZW4oYikhPTA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGMgaW4gYjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgInByb2ZpbGUucGhwIiBpbiBjWzBdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZD1yZS5zZWFyY2goInByb2ZpbGUucGhwXD9pZD0oXFxkKikiLGNbMF0pLmdyb3VwKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkIGluIGlkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkLmFwcGVuZChkKyI8PT4iK2NbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigiZHVtcC8iK25hbWFfZ3J1cCsiLmpzb24iLCAiYSIpLndyaXRlKGQrIjw9PiIrY1sxXSsiXG4iKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZD1yZS5zZWFyY2goIiguKj8pXD9yZWZpZCIsY1swXSkuZ3JvdXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGQgaW4gaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQuYXBwZW5kKGQrIjw9PiIrY1sxXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuKCJkdW1wLyIrbmFtYV9ncnVwKyIuanNvbiIsICJhIikud3JpdGUoZCsiPD0+IitjWzFdKyJcbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyJyt3YXIrJ01lbmd1bXB1bGthbiAlcyBJZHouLi4gJyUobGVuKGlkKSkpOyBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICAgICAgICAgIGlmICJMaWhhdCBQb3N0aW5nYW4gTGFpbm55YSIgaW4gYToKICAgICAgICAgICAgICAgICAgICBnZWgodXJsX21iK0JlYXV0aWZ1bFNvdXAoYSwiaHRtbC5wYXJzZXIiKS5maW5kKCJhIixzdHJpbmc9IkxpaGF0IFBvc3RpbmdhbiBMYWlubnlhIikuZ2V0KCJocmVmIikpCiAgICAgICAgICAgIGdlaChmInt1cmxfbWJ9L2dyb3Vwcy8iK3JlLnNlYXJjaCgiaWQ9KFxcZCopIixoZW5jZXQpLmdyb3VwKDEpKQogICAgZXhjZXB0OnBhc3MKCgoKCmRlZiBkdW1wX3B1YmxpYygpOgoJdHJ5OgoJCXRva2VuID0gb3BlbigiLmxvZ2luLnR4dCIsICJyIikucmVhZCgpCglleGNlcHQgSU9FcnJvcjoKCQlvcy5zeXN0ZW0oInJtIC1yZiAubG9naW4udHh0IikKCQlleGl0KHdhcisiVG9rZW4gRmFpbGVkICEhIik7dGltZS5zbGVlcCgyKQoJdHJ5OgoJCXRhbnlhX3RvdGFsID0gaW50KGlucHV0KHdhcisiTWF1IER1bXAgQmVyYXBhIElkIDogIikpCglleGNlcHQ6dGFueWFfdG90YWw9MQoJbmFtYWZpID0gaW5wdXQod2FyKyJOYW1hIEZpbGUgKGNvbnRvaCA6IHNheWFuZykiK0srIkVudGVyOlJhbmRvbSIrUSsiIDogIikKCWlmIG5hbWFmaSA9PSAiIiBvciBuYW1hZmkgPT0gIiAiOgoJCW5hbWFmaSA9IHRleHRfcmFuZG9tKCkKCWR1bXAgPSBvcGVuKCdkdW1wLycrbmFtYWZpKycuanNvbicsJ3cnKSAKCWphbGFuKHdhcisiS2V0aWsgPiIrSSsibWUiK1ErIjwgVW50dWsgRHVtcCBEYXRhIFNlbmRpcmkiKQoJZm9yIHQgaW4gcmFuZ2UodGFueWFfdG90YWwpOgoJCXQgKz0xCgkJaWR0ID0gaW5wdXQod2FyKyJNYXN1a2FuIElkeiBBdGF1IFVzZXJuYW1lIFRhcmdldCAlcyA6ICIlKHQpKQoJCWlkdCA9IHViYWhfdXNlcm5hbWVfdG9faWQoaWR0KQojCQljZWtfaGlzdG9yeShpZHQpCgkJbGltaXQgPSAoIjEwMDAwIikKCQl0cnk6CgkJCWlmIGlkdCA9PSAibWUiIG9yICJtZSIgPT0gaWR0OgoJCQkJb3R3ID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZS8/YWNjZXNzX3Rva2VuPSIrdG9rZW4pCgkJCQlvcCA9IGpzb24ubG9hZHMob3R3LnRleHQpCgkJCWVsc2U6CgkJCQlqb2sgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyI/YWNjZXNzX3Rva2VuPSIrdG9rZW4pCgkJCQlvcCA9IGpzb24ubG9hZHMoam9rLnRleHQpCgkJCXRyeToKCQkJCW5hbWEgPSBvcFsnbmFtZSddCgkJCWV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgoJCQkJbmFtYSA9ICgiTmFtYSBUaWRhayBEaVRlbXVrYW4gISIpCiMJCQl0cnk6CiMJCQkJdGVtcGF0ID0gb3BbJ2xvY2F0aW9uJ11bJ25hbWUnXQojCQkJZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiMJCQkJdGVtcGF0ID0gKCJMb2thc2kgVGlkYWsgRGlUZW11a2FuIikKIwkJCXRyeToKIwkJCQl0aW5nZ2FsID0gb3BbJ2hvbWV0b3duJ11bJ25hbWUnXQojCQkJZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiMJCQkJdGluZ2dhbCA9ICgiTmFtYSBLb3RhIFRpZGFrIERpVGVtdWthbiIpCgoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJamFsYW4od2FyKyJNYWFmIElEICIrQytpZHQrUSsiIEluaSBUaWRhayBEaVRlbXVrYW4gISAoIitzdHIoZSkrIikiKQoJCQljb250aW51ZQoJCWphbGFuKCJcbiIrd2FyKyJOYW1hICAgOiAiK0krbmFtYStRKyJcbiIpCiMJCWphbGFuKHdhcisiS290YSAgIDogIitJK3RlbXBhdCtRKQojCQlqYWxhbih3YXIrIkxva2FzaSA6ICIrSSt0aW5nZ2FsK1ErIlxuIikKCQl0cnk6CgkJCWR1bXAgPSBvcGVuKCdkdW1wLycrbmFtYWZpKycuanNvbicsJ2ErJykgCgkJCWZvciBpIGluIHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIi9mcmllbmRzP2xpbWl0PSIrbGltaXQrIiZhY2Nlc3NfdG9rZW49Iit0b2tlbikuanNvbigpWyJkYXRhIl06CgkJCQl0cnk6CgkJCQkJdWlkID0gaVsiaWQiXQoJCQkJCW5hbWEgPSBpWyJuYW1lIl0KCQkJCQlpZC5hcHBlbmQodWlkKyI8PT4iK25hbWEpCgkJCQkJZHVtcC53cml0ZSh1aWQrJzw9PicrbmFtYSsnXG4nKQoJCQkJZXhjZXB0OnBhc3MKCQkJZHVtcC5jbG9zZSgpCgkJZXhjZXB0IEtleUVycm9yOnBhc3MKCWlkXyA9ICgiJXMiJShsZW4oaWQpKSkKCWlmIGlkXyA9PSAiMCIgb3IgIjAiID09IGlkXzoKCQlqYWxhbih3YXIrIktlbXVuZ2tpbmFuIElkeiBZYW5nIEFuZGEgTWFzdWthbiBUaWRhayBEaVB1YmxpY2thbiAhISIpCgllbHNlOgoJCXByaW50KHdhcisiVG90YWwgSUQgOiAlcyIlKGxlbihpZCkpKQoJCWphbGFuKHdhcisiTmFtYSBIYXNpbCBEdW1wIDogIitJKyJkdW1wLyIrbmFtYWZpKyIuanNvbiIrUSkKCQlqYWxhbih3YXIrIlNpbGFoa2FuIENvcHkgTmFtYSBIYXNpbCBEdW1wIFRhZGkgISEiKQoJCWphbGFuKCJcbiIrd2FyKyJBcGFrYWggQW5kYSBNYXUgTGFzdW5nIENyYWNrIERlbmdhbiBGaWxlIEluaSAoWS9uKSA6ICIpCgkJenogPSBpbnB1dCh3YXIrJ1BpbGloIDogJykKCQlpZiB6eiBpbiBbIlkiLCAieSIsICJZZXMiLCAiMSJdOgoJCQljcmFja21lbnUoImR1bXAvIituYW1hZmkrIi5qc29uIikucGFzc21lbnUoImR1bXAvIituYW1hZmkrIi5qc29uIikKCQkJZXhpdCgpCgkJZWxzZToKCQkJcGFzcwoJaW5wdXQod2FyKyJUZWthbiBFbnRlciAhISIpCgltZW51KCkKCmRlZiBkdW1wX2ZvbGxvd19wdWJsaWMoKToKCXRyeToKCQl0b2tlbiA9IG9wZW4oIi5sb2dpbi50eHQiLCAiciIpLnJlYWQoKQoJZXhjZXB0IElPRXJyb3I6CgkJb3Muc3lzdGVtKCJybSAtcmYgLmxvZ2luLnR4dCIpCgkJZXhpdCh3YXIrIlRva2VuIEZhaWxlZCAhISIpO3RpbWUuc2xlZXAoMikKCgl0cnk6CgkJdGFueWFfdG90YWwgPSBpbnQoaW5wdXQod2FyKyJNYXUgRHVtcCBCZXJhcGEgSWQgOiAiKSkKCWV4Y2VwdDp0YW55YV90b3RhbD0xCgluYW1hZmkgPSBpbnB1dCh3YXIrIk5hbWEgRmlsZSAoY29udG9oIDogc2F5YW5nKSIrSysiRW50ZXI6UmFuZG9tIitRKyIgOiAiKQoJaWYgbmFtYWZpID09ICIiIG9yIG5hbWFmaSA9PSAiICI6CgkJbmFtYWZpID0gdGV4dF9yYW5kb20oKQoJZHVtcCA9IG9wZW4oJ2R1bXAvJytuYW1hZmkrJy5qc29uJywndycpIAoJamFsYW4od2FyKyJLZXRpayA+IitJKyJtZSIrUSsiPCBVbnR1ayBEdW1wIERhdGEgU2VuZGlyaSIpCglmb3IgdCBpbiByYW5nZSh0YW55YV90b3RhbCk6CgkJdCArPTEKCQlpZHQgPSBpbnB1dCh3YXIrIk1hc3VrYW4gSWR6IEF0YXUgVXNlcm5hbWUgVGFyZ2V0ICVzIDogIiUodCkpCgkJaWR0ID0gdWJhaF91c2VybmFtZV90b19pZChpZHQpCgkJbGltaXQgPSAoIjEwMDAwIikKCQl0cnk6CgkJCWlmIGlkdCA9PSAibWUiIG9yICJtZSIgPT0gaWR0OgoJCQkJb3R3ID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZS8/YWNjZXNzX3Rva2VuPSIrdG9rZW4pCgkJCQlvcCA9IGpzb24ubG9hZHMob3R3LnRleHQpCgkJCWVsc2U6CgkJCQlqb2sgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyI/YWNjZXNzX3Rva2VuPSIrdG9rZW4pCgkJCQlvcCA9IGpzb24ubG9hZHMoam9rLnRleHQpCgkJCXRyeToKCQkJCW5hbWEgPSBvcFsnbmFtZSddCgkJCWV4Y2VwdCAoS2V5RXJyb3IsIElPRXJyb3IpOgoJCQkJbmFtYSA9ICgiTmFtYSBUaWRhayBEaVRlbXVrYW4gISIpCiMJCQl0cnk6CiMJCQkJdGVtcGF0ID0gb3BbJ2xvY2F0aW9uJ11bJ25hbWUnXQojCQkJZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiMJCQkJdGVtcGF0ID0gKCJMb2thc2kgVGlkYWsgRGlUZW11a2FuIikKIwkJCXRyeToKIwkJCQl0aW5nZ2FsID0gb3BbJ2hvbWV0b3duJ11bJ25hbWUnXQojCQkJZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiMJCQkJdGluZ2dhbCA9ICgiTmFtYSBLb3RhIFRpZGFrIERpVGVtdWthbiIpCgoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJamFsYW4od2FyKyJNYWFmIElEICIrQytpZHQrUSsiIEluaSBUaWRhayBEaVRlbXVrYW4gISIpCgkJCWNvbnRpbnVlCgkJamFsYW4oIlxuIit3YXIrIk5hbWEgICA6ICIrSStuYW1hK1ErIlxuIikKIwkJamFsYW4od2FyKyJLb3RhICAgOiAiK0krdGVtcGF0K1EpCiMJCWphbGFuKHdhcisiTG9rYXNpIDogIitJK3RpbmdnYWwrUSsiXG4iKQoJCXRyeToKCQkJZHVtcCA9IG9wZW4oJ2R1bXAvJytuYW1hZmkrJy5qc29uJywnYSsnKQoJCQlmb3IgaSBpbiByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyIvc3Vic2NyaWJlcnM/bGltaXQ9IitsaW1pdCsiJmFjY2Vzc190b2tlbj0iK3Rva2VuKS5qc29uKClbImRhdGEiXToKCQkJCXRyeToKCQkJCQl1aWQgPSBpWyJpZCJdCgkJCQkJbmFtYSA9IGlbIm5hbWUiXQoJCQkJCWlkLmFwcGVuZCh1aWQrIjw9PiIrbmFtYSkKCQkJCQlkdW1wLndyaXRlKHVpZCsnPD0+JytuYW1hKydcbicpCgkJCQlleGNlcHQ6cGFzcwoJCQlkdW1wLmNsb3NlKCkKCQlleGNlcHQgS2V5RXJyb3I6cGFzcwoJCXRyeToKCQkJZm9yIGkgaW4gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiL2ZyaWVuZHM/bGltaXQ9IitsaW1pdCsiJmFjY2Vzc190b2tlbj0iK3Rva2VuKS5qc29uKClbImRhdGEiXToKCQkJCXRyeToKCQkJCQl1aWQgPSBpWyJpZCJdCgkJCQkJbmFtYSA9IGlbIm5hbWUiXQoJCQkJCWlkLmFwcGVuZCh1aWQrIjw9PiIrbmFtYSkKCQkJCQlkdW1wLndyaXRlKHVpZCsnPD0+JytuYW1hKydcbicpCgkJCQlleGNlcHQ6cGFzcwoJCQlkdW1wLmNsb3NlKCkKCQlleGNlcHQgS2V5RXJyb3I6cGFzcwoJaWRfID0gKCIlcyIlKGxlbihpZCkpKQoJaWYgaWRfID09ICIwIiBvciAiMCIgPT0gaWRfOgoJCWphbGFuKHdhcisiS2VtdW5na2luYW4gSWR6IFlhbmcgQW5kYSBNYXN1a2FuIFRpZGFrIERpUHVibGlja2FuICEhIikKCWVsc2U6CgkJcHJpbnQod2FyKyJUb3RhbCBJRCA6ICVzIiUobGVuKGlkKSkpCgkJamFsYW4od2FyKyJOYW1hIEhhc2lsIER1bXAgOiAiK0krImR1bXAvIituYW1hZmkrIi5qc29uIitRKQoJCWphbGFuKHdhcisiU2lsYWhrYW4gQ29weSBOYW1hIEhhc2lsIER1bXAgVGFkaSAhISIpCgkJamFsYW4oIlxuIit3YXIrIkFwYWthaCBBbmRhIE1hdSBMYXN1bmcgQ3JhY2sgRGVuZ2FuIEZpbGUgSW5pIChZL24pIDogIikKCQl6eiA9IGlucHV0KHdhcisnUGlsaWggOiAnKQoJCWlmIHp6IGluIFsiWSIsICJ5IiwgIlllcyIsICIxIl06CgkJCWNyYWNrbWVudSgiZHVtcC8iK25hbWFmaSsiLmpzb24iKS5wYXNzbWVudSgiZHVtcC8iK25hbWFmaSsiLmpzb24iKQoJCQlleGl0KCkKCQllbHNlOgoJCQlwYXNzCglpbnB1dCh3YXIrIlRla2FuIEVudGVyICEhIikKCW1lbnUoKQpkZWYgY2VrZmlsZShmb2xkZXIpOgogICAgICAgIGRpcnMgPSBvcy5saXN0ZGlyKGZvbGRlcikKICAgICAgICBmb3IgZmlsZSBpbiBkaXJzOgogICAgICAgICAgICAgICAgZmlsZXggPSAoZm9sZGVyKyIvIitmaWxlKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBqdW1hID0gb3BlbihmaWxleCwiciIpLnJlYWRsaW5lcygpCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsID0gKCIlcyIlKHN0cihsZW4oanVtYSkpKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDp0b3RhbCA9ICgiID8/ICIpCiAgICAgICAgICAgICAgICBwcmludCh3YXIrQytmaWxleCtVKyIgPD09PiAiK1ErSyt0b3RhbCkKZGVmIGNla2ZpbGVfY3JrKGZvbGRlcik6CiAgICAgICAgZGlycyA9IG9zLmxpc3RkaXIoZm9sZGVyKQogICAgICAgIGZvciBmaWxlIGluIGRpcnM6CiAgICAgICAgICAgICAgICBmaWxleCA9IChmb2xkZXIrIi8iK2ZpbGUpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGp1bWEgPSBvcGVuKGZpbGV4LCJyIikucmVhZGxpbmVzKCkKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWwgPSAoIiVzIiUoc3RyKGxlbihqdW1hKSkpKQogICAgICAgICAgICAgICAgZXhjZXB0OnRvdGFsID0gKCIgPz8gIikKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpam9fXyA9IGZpbGV4LnNwbGl0KCJIYXNpbC9PSy0iKVsxXQogICAgICAgICAgICAgICAgICAgIGlqb18gPSAod2FyK0krIkhhc2lsL09LLSIraWpvX18pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoaWpvXytVKyIgICA8PT4gICAiK1ErTSt0b3RhbCkKICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGt1bmluZ19fID0gZmlsZXguc3BsaXQoIkhhc2lsL0NQLSIpWzFdCiAgICAgICAgICAgICAgICAgICAga3VuaW5nXyA9ICh3YXIrSysiSGFzaWwvQ1AtIitrdW5pbmdfXykKICAgICAgICAgICAgICAgICAgICBwcmludChrdW5pbmdfK1UrIiAgIDw9PiAgICIrUStNK3RvdGFsKQogICAgICAgICAgICAgICAgZXhjZXB0OnBhc3MKCiMgICAgICAgICAgICAgICAgcHJpbnQod2FyK0MrZmlsZXgrVSsiIDw9PT4gIitRK0srdG90YWwpCgpkZWYgZHVtcF91bHRpKCk6Cgl0cnk6CgkJdG9rZW4gPSBvcGVuKCIubG9naW4udHh0IiwgInIiKS5yZWFkKCkKCQl0b2tldCA9IG9wZW4oIi5sb2dpbi50eHQiLCAiciIpLnJlYWQoKQoJZXhjZXB0IElPRXJyb3I6CgkJb3Muc3lzdGVtKCJybSAtcmYgLmxvZ2luLnR4dCIpCgkJZXhpdCh3YXIrIlRva2VuIEZhaWxlZCAhISIpO3RpbWUuc2xlZXAoMikKCglqYWxhbih3YXIrIktldGlrID4iK0krIm1lIitRKyI8IFVudHVrIER1bXAgRGF0YSBTZW5kaXJpIikKCWlkdCA9IGlucHV0KHdhcisiTWFzdWthbiBJZHogQXRhdSBVc2VybmFtZSBUYXJnZXQgOiAiICkKCWlkdCA9IHViYWhfdXNlcm5hbWVfdG9faWQoaWR0KQoJdHJ5OgoJCWlmIGlkdCA9PSAibWUiIG9yICJtZSIgPT0gaWR0OgoJCQlvdHcgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lLz9hY2Nlc3NfdG9rZW49Iit0b2tlbikKCQkJb3AgPSBqc29uLmxvYWRzKG90dy50ZXh0KQoJCWVsc2U6CgkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tlbikKCQkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCXRyeToKCQkJbmFtYSA9IG9wWyduYW1lJ10KCQlleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKCQkJbmFtYSA9ICgiTmFtYSBUaWRhayBEaVRlbXVrYW4gISIpCiMJCXRyeToKIwkJCXRlbXBhdCA9IG9wWydsb2NhdGlvbiddWyduYW1lJ10KIwkJZXhjZXB0IChLZXlFcnJvciwgSU9FcnJvcik6CiMJCQl0ZW1wYXQgPSAoIkxva2FzaSBUaWRhayBEaVRlbXVrYW4iKQojCQl0cnk6CiMJCQl0aW5nZ2FsID0gb3BbJ2hvbWV0b3duJ11bJ25hbWUnXQojCQlleGNlcHQgKEtleUVycm9yLCBJT0Vycm9yKToKIwkJCXRpbmdnYWwgPSAoIk5hbWEgS290YSBUaWRhayBEaVRlbXVrYW4iKQoKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlqYWxhbih3YXIrIk1hYWYgSUQgIitDK2lkdCtRKyIgSW5pIFRpZGFrIERpVGVtdWthbiAhIikKCQl0aW1lLnNsZWVwKDIpCgkJZHVtcF91bHRpKCkKCWphbGFuKCJcbiIrd2FyKyJOYW1hICAgOiAiK0krbmFtYStRKyJcbiIpCglpZiBuYW1hID09ICJOYW1hIFRpZGFrIERpVGVtdWthbiAhIjoKCQl0aW1lLnNsZWVwKDIpCgkJZHVtcF91bHRpKCkKCiMJamFsYW4od2FyKyJLb3RhICAgOiAiK0krdGVtcGF0K1EpCiMJamFsYW4od2FyKyJMb2thc2kgOiAiK0krdGluZ2dhbCtRKyJcbiIpCgluYW1xID0gaW5wdXQod2FyKyJOYW1hIEZpbGUgKGNvbnRvaCA6IGphbWV0KSIrSysiRW50ZXI6UmFuZG9tIitRKyI6ICIpCglpZiBuYW1xID09ICIiIG9yIG5hbXEgPT0gIiAiOgoJCW5hbXEgPSB0ZXh0X3JhbmRvbSgpCglkdW1wID0gb3BlbignLmphbmdhbmVkaXQnLCd3JykgCgl0cnk6CgkJZHVtcCA9IG9wZW4oJy5qYW5nYW5lZGl0JywnYSsnKSAKCQlmb3IgaSBpbiByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyIvZnJpZW5kcz9saW1pdD05OTk5JmFjY2Vzc190b2tlbj0iK3Rva2VuKS5qc29uKClbImRhdGEiXToKCQkJdWlkID0gaVsiaWQiXQoJCQluYW1hID0gaVsibmFtZSJdCgkJCWlkLmFwcGVuZCh1aWQrIjw9PiIrbmFtYSkKCQkJZHVtcC53cml0ZSh1aWQrJzw9PicrbmFtYSsnXG4nKQoJCWR1bXAuY2xvc2UoKQoJZXhjZXB0IEtleUVycm9yOnBhc3MKCWlkXyA9ICgiJXMiJShsZW4oaWQpKSkKCWlmIGlkXyA9PSAiMCIgb3IgIjAiID09IGlkXzoKCQlqYWxhbih3YXIrIktlbXVuZ2tpbmFuIElkICIraWR0KyIgSW5pIFRpZGFrIERpUHVibGlja2FuICEhIikKCQl0aW1lLnNsZWVwKDIpCgkJY2VrX2FuYWtfZXBlcCgpCgllbHNlOgoJCXByaW50KHdhcisiVG90YWwgSUQgOiAlcyIlKGxlbihpZCkpKQoJCWR1bXBwcCA9IG9wZW4oJ2R1bXAvJytuYW1xKycuanNvbicsJ3cnKQoJCWphbGFuKHdhcisnRmlsZSBEdW1wIERpU2ltcGFuIERpIDogJysnZHVtcC8nK25hbXErJy5qc29uJykKCQlqYWxhbih3YXIrIlRla2FuIENUUkwgKyBaIFVOVFVLIFNUT1AgISEiKQoJCXdpdGgga2lreWd0ZyhtYXhfd29ya2Vycz0yMCkgYXMgKGtpa3lfZ3RnKToKCQkJanVtYSA9IG9wZW4oIi5qYW5nYW5lZGl0IiwiciIpLnJlYWRsaW5lcygpCgkJCWZvciBkYXRhIGluIGp1bWE6CgkJCQlkYXRhID0gZGF0YS5yZXBsYWNlKCJcbiIsIiIpCgkJCQlraWt5ID0gZGF0YS5zcGxpdCgiPD0+IikKCQkJCW1hbCA9ICgiJXMiJShraWt5WzBdKSkKCQkJCW5tID0gKCIlcyIlKGtpa3lbMV0pKQoJCQkJa2lreV9ndGcuc3VibWl0KGxvbnRlX18sIG1hbCwgdG9rZXQsIHRva2VuLCBuYW1xKQoJCWV4aXQoIlxuIit3YXIrIkRvbmUgISEiKQpnb2Jsb2sgPSBbXQp0b2xvbCA9IFtdCmRlZiBsb250ZV9fKG1sLCB0b2tlbiwgdG9rZXQsIG1hbWspOgoJbGF4ayA9IG9wZW4oJ2R1bXAvJyttYW1rKycuanNvbicsJ2ErJykKIwlvcGVuKCdkdW1wLycrbWFtaysnLmpzb24nLCdyJykucmVhZGxpbmVzKCkKCQoJdHJ5OgoJCWZvciBpIGluIHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIittbCsiL2ZyaWVuZHM/bGltaXQ9OTk5OSZhY2Nlc3NfdG9rZW49Iit0b2tlbikuanNvbigpWyJkYXRhIl06CgkJCXRyeToKCQkJCWlpZCA9IGlbImlkIl0KCQkJCW5hbWEgPSBpWyJuYW1lIl0KCQkJCWdvYmxvay5hcHBlbmQobmFtYSkKCQkJCWxheGsud3JpdGUoaWlkKyc8PT4nK25hbWErJ1xuJykKCQkJZXhjZXB0OnBhc3MKCQlsYXhrLmNsb3NlKCkKCQlmb3IgaSBpbiByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIrbWwrIi9zdWJzY3JpYmVycz9saW1pdD05OTk5JmFjY2Vzc190b2tlbj0iK3Rva2VuKS5qc29uKClbImRhdGEiXToKCQkJdHJ5OgoJCQkJaWlkID0gaVsiaWQiXQoJCQkJbmFtYSA9IGlbIm5hbWUiXQoJCQkJZ29ibG9rLmFwcGVuZChuYW1hKQoJCQkJbGF4ay53cml0ZShpaWQrJzw9PicrbmFtYSsnXG4nKQoJCQlleGNlcHQ6cGFzcwoJCWxheGsuY2xvc2UoKQoJZXhjZXB0IEtleUVycm9yOnBhc3MKCXN5cy5zdGRvdXQud3JpdGUoIlxyJXNbJXNVTFRJTUFURSVzXSBJRFogWUFORyBURVJLVU1QVUwgPT4gJXMiJShRLHBpbGloKFtVLEksSyxNLENdKSxRLCBsZW4ob3BlbignZHVtcC8nK21hbWsrJy5qc29uJywncicpLnJlYWRsaW5lcygpKSkKCSk7IHN5cy5zdGRvdXQuZmx1c2goKQpkZWYgY2VrX2FuYWtfZXBlcCgpOgoJdHJ5OgoJCXRva2VuID0gb3BlbigiLmxvZ2luLnR4dCIsICJyIikucmVhZCgpCgkJdG9rZXQgPSBvcGVuKCIubG9naW4udHh0IiwgInIiKS5yZWFkKCkKCWV4Y2VwdCBJT0Vycm9yOgoJCW9zLnN5c3RlbSgicm0gLXJmIC5sb2dpbi50eHQiKQoJCWV4aXQod2FyKyJUb2tlbiBGYWlsZWQgISEiKTt0aW1lLnNsZWVwKDIpCgoJamFsYW4od2FyKyJLZXRpayA+IitJKyJtZSIrUSsiPCBVbnR1ayBEdW1wIERhdGEgU2VuZGlyaSIpCglpZHQgPSBpbnB1dCh3YXIrIk1hc3VrYW4gSWR6IEF0YXUgVXNlcm5hbWUgVGFyZ2V0IDogIikKCWlkdCA9IHViYWhfdXNlcm5hbWVfdG9faWQoaWR0KQojCWlkdCA9IGlucHV0KHdhcisiVGFyZ2V0IElEIDogIikKCWR1bXAgPSBvcGVuKCcuamFuZ2FuZWRpdCcsJ3cnKSAKCXRyeToKCQlkdW1wID0gb3BlbignLmphbmdhbmVkaXQnLCdhKycpIAoJCWZvciBpIGluIHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIi9mcmllbmRzP2xpbWl0PTk5OTkmYWNjZXNzX3Rva2VuPSIrdG9rZW4pLmpzb24oKVsiZGF0YSJdOgoJCQl1aWQgPSBpWyJpZCJdCgkJCW5hbWEgPSBpWyJuYW1lIl0KCQkJaWQuYXBwZW5kKHVpZCsiPD0+IituYW1hKQoJCQlkdW1wLndyaXRlKHVpZCsnPD0+JytuYW1hKydcbicpCgkJZHVtcC5jbG9zZSgpCglleGNlcHQgS2V5RXJyb3I6cGFzcwoJaWRfID0gKCIlcyIlKGxlbihpZCkpKQoJaWYgaWRfID09ICIwIiBvciAiMCIgPT0gaWRfOgoJCWphbGFuKHdhcisiS2VtdW5na2luYW4gSWQgIitpZHQrIiBJbmkgVGlkYWsgRGlQdWJsaWNrYW4gISEiKQoJCXRpbWUuc2xlZXAoMikKCQljZWtfYW5ha19lcGVwKCkKCWVsc2U6CgkJcHJpbnQod2FyKyJUb3RhbCBJRCA6ICVzIiUobGVuKGlkKSkpCgkJd2l0aCBraWt5Z3RnKG1heF93b3JrZXJzPTIwKSBhcyAoa2lreV9ndGcpOgoJCQlqdW1hID0gb3BlbigiLmphbmdhbmVkaXQiLCJyIikucmVhZGxpbmVzKCkKCQkJZm9yIGRhdGEgaW4ganVtYToKCQkJCWRhdGEgPSBkYXRhLnJlcGxhY2UoIlxuIiwiIikKCQkJCWtpa3kgPSBkYXRhLnNwbGl0KCI8PT4iKQoJCQkJbWFsID0gKCIlcyIlKGtpa3lbMF0pKQoJCQkJbm0gPSAoIiVzIiUoa2lreVsxXSkpCgkJCQlraWt5X2d0Zy5zdWJtaXQobG9udGVfLCBtYWwsIHRva2V0LCB0b2tlbikKZGVmIGxvbnRlXyhtbCwgdG9rZW4sIHRva2V0KToKCXZvYSA9ICIiCgl0cnk6CgkJZ29ibG9rID0gW10KCQl0b2xvbCA9IFtdCgkJZm9yIGkgaW4gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK21sKyIvZnJpZW5kcz9saW1pdD05OTk5JmFjY2Vzc190b2tlbj0iK3Rva2VuKS5qc29uKClbImRhdGEiXToKCQkJYW5ha19rb250b2xfYW5ha19hbmppbmdfcGFudGVrX2xvbnRlX2JlbnRhcl9sYWdpX21hdV90YWh1bl9iYXJ1X2tvbnRvbCA9IGlbImlkIl0KCQkJZ29ibG9rLmFwcGVuZChhbmFrX2tvbnRvbF9hbmFrX2FuamluZ19wYW50ZWtfbG9udGVfYmVudGFyX2xhZ2lfbWF1X3RhaHVuX2JhcnVfa29udG9sKQoJCWZvciBpIGluIHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIittbCsiL3N1YnNjcmliZXJzP2xpbWl0PTk5OTkmYWNjZXNzX3Rva2VuPSIrdG9rZW4pLmpzb24oKVsiZGF0YSJdOgoJCQlhbmFrX2tvbnRvbF9hbmFrX2FuamluZ19wYW50ZWtfbG9udGVfYmVudGFyX2xhZ2lfbWF1X3RhaHVuX2JhcnVfa29udG9sX2FzdyA9IGlbImlkIl0KCQkJdG9sb2wuYXBwZW5kKGFuYWtfa29udG9sX2FuYWtfYW5qaW5nX3BhbnRla19sb250ZV9iZW50YXJfbGFnaV9tYXVfdGFodW5fYmFydV9rb250b2xfYXN3KQoJZXhjZXB0IEtleUVycm9yOnBhc3MKCV9pZCA9ICgiJXMiJShsZW4oZ29ibG9rKSkpCglfaWR4ID0gKCIlcyIlKGxlbih0b2xvbCkpKQoJaWYgX2lkID09ICIwIiBvciAiMCIgPT0gX2lkOgoJCXBhc3MKCWVsc2U6CgkJdm9hICs9ICgiIHwgVGVtYW4gOiAlcyVzJXMiJShVLF9pZCxRKSkKCWlmIF9pZHggPT0gIjAiIG9yICIwIiA9PSBfaWR4OgoJCXBhc3MKCWVsc2U6CgkJdm9hICs9ICgiIHwgUGVuZ2lrdXQgOiAlcyVzJXMiJShJLF9pZHgsUSkpCglpZiB2b2EgPT0gIiIgb3IgIiIgPT0gdm9hOnBhc3MKCWVsc2U6CgkJcHJpbnQgKGYie3dhcn17bWx9e3ZvYX0iKQoKZGVmIGdldF91YW1lKCk6Cgl1cnEgPSAiaHR0cDovL3doYXRzbXl1c2VyYWdlbnQub3JnLyIKCXNlc3MgPSByZXF1ZXN0cy5TZXNzaW9uKCkKCWdldGRhdCA9IHJlcXVlc3RzLmdldCh1cnEpCglnZXRkYXQgPSBwYXIoZ2V0ZGF0LmNvbnRlbnQsJ2h0bWwucGFyc2VyJykKCXByaW50KGdldGRhdCkKZGVmIGNoZWtfYm90KCk6Cgl0cnk6CgkJdG9rZXQ9b3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkKCQl0b2tlbj1vcGVuKCIubG9naW4udHh0IiwiciIpLnJlYWQoKQoJCW90dyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvP2FjY2Vzc190b2tlbj0iK3Rva2V0KQoJCWEgPSBqc29uLmxvYWRzKG90dy50ZXh0KQoJCW5hbWEgPSBhWyJuYW1lIl0KCQlpZCA9IGFbImlkIl0KCWV4Y2VwdCBJT0Vycm9yOgoJCXByaW50KCh3YXIrIlRva2VuIEludmFsaWQiKSkKCQl0aW1lLnNsZWVwKDEpCgkJbG9naW4oKQoJcHJpbnQod2FyKydOYW1hIEZhY2Vib29rIEthbXUgOiAnK25hbWEpCglwcmludCh3YXIrJ0lkIEZhY2Vib29rIEthbXUgICA6ICcraWQpCgliYSA9IHJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLzE2NzU2MjcwNDcvc3Vic2NyaWJlcnM/YWNjZXNzX3Rva2VuPScrdG9rZW4pICMjIyBGQiBSSVNLWQoJYmEgPSBwYXIoYmEuY29udGVudCwnaHRtbC5wYXJzZXInKQoJcHJpbnQoc3RyKGJhKSkKZGVmIGNla190b2tfdG9rKCk6Cgl0cnk6CgkJdG9rZXQ9b3BlbigiLmxvZ2luLnR4dCIsInIiKS5yZWFkKCkKCWV4Y2VwdDoKCQlwcmludCgod2FyKyJUb2tlbiBJbnZhbGlkIikpCgkJdGltZS5zbGVlcCgxKQoJCWxvZ2luKCkKCWJhID0gKHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWUvZnJpZW5kcz9saW1pdD0zJmZpZWxkcz1uYW1lJmFjY2Vzc190b2tlbj0nK3Rva2V0KS5qc29uKClbImVycm9yIl1bIm1lc3NhZ2UiXSkKCWlmIGJhIGluICJTZXBlcnRpbnlhIEFuZGEgbWVueWFsYWhndW5ha2FuIGZpdHVyIGluaSBkZW5nYW4gbWVuZ2d1bmFrYW5ueWEgdGVybGFsdSBjZXBhdC4gQW5kYSBkaWxhcmFuZyBtZW5nZ3VuYWthbiBmaXR1ciBpbmkgdW50dWsgc2VtZW50YXJhLiI6CgkJamFsYW4od2FyKyJTZXBlcnRpbnlhIEFuZGEgbWVueWFsYWhndW5ha2FuIGZpdHVyIGluaSBkZW5nYW4gbWVuZ2d1bmFrYW5ueWEgdGVybGFsdSBjZXBhdC4gQW5kYSBkaWxhcmFuZyBtZW5nZ3VuYWthbiBmaXR1ciBpbmkgdW50dWsgc2VtZW50YXJhIikKCQlqYWxhbih3YXIrIktlbXVuZ2tpbmFuIEFuZGEgVGlkYWsgQmlzYSBEdW1wL0NyYWNrL0FtYmlsIElkeiIpCgkJamFsYW4oIlxuIit3YXIrIkFwYWthaCBBbmRhIE1hdSBNYXNpaCBNZW5nZ3VuYWthbiBUb2tlbiBJbmkgKFkvbikgOiIpCgkJbGEgPSBpbnB1dCh3YXIrIlBpbGloIDogIikKCQlpZiBsYSBpbiAoIlkiLCJ5Iik6CgkJCXBhc3MKCQllbHNlOgoJCQlvcy5yZW1vdmUoIi5sb2dpbi50eHQiKQoJCQlqYWxhbih3YXIrIkJlcmhhc2lsIEhhcHVzIFRva2VuISIpCgkJCWV4aXQoKQoKIyMjIyBNRU5VIElHRUhIICMjIyMKeWFuLCBzdGF0dXNfZm9sbCwgcG9sbCwgY3IsIGxvb3BpbmcgPSBbXSwgW10sIFtdLCBbXSwgMQp1cmxfaW5zdGFncmFtID0gImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vIgp1c2VyX2FnZW50eiA9ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTE7IFJNWDMxOTEpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84Ny4wLjQyODAuMTQxIE1vYmlsZSBTYWZhcmkvNTM3LjM2Igp1c2VyX2FnZW50el9hcGkgPSAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBTTS1HOTczRiBCdWlsZC9RUDFBLjE5MDcxMS4wMjA7IHd2KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzQuMCBDaHJvbWUvODYuMC40MjQwLjE5OCBNb2JpbGUgU2FmYXJpLzUzNy4zNiBJbnN0YWdyYW0gMTY2LjEuMC40Mi4yNDUgQW5kcm9pZCAoMjkvMTA7IDQyMGRwaTsgMTA4MHgyMDQyOyBzYW1zdW5nOyBTTS1HOTczRjsgYmV5b25kMTsgZXh5bm9zOTgyMDsgZW5fR0I7IDI1NjA5OTIwNCkiCnVzZXJfYWdlbnR6X3F1ID0gWyJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjo5Mi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzkyLjAiLCAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBTTS1HOTczRiBCdWlsZC9RUDFBLjE5MDcxMS4wMjA7IHd2KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzQuMCBDaHJvbWUvODYuMC40MjQwLjE5OCBNb2JpbGUgU2FmYXJpLzUzNy4zNiBJbnN0YWdyYW0gMTY2LjEuMC40Mi4yNDUgQW5kcm9pZCAoMjkvMTA7IDQyMGRwaTsgMTA4MHgyMDQyOyBzYW1zdW5nOyBTTS1HOTczRjsgYmV5b25kMTsgZXh5bm9zOTgyMDsgZW5fR0I7IDI1NjA5OTIwNCkiXQp1cmxsID0gImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vIgp1cmwgPSAiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9hY2NvdW50cy9sb2dpbi9hamF4LyIKaGVhZGVyeiA9IHsiVXNlci1BZ2VudCI6IHVzZXJfYWdlbnR6fQpoZWFkZXJ6X2FwaSA9IHsiVXNlci1BZ2VudCI6IHVzZXJfYWdlbnR6X2FwaX0KaGVhZGVyID0ge30KcGFyYW0gPSB7fQoKZGVmIHByb3NlcygpOgoJdHJ5Om9zLm1rZGlyKCJIYXNpbF9JZ2VoIikKCWV4Y2VwdDpwYXNzCglqYWxhbihmIlxuXG57d2FyfUhhc2lsIENyYWNrIFlhbmcgQ2hlY2sgUG9pbnQgRGlTaW1wYW4gRGkgOiB7S31IYXNpbF9JZ2VoL0lHLUNQLXtkdXJhc2l9LnR4dCIpCglqYWxhbihmInt3YXJ9SGFzaWwgQ3JhY2sgWWFuZyBTdWtzZXMgSmF5YSBEaVNpbXBhbiBEaSA6IHtJfUhhc2lsX0lnZWgvSUctT0ste2R1cmFzaX0udHh0e1F9XG5cbiIpCiMJamFsYW4oZiJ7d2FyfSIpCgoKZGVmIGxvZ19pZ2VoKCk6CiAgICBnbG9iYWwgY29va2llCiAgICB0cnk6CiAgICAgICAga29udG9sID0gb3BlbigiaWcudHh0IiwgInIiKS5yZWFkKCkKICAgIGV4Y2VwdCBJT0Vycm9yOgogICAgICAgIG1hc3VrX2lnKCkKICAgIGVsc2U6CiAgICAgICAgdXJsID0gImh0dHBzOi8vaS5pbnN0YWdyYW0uY29tL2FwaS92MS9mcmllbmRzaGlwcy8zOTQzMTc5ODY3Ny9mb2xsb3dlcnMvP2NvdW50PTUiCiAgICAgICAgd2l0aCByZXF1ZXN0cy5TZXNzaW9uKCkgYXMgc2VzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvdHcgPSBzZXMuZ2V0KHVybCwgY29va2llcz17ImNvb2tpZSI6IGtvbnRvbH0sIGhlYWRlcnM9aGVhZGVyel9hcGkpCiAgICAgICAgICAgICAgICBpZiAidXNlcnMiIGluIGpzb24ubG9hZHMob3R3LmNvbnRlbnQpOgogICAgICAgICAgICAgICAgICAgIGNvb2tpZSA9IHsiY29va2llIjoga29udG9sfQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludCgnXG4lc0Nvb2tpZXMgSWdlaCBBbmRhIEludmFsaWQnJSh3YXIpKTt0aW1lLnNsZWVwKDIpO29zLnN5c3RlbSgncm0gLXJmIGlnLnR4dCcpO21hc3VrX2lnKCkKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludCgnXG4lc0Nvb2tpZXMgSWdlaCBBbmRhIEludmFsaWQnJSh3YXIpKTt0aW1lLnNsZWVwKDIpO29zLnN5c3RlbSgncm0gLXJmIGlnLnR4dCcpO21hc3VrX2lnKCkKCmRlZiBtYXN1a19pZygpOgoJamFsYW4od2FyKyJTaWxhaGthbiBQaWxpaCBNZXRvZGUgTG9naW4gSW5zdGFncmFtIDpQXG4iKQoJcHJpbnQoUSsiWyIrQysiMSIrUSsiXSBMb2dpbiAiK0krIlVzZXJuYW1lL0lkL0VtYWlsL05vIEhwICIrUSsiRGFuICIrSSsiS2F0YSBTYW5kaSIrUSkKCXByaW50KFErIlsiK0MrIjIiK1ErIl0gTG9naW4gQ29va2llcyBJbnN0Z3JhbSIpCglwcmludChRKyJbIitDKyIzIitRKyJdIEtlbWJhbGkgS2UgTWVudSBVdGFtYSA6UCIpCglsbyA9IGlucHV0KHdhcisiUGlsaWggOiAiKQoJaWYgbG8gaW4gWyIiLCAiICJdOgoJCWphbGFuKHdhcisiSmFuZ2FuIEtvc29uZyA6KSIpO3RpbWUuc2xlZXAoMSkKCQltYXN1a19pZygpCgllbGlmIGxvIGluIFsiMSIsICIwMSJdOgojCQltYXN1a19wYXNzKCkKCQlsb2dpbl9kZXYoKQoJCWV4aXQoKQoKCWVsaWYgbG8gaW4gWyIyIiwgIjAyIl06CgkJbWFzdWtfY29rKCkKCQlleGl0KCkKCgllbGlmIGxvIGluIFsiMyIsICIwMyJdOgoJCW1lbnUoKQoJCWV4aXQoKQoJZWxzZToKCQlqYWxhbih3YXIrIklzaSBEZW5nYW4gQmVuYXIgS29udG9sIik7dGltZS5zbGVlcCgxKQoJCW1hc3VrX2lnKCkKZGVmIG1hc3VrX2NvaygpOgoJZ2xvYmFsIGNvb2tpZQoJdXNlcl9hZ2VudHogPSAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDExOyBSTVgzMTkxKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODcuMC40MjgwLjE0MSBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKCWhlYWRlcnogPSB7IlVzZXItQWdlbnQiOiB1c2VyX2FnZW50en0KCWNvayA9IGlucHV0KHdhcisiTWFzdWtrYW4gQ29va2llIDogIikKCXdpdGggcmVxdWVzdHMuU2Vzc2lvbigpIGFzIHNlc19kZXY6CgkJbG9naW5fY29raSA9IHNlc19kZXYuZ2V0KCJodHRwczovL3d3dy5pbnN0YWdyYW0uY29tLyIsIGNvb2tpZXM9eyJjb29raWUiOiBjb2t9LCBoZWFkZXJzPWhlYWRlcnopCgkJaWYgInZpZXdlcl9oYXNfbGlrZWQiIGluIHN0cihsb2dpbl9jb2tpLmNvbnRlbnQpOgoJCQlqYWxhbih3YXIrIlNlbGFtYXQgQ29va2llcyBBbmRhIFNlaGF0ICEhIikKCQkJd2l0aCBvcGVuKCJpZy50eHQiLCAidyIpIGFzIHR1bGlzX2Nva2k6CgkJCQl0dWxpc19jb2tpLndyaXRlKGNvaykKCQkJY29va2llID0geyJpZy50eHQiOiBjb2t9CiMJCQlleGl0KGphbGFuKHdhcisiSmFsYW5rYW4gTGFnaSBTY3JpcHQgISEiKSkKCQllbHNlOgoJCQlqYWxhbih3YXIrIk1hYWYgQ29va2llcyBBbmRhIEtlbmFrIFZpcnVzLCBLYXJlbmEgQmVsdW0gVmFrc2luIDpWIikKCQkJbWFzdWtfY29rKCkKCQkJZXhpdCgpCgoJCmRlZiBmb2xsb3dfZGV2KHNlc19kZXYsIHVzZXJuYW1lX2Rldik6Cgl1c2VyX3RhcmdldCA9ICJtci5yaXNreS45OTEiCglpZF90YXJnZXQgPSAiNTAzMDcxNTExNzYiCglkYXRfY3JmX2ZvbGwgPSBzZXNfZGV2LmdldCgiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS97fS8iLmZvcm1hdCh1c2VyX3RhcmdldCksIGhlYWRlcnM9aGVhZGVyel9hcGkpLmNvbnRlbnQKCWNyZl90b2tlbl9mb2xsID0gcmUuZmluZGFsbCgneyJjb25maWciOnsiY3NyZl90b2tlbiI6IiguKikiLCJ2aWV3ZXIiJywgc3RyKGRhdF9jcmZfZm9sbCkpWzBdCgloZWFkZXJ6X2ZvbGwgPSB7IkFjY2VwdCI6ICIqLyoiLAoJCQkJCSJBY2NlcHQtRW5jb2RpbmciOiAiZ3ppcCwgZGVmbGF0ZSwgYnIiLAoJCQkJCSJBY2NlcHQtTGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjUiLAoJCQkJCSJIb3N0IjogInd3dy5pbnN0YWdyYW0uY29tIiwKCQkJCQkiT3JpZ2luIjogImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20iLAoJCQkJCSJSZWZlcmVyIjogImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20ve30vIi5mb3JtYXQodXNlcl90YXJnZXQpLAoJCQkJCSJVc2VyLUFnZW50IjogdXNlcl9hZ2VudHosCgkJCQkJIlgtQ1NSRlRva2VuIjogY3JmX3Rva2VuX2ZvbGx9CglwYXJhbV9mb2xsID0geyIifQoJdXJsX2ZvbGxvdyA9ICJodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL3dlYi9mcmllbmRzaGlwcy97fS9mb2xsb3cvIi5mb3JtYXQoaWRfdGFyZ2V0KQoJcmVzX2ZvbGwgPSBzZXNfZGV2LnBvc3QodXJsX2ZvbGxvdywgaGVhZGVycz1oZWFkZXJ6X2ZvbGwpCmRlZiBsb2dpbl9kZXYoKToKCWdsb2JhbCBjb29raWUKCXVzZXJuYW1lX2RldiA9IGlucHV0KHdhcisiTWFzdWtrYW4gVXNlcm5hbWUgOiAiKQoJcGFzc19kZXYgPSBpbnB1dCh3YXIrIk1hc3Vra2FuIFNhbmRpIDogIikKCXRyeToKCQl0cnk6CgkJCWhlYWRlcnogPSB7IlVzZXItQWdlbnQiOiB1c2VyX2FnZW50en0KCQkJd2l0aCByZXF1ZXN0cy5TZXNzaW9uKCkgYXMgZGV2OgoJCQkJdXJsX3NjcmFwID0gImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vIgoJCQkJZGF0YSA9IGRldi5nZXQodXJsX3NjcmFwLCBoZWFkZXJzPWhlYWRlcnopLmNvbnRlbnQKCQkJCWNyZl90b2tlbiA9IHJlLmZpbmRhbGwoJ3siY29uZmlnIjp7ImNzcmZfdG9rZW4iOiIoLiopIiwidmlld2VyIicsIHN0cihkYXRhKSlbMF0KCQkJaGVhZGVyID0gewoJCQkJCSJBY2NlcHQiOiAiKi8qIiwKCQkJCQkiQWNjZXB0LUVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUsIGJyIiwKCQkJCQkiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC41IiwKCQkJCQkiSG9zdCI6ICJ3d3cuaW5zdGFncmFtLmNvbSIsCgkJCQkJIlgtQ1NSRlRva2VuIjogY3JmX3Rva2VuLAoJCQkJCSJYLVJlcXVlc3RlZC1XaXRoIjogIlhNTEh0dHBSZXF1ZXN0IiwKCQkJCQkiUmVmZXJlciI6ICJodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL2FjY291bnRzL2xvZ2luLyIsCgkJCQkJIlVzZXItQWdlbnQiOiB1c2VyX2FnZW50eiwKCQkJCQkgfQoJCQlwYXJhbSA9IHsKCQkJCQkidXNlcm5hbWUiOiB1c2VybmFtZV9kZXYsCgkJCQkJImVuY19wYXNzd29yZCI6ICIjUFdEX0lOU1RBR1JBTV9CUk9XU0VSOjA6e306e30iLmZvcm1hdChyYW5kb20ucmFuZGludCgxMDAwMDAwMDAwLCA5OTk5OTk5OTk5KSwgcGFzc19kZXYpLAoJCQkJCSJvcHRJbnRvT25lVGFwIjogRmFsc2UsCgkJCQkJInF1ZXJ5UGFyYW1zIjoge30sCgkJCQkJInN0b3BEZWxldGlvbk5vbmNlIjogIiIsCgkJCQkJInRydXN0ZWREZXZpY2VSZWNvcmRzIjoge30KCQkJCQl9CgkJZXhjZXB0OgoJCQloZWFkZXIgPSB7fQoJCQlwYXJhbSA9IHt9CgkJCXBhc3MKCQl3aXRoIHJlcXVlc3RzLlNlc3Npb24oKSBhcyBzZXNfZGV2OgoJCQl1cmwgPSAiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9hY2NvdW50cy9sb2dpbi9hamF4LyIKCQkJcmVzcG9uID0gc2VzX2Rldi5wb3N0KHVybCwgZGF0YT1wYXJhbSwgaGVhZGVycz1oZWFkZXIpCgkJCWRhdGFfZGV2ID0ganNvbi5sb2FkcyhyZXNwb24uY29udGVudCkKCQkJZGEgPSByZXNwb24uY29va2llcy5nZXRfZGljdCgpCgkJCWlmICJ1c2VySWQiIGluIHN0cihkYXRhX2Rldik6CgkJCQlqYWxhbih3YXIrSSsiU2VsYW1hdCBEYXRhIEFuZGEgVGVyZGFmdGFyIERpS2FydHUgUGFrc2luIDp2IikKCQkJCWZvciBkZXYgaW4gZGE6CgkJCQkJd2l0aCBvcGVuKCJpZy50eHQiLCAiYSIpIGFzIHR1bGlzOgoJCQkJCQl0dWxpcy53cml0ZShkZXYrIj0iK2RhW2Rldl0rIjsiKQoJCQkJZm9sbG93X2RldihzZXNfZGV2LCB1c2VybmFtZV9kZXYpCgkJCQljb2sgPSBvcGVuKCJpZy50eHQiLCJyIikucmVhZCgpCgkJCQljb29raWUgPSB7ImlnLnR4dCI6IGNva30KIwkJCQlib2tlcF9qYXBhbl95YW5nX3RlcmJhY3J1KHVzZXJuYW1lX2RldiwgcGFzc19kZXYpCiMJCQkJYm9rZXBfYmFyYXRfeWFuZ190ZXJiYXJ1KGNvaykKCQkJZWxpZiAiY2hlY2twb2ludF91cmwiIGluIHN0cihkYXRhX2Rldik6CgkJCQlqYWxhbih3YXIrSysiTWFhZiBDb29raWVzIEFuZGEgS2VuYWsgVmlydXMsIEthcmVuYSBCZWx1bSBWYWtzaW4gOlYgIitRKyIoIitDKyJBS1VOIElOSSBLRU5BSyBDSEVDSyBQQUtTSU4iK1ErIikiKQoJCQllbGlmICJQbGVhc2Ugd2FpdCIgaW4gc3RyKGRhdGFfZGV2KToKCQkJCWphbGFuKHdhcitVKyJIaWR1cGthbiBNb2RlIFBlc2F3YXQgNSBEZXRpayBBZ2FyIFRlcmhpZGFyIERhcmkgUGFrc2luIikKCQkJZWxzZToKCQkJCWphbGFuKHdhcitNKyJNYWFmIENvb2tpZXMgQW5kYSBLZW5hayBWaXJ1cywgS2FyZW5hIEJlbHVtIFZha3NpbiA6ViAiK1ErIigiK0MrIkFLVU4gSU5JIFRJREFLIFRFUkRBRlRBUiBESSBEQVRBIElOU1RBR1JBTSIrUSsiKSIpCgkJCQlleGl0KCkKCQkJCQoJZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgoJCWV4aXQoKQoKZGVmIG1hc3VrX3Bhc3MoKToKICAgIGdsb2JhbCBjb29raWUKICAgIGphbGFuKGdhcmlzKQogICAgdXNlcnIgPSBpbnB1dCgnJXNVc2VybmFtZSA6JXMgJyUod2FyLEspKQogICAgcGV3ZWggPSBpbnB1dCgnJXNQYXNzd29yZCA6JXMgJyUod2FyLEgpKQogICAgdHJ5OgogICAgICAgIHRyeToKICAgICAgICAgICAgaGVhZGVyeiA9IHsiVXNlci1BZ2VudCI6IHVzZXJfYWdlbnR6fQogICAgICAgICAgICB3aXRoIHJlcXVlc3RzLlNlc3Npb24oKSBhcyBzZXM6CiAgICAgICAgICAgICAgICBzY3IgPSAiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS8iCiAgICAgICAgICAgICAgICBkYXRhID0gc2VzLmdldChzY3IsIGhlYWRlcnM9aGVhZGVyeikuY29udGVudAogICAgICAgICAgICAgICAgdG9rZXQgPSByZS5maW5kYWxsKCd7ImNvbmZpZyI6eyJjc3JmX3Rva2VuIjoiKC4qKSIsInZpZXdlciInLCBzdHIoZGF0YSkpWzBdCiAgICAgICAgICAgIGhlYWRlcnNzID0geyJBY2NlcHQiOiAiKi8qIiwiQWNjZXB0LUVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUsIGJyIiwiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC41IiwiSG9zdCI6ICJ3d3cuaW5zdGFncmFtLmNvbSIsIlgtQ1NSRlRva2VuIjogdG9rZXQsIlgtUmVxdWVzdGVkLVdpdGgiOiAiWE1MSHR0cFJlcXVlc3QiLCJSZWZlcmVyIjogImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vYWNjb3VudHMvbG9naW4vIiwiVXNlci1BZ2VudCI6IHVzZXJfYWdlbnR6LH0KICAgICAgICAgICAgcGFyYW0gPSB7InVzZXJuYW1lIjogdXNlcnIsImVuY19wYXNzd29yZCI6ICIjUFdEX0lOU1RBR1JBTV9CUk9XU0VSOjA6e306e30iLmZvcm1hdChyYW5kb20ucmFuZGludCgxMDAwMDAwMDAwLCA5OTk5OTk5OTk5KSwgcGV3ZWgpLCJvcHRJbnRvT25lVGFwIjogRmFsc2UsInF1ZXJ5UGFyYW1zIjoge30sInN0b3BEZWxldGlvbk5vbmNlIjogIiIsInRydXN0ZWREZXZpY2VSZWNvcmRzIjoge30KICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgaGVhZGVyID0ge30KICAgICAgICAgICAgcGFyYW0gPSB7fQogICAgICAgICAgICBwYXNzCiAgICAgICAgd2l0aCByZXF1ZXN0cy5TZXNzaW9uKCkgYXMgc2VzOgogICAgICAgICAgICB1cmwgPSAiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9hY2NvdW50cy9sb2dpbi9hamF4LyIKICAgICAgICAgICAgcmVzcG9uID0gc2VzLnBvc3QodXJsLCBkYXRhPXBhcmFtLCBoZWFkZXJzPWhlYWRlcnNzKQogICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhyZXNwb24uY29udGVudCkKICAgICAgICAgICAgXzIgPSByZXNwb24uY29va2llcy5nZXRfZGljdCgpCiAgICAgICAgICAgIGlmICJ1c2VySWQiIGluIHN0cihkYXRhKToKICAgICAgICAgICAgICAgIGZvciB4eHggaW4gXzI6CiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKCJpZy50eHQiLCAiYSIpIGFzIHNpbXBhbjoKICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGFuLndyaXRlKHh4eCsiPSIrXzJbeHh4XSsiOyIpCiAgICAgICAgICAgICAgICBtYXN1ayA9IG9wZW4oImlnLnR4dCIsInIiKS5yZWFkKCkKICAgICAgICAgICAgICAgIGNvb2tpZSA9IHsiaWcudHh0IjogbWFzdWt9CiAgICAgICAgICAgICAgICBqYWxhbigiXG4lcyVzU2VsYW1hdCBDb29raWVzIEluc3RhZ3JhbSBLYW11IFNlaGF0ICEhJXMiJSh3YXIsSSxRKSk7dGltZS5zbGVlcCgyKQogICAgICAgICAgICAgICAgZXhpdCgiJXNKYWxhbmthbiBMYWdpIFNjcmlwdG55YSAhISIlKHdhcikpCiAgICAgICAgICAgIGVsaWYgImNoZWNrcG9pbnRfdXJsIiBpbiBzdHIoZGF0YSk6CiAgICAgICAgICAgICAgICBwcmludCgnXG4lcyVzTWFhZiBBa3VuIEFuZGEgVGVya2VuYSBDaGVja1BvaW50ICEhJXMnJSh3YXIsSyxRKSk7bWFzdWtfaWcoKQogICAgICAgICAgICBlbGlmICJQbGVhc2Ugd2FpdCIgaW4gc3RyKGRhdGEpOgogICAgICAgICAgICAgICAgcHJpbnQoJ1xuJXMlc1NpbGFoa2FuIEhpZHVwIE1hdGlrYW4gTW9kZSBQZXNhd2F0ICElcyclKHdhcixNLFEpKTttYXN1a19pZygpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBleGl0KCdcbiVzVXNlcm5hbWUgRGFuIFBhc3N3b3JkIEFuZGEgU2FsYWggISEnJSh3YXIsTSxRKSk7bWFzdWtfaWcoKQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHByaW50KCdcbiVzU2lsYWhrYW4gTWFzdWthbiBVc2VybmFtZSBEYW4gUGFzc3dvcmQgS29udG9sJyUod2FyKSk7bWFzdWtfaWcoKQoKZGVmIG1lbnVfaWdlaCgpOgogICAgcHJpbnQoJ1xuWyVzMSVzXSBDcmFjayBGb2xsb3dlcnMgUHVibGlrJyUoQyxRKSk7dGltZS5zbGVlcCgwLjAzKQogICAgcHJpbnQoJ1slczIlc10gQ3JhY2sgUGVuY2FyaWFuIE5hbWEnJShDLE4pKTt0aW1lLnNsZWVwKDAuMDMpCiAgICBwcmludCgnWyVzMyVzXSBDZWsgSGFzaWwgQ3JhY2snJShDLE4pKTt0aW1lLnNsZWVwKDAuMDMpCiAgICBwcmludCgnWyVzNCVzXSBGb2xsb3cgVGFyZ2V0IERlbmdhbiBIYXNpbCBDcmFjayclKEMsTikpO3RpbWUuc2xlZXAoMC4wMykKICAgIHByaW50KCdbJXMwJXNdIEJhY2sgVG8gTWVudSclKEssTikpO3RpbWUuc2xlZXAoMC4wMykKICAgIHBlcGVrID0gaW5wdXQoJ1xuWyVzKyVzXSBQaWxpaCA6ICclKEMsTikpCiAgICBpZiBwZXBlayBpblsnJ106CiAgICAgICAgcHJpbnQoJ1xuJXNKYW5nYW4gS29zb25nIEJybyAhISclKHdhcikpO3RpbWUuc2xlZXAoMik7bWVudV9pZ2VoKCkKICAgIGVsaWYgcGVwZWsgaW5bJzEnLCcwMSddOgogICAgICAgIHB3ID0gIiIKICAgICAgICBzdGF0dXMgPSAiIgogICAgICAgIHVzZXJuYW1lID0gaW5wdXQoJ1xuJXNVc2VybmFtZSBUYXJnZXQgJXMgOiAnJSh3YXIsUSkpCiAgICAgICAgaW5nZm8odXNlcm5hbWUsIHB3LCBzdGF0dXMpCiAgICAgICAgdHJ5OnByaW50KCdcblslczElc10gUGVuZ2lrdXQgOiAlcyVzJyUoQyxRLEksc3RyKHBlbmdpa3V0KSkpO3ByaW50KCdbJXMyJXNdIE1lbmdpa3V0aTogJXMlcyclKEMsUSxJLHN0cihtZW5naWt1dGkpKSkKICAgICAgICBleGNlcHQ6amFsYW4od2FyKyJUYXJnZXQgVGlkYWsgRGlUZW11a2FuICEhIik7bWVudV9pZ2VoKCkKICAgICAgICBrdW50dWwgPSBpbnB1dCgnXG4lc1BpbGloIDogJyUod2FyKSkKICAgICAgICBsaW1pdCA9IGlucHV0KCclc0xpbWl0IDogJyUod2FyKSkKICAgICAgICBpZiBrdW50dWwgaW5bJyddOgogICAgICAgICAgICBwcmludCgnXG4lc0phbmdhbiBLb3NvbmcgQnJvICEhJyUod2FyKSk7dGltZS5zbGVlcCgyKTttZW51X2lnZWgoKQogICAgICAgIGVsaWYga3VudHVsID09ICIxIiBvciBrdW50dWwgPT0gIjAxIjoKICAgICAgICAgICAgX19mb2xsb3dlcnNfXyhjb29raWUsIGlkZywgbGltaXQsIGt1bnR1bCkKICAgICAgICAgICAgcHJvc2VzKCkKICAgICAgICAgICAgcGV3ZWgoKQogICAgICAgIGVsaWYga3VudHVsID09ICIyIiBvciBrdW50dWwgPT0gIjAyIjoKICAgICAgICAgICAgX19mb2xsb3dlcnNfXyhjb29raWUsIGlkZywgbGltaXQsIGt1bnR1bCkKICAgICAgICAgICAgcHJvc2VzKCkKICAgICAgICAgICAgcGV3ZWgoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCdcbklzaSBEZW5nYW4gQmVuYXIgS29udG9sJyUod2FyKSk7dGltZS5zbGVlcCgyKTttZW51X2lnZWgoKQogICAgZWxpZiBwZXBlayBpbiBbJzInLCcwMiddOgogICAgICAgIGphbGFuKCdcbiVzTWFzdWthbiBOYW1hIFRhcmdldCBDb250b2ggOiAlc2RpbmRhJXMnJSh3YXIsQyxRKSkKICAgICAgICB1c2VyID0gaW5wdXQoJ1xuJXNOYW1hIDogJyUod2FyKSkKICAgICAgICBqdW1sYWggPSBpbnQoaW5wdXQoJyVzTGltaXQgOiAnJSh3YXIpKSkKICAgICAgICBhc2sgPSB1c2VyLnJlcGxhY2UoIiAiLCAiIikKICAgICAgICBjci5hcHBlbmQoImFzd19sdSIpCiAgICAgICAgeWFuLmFwcGVuZChhc2srInwiK2FzaykKICAgICAgICB5YW4uYXBwZW5kKGFzaysiXyIrInwiK2FzaykKICAgICAgICBmb3IgeCBpbiByYW5nZSgxLCBqdW1sYWgrMSk6CiAgICAgICAgICAgIHlhbi5hcHBlbmQoYXNrK3N0cih4KSsifCIrYXNrKQogICAgICAgICAgICB5YW4uYXBwZW5kKGFzaysiXyIrc3RyKHgpKyJ8Iithc2spCiAgICAgICAgICAgIHlhbi5hcHBlbmQoYXNrK3N0cih4KSsiXyIrInwiK2FzaykKICAgICAgICBwcm9zZXMoKQogICAgICAgIHBld2VoKCkKICAgIGVsaWYgcGVwZWsgaW4gWyczJywnMDMnXToKICAgICAgICBkaXJzID0gb3MubGlzdGRpcigiSGFzaWxfSWdlaCIpCiAgICAgICAgZm9yIGZpbGUgaW4gZGlyczoKICAgICAgICAgICAgcHJpbnQoIiVzTmFtYSBGaWxlIDogJXNIYXNpbF9JZ2VoLyVzJXMiJSh3YXIsQyxmaWxlLFEpKQogICAgICAgIHRyeTpmaWxlID0gaW5wdXQoIlxuJXNOYW1hIEZpbGUgOiAiJSh3YXIpKTt0b3RhbCA9IG9wZW4oIiVzIiUoZmlsZSkpLnJlYWQoKS5zcGxpdGxpbmVzKCkKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6amFsYW4od2FyKyJNYWFmIEZpbGUgVGlkYWsgQWRhICEiKTttZW51X2lnZWgoKQogICAgICAgIG5tX2ZpbGUgPSAoIiVzIiUoZmlsZSkpLnJlcGxhY2UoIi0iLCAiICIpCiAgICAgICAgamFsYW4od2FyKyJUb3RhbCBBa3VuIDogIitJK3N0cihsZW4oZmlsZSkpK1EpCiAgICAgICAgamFsYW4oZ2FyaXMpCiAgICAgICAgZm9yIG1lbWVrIGluIHRvdGFsOgogICAgICAgICAgICBrb250b2wgPSBtZW1lay5yZXBsYWNlKCJcbiIsIiIpCiAgICAgICAgICAgIHByaW50KCJbSUddICVzJXMiJShrb250b2wsUSkpO3RpbWUuc2xlZXAoMC4wMikKICAgICAgICBpbnB1dCgnXG4lc1Rla2FuIEVudGFyIFVudHVrIEtlbWJhbGknJSh3YXIpKTttZW51X2lnZWgoKQogICAgZWxpZiBwZXBlayBpbiBbJzQnLCcwNCddOgogICAgICAgIGphbGFuKHdhcisiTWFhZiBCcm8gRmlrdHVyIEluaSBNYXNpaCBUYWhhcCBQZXJrZW1iYW5nYW4sIEhhcmFwIEJlc2FiYXIgISIpO3RpbWUuc2xlZXAoMSk7bWVudV9pZ2VoKCkKIyAgICAgICAgc3RhcnRfYm90KCkKIyAgICAgICAgc3RhcnRfYm90X3YyKCkKICMgICAgICAgZXhpdCgiXG4iK3dhcisiRG9uZSAhISIpCiAgICBlbGlmIHBlcGVrIGluWycwJywnMDAnXToKICAgICAgICBtZW51KCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoJ1xuJXNJc2kgRGVuZ2FuIEJlbmFyIEJybyAhJyUod2FyKSk7dGltZS5zbGVlcCgyKTttZW51X2lnZWgoKQpkZWYgc3RhcnRfYm90KCk6CglnbG9iYWwgaWRfLCB1c2VyX25hbWUsIG9rX2lrLCBjcF9paywgZ2dfaWsKCW9rX2lrID0gMAoJY3BfaWsgPSAwCglnZ19payA9IDAKCWNla2ZpbGUoIkhhc2lsX0lnZWgiKQoJbmFtYXg9aW5wdXQoIlxuIitpbnArIk5hbWEgRmlsZSA6ICIpCgl0cnk6CgkJZmlsZT1vcGVuKG5hbWF4LCJyIikucmVhZGxpbmVzKCkKCWV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKCQlqYWxhbih3YXIrIk1hYWYgRmlsZSBUaWRhayBEaVRlbXVrYW4iKQoJCXN0YXJ0X2JvdCgpCgoJdXNlcl9uYW1lID0gaW5wdXQod2FyKyJNYXN1a2thbiBVc2VybmFtZSBVbnR1ayBEaSBGb2xsb3cgOiAiK0kpCglkdGEgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vJXMvP19fYT0xIiUodXNlcl9uYW1lKSwgaGVhZGVycz17IlVzZXItQWdlbnQiOiB1c2VyX2FnZW50en0pCglkdGFfID0gZHRhLmpzb24oKVsiZ3JhcGhxbCJdWyJ1c2VyIl0KCWlkXyA9IGR0YV9bImlkIl0KCWlrdXRfID0gZHRhX1siZWRnZV9mb2xsb3dlZF9ieSJdWyJjb3VudCJdCgluYW1hXyA9IGR0YV9bImZ1bGxfbmFtZSJdCgltZW5nXyA9IGR0YV9bImVkZ2VfZm9sbG93Il1bImNvdW50Il0KCXlnX2tlID0gc3RyKGlrdXRfKQoJamFsYW4od2FyKyJUYXJnZXQgWWFuZyBBa2FuIERpRm9sbG93IDogIikKCWphbGFuKGYiXHJ7d2FyfU5hbWEgICAgICA6IHtuYW1hX31cbnt3YXJ9VXNlcm5hbWUgIDoge3VzZXJfbmFtZX1cbnt3YXJ9SWQgVXNlciAgIDoge2lkX31cbnt3YXJ9UGVuZ2lrdXQgIDoge3N0cihpa3V0Xyl9XG57d2FyfU1lbmdpa3V0aSA6IHtzdHIobWVuZ18pfSIpCglwcmludChRKQoJcHJpbnQoIlxuXG4iK3dhcisiSnVtbGFoIEFrdW4gOiIsbGVuKGZpbGUpLCJcbiIpCglmb3IgZGF0YSBpbiBmaWxlOgoJCXRyeToKCQkJZGF0YSA9IGRhdGEucmVwbGFjZSgiXG4iLCIiKQoJCQl0cnk6dXNlcixwd3csdGxsID0gZGF0YS5zcGxpdCgifCIpCgkJCWV4Y2VwdDp1c2VyLHB3dyA9IGRhdGEuc3BsaXQoInwiKTt0bGw9KCIgLSAiKQoJCQl0cnk6Ym90X2ZvbGwodXNlcixwd3cpO3ByaW50KCJcbiIpCgkJCWV4Y2VwdDp0aW1lLnNsZWVwKDIpO3Bhc3MKCQlleGNlcHQ6cGFzcwoKZGVmIHN0YXJ0X2JvdF92MigpOgoJZ2xvYmFsIGlkXywgdXNlcl9uYW1lLCBva19paywgY3BfaWssIGdnX2lrLCB5Z19rZSwgaWt1dF8KCW9rX2lrID0gMAoJY3BfaWsgPSAwCglnZ19payA9IDAKCWNla2ZpbGUoIkhhc2lsX0lnZWgiKQoJbmFtYXg9aW5wdXQoIlxuIitpbnArIk5hbWEgRmlsZSA6ICIpCgl0cnk6CgkJZmlsZT1vcGVuKG5hbWF4LCJyIikucmVhZGxpbmVzKCkKCWV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKCQlqYWxhbih3YXIrIk1hYWYgRmlsZSBUaWRhayBEaVRlbXVrYW4iKQoJCXN0YXJ0X2JvdCgpCgoJdXNlcl9uYW1lID0gaW5wdXQod2FyKyJNYXN1a2thbiBVc2VybmFtZSBVbnR1ayBEaSBGb2xsb3cgOiAiK0kpCgl0cnk6CgkJZHRhID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL3d3dy5pbnN0YWdyYW0uY29tLyVzLz9fX2E9MSIlKHVzZXJfbmFtZSksIGhlYWRlcnM9eyJVc2VyLUFnZW50IjogdXNlcl9hZ2VudHp9KQoJCWR0YV8gPSBkdGEuanNvbigpWyJncmFwaHFsIl1bInVzZXIiXQoJCWlkXyA9IGR0YV9bImlkIl0KCQlpa3V0XyA9IGR0YV9bImVkZ2VfZm9sbG93ZWRfYnkiXVsiY291bnQiXQoJCW5hbWFfID0gZHRhX1siZnVsbF9uYW1lIl0KCQltZW5nXyA9IGR0YV9bImVkZ2VfZm9sbG93Il1bImNvdW50Il0KCQl5Z19rZSA9IHN0cihpa3V0XykKCQlqYWxhbih3YXIrIlRhcmdldCBZYW5nIEFrYW4gRGlGb2xsb3cgOiAiKQoJCWphbGFuKGYiXHJ7d2FyfU5hbWEgICAgICA6IHtuYW1hX31cbnt3YXJ9VXNlcm5hbWUgIDoge3VzZXJfbmFtZX1cbnt3YXJ9SWQgVXNlciAgIDoge2lkX31cbnt3YXJ9UGVuZ2lrdXQgIDoge3N0cihpa3V0Xyl9XG57d2FyfU1lbmdpa3V0aSA6IHtzdHIobWVuZ18pfSIpCglleGNlcHQ6amFsYW4od2FyKyJUYXJnZXQgVW50dWsgRGlGb2xsb3cgVGlkYWsgRGlUZW11a2FuICEiKTt0aW1lLnNsZWVwKDEpO3N0YXJ0X2JvdF92MigpCglwcmludChRKQoJcHJpbnQoIlxuXG4iK3dhcisiSnVtbGFoIEFrdW4gOiIsbGVuKGZpbGUpLCJcbiIpCgl3aXRoIHp0aHJlYWRzKG1heF93b3JrZXJzPTUpIGFzIChmb3JtKToKCQlmb3IgZGF0YSBpbiBmaWxlOgoJCQl0cnk6CgkJCQlkYXRhID0gZGF0YS5yZXBsYWNlKCJcbiIsIiIpCgkJCQl0cnk6CgkJCQkJdHJ5OnVzZXIscHd3LHRsbCA9IGRhdGEuc3BsaXQoInwiKQoJCQkJCWV4Y2VwdDp1c2VyLHB3dyA9IGRhdGEuc3BsaXQoInwiKTt0bGw9KCIgLSAiKQoJCQkJZXhjZXB0OmNvbnRpbnVlCgkJCQlmb3JtLnN1Ym1pdChib3RfZm9sbCwgdXNlciwgcHd3KSwKCQkJZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yOmRlbGF5KCkKZGVmIGRlbGF5KCk6Cglmb3IgeCBpbiBsaXN0KFsiMSIsICIyIiwgIjMiLCAiNCIsICI1Il0pOgoJCWZvciBuIGluIGxpc3QoWyIvICIsICItICIsICJ8ICIsICJcICIsICJ8ICJdKToKCQkJc3lzLnN0ZG91dC53cml0ZShmJ1xye1F9WyB7Q317bn17UX1dIERlbGF5IHt4fVMnKSwKCQkJc3lzLnN0ZG91dC5mbHVzaCgpCgkJCXRpbWUuc2xlZXAoMC40MCkKZGVmIGJvdF9mb2xsKHVzZXJuYW1lX2RldiwgcGFzc19kZXYpOgoJYmtvID0gIiIKCWR0YV8gPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vJXMvP19fYT0xIiUodXNlcm5hbWVfZGV2KSwgaGVhZGVycz17IlVzZXItQWdlbnQiOiB1c2VyX2FnZW50en0pCglkdGFfXyA9IGR0YV8uanNvbigpWyJncmFwaHFsIl1bInVzZXIiXQoJaWt1dF9fID0gZHRhX19bImVkZ2VfZm9sbG93ZWRfYnkiXVsiY291bnQiXQoJdHJ5OgoJCXRyeToKCQkJaGVhZGVyeiA9IHsiVXNlci1BZ2VudCI6IHVzZXJfYWdlbnR6fQoJCQl3aXRoIHJlcXVlc3RzLlNlc3Npb24oKSBhcyBkZXY6CgkJCQl1cmxfc2NyYXAgPSAiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS8iCgkJCQlkYXRhID0gZGV2LmdldCh1cmxfc2NyYXAsIGhlYWRlcnM9aGVhZGVyeikuY29udGVudAoJCQkJY3JmX3Rva2VuID0gcmUuZmluZGFsbCgneyJjb25maWciOnsiY3NyZl90b2tlbiI6IiguKikiLCJ2aWV3ZXIiJywgc3RyKGRhdGEpKVswXQoJCQloZWFkZXIgPSB7CgkJCQkJIkFjY2VwdCI6ICIqLyoiLAoJCQkJCSJBY2NlcHQtRW5jb2RpbmciOiAiZ3ppcCwgZGVmbGF0ZSwgYnIiLAoJCQkJCSJBY2NlcHQtTGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjUiLAoJCQkJCSJIb3N0IjogInd3dy5pbnN0YWdyYW0uY29tIiwKCQkJCQkiWC1DU1JGVG9rZW4iOiBjcmZfdG9rZW4sCgkJCQkJIlgtUmVxdWVzdGVkLVdpdGgiOiAiWE1MSHR0cFJlcXVlc3QiLAoJCQkJCSJSZWZlcmVyIjogImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vYWNjb3VudHMvbG9naW4vIiwKCQkJCQkiVXNlci1BZ2VudCI6IHVzZXJfYWdlbnR6LAoJCQkJCSB9CgkJCXBhcmFtID0gewoJCQkJCSJ1c2VybmFtZSI6IHVzZXJuYW1lX2RldiwKCQkJCQkiZW5jX3Bhc3N3b3JkIjogIiNQV0RfSU5TVEFHUkFNX0JST1dTRVI6MDp7fTp7fSIuZm9ybWF0KHJhbmRvbS5yYW5kaW50KDEwMDAwMDAwMDAsIDk5OTk5OTk5OTkpLCBwYXNzX2RldiksCgkJCQkJIm9wdEludG9PbmVUYXAiOiBGYWxzZSwKCQkJCQkicXVlcnlQYXJhbXMiOiB7fSwKCQkJCQkic3RvcERlbGV0aW9uTm9uY2UiOiAiIiwKCQkJCQkidHJ1c3RlZERldmljZVJlY29yZHMiOiB7fQoJCQkJCX0KCQlleGNlcHQ6CgkJCWhlYWRlciA9IHt9CgkJCXBhcmFtID0ge30KCQkJcGFzcwoJCXdpdGggcmVxdWVzdHMuU2Vzc2lvbigpIGFzIHNlc19kZXY6CgkJCXVybCA9ICJodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL2FjY291bnRzL2xvZ2luL2FqYXgvIgoJCQlyZXNwb24gPSBzZXNfZGV2LnBvc3QodXJsLCBkYXRhPXBhcmFtLCBoZWFkZXJzPWhlYWRlcikKCQkJZGF0YV9kZXYgPSBqc29uLmxvYWRzKHJlc3Bvbi5jb250ZW50KQoJCQlkYSA9IHJlc3Bvbi5jb29raWVzLmdldF9kaWN0KCkKCQkJaWYgInVzZXJJZCIgaW4gc3RyKGRhdGFfZGV2KToKCQkJCWZvbGxvd19ib3Qoc2VzX2RldiwgdXNlcm5hbWVfZGV2KQoJCQkJdHJ5OgoJCQkJCWR0YSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS8lcy8/X19hPTEiJSh1c2VyX25hbWUpLCBoZWFkZXJzPXsiVXNlci1BZ2VudCI6IHVzZXJfYWdlbnR6fSkKCQkJCQlkdGFfID0gZHRhLmpzb24oKVsiZ3JhcGhxbCJdWyJ1c2VyIl0KCQkJCQlpa3V0XyA9IGR0YV9bImVkZ2VfZm9sbG93ZWRfYnkiXVsiY291bnQiXQoJCQkJCWJrbyArPSAod2FyK3VzZXJuYW1lX2RldisifCIrcGFzc19kZXYrInwiK3N0cihpa3V0X18pKyJcbiIpCgkJCQkJYmtvICs9IChqYXJhayt3YXIrSSsiQmVyaGFzaWwgRm9sbG93ICIrTSt1c2VyX25hbWUrSSsiIFlhbmcgS2UgIitNK3N0cihpa3V0XykrUSkKCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCh3YXIrIkVycm9yIDogJXMiJShlKSkKCQkJZWxpZiAiY2hlY2twb2ludF91cmwiIGluIHN0cihkYXRhX2Rldik6CgkJCQlia28gKz0gKHdhcit1c2VybmFtZV9kZXYrInwiK3Bhc3NfZGV2KyJ8IitzdHIoaWt1dF9fKSsiXG4iKQoJCQkJYmtvICs9IChqYXJhayt3YXIrSysiQ2hlY2sgUG9pbnRzIikKIwkJCQlqYWxhbih3YXIrSysiTWFhZiBBa3VuIEluaSBLZW5hayBWaXJ1cywgS2FyZW5hIEJlbHVtIFZha3NpbiA6ViAiK1ErIigiK0MrIkFLVU4gSU5JIEtFTkFLIENIRUNLIFBBS1NJTiIrUSkKCQkJZWxpZiAiUGxlYXNlIHdhaXQiIGluIHN0cihkYXRhX2Rldik6CgkJCQlia28gKz0gKHdhcit1c2VybmFtZV9kZXYrInwiK3Bhc3NfZGV2KyJ8IitzdHIoaWt1dF9fKSsiXG4iKQoJCQkJYmtvICs9IChqYXJhayt3YXIrVSsiSGlkdXBrYW4gTW9kZSBQZXNhd2F0IDUgRGV0aWsgQWdhciBUZXJoaWRhciBEYXJpIFBha3NpbiIpCgkJCWVsc2U6CgkJCQlia28gKz0gKHdhcit1c2VybmFtZV9kZXYrInwiK3Bhc3NfZGV2KyJ8IitzdHIoaWt1dF9fKSsiXG4iKQoJCQkJYmtvICs9IChqYXJhayt3YXIrTSsiS2F0YSBTYW5kaSBTYWxhaCIpCiMJCQkJamFsYW4od2FyK00rIk1hYWYgQWt1biBJbmkgS2VuYWsgVmlydXMsIEthcmVuYSBCZWx1bSBWYWtzaW4gOlYgIitRKyIoIitDKyJBS1VOIElOSSBUSURBSyBURVJEQUZUQVIgREkgREFUQSBQQUtTSU4vSU5TVEFHUkFNIitRKyIpIikKIwkJCQlleGl0KCkKCQkJCQoJZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgoJCWV4aXQoKQoJZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yOmRlbGF5KCkKCXByaW50KCJcciIrYmtvKyJcbiIpCmRlZiBmb2xsb3dfYm90KHNlc19kZXYsIHVzZXJuYW1lX2Rldik6Cgl1c2VyX3RhcmdldCA9ICgiJXMiJSh1c2VyX25hbWUpKQoJaWRfdGFyZ2V0ID0gKCIlcyIlKGlkXykpCiMJdXNlcl90YXJnZXQgPSAibXIucmlza3kuOTkxIgojCWlkX3RhcmdldCA9ICI1MDMwNzE1MTE3NiIKCWRhdF9jcmZfZm9sbCA9IHNlc19kZXYuZ2V0KCJodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL3t9LyIuZm9ybWF0KHVzZXJfdGFyZ2V0KSwgaGVhZGVycz1oZWFkZXJ6X2FwaSkuY29udGVudAoJY3JmX3Rva2VuX2ZvbGwgPSByZS5maW5kYWxsKCd7ImNvbmZpZyI6eyJjc3JmX3Rva2VuIjoiKC4qKSIsInZpZXdlciInLCBzdHIoZGF0X2NyZl9mb2xsKSlbMF0KCWhlYWRlcnpfZm9sbCA9IHsiQWNjZXB0IjogIiovKiIsCgkJCQkJIkFjY2VwdC1FbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlLCBiciIsCgkJCQkJIkFjY2VwdC1MYW5ndWFnZSI6ICJlbi1VUyxlbjtxPTAuNSIsCgkJCQkJIkhvc3QiOiAid3d3Lmluc3RhZ3JhbS5jb20iLAoJCQkJCSJPcmlnaW4iOiAiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbSIsCgkJCQkJIlJlZmVyZXIiOiAiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS97fS8iLmZvcm1hdCh1c2VyX3RhcmdldCksCgkJCQkJIlVzZXItQWdlbnQiOiB1c2VyX2FnZW50eiwKCQkJCQkiWC1DU1JGVG9rZW4iOiBjcmZfdG9rZW5fZm9sbH0KCXBhcmFtX2ZvbGwgPSB7IiJ9Cgl1cmxfZm9sbG93ID0gImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vd2ViL2ZyaWVuZHNoaXBzL3t9L2ZvbGxvdy8iLmZvcm1hdChpZF90YXJnZXQpCglyZXNfZm9sbCA9IHNlc19kZXYucG9zdCh1cmxfZm9sbG93LCBoZWFkZXJzPWhlYWRlcnpfZm9sbCkKCmRlZiBfX2ZvbGxvd2Vyc19fKGNvb2tpZSwgaWRfdGFyZ2V0LCBsaW1pdCwga3VudHVsKToKICAgIGdsb2JhbCBsb29waW5nCiAgICBpZiBrdW50dWwgaW5bIiJdOgogICAgICAgIHByaW50KCdcbiAlc0phbmdhbiBLb3NvbmcgQnJvICEhJyUod2FyKSk7dGltZS5zbGVlcCgyKTttZW51X2lnZWgoKQogICAgZWxpZiBrdW50dWwgaW5bIjEiLCIwMSJdOgogICAgICAgIHVybCA9ICJodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjEvZnJpZW5kc2hpcHMve30vZm9sbG93ZXJzLz9jb3VudD17fSIuZm9ybWF0KGlkX3RhcmdldCwgbGltaXQpCiAgICBlbGlmIGt1bnR1bCBpblsiMiIsIjAyIl06CiAgICAgICAgdXJsID0gImh0dHBzOi8vaS5pbnN0YWdyYW0uY29tL2FwaS92MS9mcmllbmRzaGlwcy97fS9mb2xsb3dpbmcvP2NvdW50PXt9Ii5mb3JtYXQoaWRfdGFyZ2V0LCBsaW1pdCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoJ1xuJXNJc2kgRGVuZ2FuIEJlbmFyIEJybyAhISclKHdhcikpO3RpbWUuc2xlZXAoMik7bWVudV9pZ2VoKCkKICAgIHdpdGggcmVxdWVzdHMuU2Vzc2lvbigpIGFzIHNlczoKICAgICAgICBvdHcgPSBzZXMuZ2V0KHVybCwgY29va2llcz1jb29raWUsIGhlYWRlcnM9aGVhZGVyel9hcGkpCiAgICAgICAgZm9yIHh4eCBpbiBqc29uLmxvYWRzKG90dy5jb250ZW50KVsidXNlcnMiXToKICAgICAgICAgICAgdXNlcm5hbWUgPSB4eHhbInVzZXJuYW1lIl0KICAgICAgICAgICAgbmFtYSA9IHh4eFsiZnVsbF9uYW1lIl0uZW5jb2RlKCJ1dGYtOCIpCiAgICAgICAgICAgIGlmIGxlbihzdGF0dXNfZm9sbCkgIT0gMToKICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xyJXNTZWRhbmcgTWVuZ3VtcHVsa2FuICVzIElkLi4uICclKHdhciwgbGVuKHlhbikpKTsgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgICAgICB5YW4uYXBwZW5kKHVzZXJuYW1lKyJ8IituYW1hLmRlY29kZSgidXRmLTgiKSkKICAgICAgICAgICAgICAgICNvcGVuKCdUZXMtZHVtcC50eHQnLCdhJykud3JpdGUoZid7dXNlcm5hbWV9fHtuYW1hLmRlY29kZSgidXRmLTgiKX1cbicpCiAgICAgICAgICAgICAgICBsb29waW5nKz0xCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwb2xsLmFwcGVuZCh1c2VybmFtZSkKZGVmIHBld2VoKCk6CiAgICB3aXRoIGtpa3lndGcobWF4X3dvcmtlcnM9NDApIGFzIChfX3lheWFuWERfXyk6CiAgICAgICAgZm9yIHludGt0cyBpbiB5YW46CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVpZCwgbmFtZSA9IHludGt0cy5zcGxpdCgnfCcpCiAgICAgICAgICAgICAgICB4eiA9IG5hbWUuc3BsaXQoJyAnKQogICAgICAgICAgICAgICAgaWYgbGVuKHh6KSA9PSAzIG9yIGxlbih4eikgPT0gNCBvciBsZW4oeHopID09IDUgb3IgbGVuKHh6KSA9PSA2OgojICAgICAgICAgICAgICAgICAgICBwd3ggPSBbbmFtZSwgeHpbMF0rIjEyMyIsIHh6WzBdKyIxMjM0NSJdICMgUFcgU0lOR0tBVAogICAgICAgICAgICAgICAgICAgIHB3eCA9IFtuYW1lLCB4elswXSsiMTIzIiwgeHpbMF0rIjEyMzQiLCB4elswXSsiMTIzNDUiXSAjIFBXIEpPWloKICAgICAgICAgICAgICAgIGVsc2U6CiMgICAgICAgICAgICAgICAgICAgIHB3eCA9IFtuYW1lLCB4elswXSsiMTIzIiwgeHpbMF0rIjEyMzQ1Il0gIyBQVyBTSU5HS0FUCiAgICAgICAgICAgICAgICAgICAgcHd4ID0gW25hbWUsIHh6WzBdKyIxMjMiLCB4elswXSsiMTIzNCIsIHh6WzBdKyIxMjM0NSIsICJzYXlhbmciLCAia29udG9sIiwgImFuamluZyJdICMgUFcgSk9aWgogICAgICAgICAgICAgICAgX195YXlhblhEX18uc3VibWl0KGNyYWNrMiwgdWlkLCBwd3gpCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgZXhpdChmIlxue3dhcn1DcmFjayBTZWxlc2FpICEhIikKCmRlZiBjcmFjazIodXNlciwgcHd4KToKICAgIGdsb2JhbCBsb29waW5nLCBsb3BpbmcKICAgIGFzd3cgPSBsZW4ocHd4KQogICAgZm9yIHBhcyBpbiBwd3g6CiAgICAgICAgaWYgbG9vcGluZyAhPSAxOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbGVuKHN0YXR1c19mb2xsKSAhPSAxOgogICAgICAgICAgICAgICAgc3lzLnN0ZG91dC53cml0ZSgnXHJbJXMlcyVzXSAlcy8lcyBbIE9LOiVzIF0gLS0gWyBDUDolcyBdICAgICAgICAgICAgICAnJShwaWxpaChbSSxLLFUsTSxCLEMsUV0pLGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpLFEsc3RyKGxvcGluZyksbGVuKHlhbiksbGVuKG9rKSxsZW4oY3ApKSksCiAgICAgICAgICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICAgICAgICAgIGFzd3cgLT0gMQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgdXNlciBpbiBvayBvciB1c2VyIGluIGNwOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgcHcgPSBwYXMubG93ZXIoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBoZWFkZXJ6ID0geyJVc2VyLUFnZW50IjogdXNlcl9hZ2VudHpfYXBpfQogICAgICAgICAgICAgICAgd2l0aCByZXF1ZXN0cy5TZXNzaW9uKCkgYXMgc2VzOgogICAgICAgICAgICAgICAgICAgIHVybGwgPSAiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS8iCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHNlcy5nZXQodXJsbCwgaGVhZGVycz1oZWFkZXJ6KS5jb250ZW50CiAgICAgICAgICAgICAgICAgICAgdG9rZXR0ID0gcmUuZmluZGFsbCgneyJjb25maWciOnsiY3NyZl90b2tlbiI6IiguKikiLCJ2aWV3ZXIiJywgc3RyKGRhdGEpKVswXQogICAgICAgICAgICAgICAgaGVhZGVyID0geyJBY2NlcHQiOiAiKi8qIiwiQWNjZXB0LUVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUsIGJyIiwiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC41IiwiSG9zdCI6ICJ3d3cuaW5zdGFncmFtLmNvbSIsIlgtQ1NSRlRva2VuIjogdG9rZXR0LCJYLVJlcXVlc3RlZC1XaXRoIjogIlhNTEh0dHBSZXF1ZXN0IiwiUmVmZXJlciI6ICJodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL2FjY291bnRzL2xvZ2luLyIsIlVzZXItQWdlbnQiOiB1c2VyX2FnZW50eiwKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBhcmFtID0geyJ1c2VybmFtZSI6IHVzZXIsImVuY19wYXNzd29yZCI6ICIjUFdEX0lOU1RBR1JBTV9CUk9XU0VSOjA6e306e30iLmZvcm1hdChyYW5kb20ucmFuZGludCgxMDAwMDAwMDAwLCA5OTk5OTk5OTk5OSksIHB3KSwib3B0SW50b09uZVRhcCI6IEZhbHNlLCJxdWVyeVBhcmFtcyI6IHt9LCJzdG9wRGVsZXRpb25Ob25jZSI6ICIiLCJ0cnVzdGVkRGV2aWNlUmVjb3JkcyI6IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgaGVhZGVyID0ge30KICAgICAgICAgICAgICAgIHBhcmFtID0ge30KICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgd2l0aCByZXF1ZXN0cy5TZXNzaW9uKCkgYXMgc2VzOgogICAgICAgICAgICAgICAgdXJsID0gImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vYWNjb3VudHMvbG9naW4vYWpheC8iCiAgICAgICAgICAgICAgICByZXNwb24gPSBzZXMucG9zdCh1cmwsIGRhdGE9cGFyYW0sIGhlYWRlcnM9aGVhZGVyKQogICAgICAgICAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMocmVzcG9uLmNvbnRlbnQpO3RpbWUuc2xlZXAoMDAuMSkKICAgICAgICAgICAgICAgIGlmICJjaGVja3BvaW50X3VybCIgaW4gc3RyKGRhdGEpOgogICAgICAgICAgICAgICAgICAgIGNlcGVoID0gIkNoZWNrcG9pbnQiCiAgICAgICAgICAgICAgICAgICAgaW5nZm8odXNlciwgcHcsIGNlcGVoKQogICAgICAgICAgICAgICAgICAgIG9wZW4oJ0hhc2lsX0lnZWgvSUctQ1AtJXMudHh0JyAlIChkdXJhc2kpLCAnYScpLndyaXRlKHVzZXIrInwiK3B3KyJcbiIpCiAgICAgICAgICAgICAgICAgICAgY3AuYXBwZW5kKHVzZXIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYgInVzZXJJZCIgaW4gc3RyKGRhdGEpOgogICAgICAgICAgICAgICAgICAgIG9rZWggPSAiQmVyaGFzaWwiCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHN0YXR1c19mb2xsKSAhPSAxOgogICAgICAgICAgICAgICAgICAgICAgICBpbmdmbyh1c2VyLCBwdywgb2tlaCkKICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKCdIYXNpbF9JZ2VoL0lHLU9LLSVzLnR4dCcgJSAoZHVyYXNpKSwgJ2EnKSBhcyBzaW1wYW46CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW1wYW4ud3JpdGUodXNlcisifCIrcHcrIlxuIikKICAgICAgICAgICAgICAgICAgICAgICAgb2suYXBwZW5kKHVzZXIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYgIlBsZWFzZSB3YWl0IiBpbiBzdHIoZGF0YSk6CiAgICAgICAgICAgICAgICAgICAgc3lzLnN0ZG91dC53cml0ZSgnXHJbJXMlcyVzXSVzSGlkdXAgTWF0aWthbiBNb2RlIFBlc2F3YXQgU2VsYW1hIDIgRGV0aWsgISElcyAgICAgICAgICclKHBpbGloKFtJLEssQixDLFUsUCxRXSksZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJyksUSxLLFEpKSwKICAgICAgICAgICAgICAgICAgICBsb29waW5nKz0xCiAgICAgICAgICAgICAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgICAgICAgICAgcHd4ID0gW3B3XQogICAgICAgICAgICAgICAgICAgIGNyYWNrMih1c2VyLCBwd3gpCiAgICAgICAgICAgICAgICAgICAgbG9waW5nIC09IDEKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9vcGluZyA9IDEKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yOgogICAgICAgICAgICBzeXMuc3Rkb3V0LndyaXRlKCdcclslcyVzJXNdJXNKYXJpbmdhbiBBbmRhIFRlcnB1dHVzICEhJXMgICAgICAgICclKHBpbGloKFtVLEssQixDLFFdKSxkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJUg6JU06JVMnKSxRLFUsUSkpLAogICAgICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICAgICAgbG9vcGluZys9MQogICAgICAgICAgICBwd3ggPSBbcHddCiAgICAgICAgICAgIGNyYWNrMih1c2VyLCBwd3gpCiAgICAgICAgICAgIGxvcGluZyAtPSAxCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGxvb3BpbmcgPSAxCiAgICAgICAgICAgIHBhc3MKICAgIGxvcGluZys9MQpkZWYgaW5nZm8odXNlciwgcHcsIHN0YXR1cyk6CiAgICB0cnk6CiAgICAgICAgZ2xvYmFsIGlkZywgcGVuZ2lrdXQsIG1lbmdpa3V0aQogICAgICAgIGR0YSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS8lcy8/X19hPTEiJSh1c2VyKSwgaGVhZGVycz17IlVzZXItQWdlbnQiOiB1c2VyX2FnZW50en0pCiAgICAgICAgZHRhXyA9IGR0YS5qc29uKClbImdyYXBocWwiXVsidXNlciJdCiAgICAgICAgbmFtYSA9IGR0YV9bImZ1bGxfbmFtZSJdCiAgICAgICAgaWRnID0gZHRhX1siaWQiXQogICAgICAgIHBlbmdpa3V0ID0gZHRhX1siZWRnZV9mb2xsb3dlZF9ieSJdWyJjb3VudCJdCiAgICAgICAgbWVuZ2lrdXRpID0gZHRhX1siZWRnZV9mb2xsb3ciXVsiY291bnQiXQogICAgICAgIGlmIHN0YXR1cyA9PSAiQmVyaGFzaWwiOgogICAgICAgICAgICBwcmludChmIlxye1F9W3tJfeKck3tRfV0gTmFtZSAgICAgIDoge0l9e25hbWF9ICAgICAgICAgICAgICAgICBcbntRfVt7SX3inJN7UX1dIFVzZXJuYW1lICA6IHtJfXt1c2VyfSAgICAgICAgICAgICAgICAgXG57UX1be0l94pyTe1F9XSBQYXNzd29yZCAgOiB7SX17cHd9ICAgICAgICAgICAgICAgICBcbntRfVt7SX3inJN7UX1dIFBlbmdpa3V0ICA6IHtJfXtzdHIocGVuZ2lrdXQpfSAgICAgICAgICAgICAgICAgXG57UX1be0l94pyTe1F9XSBNZW5naWt1dGkgOiB7SX17c3RyKG1lbmdpa3V0aSl9ICAgICAgICAgICAgICAgICBcbiIpO3BsYXlfbXB2KCdhc3NhbGFtdWFsYWlrdW0ubXAzJykKIyAgICAgICAgICAgIGJva2VwX2phcGFuX3lhbmdfdGVyYmFydXYyKCJPSyIsIHVzZXIsIHB3LCBzdHIocGVuZ2lrdXQpKQogICAgICAgICAgICB0cnk6Ym9rZXBfamFwYW5feWFuZ190ZXJiYXJ1djIoIk9LIiwgdXNlciwgcHcsIHN0cihwZW5naWt1dCkpCiAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgZWxpZiBzdGF0dXMgPT0gIkNoZWNrcG9pbnQiOgogICAgICAgICAgICBwcmludChmIlxue1F9W3tLfVh7UX1dIE5hbWUgICAgICA6IHtLfXtuYW1hfSAgICAgICAgICAgICAgICAgXG57UX1be0t9WHtRfV0gVXNlcm5hbWUgIDoge0t9e3VzZXJ9ICAgICAgICAgICAgICAgICBcbntRfVt7S31Ye1F9XSBQYXNzd29yZCAgOiB7S317cHd9ICAgICAgICAgICAgICAgICBcbntRfVt7S31Ye1F9XSBQZW5naWt1dCAgOiB7S317c3RyKHBlbmdpa3V0KX0gICAgICAgICAgICAgICAgIFxue1F9W3tJfVh7UX1dIE1lbmdpa3V0aSA6IHtLfXtzdHIobWVuZ2lrdXRpKX0gICAgICAgICAgICAgICAgIFxuIik7cGxheV9tcHYoJ2Fzc2FsYW11YWxhaWt1bS5tcDMnKQogICAgICAgICAgICB0cnk6Ym9rZXBfamFwYW5feWFuZ190ZXJiYXJ1djIoIktPTlRPTCIsIHVzZXIsIHB3LCBzdHIocGVuZ2lrdXQpKQogICAgICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHBhc3MKICAgIGV4Y2VwdDogcGFzcwpsb3Bpbmc9IDEKCmxpc19wcm94ID0gW10KbGlzdF9wcm94eSA9IFtdCmM9MQpkZWYgY2VrX3Byb3h5KHByb3h5KToKICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXNwb24gPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vaHR0cGJpbi5vcmcvaXAiLCBwcm94aWVzPXsiaHR0cCI6IHByb3h5LCJodHRwcyI6IHByb3h5fSwgdGltZW91dD0zKS5qc29uKClbIm9yaWdpbiJdCiAgICAgICAgICAgICAgICBwcmludCAoIiA+PiBMaXZlIC0tICIrcHJveHkpCiAgICAgICAgICAgICAgICBsaXN0X3Byb3h5LmFwcGVuZChwcm94eSkKICAgICAgICAgICAgICAgIGMrPTEKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgpkZWYgc2NyYXAoKToKICAgICAgICBsaXNfcHJveF9kZXYgPSBbXQogICAgICAgIHVybD0iaHR0cHM6Ly9mcmVlLXByb3h5LWxpc3QubmV0LyNsaXN0IgogICAgICAgIHdpdGggcmVxdWVzdHMuU2Vzc2lvbigpIGFzIHNlc19kZXY6CiAgICAgICAgICAgICAgICByZXNwb24gPSBzZXNfZGV2LmdldCh1cmwpCiAgICAgICAgICAgICAgICBzb3AgPSBCZWF1dGlmdWxTb3VwKHJlc3Bvbi5jb250ZW50LCAiaHRtbC5wYXJzZXIiKQogICAgICAgICAgICAgICAgdGJvZHkgPSBzb3AuZmluZCgidGJvZHkiKQogICAgICAgICAgICAgICAgZm9yIGRldiBpbiB0Ym9keS5maW5kX2FsbCgidHIiKToKICAgICAgICAgICAgICAgICAgICAgICAgcHJveCA9IGRldi5maW5kX2FsbCgidGQiLCBjbGFzc189RmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc19wcm94X2Rldi5hcHBlbmQoc3RyKHByb3gpKQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgKHByb3gpCiAgICAgICAgICAgICAgICBmb3IgZGV2IGluIGxpc19wcm94X2RldjoKICAgICAgICAgICAgICAgICAgICAgICAgcGVjYWggPSBkZXYuc3BsaXQoIiwiKQogICAgICAgICAgICAgICAgICAgICAgICBpcCA9IHBlY2FoWzBdLnJlcGxhY2UoIjx0ZD4iLCAiIikucmVwbGFjZSgiPC90ZD4iLCIiKS5yZXBsYWNlKCJbIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcnQgPSBwZWNhaFsxXS5yZXBsYWNlKCI8dGQ+IiwgIiIpLnJlcGxhY2UoIjwvdGQ+IiwiIikucmVwbGFjZSgiWyIsICIiKS5zdHJpcCgiICIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc19wcm94LmFwcGVuZChpcCsiOiIrcG9ydCsiXG4iKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiIi5qb2luKGxpc19wcm94KSkKCiAgICAgICAgd2l0aCBUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MjApIGFzIGRldjoKICAgICAgICAgICAgICAgIGZvciBwcm94IGluIGxpc19wcm94X2RldjoKICAgICAgICAgICAgICAgICAgICAgICAgZGV2LnN1Ym1pdChjZWtfcHJveHksIHByb3gpCgoKZGVmIGt1a2lzX3YxKGt1a2lzX3N1cyk6CglrdWtpc19zdXMgPSBrdWtpc19zdXMucmVwbGFjZSgibm9zY3JpcHQ9MSIsICIiKQoJa3VraXNfaW1wb3MgPSAiIgoJdXNlciA9IGt1a2lzX3N1cy5zcGxpdCgiY191c2VyPSIpWzFdCgl0cnk6CgkJdXNlciA9IHVzZXIuc3BsaXQoIjsiKVswXQoJZXhjZXB0OnBhc3MKCWt1a2lzX3N1cyA9IGt1a2lzX3N1cy5yZXBsYWNlKCJjX3VzZXI9Iit1c2VyKyI7IiwgIiIpCglrdWtpc19zdXMgPSBrdWtpc19zdXMucmVwbGFjZSgiO2NfdXNlcj0iK3VzZXIrIjsiLCAiIikKCWt1a2lzX3N1cyA9IGt1a2lzX3N1cy5yZXBsYWNlKCI7Y191c2VyPSIrdXNlciwgIiIpCglrdWtpc19zdXMgPSBrdWtpc19zdXMucmVwbGFjZSgiY191c2VyPSIrdXNlciwgIiIpCglrdWtpc19pbXBvcyArPSBrdWtpc19zdXMKCWt1a2lzX2ltcG9zICs9ICI7IgoJa3VraXNfaW1wb3MgKz0gImNfdXNlcj0iCglrdWtpc19pbXBvcyArPSB1c2VyCglyZXR1cm4ga3VraXNfaW1wb3MKCgpkZWYgY2VrX2luZm9fdmlhX2t1a2lzKCk6CglnbG9iYWwgdXNlcgoJc2Vzc2lvbj1yZXEuU2Vzc2lvbigpCgltbWFrX2t1a2lzXyA9IGlucHV0KHdhcisiTWFzdWthbiBDb29raWVzIDoiKQoJdXNlciA9IG1tYWtfa3VraXNfLnNwbGl0KCJjX3VzZXI9IilbMV0KCXRyeToKCQl1c2VyID0gdXNlci5zcGxpdCgiOyIpWzBdCglleGNlcHQ6CgkJdXNlciA9IHVzZXIuc3BsaXQoIjsiKVswXQoKCWdldF9pbmZvbyhzZXNzaW9uLGt1a2lzX3YxKG1tYWtfa3VraXNfKSkKCWNla19hcGsoc2Vzc2lvbixrdWtpc192MShtbWFrX2t1a2lzXykpCgljZWtfYXBrX3YxKChtbWFrX2t1a2lzXykpCglleGl0KCkKCmRlZiBsb3FxKCk6CglzZXNzaW9uPXJlcS5TZXNzaW9uKCkKCWNva2kgPSAiMTAwMDQ5MTE1NDMyMzMzfG5hendhMTIzfGNfdXNlcj0xMDAwNDkxMTU0MzIzMzM7ZGF0cj1ELUwzWWI5cWtYNE9WRDZCWUZLQnpHb3M7ZnI9MGUwZ0Y0NU4wVVl3b2V2OGUuQVdXQU9fOUJOdnFQeHUzMTR5dUhKN3dSWDFNLkJoOS1JUS5CVS5BQUEuMC4wLkJoOS1JUS5BV1VBTkRnVU1qSTtzYj1FT0wzWWI5YkpyUktJbjBPbk1wMW1RMW47eHM9NTAlM0FJUjExQ0F1U2NhUGxxQSUzQTIlM0ExNjQzNjM1MjE2JTNBLTElM0ExMTEyMCIKCWNva2kgPSBrdWtpc192MShjb2tpKQoJY2VrID1zZXNzaW9uLmdldCgiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tL3NldHRpbmdzL2FwcHMvdGFiYmVkLz90YWI9YWN0aXZlIixjb29raWVzPXsiY29va2llIjpjb2tpfSkudGV4dAoJY2VrMiA9IHNlc3Npb24uZ2V0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vc2V0dGluZ3MvYXBwcy90YWJiZWQvP3RhYj1pbmFjdGl2ZSIsY29va2llcz17ImNvb2tpZSI6Y29raSwidXNlci1hZ2VudCI6Ik1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgQ1BIMjE3OSkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzk2LjAuNDY2NC4xMDQgTW9iaWxlIFNhZmFyaS81MzcuMzYifSkudGV4dAoJcHJpbnQoY2VrMikKZGVmIGxvcSgpOgoJZGV0aWsgPSAiIgoJZmluaXMgPSAiIgoJZGV0aWsgKz0gc3RyKCIyMDowODo1MyIucmVwbGFjZSgiOiIsICIiKSkKCWZpbmlzICs9IHN0cigiMjA6MzI6MzEiLnJlcGxhY2UoIjoiLCAiIikpCglkZXRpayA9IGRldGlrCglmaW5pcyA9IGZpbmlzCgl0b3RvbyA9IGludChmaW5pcykgLSBpbnQoZGV0aWspCglwcmludCh0b3RvbykKCmltcG9ydCB1dWlkCmRlZiBidWF0X3RnbCgpOgoJZ2xvYmFsIHdha18KCW9zLnN5c3RlbSgiY2xlYXIiKQoJdHJ5OgoJCWlkMSA9IG9wZW4oIi5kYXRhbWUxIiwgInIiKS5yZWFkKCkKCQlpZGwgPSBvcGVuKCIuZGF0YW1lMSIsICJyIikucmVhZCgpCglleGNlcHQ6CgkJa29uZm8oKQoJZ2lnID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dpdGh1Yi5jb20vU2hhbmltei96eHh4MTIzL3RyZWUvbWFpbiIpLnRleHQuc3RyaXAoKQoJaWYgaWRsIGluIGdpZzoKCQlqb2sgPSBnaWcuc3BsaXQoaWRsKyJ8IikKCQlqb2trID0gKCIlcyIlKGpva1sxXSkpCgkJam9ra2sgPSBqb2trLnNwbGl0KCI8IikKCQl3YWtrID0gam9ra2tbMF0KCQlpZiB3YWtrID09ICIiOgoJCQlrb25mbygpCgllbHNlOgoJCWtvbmZvKCkKZGVmIGtvbmZvKCk6Cglvcy5zeXN0ZW0oImNsZWFyIikKIwlwcmludCAobG9nbykKCXRyeToKCQlpZDEgPSBvcGVuKCIuZGF0YW1lMSIsICJyIikucmVhZCgpCglleGNlcHQ6CgkJaWQxID0gdXVpZC51dWlkNCgpLmhleFs6NDNdLnVwcGVyKCkKCQlqYWEgPSBvcGVuKCIuZGF0YW1lMSIsICJ3IikKCQlqYWEud3JpdGUoaWQxKQoJCWphYS5jbG9zZSgpCglqYWxhbih3YXIrJ0xpY2VzZSBBbmRhIDogJytVK2lkMStRKQoJamFsYW4od2FyKydTaWxhaGthbiBDaGF0IConK0MrJ01yLlJpc2t5JytRKycqIFVudHVrIE1lbWJlbGkgS2V5ICEnKQoJamFsYW4oZiIiInt3YXJ9SGFyZ2EgS2V5CiB8CiB8LS0zIERheSAgICAgIHtDfTEwLjAwMHtRfQogfC0tNyBEYXkgICAgICB7Q30yMC4wMDB7UX0KIHwtLTEgQnVsYW4gICAge0N9NTAuMDAwe1F9CiB8LS0xMDAgVGFodW4gIHtDfTE1MC4wMDB7UX0KIHwKe3dhcn1NZXRob2QgUGVtYmF5YXJhbgogfAogfC0tRGFuYSAoIHtVfTA4MzE0MzU2NTQ3MCB7UX0pCiB8LS1Pdm8gICgge1V9MDgzMTQzNTY1NDcwIHtRfSkKIHwKe3dhcn1JbmZvcm1hc2kvS29udGFrCiB8CiB8LS1XaGF0c2FwcCAoIHtVfTA4MzE0MzU2NTQ3MCB7UX0pCiB8LS1UZWxlZ3JhbSAoIHtVfTA4MzE0MzU2NTQ3MCB7UX0pIiIiKQoKCW5vX3dhID0gIjYyODMxNDM1NjU0NzAiCgoJdXJsX3dhID0gKCJodHRwczovL2FwaS53aGF0c2FwcC5jb20vc2VuZD9waG9uZT0iK25vX3dhKyImdGV4dD0iKSAjIFVCQUggTk9NT1IgSFAgS0FNVQoJdGtzID0gKCJIYWxvIEthaywgU2F5YSBQZW5nZ3VuYSBTY3JpcHQgKkptYmYqXG5TYXlhIE1hdSBCZWxpIEtleS9MaWNlbnNlIEtha1xuS2V5L0xpY2Vuc2UgOiAqIitpZDErIioiKQoJc3VicHJvY2Vzcy5jaGVja19vdXRwdXQoWyJhbSIsICJzdGFydCIsIHVybF93YSt0a3NdKQoJc3lzLmV4aXQoKQpkZWYgY2VrX3RnbCgpOiAgIyBDSEVDSyBUQU5HR0FMIEtPTlRPTAoJZ2xvYmFsIGluZm9uYQoJdHJ5OgoJCWlkMSA9IG9wZW4oIi5kYXRhbWUxIiwgInIiKS5yZWFkKCkKCQlpZGwgPSBvcGVuKCIuZGF0YW1lMSIsICJyIikucmVhZCgpCglleGNlcHQ6CgkJa29uZm8oKQoJZ2lnID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dpdGh1Yi5jb20vU2hhbmltei96eHh4MTIzL3RyZWUvbWFpbiIpLnRleHQuc3RyaXAoKQoJaWYgaWRsIGluIGdpZzoKCQlqb2sgPSBnaWcuc3BsaXQoaWRsKyJ8IikKCQlqb2trID0gKCIlcyIlKGpva1sxXSkpCgkJam9ra2sgPSBqb2trLnNwbGl0KCI8IikKCQl3YWsgPSBqb2tra1swXQoJCWphYSA9IG9wZW4oIi5kYXRhbWUyIiwgInciKQoJCWphYS53cml0ZSh3YWspCgkJamFhLmNsb3NlKCkKCQl3YWtfID0gb3BlbigiLmRhdGFtZTIiLCAiciIpLnJlYWQoKS5zcGxpdCgpCgllbHNlOgoJCWtvbmZvKCkKCXRyeToKCQl0Z2wgPSBkYXRldGltZS5ub3coKQoJCWJsbiA9IHRnbC5tb250aAoJCXRobiA9IHRnbC55ZWFyCgkJZGF5ID0gdGdsLmRheQoJCW11bGFpID0gZGF0ZXRpbWUoaW50KHdha19bMF0pLCBpbnQod2FrX1sxXSksIGludCh3YWtfWzJdKSkKCQlzZWxlcyA9IGRhdGV0aW1lKHRobiwgYmxuLCBkYXkpCgkJc2lzYSA9IG11bGFpIC0gc2VsZXMKCQlsaW1fZGV2X2lkID0gc3RyKHNpc2EpLnNwbGl0KClbMF0KCQlpZiAiS0lLWSIgaW4gIiI6CgkJCWluZm9uYSA9IChRKyJbIitDKyIrKyIrUSsiXSIrUSsiIFByZW1pdW0gOiAiK0krIlVsdGltYXRlL1RpZGFrIEhhYmlzwrIiK1EpCgkJCWphbGFuKGluZm9uYSk7dGltZS5zbGVlcCgyKQoJCQlyZXR1cm4gaW5mb25hCgkJZWxzZToKCQkJaW5mb25hID0gKFErIlsiK0MrIisrIitRKyJdIitRKyIgUHJlbWl1bSA6ICIrSStsaW1fZGV2X2lkKyIgSGFyaSBMYWdpIikKCQkJamFsYW4oaW5mb25hKTt0aW1lLnNsZWVwKDIpCgkJCXJldHVybiBpbmZvbmEKCQkJaWYgIjoiIGluIHN0cihsaW1fZGV2X2lkKSBvciAiLSIgaW4gc3RyKGxpbV9kZXZfaWQpOgoJCQkJZXhpdChqYWxhbih3YXIrIlNpbGFoa2FuIEh1YnVuZ2kgQXRob3VyIFVudHVrIE1lbXBlcnBhbmphbmdhbmthbiBMaWNlbnNlICEgIikpCgkJCQlzeXMuZXhpdCgpCglleGNlcHQ6CgkJdHJ5Om9zLnJlbW92ZSgiLmRhdGFtZTEiKQoJCWV4Y2VwdDpwYXNzCgkJdHJ5Om9zLnJlbW92ZSgiLmRhdGFtZTIiKQoJCWV4Y2VwdDpwYXNzCgkJZXhpdChqYWxhbigiTWFhZiBMaWNlbnNlIEFuZGEgQmVsdW0gVGVyZGFmdGFyIERpRGF0YSBCYXNlIEptYmYiKSkgI2VkaXQgbWVuamFkaSBrYXRhIGxpY2Vuc2UgYW5kYSBiZWx1bSBkaWtvbmZpcm1hc2loICEhIChhbmFrIGtvbnRvbCkKCQlzeXMuZXhpdCgpCgkJZXhpdCgpCgoKI2J1YXRfdGdsKCkKCmlmICJBTkFLIEtPTlRPTCwgU0FNQSBBSkEgTUFDQU0gSEFLSUtJIiA9PSBhbmFrX2hha2lraV9hamc6CglpZiBsZW4oc3lzLmFyZ3YpID09IDI6CgkJaWYgc3lzLmFyZ3ZbMV0gPT0gJ2Fwayc6CgkJCWNla19pbmZvX3ZpYV9rdWtpcygpCgkJCWV4aXQoKQojCQllbGlmIHN5cy5hcmd2WzFdID09ICcnOgoJCWVsc2U6CgkJCXByaW50KHdhcisiSG93IHRvIFVzZSBTZWNyZXQgQ29kZSAiKQoJCQlleGl0KGlucCsiVHlwZSA6IHB5dGhvbiBqbWJmLnB5IChjb21tZW5kKSIpCgl0cnk6Y2VrX3Rva190b2soKQoJZXhjZXB0OnBhc3MKCXRyeTpvcy5zeXN0ZW0oImdpdCBwdWxsIik7bWVudSgpO2V4aXQoKQoJZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yOmphbGFuKHdhcisiSmFyaW5nYW4gQWRhIE1hdGkhISEiKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnByaW50KHdhcisiRXJyb3IgOiAlcyIlKGUpKQ=="))